<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>pmp</title>
    <link href="/posts/2be6d594.html"/>
    <url>/posts/2be6d594.html</url>
    
    <content type="html"><![CDATA[<p>2020-09-26-PMP <span id="more"></span></p>]]></content>
    
    
    <categories>
      
      <category>PMP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PMP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pyData</title>
    <link href="/posts/62a7ad9d.html"/>
    <url>/posts/62a7ad9d.html</url>
    
    <content type="html"><![CDATA[<p>2020-09-23-pyData <span id="more"></span></p><h3 id="一环境搭建">一、环境搭建</h3><p>pip常用命令</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#查找模块</span><br>pip search &lt;包名&gt;<br><span class="hljs-comment">#安装/更新/卸载模块</span><br>pip install -r requirements.txt -i SOURCE<br>    pip install / uninstall &lt;包名&gt;<br>    pip install -U &lt;包名&gt;<br><span class="hljs-comment">#列出已安装模块</span><br>    pip freeze &gt;requirements.txt<span class="hljs-comment">#导出模块清单</span><br>    pip <span class="hljs-built_in">list</span><br><br><span class="hljs-comment">#指定全局安装源</span><br><span class="hljs-comment">##在unix和macos，配置文件为：$HOME/.pip/pip.conf</span><br><span class="hljs-comment">##在windows上，配置文件为：%HOME%\pip\pip.ini</span><br>    <span class="hljs-comment">## 阿里源</span><br>    [<span class="hljs-keyword">global</span>]<br>    timeout = <span class="hljs-number">6000</span><br>    index-url = http://mirrors.aliyun.com/pypi/simple/<br>    trusted-host = mirrors.aliyun.com<br><span class="hljs-comment">## 豆瓣源</span><br>[<span class="hljs-keyword">global</span>]<br>    timeout = <span class="hljs-number">6000</span><br>index-url = http://pypi.douban.com/simple<br>trusted-host = pypi.douban.com<br><span class="hljs-comment">#解决 ModuleNotFoundError: No module named &#x27;pip&#x27;</span><br>python -m ensurepip<br>python -m pip install --upgrade pip <br>python -m pip install --upgrade setuptools<br><span class="hljs-comment">#源</span><br><span class="hljs-comment">##豆瓣 http://pypi.douban.com/ </span><br><span class="hljs-comment">##中国科学技术大 http://pypi.mirrors.ustc.edu.cn/simple/ </span><br><span class="hljs-comment">##清华：https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="hljs-comment">##阿里云：http://mirrors.aliyun.com/pypi/simple/</span><br></code></pre></td></tr></table></figure><h4 id="安装virtualenv-与virtualenvwrapper-win模块">安装virtualenv与virtualenvwrapper-win模块</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py">pip3 install virtualenv<br>pip3 install virtualenvwrapper-win<br><br>WORKON_HOME<br>Path:<br></code></pre></td></tr></table></figure><h4 id="常用命令">常用命令</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">mkvirtualenv pyData<span class="hljs-comment">#创建虚拟环境</span><br>lsvirtualenv / workon<span class="hljs-comment">#查看虚拟环境</span><br>workon pyData<span class="hljs-comment">#进入虚拟环境</span><br>rmvirtualenv pyData<span class="hljs-comment">#删除虚拟环境</span><br>deactivate<span class="hljs-comment">#停止 虚拟环境</span><br></code></pre></td></tr></table></figure><h3id="二数据可视化库matplotlib快速入门">二、数据可视化库Matplotlib快速入门</h3><h3 id="三科学计算库numpy快速入门">三、科学计算库NumPy快速入门</h3><h3 id="五数据分析库pandas快速入门">五、数据分析库Pandas快速入门</h3><h3 id="六python爬虫">六、Python爬虫</h3>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux Tools</title>
    <link href="/posts/df044da8.html"/>
    <url>/posts/df044da8.html</url>
    
    <content type="html"><![CDATA[<p>2019-11-29-LinuxTools <span id="more"></span></p><h2 id="linux-系统观测工具">Linux 系统观测工具</h2><h2 id="系统负载及性能">系统负载及性能</h2><h3 id="uptime">1. uptime</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@192.168.1.161:~<span class="hljs-variable">$uptime</span><br>10:30:06 up 10 days, 19:26,  1 user,  load average: 3.05, 2.81, 2.15<br><br>1、当前时间 10:30:06<br>2、系统已运行的时间 10 days, 19:26<br>3、当前前在线用户 1 user<br>4、平均负载：0.54, 0.40, 0.20，最近1分钟、5分钟、15分钟系统的负载<br>5、load average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了；<br></code></pre></td></tr></table></figure><h3 id="dmesg">2. dmesg</h3><h3 id="top">3. top</h3><ul><li><ahref="https://www.cnblogs.com/zhoug2020/p/6336453.html">top参考</a></li><li><code>系统运行时间和平均负载</code></li><li><code>Tasks — 任务（进程）</code>，系统现在共有137个进程，其中处于运行中的有1个，136个在休眠（sleep），stoped状态的有0个，zombie状态（僵尸）的有0个</li><li><code>CPU 状态</code><ul><li>us, user: 运行(未调整优先级的) 用户进程的CPU时间 √</li><li>sy，system: 运行内核进程的CPU时间 √</li><li>ni，niced: 运行已调整优先级的用户进程的CPU时间</li><li>wa，IO wait: 用于等待IO完成的CPU时间</li><li>hi: 处理硬件中断的CPU时间</li><li>si: 处理软件中断的CPU时间</li><li>st：这个虚拟机被hypervisor偷去的CPU时间（译注：如果当前处于一个hypervisor下的vm，实际上hypervisor也是要消耗一部分CPU处理时间的）</li></ul></li><li><code>内存使用</code><ul><li>第一行是物理内存使用，第二行是虚拟内存使用(交换空间)</li><li>第四行的free + 第四行的buffers + 第五行的cached √</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">top - 10:41:25 up 10 days, 19:37,  1 user,  load average: 0.34, 1.03, 1.56<br>Tasks: 137 total,   1 running, 136 sleeping,   0 stopped,   0 zombie<br>%Cpu(s): 16.6 us,  1.7 sy,  0.0 ni, 81.2 <span class="hljs-built_in">id</span>,  0.3 wa,  0.0 hi,  0.3 si,  0.0 st<br>KiB Mem :  7730168 total,   204536 free,  7324360 used,   201272 buff/cache<br>KiB Swap:  5242876 total,   399728 free,  4843148 used.    81848 avail Mem<br><br>  PID USER PR  NI  VIRT    RES    SHR  S  %CPU %MEM   TIME+   COMMAND<br>21257 xy   20  0   4757972 990552 3384 S  12.0 12.8   3173:53 /opt/xy/java+<br><br>16.6% us — 用户空间占用CPU的百分比；1.7% sy — 内核空间占用CPU的百分比。<br>0.0% ni  — 改变过优先级的进程占用CPU的百分比<br>81.2% <span class="hljs-built_in">id</span> — 空闲CPU百分比<br>0.3% wa — IO等待占用CPU的百分比<br>0.0% hi — 硬中断（Hardware IRQ）占用CPU的百分比<br>0.3% si — 软中断（Software Interrupts）占用CPU的百分比<br></code></pre></td></tr></table></figure><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>d</td><td>指定刷新时间（s）</td></tr><tr><td>M</td><td>按内存占用率显示</td></tr><tr><td>P</td><td>按CPU占用率显示</td></tr><tr><td>T</td><td>按累计时间显示</td></tr><tr><td>c</td><td>切换显示命令名称和完整命令行</td></tr></tbody></table><h3 id="htop">4. htop</h3><h2 id="cpu使用率">CPU使用率</h2><h3 id="vmstatvirtual-meomory-statistic">1. vmstat(Virtual MeomoryStatistic)</h3><blockquote><p>对系统的整体情况进行统计，对系统的整体情况进行统计<br />r经常大于4，id经常少于40，表示<code>cpu的负荷很重</code>;bi，bo长期不等于0，表示<code>内存不足</code>;disk经常不等于0，且在b中的队列大于3，表示<code>io性能不好</code><br /><code>-f,--fork</code> 显示从系统启动至今的fork数量<br /><code>-s</code> 显示内存相关统计信息及多种系统活动数量<br /><code>-d,--disk</code> 查看磁盘的读写</p></blockquote><ul><li>Procs（进程）<ul><li>r: 运行队列中进程数量</li><li>b: 等待IO的进程数量</li></ul></li><li>Memory（内存）<ul><li>swpd: 使用虚拟内存大小</li><li>free: 可用内存大小</li><li>buff: 用作缓冲的内存大小</li><li>cache: 用作缓存的内存大小</li></ul></li><li>Swap<ul><li>si: 每秒从交换区写到内存的大小</li><li>so: 每秒写入交换区的内存大小</li></ul></li><li>IO(现在的Linux版本块的大小为1024bytes）<ul><li>bi: 每秒从块设备接收到的块数，单位：块/秒 也就是读块设备</li><li>bo: 每秒发送到块设备的块数，单位：块/秒 也就是写块设备</li></ul></li><li>系统<ul><li>in: 每秒中断数，包括时钟中断[interrupt]</li><li>cs: 每秒上下文切换数[count/second]</li></ul></li><li>CPU(以百分比表示)<ul><li>us: 用户进程执行时间(user time)</li><li>sy: 系统进程执行时间(system time)</li><li>id: 空闲时间(包括IO等待时间),中央处理器的空闲时间,以百分比表示</li><li>wa: 等待IO时间</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@192.168.1.161:~<span class="hljs-variable">$vmstat</span> 5 5  <span class="hljs-comment"># 5s内采集5个样本</span><br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br>r  b   swpd   free   buff  cache   si   so    bi    bo   <span class="hljs-keyword">in</span>   cs us sy <span class="hljs-built_in">id</span> wa st<br>4  0 4216792 187800      0 212148   88   40   746    84    9    4 10  2 86  2  0<br><br>root@192.168.1.161:~<span class="hljs-variable">$vmstat</span> -a 2 5  <span class="hljs-comment"># -a,--active</span><br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br>r  b   swpd   free  inact active   si   so    bi    bo   <span class="hljs-keyword">in</span>   cs us sy <span class="hljs-built_in">id</span> wa st<br>1  0 4215656 196520 1385284 5829956   88   40   746    84    9    5 10  2 86  2  0<br></code></pre></td></tr></table></figure><h3 id="mpstat">2. mpstat</h3><blockquote><p>主要用于多CPU环境下，它显示各个可用CPU的状态<br />mpstat -P CPU 时间间隔 采集次数</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@192.168.1.161:~<span class="hljs-variable">$mpstat</span> -P ALL<br>Linux 3.10.0-693.el7.x86_64 (centos) 2019年11月29日 _x86_64_(4 CPU)<br><br>12时10分00秒  CPU    %usr   %<span class="hljs-built_in">nice</span>    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>12时10分00秒  all    9.62    0.00    1.44    2.34    0.00    0.35    0.01    0.00    0.00   86.24<br></code></pre></td></tr></table></figure><h3 id="sarsystem-activity-reporter">3. sar(System ActivityReporter)</h3><blockquote><p><a href="https://blog.51cto.com/11555417/2138903">参考sar</a><br />sar [options][-o file] [t] [n]<br />t为采样间隔，n为采样次数，默认值是1；</p></blockquote><ul><li>%nice：显示在用户级别，用于nice操作，所占用 CPU 总时间的百分比</li><li>%steal：管理程序(hypervisor)为另一个虚拟进程提供服务而等待虚拟 CPU的百分比。</li><li>%idle：显示 CPU 空闲时间占用 CPU 总时间的百分比。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@192.168.1.161:~<span class="hljs-variable">$sar</span> -u -o <span class="hljs-built_in">test</span> 10 3  <span class="hljs-comment"># 周期 次数</span><br>Linux 3.10.0-693.el7.x86_64 (centos) 2019年11月29日 _x86_64_(4 CPU)<br><br>12时16分46秒     CPU     %user     %<span class="hljs-built_in">nice</span>   %system   %iowait    %steal     %idle<br>12时16分56秒     all     12.16      0.00      1.90      5.22      0.00     80.72<br><br>root@192.168.1.161:~<span class="hljs-variable">$sar</span> -u -f <span class="hljs-built_in">test</span><span class="hljs-comment"># 查看  </span><br></code></pre></td></tr></table></figure><h3 id="pidstat">4. pidstat</h3><blockquote><p>主要用于监控全部或指定进程占用系统资源的情况，如CPU，内存、设备IO、任务切换、线程等<br />cpu使用情况统计(-u)<br />内存使用情况统计(-r) IO情况统计(-d)</p></blockquote><h3 id="dstat">5. dstat</h3><blockquote><p>综合了vmstat，iostat，ifstat，netstat<br />dstat [option] [time] [count]<br />常用选项：-l,–load; -m,–memory; -tcp</p></blockquote><h2 id="内存使用率">内存使用率</h2><ul><li>free -m</li></ul><h2 id="进程">进程</h2><ul><li>vmstat 1：查看进程是否阻塞（r）</li><li>pidstat 1：查看每个进程的情况”</li></ul><h2 id="磁盘io">磁盘IO</h2><ul><li>iostat -xzm 1</li></ul><h2 id="网络io">网络IO</h2><ul><li>sar -n DEV 1</li><li>sar -n TCP,ETCP 1</li></ul><h3 id="磁盘扩容">6. 磁盘扩容</h3><ul><li><code>df -h</code> # 查看分区空间使用情况<code>-T</code>,显示<strong>文件系统</strong>类型<ul><li><code>parted -l</code></li><li><code>lsblk -f</code></li><li><code>file -s /dev/sda1</code></li></ul></li><li><code>du -sh *</code> # 查看文件所占用大小</li><li><code>fdisk -l</code> # 查看磁盘</li></ul><h4 id="新增加的磁盘">6.1 新增加的磁盘</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@anyue ~]# pvs             <span class="hljs-comment"># 查看新增加的盘</span><br>[root@anyue ~]# fdisk /dev/sdb  <span class="hljs-comment"># 建立新分区更改类型为8e</span><br>[root@anyue ~]# mkfs.ext4 /dev/sdb1<br>[root@anyue ~]# pvcreate /dev/sdb1      <span class="hljs-comment"># pvscan</span><br>[root@anyue ~]# vgextend VolGroup /dev/sdb1     <span class="hljs-comment"># 当前需要扩容的LVM的组名，通过lvs查看</span><br>[root@anyue ~]# lvextend -L +20G /dev/mapper/VolGroup-lv_root <br>[root@anyue ~]# resize2fs -p /dev/mapper/VolGroup-lv_root<br></code></pre></td></tr></table></figure><h4 id="从其他分区获得空间home-299g">6.2 从其他分区获得空间,/home299G</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@anyue ~]# umount /home    <span class="hljs-comment"># 提到无法卸载，fuser -m /home</span><br>[root@anyue ~]# e2fsck -f /dev/mapper/VolGroup-lv_home<br>[root@anyue ~]# resize2fs -p /dev/mapper/VolGroup-lv_home 279G<br>[root@anyue ~]# mount /home     <span class="hljs-comment"># 此时可查看 df -h /home</span><br>[root@anyue ~]# lvreduce -L 279G /dev/mapper/VolGroup-lv_home   <span class="hljs-comment"># -L,减小到20G；-l,减小20G；+</span><br>[root@anyue ~]# lvextend -L +20G /dev/mapper/VolGroup-lv_root<br>[root@anyue ~]# resize2fs -p /dev/mapper/VolGroup-lv_root  <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SPL</title>
    <link href="/posts/546a1914.html"/>
    <url>/posts/546a1914.html</url>
    
    <content type="html"><![CDATA[<p>2019-11-20-SPL <span id="more"></span></p><h2 id="堆-栈-队列">堆 栈 队列</h2><h3 id="参考">参考</h3><ul><li><p><ahref="https://www.cnblogs.com/guoxiaoyan/p/8664150.html">参考1</a></p></li><li><p><ahref="https://www.cnblogs.com/hedeyong/p/7841548.html">参考2</a></p></li><li><p><ahref="https://www.cnblogs.com/jinbang/p/8658708.html">参考3</a></p></li><li><p>堆：</p><ul><li>堆是在<code>程序运行</code>时，而不是在程序编译时，申请某个大小的内存空间。即动态分配内存，对其访问和对一般内存的访问没有区别。</li><li>堆是应用程序在运行的时候请求操作系统<code>分配给自己内存</code>，一般是申请/给予的过程。</li><li>堆是指程序运行时申请的动态内存，而栈只是指一种使用堆的方法(即先进后出)。</li></ul></li><li><p>堆区：由程序员分配释放，若程序员不释放，程序结束时可能有OS回收（引用类型值）。</p></li><li><p>栈：</p><ul><li>一种运算受限的线性表。其限制是仅允许在表的一端进行插入和删除运算。这一端被称为栈顶，相对地，把另一端称为栈底。</li><li>栈就是一个桶，后放进去的先拿出来，它下面本来有的东西要等它出来之后才能出来（<code>先进后出</code>）。</li><li>栈(Stack)是操作系统在建立某个进程时或者线程（在支持多线程的操作系统中是线程）为这个线程建立的存储区域。</li></ul></li><li><p>栈区：由<code>编辑器自动分配释放</code>，存放函数的<code>参数值，局部变量</code>的值等（基本类型值）。</p></li><li><p>队列：</p><ul><li>队列是一种特殊的线性表，特殊之处在于它只允许在表的<code>前端（front）进行删除操作</code>，而在<code>表的后端（rear）进行插入操作</code>，和栈一样，队列是一种操作受限制的线性表。进行删除操作的端称为队头，进行插入操作的端称为队尾。</li><li>队列中没有元素时，称为空队列。</li><li>建立顺序队列结构必须为其静态分配或动态申请一片连续的存储空间，并设置两个指针进行管理。一个是队头指针front，它指向队头元素；另一个是队尾指针rear，它指向下一个入队元素的存储位置。</li><li>队列采用的FIFO(first in firstout)，新元素（等待进入队列的元素）总是被插入到链表的尾部，而读取的时候总是从链表的头部开始读取。每次读取一个元素，释放一个元素。所谓的动态创建，动态释放。因而也不存在溢出等问题。由于链表由结构体间接而成，遍历也方便。（先进先出）</li></ul></li><li><p>堆栈的特性：</p><ul><li>堆本身就是栈，最后一个放入堆栈中的物体总是被最先拿出来，这个特性通常称为后进先出(LIFO)队列。</li><li>堆栈中定义了一些操作，两个最重要的是PUSH和POP。PUSH操作在堆栈的顶部加入一个元素。POP操作相反，在堆栈顶部移去一个元素，并将堆栈的大小减一。</li></ul></li></ul><h3 id="链表">链表</h3><ul><li>链表中每一个元素都是一个对象，每个对象称为一个<code>节点</code>，包含有<code>数据域key和指向下一个节点的指针next</code>。通过各个节点之间的相互连接，最终串联成一个链表。</li></ul><h2 id="关于spl">关于SPL</h2><h3 id="splsearch-process-language搜索处理语言">SPL:Search ProcessLanguage(搜索处理语言)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">AND</span> <span class="hljs-keyword">OR</span> () <span class="hljs-keyword">NOT</span> <br>通配符：<span class="hljs-string">&#x27;* ? []&#x27;</span><br>field:[x <span class="hljs-keyword">TO</span> y]<br><br>cat <span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>log<span class="hljs-operator">/</span>messages <span class="hljs-operator">|</span>grep Error <span class="hljs-operator">|</span>awk <span class="hljs-string">&#x27;&#123;print substr($3,1,5)&#125;&#x27;</span> <span class="hljs-operator">|</span>sort <span class="hljs-operator">|</span>uniq <span class="hljs-operator">-</span>c <span class="hljs-operator">|</span>sort <span class="hljs-operator">-</span>nr <span class="hljs-operator">|</span>head <span class="hljs-number">10</span> <br>source:&quot;/var/log/messages&quot; Error <span class="hljs-operator">|</span>bucket <span class="hljs-type">timestamp</span> sapn<span class="hljs-operator">=</span><span class="hljs-number">1</span>m <span class="hljs-keyword">as</span> ts <span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">by</span> ts <span class="hljs-operator">|</span>sort <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;count()&#x27;</span> <span class="hljs-operator">|</span>limit <span class="hljs-number">10</span> <br></code></pre></td></tr></table></figure><h3 id="常用命令">常用命令</h3><h4 id="stats">stats</h4><blockquote><p>提供统计信息，可以选择按照<code>字段分组</code>(单值统计)<br />* count() – 返回字段出现次数，统计事件数 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL"># 统计ip和stats的组合的事件数量<br>logtype:apache <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">by</span> apache.clientip,apache.status<br></code></pre></td></tr></table></figure></p></blockquote><ul><li><p>avg() – 返回字段平均值 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SQL"># 统计平均值<br>logtype:apache <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">avg</span>(apache.resp_len) <span class="hljs-keyword">as</span> avg_resp_len <span class="hljs-keyword">by</span> apache.request_path <br><span class="hljs-operator">|</span>rename avg_resp_len <span class="hljs-keyword">as</span> &quot;平均响应长度&quot;<br></code></pre></td></tr></table></figure></p></li><li><p>sum() <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL"># 统计日志量<br><span class="hljs-operator">*</span> <span class="hljs-operator">|</span>stats <span class="hljs-built_in">sum</span>(raw_message_length) <span class="hljs-keyword">as</span> byte <br><span class="hljs-operator">|</span>eval Mb<span class="hljs-operator">=</span>byte<span class="hljs-operator">/</span><span class="hljs-number">1024</span><span class="hljs-operator">/</span><span class="hljs-number">1024</span><br></code></pre></td></tr></table></figure></p></li><li><p>max()</p></li><li><p>min()</p></li><li><p>dc() – 返回字段唯一个数，去重，<code>dedup field</code></p></li></ul><h4 id="bucket">bucket</h4><blockquote><p>将字段连续的值放到离散的数据桶中，可用于后续的stats等命令分组字段中<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">/*每1小时跨度内每个hostname的apache.resp_len平均值*/</span><br>logtype:apache <br><span class="hljs-operator">|</span>bucket <span class="hljs-type">timestamp</span> span<span class="hljs-operator">=</span><span class="hljs-number">1</span>h <span class="hljs-keyword">as</span> ts <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">avg</span>(apache.resp_len) <span class="hljs-keyword">by</span> hostname,ts <br><span class="hljs-operator">|</span>eval ts_human<span class="hljs-operator">=</span>foramtdate(ts)<br><span class="hljs-comment">/******/</span><br><span class="hljs-comment">/*返回apache.status为100-200，200-400，400以上的apache.status事件数*/</span><br>logtype:apache <br><span class="hljs-operator">|</span>bucket apache.status ranges<span class="hljs-operator">=</span>((<span class="hljs-number">100</span>,<span class="hljs-number">200</span>),(<span class="hljs-number">200</span>,<span class="hljs-number">400</span>),(<span class="hljs-number">400</span>,)) <span class="hljs-keyword">as</span> rs <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(apache.status) <span class="hljs-keyword">by</span> rs<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="rename">rename</h4><blockquote><p>重命名指定字段，支持对多字段同时进行重命名用<code>,</code>分开，支持通配符<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SQL">logtype:apache <br><span class="hljs-operator">|</span>rename apache.clientip <span class="hljs-keyword">as</span> &quot;ip地址&quot;<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="eval">eval</h4><blockquote><p>计算表达式并将生成值放到新的字段中，存在将覆盖<br />常用函数：todouble()、formatdate(timestamp,“HH:mm”)<br />* 根据响应时间获取short,middle,long三个分类值 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs SQL">logtype:apache <br><span class="hljs-operator">|</span>eval length<span class="hljs-operator">=</span><span class="hljs-keyword">case</span>(apache.resp_len<span class="hljs-operator">&lt;</span><span class="hljs-number">1500</span>,&quot;short&quot;,apache.resp_len<span class="hljs-operator">&gt;</span><span class="hljs-number">2000</span>,&quot;long&quot;,<span class="hljs-keyword">default</span>,&quot;middle&quot;) <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(<span class="hljs-keyword">desc</span>) <span class="hljs-keyword">by</span> <span class="hljs-keyword">desc</span><br><span class="hljs-comment">/********************************/</span><br><br>logtype:apache <br><span class="hljs-operator">|</span>eval <span class="hljs-keyword">desc</span><span class="hljs-operator">=</span>if(apache.status<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-number">20</span>,&quot;OK&quot;,&quot;Error&quot;) <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(<span class="hljs-keyword">desc</span>) <span class="hljs-keyword">by</span> <span class="hljs-keyword">desc</span><br><span class="hljs-comment">/********************************/</span><br>logtype apache <br><span class="hljs-operator">|</span>eval <span class="hljs-type">int</span> status<span class="hljs-operator">=</span>tolong(apache.status)<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="fileds">fileds</h4><blockquote><p>保留搜索结果中的字段，支持通配<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL">logtype:apache <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">by</span> appname,hostname <br><span class="hljs-operator">|</span>fields appname,hostname<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="table">table</h4><blockquote><p>将查询结果以表格形式展示，并对字段进行筛选，若不包含空行显示，支持通配符<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-operator">*</span> <span class="hljs-operator">|</span><span class="hljs-keyword">table</span> apache.status,apache.method<br><span class="hljs-comment">/*****/</span>  <br>appname:nginx <span class="hljs-keyword">AND</span> nginx.request_time:<span class="hljs-operator">*</span> <br><span class="hljs-operator">|</span>eval new_reuqest_time<span class="hljs-operator">=</span>todouble(nginx.request_time) <br><span class="hljs-operator">|</span><span class="hljs-keyword">table</span> nginx.client_ip.geo.ip,nginx.client_ip.geo.isp,nginx.client_ip.gep.province<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="makeresults">makeresults</h4><blockquote><p>构造指定的结果<br />* 产生一条结果并生成新的app字段，用于后续map命令 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-operator">*</span> <span class="hljs-operator">|</span> makeresults count<span class="hljs-operator">=</span><span class="hljs-number">1</span> <br><span class="hljs-operator">|</span>eval app<span class="hljs-operator">=</span>&quot;zookeeper&quot; <br><span class="hljs-operator">|</span>map &quot;* appname:$app$&quot;<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="where">where</h4><blockquote><p>使用表达式对结果进行过滤<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL">logtype:apache <span class="hljs-keyword">AND</span> apache.geo.city:&quot;深圳市&quot; <br><span class="hljs-operator">|</span>stats dc(apache.clientip) <span class="hljs-keyword">as</span> dc_count <span class="hljs-keyword">by</span> apache.request_path <br><span class="hljs-operator">|</span><span class="hljs-keyword">where</span> dc_count<span class="hljs-operator">&gt;</span><span class="hljs-number">40</span> <span class="hljs-operator">&amp;&amp;</span> dc_count<span class="hljs-operator">&lt;</span><span class="hljs-number">100</span><br></code></pre></td></tr></table></figure></p></blockquote><h4 id="top">top</h4><blockquote><p>获取字段出现次数前N的值集合<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-operator">*</span> <span class="hljs-operator">|</span>top <span class="hljs-number">5</span> nginx.client_ip.geo.province<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="limit">limit</h4><blockquote><p>返回前n个结果<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SQL">logtype:apache <span class="hljs-operator">|</span>limit <span class="hljs-number">2</span><br><span class="hljs-comment">/*******/</span><br>logtype:apache <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">by</span> apache.clientip <br><span class="hljs-operator">|</span>limit <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure></p></blockquote><h4 id="sort">sort</h4><blockquote><p>按照指定字段对搜索结果排序，+升序，-降序<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SQL">logtype:apache <span class="hljs-operator">|</span>sort <span class="hljs-keyword">by</span> <span class="hljs-operator">+</span><span class="hljs-type">timestamp</span><br><span class="hljs-comment">/********/</span><br>logtype:apache <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(apache.clientip) <span class="hljs-keyword">as</span> ip_count <span class="hljs-keyword">by</span> appname <br><span class="hljs-operator">|</span>sort <span class="hljs-keyword">by</span> <span class="hljs-operator">-</span>ip_count<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="join">join</h4><blockquote><p>对父管道结果和子管道结果进行类似SQL的join，关联分析<br />type=left/inner (取左/取并)<br />* 统计昨天每个小时每个IP的事件数占当前这个小时总数的百分比<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs SQL">logtype:apache <br><span class="hljs-operator">|</span>bucket <span class="hljs-type">timestamp</span> span<span class="hljs-operator">=</span><span class="hljs-number">1</span>h <span class="hljs-keyword">as</span> ts <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">as</span> ip_count <span class="hljs-keyword">by</span> apache.clientip,ts <br><span class="hljs-operator">|</span><span class="hljs-keyword">join</span> type<span class="hljs-operator">=</span><span class="hljs-keyword">left</span> ts [[ <br>  logtype:apache <br>  <span class="hljs-operator">|</span>bucket <span class="hljs-type">timestamp</span> span<span class="hljs-operator">=</span><span class="hljs-number">1</span>h <span class="hljs-keyword">as</span> ts <br>  <span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">as</span> hour_count <span class="hljs-keyword">by</span> ts<br>  ]] <br><span class="hljs-operator">|</span>eval ippercent<span class="hljs-operator">=</span><span class="hljs-number">100</span><span class="hljs-operator">*</span>ip_count<span class="hljs-operator">/</span>hour_count<br></code></pre></td></tr></table></figure></p></blockquote><ul><li>按照运营商ISP统计总数，status：400-499数量及占比，status：500-599数量及占比，请求长度大于1000数量及占比，形成一张统计表<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs SQL">logtype:apache <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(logtype) <span class="hljs-keyword">as</span> count_all <span class="hljs-keyword">by</span> apache.geo.isp <br><span class="hljs-operator">|</span>sort <span class="hljs-keyword">by</span> count_all <br><span class="hljs-operator">|</span>limit <span class="hljs-number">5</span><br><span class="hljs-comment">/**************/</span><br>logtype:apache <span class="hljs-keyword">AND</span> apache.status:[<span class="hljs-number">400</span> <span class="hljs-keyword">TO</span> <span class="hljs-number">499</span>] <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(logtype) <span class="hljs-keyword">as</span> count_400 <span class="hljs-keyword">by</span> apache.geo.isp<br><span class="hljs-comment">/**************/</span><br>logtype:apache <span class="hljs-keyword">AND</span> apache.status:[<span class="hljs-number">500</span> <span class="hljs-keyword">TO</span> <span class="hljs-number">599</span>] <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(logtype) <span class="hljs-keyword">as</span> count_500 <span class="hljs-keyword">by</span> apache.geo.isp<br><span class="hljs-comment">/**************/</span><br>logtype:apache <span class="hljs-keyword">AND</span> apache.resp_len<span class="hljs-operator">&gt;</span><span class="hljs-number">1000</span> <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(logtype) <span class="hljs-keyword">as</span> len_1000 <span class="hljs-keyword">by</span> apache.geo.isp<br><span class="hljs-comment">/**************/</span><br>logtype:apache <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(logtype) <span class="hljs-keyword">as</span> count_all <span class="hljs-keyword">by</span> apache.geo.isp <br><span class="hljs-operator">|</span>sort <span class="hljs-keyword">by</span> count_all <br><span class="hljs-operator">|</span>limit <span class="hljs-number">5</span> <br><span class="hljs-operator">|</span><span class="hljs-keyword">join</span> type<span class="hljs-operator">=</span><span class="hljs-keyword">left</span> apache.geo.isp [[ <br>  logtype:apache <span class="hljs-keyword">AND</span> apache.status:[<span class="hljs-number">400</span> <span class="hljs-keyword">TO</span> <span class="hljs-number">499</span>] <br>  <span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(logtype) <span class="hljs-keyword">as</span> count_400 <span class="hljs-keyword">by</span> apache.geo.isp<br>  ]]  <br><span class="hljs-operator">|</span><span class="hljs-keyword">join</span> type<span class="hljs-operator">=</span><span class="hljs-keyword">left</span> apache.geo.isp [[ <br>  logtype:apache <span class="hljs-keyword">AND</span> apache.status:[<span class="hljs-number">500</span> <span class="hljs-keyword">TO</span> <span class="hljs-number">599</span>] <br>  <span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(logtype) <span class="hljs-keyword">as</span> count_500 <span class="hljs-keyword">by</span> apache.geo.isp<br>  ]] <br><span class="hljs-operator">|</span><span class="hljs-keyword">join</span> type<span class="hljs-operator">=</span><span class="hljs-keyword">left</span> apache.geo.isp [[<br>  logtype:apache <span class="hljs-keyword">AND</span> apache.resp_len<span class="hljs-operator">&gt;</span><span class="hljs-number">1000</span> <br>  <span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(logtype) <span class="hljs-keyword">as</span> len_1000 <span class="hljs-keyword">by</span> apache.geo.isp<br>  ]]<br></code></pre></td></tr></table></figure></li></ul><h4 id="append">append</h4><blockquote><p>将子管道结果附加在主管道结果之后，可以将不同类型数据进行关联分析，子查询*主管道统计大前天的平均响应值，append命令中子管道统计昨天的平均值，其结果合并在一张表中<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs SQL">starttime<span class="hljs-operator">=</span>&quot;-3d/d&quot; endtime<span class="hljs-operator">=</span>&quot;-2d/d&quot; <span class="hljs-operator">*</span> <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">avg</span>(apache.resp_len) <br><span class="hljs-operator">|</span>eval <span class="hljs-keyword">day</span><span class="hljs-operator">=</span>&quot;the day before yesterday&quot; <br><span class="hljs-operator">|</span>append [[<br>  starttime<span class="hljs-operator">=</span>&quot;-1d/d&quot; endtime<span class="hljs-operator">=</span>&quot;now/d&quot; <span class="hljs-operator">*</span> <br>  <span class="hljs-operator">|</span>stats <span class="hljs-built_in">avg</span>(apache.resp_len) <br>  <span class="hljs-operator">|</span>eval <span class="hljs-keyword">day</span><span class="hljs-operator">=</span>&quot;yesterday&quot;<br>  ]]<br><span class="hljs-comment">/**************/</span><br>starttime<span class="hljs-operator">=</span>&quot;-1d/d endtime=now/d&quot; <br><span class="hljs-operator">|</span>bucket <span class="hljs-type">timestamp</span> span<span class="hljs-operator">=</span><span class="hljs-number">1</span>h <span class="hljs-keyword">as</span> ts <br><span class="hljs-operator">|</span>eval <span class="hljs-type">time</span><span class="hljs-operator">=</span>formatdate(ts,&quot;HH&quot;) <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">as</span> _count <span class="hljs-keyword">by</span> <span class="hljs-type">time</span> <br><span class="hljs-operator">|</span>eval <span class="hljs-keyword">group</span><span class="hljs-operator">=</span>&quot;yesterday&quot; <br><span class="hljs-operator">|</span>append [[<br>  starttime<span class="hljs-operator">=</span>&quot;now/d endtime=now&quot; <br>  <span class="hljs-operator">|</span>bucket <span class="hljs-type">timestamp</span> span<span class="hljs-operator">=</span><span class="hljs-number">1</span>h <span class="hljs-keyword">as</span> ts <br>  <span class="hljs-operator">|</span>eval <span class="hljs-type">time</span><span class="hljs-operator">=</span>formatdate(ts,&quot;HH&quot;) <br>  <span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">as</span> _count <span class="hljs-keyword">by</span> <span class="hljs-type">time</span> <br>  <span class="hljs-operator">|</span>eval <span class="hljs-keyword">group</span><span class="hljs-operator">=</span>&quot;today&quot;<br>  ]]<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="autoregress">autoregress</h4><blockquote><p>一般用作行与行之间的值计算，计算指标数据，如环比， *按小时统计事件数，并计算出当前小时和上个小时的事件变化率<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-operator">*</span> <span class="hljs-operator">|</span>bucket <span class="hljs-type">timestamp</span> span<span class="hljs-operator">=</span><span class="hljs-number">1</span>h <span class="hljs-keyword">as</span> ts <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">as</span> count_ <span class="hljs-keyword">by</span> ts <br><span class="hljs-operator">|</span>autoregress count_ <span class="hljs-keyword">as</span> last_count p<span class="hljs-operator">=</span><span class="hljs-number">1</span> <br><span class="hljs-operator">|</span>eval a<span class="hljs-operator">=</span>(last_count<span class="hljs-operator">-</span>count_) <span class="hljs-operator">/</span> count_ <br><span class="hljs-operator">|</span>eval change_rate<span class="hljs-operator">=</span>format(&quot;%.3f%%&quot;,(last_count <span class="hljs-operator">-</span> count_)<span class="hljs-operator">*</span><span class="hljs-number">100</span> <span class="hljs-operator">/</span> count_)<br><span class="hljs-comment">/**************/</span><br>starttime<span class="hljs-operator">=</span>&quot;-2h/h&quot; endtime<span class="hljs-operator">=</span>&quot;now/h&quot; <span class="hljs-operator">*</span> <br><span class="hljs-operator">|</span>bucket <span class="hljs-type">timestamp</span> span<span class="hljs-operator">=</span><span class="hljs-number">10</span>m <span class="hljs-keyword">as</span> ts <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">as</span> count_app <span class="hljs-keyword">by</span> ts \<br><span class="hljs-operator">|</span>eval <span class="hljs-type">time</span><span class="hljs-operator">=</span>formatdate(ts) <br><span class="hljs-operator">|</span>autoregress count_app p<span class="hljs-operator">=</span><span class="hljs-number">3</span><br></code></pre></td></tr></table></figure></p></blockquote><h4 id="lookup">lookup</h4><blockquote><p>外部导入生成新字段 * csv文件字段host,user,department将搜索结果的hostname字段与csv文件的host进行关联<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL">logtype:apache <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">by</span> hostname <br><span class="hljs-operator">|</span>lookup <span class="hljs-keyword">user</span>,department <span class="hljs-operator">/</span>data<span class="hljs-operator">/</span>rizhiyi<span class="hljs-operator">/</span>share<span class="hljs-operator">/</span>host_user.csv <span class="hljs-keyword">on</span> hostname<span class="hljs-operator">=</span>host<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="map">map</h4><blockquote><p>引用上次搜索结果 *列出日志数最多的三种logtype他们各自最大的日志文本长度 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-operator">*</span> <span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">by</span> logtype <br><span class="hljs-operator">|</span>limit <span class="hljs-number">3</span> <br><span class="hljs-operator">|</span>rename logtype <span class="hljs-keyword">as</span> type <br><span class="hljs-operator">|</span>map &quot;logtype:$type$ <br>|stats max(raw_message_length)&quot;<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="parse">parse</h4><blockquote><p>搜索时抽取字段<br />* 从原文中抽取IP地址，得到新的字段ip_addr分组并计算appname的个数<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-operator">*</span> <span class="hljs-operator">|</span>parse &quot;(?&lt;ip_addr&gt;\d+\.\d+\.\d+\.\d+)&quot; <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>(appname) <span class="hljs-keyword">by</span> ip_addr<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="parsedate">parsedate</h4><blockquote><p>时间处理<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-operator">|</span>makeresults count<span class="hljs-operator">=</span><span class="hljs-number">1</span> <br><span class="hljs-operator">|</span>eval pd<span class="hljs-operator">=</span>parsedate(&quot;28/04/2019:12:01:01&quot;,&quot;dd/MM/yyyy:HH:mm:ss&quot;) <br><span class="hljs-operator">|</span>eval fd<span class="hljs-operator">=</span>formatdate(bd,&quot;yyyy/dd/MM HH:mm:ss&quot;)<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="esma智能运维">esma智能运维</h4><blockquote><p>对某一个字段的未来值进行预测<br />* 统计过去一年的每天平均延迟，推测接下来一个月网络延迟<br /><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">* |bucket timestamp <span class="hljs-attribute">span</span>=1d as ts <br>|stats avg(network.latency) as latency by ts <br>|esma latency <span class="hljs-attribute">timefield</span>=ts <span class="hljs-attribute">period</span>=7 <span class="hljs-attribute">futurecount</span>=30<br></code></pre></td></tr></table></figure></p></blockquote><ul><li>主机内存使用预测 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SQL">appname:top_info_system_stats <span class="hljs-keyword">AND</span> ip:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> <br><span class="hljs-operator">|</span>bucket <span class="hljs-type">timestamp</span> span<span class="hljs-operator">=</span><span class="hljs-number">10</span>m <span class="hljs-keyword">as</span> ts <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">avg</span>(json.Mem.used_percent) <span class="hljs-keyword">as</span> mem_use <span class="hljs-keyword">by</span> ts <br><span class="hljs-operator">|</span>esma mem_use timefield<span class="hljs-operator">=</span>ts<br></code></pre></td></tr></table></figure></li></ul><h4 id="movingavg">movingavg</h4><blockquote><p>计算移动平均值<br />*以分钟为单位统计apache返回apache_len长度的和，以10为窗口计算移动平均值，得到每分钟的响应长度和平滑后的值<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SQL">logtype:apache <br><span class="hljs-operator">|</span>bucket <span class="hljs-type">timestamp</span> span<span class="hljs-operator">=</span><span class="hljs-number">1</span>m <span class="hljs-keyword">as</span> ts <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">sum</span>(apache.resp_len) <span class="hljs-keyword">as</span> sum_len <span class="hljs-keyword">by</span> ts <br><span class="hljs-operator">|</span>movingavg sum_len,<span class="hljs-number">10</span> <span class="hljs-keyword">as</span> moving_avg_resp_len<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="rollingavg">rollingavg</h4><blockquote><p>计算移动标准差 *以时间分组算出apache返回的reponse长度的和，以10为窗口计算rolling的标准差，观察resp_len的波动情况<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL">logtype:apache <br><span class="hljs-operator">|</span>stats <span class="hljs-built_in">sum</span>(apache.resp_len) <span class="hljs-keyword">as</span> sum_resp_len <span class="hljs-keyword">by</span> <span class="hljs-type">timestamp</span> <br><span class="hljs-operator">|</span>rollingstd sum_resp_len,<span class="hljs-number">10</span> <span class="hljs-keyword">as</span> resp_len_rolling_std<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="transpose">transpose</h4><blockquote><p>将查询的表格数据进行行列转换<br /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-operator">*</span> <span class="hljs-operator">|</span>stats <span class="hljs-built_in">count</span>() <span class="hljs-keyword">as</span> cnt <span class="hljs-keyword">by</span> apache.method,apache.status <br><span class="hljs-operator">|</span>transpose <span class="hljs-type">row</span><span class="hljs-operator">=</span>apache.method <span class="hljs-keyword">column</span><span class="hljs-operator">=</span>apache.status valuefield<span class="hljs-operator">=</span>cnt<br></code></pre></td></tr></table></figure></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>SPL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SPL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zookeeper和Kafka</title>
    <link href="/posts/e1f23b16.html"/>
    <url>/posts/e1f23b16.html</url>
    
    <content type="html"><![CDATA[<p>2019-11-08-Zookeeper&amp;Kafka <span id="more"></span></p><h1 id="zookeeper">Zookeeper</h1><h2 id="zookeeper官网"><ahref="http://zookeeper.apache.org/">Zookeeper官网</a></h2><h3 id="什么是zookeeper">1. 什么是Zookeeper?</h3><blockquote><p>Zookeeper是开源<code>分布式</code>的，为分布式应用<code>提供协调服务</code>的Apache项目；<br />Zookeeper是一个基于<code>观察者模式</code>设计的<code>分布式服务管理框架</code>，负责<code>存储和管理</code>数据，接受观察者的注册，数据状态一旦发生变化，Zookeeper负责通知已经在Zookeeper注册的观察者做出相应的反应；<br />应用场景：统一命名服务；统一配置管理；统一集群管理；监控服务器动态上下线；软负载均衡；</p></blockquote><h3 id="zookeeper特点">2. Zookeeper特点</h3><h4 id="zookeeper的设计目标">2.1 Zookeeper的设计目标</h4><img src="/posts/e1f23b16/zkservice.png" class="" title="[zkservice]"><ul><li>一个Leader，多个Follwers；</li><li>集群只要有半数以上节点存活，集群就可以正常服务，适合安装奇数台服务器；</li><li>全局数据一致，每个Server保存一份相同数据副本；</li><li>数据更新<code>原子性</code>，要么成功，要么失败；</li><li><code>实时性</code>：一定时间内，Client能读到最新数据；</li><li><code>顺序性</code>：来自同一个Client的更新请求按其发送顺序一次执行；</li></ul><h4 id="zookeeper数据模型和分层名称">2.2Zookeeper数据模型和分层名称</h4><img src="/posts/e1f23b16/zknamespace.png" class="" title="[zknamespace]"><ul><li>类似于Unix文件系统，每个节点称为ZNode，默认存储1MB的数据，每个节点可以通过其路径唯一表示；</li></ul><h3 id="zookeeper的使用">3. Zookeeper的使用</h3><h4 id="下载地址">3.1 下载地址</h4><p><ahref="http://zookeeper.apache.org/releases.html">Zookeeper下载地址</a></p><h4 id="本地模式安装部署">3.2 本地模式安装部署</h4><ul><li>JDK<ul><li><code>vim /etc/profile</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">JAVA_HOME=/opt/jdk1.8<br>JRE_HOME=<span class="hljs-variable">$JAVA_HOME</span>/jre<br>CLASSPATH=.:<span class="hljs-variable">$JAVA_HOME</span>/lib:<span class="hljs-variable">$JRE_HOME</span>/lib<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure></li></ul></li><li>解压Zookeeper到/opt</li></ul><h4 id="修改配置文件">3.3 修改配置文件</h4><ul><li>路径：/zookeepr-version/conf<ul><li><code>mv ./zoo_sample.cfg ./zoo.cfg &amp;&amp; mkdir zkData</code></li><li><code>vim zoo.cfg</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">tickTime=2000 <span class="hljs-comment"># 通信心跳时间 2s，S-C</span><br>initLimit=10  <span class="hljs-comment"># 2sx10=20s，初始Leader与Followed通信时限</span><br>syncLimit=5   <span class="hljs-comment"># LF同步通信时限，5x2s=10s</span><br>clientPort=2181   <span class="hljs-comment"># 监听客户端连接端口号</span><br>dataDir=/opt/zookeeper-version/zkData <span class="hljs-comment"># 数据文件目录和数据持久化路径  </span><br></code></pre></td></tr></table></figure></li></ul></li><li>启动zookeeper服务端&amp;客户端<ul><li><code>./bin/zkServer.sh start</code></li><li><code>jps</code> # Java Virtual Machine Process Status Tool</li><li><code>./bin/zkCli.sh -server IP</code> # Command lineIteraction</li></ul></li></ul><h4 id="测试">3.4 测试</h4><table><thead><tr><th style="text-align: left;">命令</th><th style="text-align: left;">说明</th></tr></thead><tbody><tr><td style="text-align: left;">ls</td><td style="text-align: left;">查看节点</td></tr><tr><td style="text-align: left;">–</td><td style="text-align: left;">watch, 监听节点变化</td></tr><tr><td style="text-align: left;">create</td><td style="text-align: left;">创建节点</td></tr><tr><td style="text-align: left;">–</td><td style="text-align: left;">-s, 自动建立序号</td></tr><tr><td style="text-align: left;">delete</td><td style="text-align: left;">删除节点</td></tr><tr><td style="text-align: left;">set</td><td style="text-align: left;">设置节点值</td></tr><tr><td style="text-align: left;">get</td><td style="text-align: left;">获取节点的值</td></tr><tr><td style="text-align: left;">–</td><td style="text-align: left;">watch, 监听节点值的变化</td></tr><tr><td style="text-align: left;">stat</td><td style="text-align: left;">查看节点状态</td></tr></tbody></table><ul><li><p>连接到Zookeeper：</p></li><li><p><code>$ bin/zkCli.sh -server 127.0.0.1:2181</code> # help查询帮助命令</p></li><li><p>创建znode <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zkshell: 9] create /zk_test <span class="hljs-string">&quot;my_data&quot;</span>    <span class="hljs-comment"># 要有相应的值 </span><br>Created /zk_test<br><br>[zkshell: 11] <span class="hljs-built_in">ls</span> /<br>[zookeeper, zk_test]<br><br>[zkshell: 12] get /zk_test    <span class="hljs-comment"># set /zk_test junk     delete /zk_test</span><br>my_data<br>cZxid = 5<br>...<br>numChildren = 0<br></code></pre></td></tr></table></figure></p></li></ul><h3 id="分布式安装部署建议奇数台">4. 分布式安装部署(建议奇数台)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim conf/zoo.cfg<br>tickTime=2000<br>dataDir=/var/lib/zookeeper<br>clientPort=2181<br>initLimit=5<br>syncLimit=2<br>server.1=zoo1:2888:3888 <span class="hljs-comment"># zoo1建议为主机名； </span><br>server.2=zoo2:2888:3888 <span class="hljs-comment"># 2888：该server与集群leader server交换信息的端口；</span><br>server.3=zoo3:2888:3888 <span class="hljs-comment"># 3888选举端口；</span><br><br><span class="hljs-comment"># 配置myid 在数据目录下</span><br>vim myid<br>1<br></code></pre></td></tr></table></figure><h1 id="kafka">Kafka</h1><h2 id="kafka官网"><a href="http://kafka.apache.org/">Kafka官网</a></h2><h3 id="什么是kafka">1. 什么是Kafka？</h3><blockquote><p>Kafka是一个<code>分布式</code>的<code>基于发布/订阅模式</code>的<code>消息队列</code>(MessageQueue)，主要应用于大数据领域的实时计算以及日志采集。</p></blockquote><h3 id="什么是message-queue">2. 什么是Message Queue？</h3><blockquote><p>消息队列比作是一个<code>存放消息的容器</code>，需要使用消息的时候可以取出消息供自己使用，消息队列是<code>分布式系统</code>中重要的组件，目前使用较多的消息队列有<code>ActiveMQ，RabbitMQ，Kafka，RocketMQ</code>；队列Queue 是一种<code>先进先出</code>的数据结构。</p></blockquote><blockquote><p>消息队列的模式：<br />&gt;点对点模式，消费者<code>主动</code>拉取数据，消息收到后消息清除（阅后即焚）；<br /><img src="/posts/e1f23b16/PP.png" class="" title="[点对点模式]"><br />&gt; 发布-订阅模式，发布到Topic数据不会清除，分为push / pull；<br /><img src="/posts/e1f23b16/PS.png" class="" title="[发布-订阅模式]"></p></blockquote><blockquote><p>优点：<br />&gt; 1）通过异步处理提高系统性能（削峰、减少响应所需时间）；<br />&gt;2）降低系统耦合性，消息队列使利用<code>发布-订阅</code>模式工作，消息发送者（<code>生产者</code>）发布消息，一个或多个消息接受者（<code>消费者</code>）订阅消息；</p></blockquote><h3 id="kafka的4个核心api">3. Kafka的4个核心API</h3><ul><li><p><code>Producer API</code>：允许应用程序发布的记录流至一个或多个Kafkatopics。</p></li><li><p><code>Consumer API</code>：允许应用程序订阅一个或多个主题，并处理所产生的记录流。</p></li><li><p><code>Streams API</code>：允许应用程序扮演流处理器，从一个或多个主题消耗的输入流，并产生一个输出流至一个或多个输出的主题，有效地把输入数据流转变输出流。</p></li><li><p><code>Connector API</code>：允许构建和运行可重复使用的生产者或消费者，将Kafkatopics连接到现有的应用程序或数据系统。例如，关系数据库的连接器可能会捕获对表的所有更改。</p></li><li><p>在Kafka中，客户端和服务器之间的通信是通过简单，高性能，与语言无关的<code>TCP协议</code>完成的。</p></li></ul><img src="/posts/e1f23b16/kafka-apis.png" class="" title="[kafka-apis]"><ul><li>topics：主题是被发布记录的一种类别或者订阅名称，Kafka的主题是通常是多用户的，也即一个主题可以有零个，一个或者多个消费者来订阅写入该主题的数据；对于每个主题，Kafka集群都会维护一个分区日志。</li></ul><img src="/posts/e1f23b16/Topic.png" class="" title="[Topic]"><h3 id="kafka架构">4. kafka架构：</h3><img src="/posts/e1f23b16/kafka.png" class="" title="[kafka架构]"><ul><li><code>Producer</code>：消息生产者，就是向kafkabroker发消息的客户端；</li><li><code>Consumer</code>：消息消费者，向kafkabroker取消息的客户端；</li><li><code>Consumer Group （CG）</code>：kafka用来实现一个topic消息的广播（发给所有的consumer）和单播（发给任意一个consumer）的手段；广播的实现：让每一个Consuner拥有独立的CG；<ul><li>第一：同一个消费者组里面，只能有一个消费者去消费分区的数据；</li><li>第二：同一个消费者组里面是不会重复消费消息的；</li><li>第三：同一个消费者组的一个消费者不是以一条一条数据为单元的，是以<code>分区为单元</code>，就相当于消费者和分区建立某种socket，进行传输数据，所以，一旦建立这个关系，这个分区的数据只能是由这个消费者消费；</li></ul></li><li><code>Broker</code>：一台kafka服务器就是一个broker；一个集群由多个broker组成。一个broker可以容纳多个topic；</li><li><code>Topic</code>：可以理解为一个队列；</li><li><code>Partition</code>：为了实现扩展性，数据量大的topic可以分布到多个broker（即服务器）上，一个topic可以分为多个partition，每个partition是一个有序的队列。partition中的每条消息都会被分配一个有序的id（offset）。kafka只保证按一个partition中的顺序将消息发给consumer，不保证一个topic的整体（多个partition间）的顺序；</li><li><code>Offset</code>：kafka的存储文件都是按照offset.kafka来命名，用offset做名字的好处是方便查找。例如你想找位于2049的位置，只要找到2048.kafka的文件即可。当然thefirst offset就是00000000000.kafka；</li><li>Zookeeper：存储Kafka集群信息，实现集群的高可用；</li></ul><h3 id="kafka安装部署">5. kafka安装部署：</h3><h4 id="下载地址-1">5.1 <ahref="http://kafka.apache.org/quickstart">下载地址</a></h4><blockquote><p>依赖于Zk</p></blockquote><h4 id="安装部署">5.2 安装部署</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -xzvf kafka_version.tgz -C /opt/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Devops</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>五笔和双拼</title>
    <link href="/posts/47b7e05b.html"/>
    <url>/posts/47b7e05b.html</url>
    
    <content type="html"><![CDATA[<p>2019-11-05-五笔和双拼 <span id="more"></span></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Linux笔记</title>
    <link href="/posts/e511c25d.html"/>
    <url>/posts/e511c25d.html</url>
    
    <content type="html"><![CDATA[<p>2019-10-31 <span id="more"></span></p><h4 id="用户操作练习">用户操作练习</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建一个用户mandriva，其ID号为2002，基本组为distro（组ID为3003），附加组为linux</span><br>groupadd -g 3003 distro<br>groupadd linux<br>useradd -u 2002 -g distro -G linux mandriva<br><br><span class="hljs-comment"># 创建一个用户fedora，其全名为Fedora Community，默认shell为tcsh</span><br>useradd -c <span class="hljs-string">&quot;Fedora Community&quot;</span> -s /bin/tcsh fedora<br><br><span class="hljs-comment"># 修改mandriva的ID号为4004，基本组为linux，附加组为distro和fedora</span><br>usermod -u 4004 -g linux -G distro,fedora mandriva<br><br><span class="hljs-comment"># 给fedora加密码，并设定其密码最短使用期限2D，最长为50D</span><br>passwd -n 2 -x 50 fedora<br><br><span class="hljs-comment"># 将mandriva的默认shell修改为/bin/bash</span><br>usermod -s /bin/bash mandriva<br><br><span class="hljs-comment"># 添加系统用户hbase，且不允许登录系统</span><br>useradd -r -s /sbin/nologin hbase<br><br><span class="hljs-comment"># 新建一个没有家目录的用户openstack</span><br>useradd -M openstack<br></code></pre></td></tr></table></figure><h4 id="权限练习">权限练习</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 复制/etc/skel 为/home/openstack</span><br><span class="hljs-built_in">cp</span> -r /etc/skel /home/openstack<br><br><span class="hljs-comment"># 改变/home/openstack及其内部文件的属主属组均为openstack</span><br><span class="hljs-built_in">chown</span> -R openstack.openstack /home/openstack<br><br><span class="hljs-comment"># /home/openstack及其内部文件属主与其他用户没有任何访问权限</span><br><span class="hljs-built_in">chmod</span> -R go= /home/openstack<br></code></pre></td></tr></table></figure><h4 id="统计">统计</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 统计/usr/bin目录下的文件个数</span><br><span class="hljs-built_in">ls</span> /usr/bin |<span class="hljs-built_in">wc</span> -l<br><br><span class="hljs-comment"># 取出当前系统上所有用户的shell，每种shell只显示一次，并且按顺序进行显示</span><br><span class="hljs-built_in">cat</span> /etc/passwd |<span class="hljs-built_in">cut</span> -d: -f7 |<span class="hljs-built_in">sort</span> -u<br><br><span class="hljs-comment"># 如何显示/var/log目录下每个文件的内容类型？</span><br>file /var/log/* <br>file $(<span class="hljs-built_in">ls</span> /var/log)<br><br><span class="hljs-comment"># 取出/etc/inittab文件的第六行</span><br><span class="hljs-built_in">head</span> -n6 |<span class="hljs-built_in">tail</span> -n1<br><br><span class="hljs-comment"># 取出/etc/passwd文件中倒数第九个用户的用户名和shell，显示到屏幕并将其保存至/tmp/users文件中</span><br><span class="hljs-built_in">tail</span> -n9 |<span class="hljs-built_in">head</span> -n1 |<span class="hljs-built_in">cut</span> -d: -f1,7 &gt;/tmp/users<br><br><span class="hljs-comment"># 显示/etc目录所有以pa开头的文件，并统计个数</span><br><span class="hljs-built_in">ls</span> -d /etc/pa* |<span class="hljs-built_in">wc</span> -l<br><br><span class="hljs-comment"># 不使用文本编辑器将alias cls=&quot;clear&quot;添加到当前用户的.bashrc文件中</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;alias cls=clear&quot;</span>&gt;&gt;~/.bashrc<br></code></pre></td></tr></table></figure><h4 id="grepsedawk">grep/sed/awk</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 找出ifconfig命令结果中的1-255之间的整数</span><br>grep -E <span class="hljs-string">&#x27;(\&lt;([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\&gt;\.)&#123;3&#125;\&lt;([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\&gt;&#x27;</span>  <br>  A: 1-127  <br>  B: 128-191  <br>  C: 192-223  <br>grep -E <span class="hljs-string">&#x27;\&lt;[1-9]|1[1-9]&#123;2&#125;|2[01][0-9]|22[0-3]\&gt;(\.\&lt;([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])\&gt;)&#123;2&#125;\.\&lt;([1-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])\&gt;&#x27;</span><br><br><span class="hljs-comment"># 删除/etc/grub.conf文件中行首的空白符</span><br>sed <span class="hljs-string">&#x27;s/[[:space:]]+//g&#x27;</span> /etc/grub.conf<br><br><span class="hljs-comment"># 替换/etc/inittab文件中&quot;id:3:initdefault&quot;一行中的数字5</span><br>sed <span class="hljs-string">&#x27;s@\(id:\)[0-9]\(:initdefault:\)@\15\2@g&#x27;</span> /etc/inittab <br><br><span class="hljs-comment"># 删除/etc/inittab文件中的空白行</span><br>sed <span class="hljs-string">&#x27;/^$/d&#x27;</span> /etc/inittab<br><br><span class="hljs-comment"># 删除/etc/inittab文件开头的#号</span><br>sed <span class="hljs-string">&#x27;s/^#//g&#x27;</span> /etc/inittab<br><br><span class="hljs-comment"># 删除某文件中开头的#及后面的空白字符，但要求#后面必须有空白字符</span><br>sed -r <span class="hljs-string">&#x27;s@^#[[:space:]]+@@&#x27;</span> /etc/inittab<br><br><span class="hljs-comment"># 删除某文件以空白字符且后边跟#号的开头的行的空白字符及#</span><br>sed <span class="hljs-string">&#x27;s/^[[:space:]+#//g&#x27;</span> /etc/inittab<br><br><span class="hljs-comment"># 取出一个文件路径的目录名称</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;/etc/rc.d&#x27;</span> |sed -r <span class="hljs-string">&#x27;s@^(/.*/)[^/]+/?@\1@g&#x27;</span>/etc/<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;/etc/rc.d&#x27;</span> |sed -r <span class="hljs-string">&#x27;s@^/.*/([^/]+)/?@\1@g&#x27;</span>rc.d<br></code></pre></td></tr></table></figure><h4 id="find">find</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查找/var 下属主为root并且属组为mail的所有文件</span><br>find /var -user root -a -group mail<br><br><span class="hljs-comment"># 查找/usr 下不属于root,bin,或student的文件</span><br>find /usr -not \( -user root -o -user bin -o -user student \)<br>find  /usr -not -user root -a -not -user bin -not -user student<br><br><span class="hljs-comment"># 查找/etc 下最近一周内内容修改过的且不属于root及student用户的文件</span><br>find /etc -mtime -7 -not \( -user root -o -user student \)<br>find /etc -mtime -7 -not -user root -a -not -user student<br><br><span class="hljs-comment"># 查找当前系统上没有属主或属组且最近1天内被访问过的文件，并将其属主属组均改为root</span><br>find / \( -nouser -o -nogroup \) -a -atime -1 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">chown</span> root.root &#123;&#125; \;<br><br><span class="hljs-comment"># 查找/etc下大于1M 的文件，并将其文件名写入/tmp/etc.largefiles文件中</span><br>find /etc -size +1M -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">echo</span> &#123;&#125; &gt;&gt;/tmp/etc.largefiles \;  <br>find /etc -size +1M &gt;&gt;/tmp/etc.largefiles<br><br><span class="hljs-comment"># xargs - build and execute command lines from standford input</span><br>find /etc -size +1M |xargs <span class="hljs-built_in">echo</span> &gt;&gt;/tmp/etc.largefiles <br><br><span class="hljs-comment"># 查找/etc下所有用户都没有写权限的文件，显示出详细信息</span><br>find /etc -not -perm /222 -<span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><h4 id="磁盘">磁盘</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建5G的分区，文件系统为ext3，卷标为MYDATA，块大小为1024，预留管理空间为磁盘分区3%，要求开机后自动挂载至/data目录，并且自动挂载的设备要使用卷标进行引导</span><br>mke2fs -t ext3 -L MYDATA -b 1024 -m 3 /dev/sda2<br>blkid<span class="hljs-comment"># 查看磁盘 UUID  TYPE  LABEL等属性  </span><br>tune2fs <span class="hljs-comment"># 调整文件系统属性 -L -m -o</span><br>dumpe2fs<span class="hljs-comment"># 显示文件属性信息  </span><br>fsck / e2fsck<br><br><span class="hljs-comment"># 上述如何操作，让其自动挂载的同时启用ACL功能</span><br>/etc/fstab<br>LABEL=<span class="hljs-string">&#x27;MYDATA&#x27;</span>/dataext3defaults,acl0 0<br><br><span class="hljs-comment"># 创建一个本地回环文件/var/swaptmp/swapfile来用于swap，要求大小为512MB，卷标为SWAP-FILE，且开机自动挂载此交换设备</span><br><br><span class="hljs-built_in">mkdir</span> /var/swaptmp<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/var/swaptmp/swapfile bs=1M count=512<br>mkswap LABLE=SWAP-FILE /var/swaptmp/swapfile<br><br>/var/swaptmp/swapfileswapswapdefaults0 0<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis</title>
    <link href="/posts/bae4ff13.html"/>
    <url>/posts/bae4ff13.html</url>
    
    <content type="html"><![CDATA[<p>2019-09-14-Redis <span id="more"></span></p><h1 id="redis">Redis</h1><h2 id="介绍">介绍</h2><blockquote><p>Redis是完全开源免费的，遵守BSD协议，是一个高性能的key-value数据库。</p></blockquote><blockquote><p>Redis支持数据的持久化，可以将<code>内存中的数据</code>保存在磁盘中，重启的时候可以再次加载进行使用;Redis不仅仅支持简单的<code>key-value</code>类型的数据，同时还提供<code>list，set，zset，hash</code>等数据结构的存储;Redis支持<code>数据的备份</code>，即master-slave模式的数据备份。</p></blockquote><h2 id="安装">安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@anyue ~]# wget http://download.redis.io/releases/redis-5.0.5.tar.gz<br>[root@anyue redis-5.0.5]# tar -xzf redis-5.0.5.tar.gz<br>[root@anyue redis-5.0.5]# make PREFIX=/usr/local/redis install <br>[root@anyue redis-5.0.5]# <span class="hljs-built_in">mkdir</span> /usr/local/redis/etc<br>[root@anyue redis-5.0.5]# <span class="hljs-built_in">cp</span> ./redis.conf /usr/local/redis/etc/<br>[root@anyue redis-5.0.5]# vim /usr/local/redis/etc/redis.conf   <br>  daemonize <span class="hljs-built_in">yes</span>  <br>[root@anyue redis-5.0.5]# <span class="hljs-built_in">ln</span> -s /usr/local/redis/bin/* /usr/local/bin <br>[root@anyue redis-5.0.5]# <span class="hljs-built_in">cp</span> /utils/redis_init_script /usr/local/redis/etc/  <span class="hljs-comment"># 启动脚本</span><br>[root@anyue redis-5.0.5]# vim /usr/local/redis/etc/redis_init_script  <br><span class="hljs-comment">#!/bin/sh</span><br><span class="hljs-comment"># chkconfig: 2345 80 90</span><br><span class="hljs-comment"># description: source package redis</span><br><br><span class="hljs-comment"># Simple Redis init.d script conceived to work on Linux systems</span><br><span class="hljs-comment"># as it does use of the /proc filesystem.</span><br><span class="hljs-comment">### BEGIN INIT INFO</span><br><span class="hljs-comment"># Provides:     redis_6379</span><br><span class="hljs-comment"># Default-Start:        2 3 4 5</span><br><span class="hljs-comment"># Default-Stop:         0 1 6</span><br><span class="hljs-comment"># Short-Description:    Redis data structure server</span><br><span class="hljs-comment"># Description:          Redis data structure server. See https://redis.io</span><br><span class="hljs-comment">### END INIT INFO</span><br><br>REDISPORT=6379<br>EXEC=/usr/local/redis/bin/redis-server<br>CLIEXEC=/usr/local/redis/bin/redis-cli<br><br>PIDFILE=/var/run/redis_<span class="hljs-variable">$&#123;REDISPORT&#125;</span>.pid<br>CONF=<span class="hljs-string">&quot;/usr/local/redis/etc/<span class="hljs-variable">$&#123;REDISPORT&#125;</span>.conf&quot;</span><br><br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-keyword">in</span><br>start)<br><span class="hljs-keyword">if</span> [ -f <span class="hljs-variable">$PIDFILE</span> ]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PIDFILE</span> exists, process is already running or crashed&quot;</span><br><span class="hljs-keyword">else</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Starting Redis server...&quot;</span><br><span class="hljs-variable">$EXEC</span> <span class="hljs-variable">$CONF</span> &amp;<br><span class="hljs-keyword">fi</span><br>;;<br>stop)<br><span class="hljs-keyword">if</span> [ ! -f <span class="hljs-variable">$PIDFILE</span> ]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PIDFILE</span> does not exist, process is not running&quot;</span><br><span class="hljs-keyword">else</span><br>PID=$(<span class="hljs-built_in">cat</span> <span class="hljs-variable">$PIDFILE</span>)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Stopping ...&quot;</span><br><span class="hljs-variable">$CLIEXEC</span> -p <span class="hljs-variable">$REDISPORT</span> shutdown<br><span class="hljs-keyword">while</span> [ -x /proc/<span class="hljs-variable">$&#123;PID&#125;</span> ]<br><span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Waiting for Redis to shutdown ...&quot;</span><br><span class="hljs-built_in">sleep</span> 1<br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Redis stopped&quot;</span><br><span class="hljs-keyword">fi</span><br>;;<br>*)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Please use start or stop as first argument&quot;</span><br>;;<br><span class="hljs-keyword">esac</span><br>[root@anyue redis-5.0.5]# <span class="hljs-built_in">ln</span> -s /usr/local/redis/etc/redis_init_script /etc/init.d/redisd  <br>[root@anyue redis-5.0.5]# chkconfig --add redisd`  <span class="hljs-comment"># 加入开机自启  </span><br></code></pre></td></tr></table></figure><h2 id="使用">使用</h2><h3 id="string-类型及操作">string 类型及操作</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@anyue</span> redis<span class="hljs-number">-5.0</span><span class="hljs-number">.5</span>]<span class="hljs-meta"># redis-cli -h 127.0.0.1 -p6379 -apasswd  # 远程</span><br></code></pre></td></tr></table></figure><h2 id="待续">待续。。。</h2>]]></content>
    
    
    <categories>
      
      <category>linux, Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ES</title>
    <link href="/posts/3eb5a9f1.html"/>
    <url>/posts/3eb5a9f1.html</url>
    
    <content type="html"><![CDATA[<p>2019-09-14-ElasticSearch <span id="more"></span></p><h2 id="rsync-同步服务">rsync 同步服务：</h2><h3 id="rsync基本使用">rsync基本使用：</h3><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>归档模式</td></tr><tr><td>-v</td><td>显示同步过程</td></tr><tr><td>-z</td><td>传输时压缩</td></tr></tbody></table><ul><li>下载: rsync -avz 服务器IP:/服务器目录/file /本地目录<br /><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ruby">  rsync -avz root<span class="hljs-variable">@192</span>.<span class="hljs-number">168.37</span>.<span class="hljs-number">10</span><span class="hljs-symbol">:/filesrc/text</span>.txt /filedst/<br>  <span class="hljs-string">``</span><span class="hljs-string">`  </span><br><span class="hljs-string"></span><br><span class="hljs-string">+ 上传: rsync -avz /本地目录/file 服务器IP:/服务器目录/*  </span><br></code></pre></td></tr></table></figure> rsync -avz /filedst/test.txtroot@192.168.37.10:/filesrc/ <figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs csharp">    <br>*ssh-keygen -t rsa -b <span class="hljs-number">2048</span>*  <br>*ssh-copy-id root@<span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.20</span>*  <br><br><span class="hljs-meta">#### rsync服务端(NFS服务器)</span><br>```bash<br>[<span class="hljs-meta">root@xy ~</span>]<span class="hljs-meta"># vim /etc/rsyncd.conf  </span><br>  address = <span class="hljs-number">192.168</span><span class="hljs-number">.37</span><span class="hljs-number">.10</span> <span class="hljs-meta">#rsync服务绑定IP</span><br>  port = <span class="hljs-number">873</span><br>  log <span class="hljs-keyword">file</span> =/<span class="hljs-keyword">var</span>/log/rsyncd.log <br>  pid <span class="hljs-keyword">file</span> = /<span class="hljs-keyword">var</span>/run/rsyncd.pid<br>  [<span class="hljs-meta">web</span>]<br>      comment = web directory backup<br>      path = /filesrc<br>      read only = no<br>      dont commpress = *.gz *.bz2<br>      auth users =user1   <span class="hljs-meta"># 非系统用户, 自行创建</span><br>      secrets <span class="hljs-keyword">file</span> = /etc/rsyncd_users.db<br>[<span class="hljs-meta">root@xy ~</span>]<span class="hljs-meta"># vim /etc/rsyncd_users.db   </span><br>  user1:<span class="hljs-number">123456</span><br>[<span class="hljs-meta">root@xy ~</span>]<span class="hljs-meta"># chmod 600 /etc/rsyncd_users.db </span><br>[<span class="hljs-meta">root@xy ~</span>]<span class="hljs-meta"># rsync --daemon  </span><br>[<span class="hljs-meta">root@xy ~</span>]<span class="hljs-meta"># netstat -antp |grep :873  </span><br>[<span class="hljs-meta">root@xy ~</span>]<span class="hljs-meta"># setfacl -m u:nobody:rwx /filesrc </span><br></code></pre></td></tr></table></figure></li></ul><h4 id="客户端">客户端</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# rsync -avz rsync://user1@192.168.37.10/filesrc /filedst      <span class="hljs-comment"># 下载 </span><br>[root@xy ~]# rsync -avz /filedst/* rsync://user1@192.168.37.10/filesrc`   <span class="hljs-comment"># 上传    </span><br></code></pre></td></tr></table></figure><h3 id="rsync基于xinetd-inotifywait-实现单向实时同步">rsync(基于xinetd)+ inotifywait 实现单向实时同步：</h3><table><thead><tr><th>inotifywait 命令选项</th><th>说明</th></tr></thead><tbody><tr><td>-m</td><td>始终保持监听</td></tr><tr><td>-r</td><td>递归查询目录</td></tr><tr><td>-q</td><td>只打印监控事件信息</td></tr></tbody></table><h4 id="服务端">服务端</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs perl">[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># yum -y install gcc*  </span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># tar -xvf inotify-tools-3.14.tar.gz </span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># cd inotify-tools-3.14.tar.gz</span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># ./configure &amp;&amp; make make install  </span><br><br><span class="hljs-comment"># 监控动作：modify,create,attrib,move,delete </span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># inotifywait -mrq -e 监控动作1,监控动作2 /监控目录 &amp;     </span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># inotifywait -mrq -e create,delete,modify /filesrc &amp;   </span><br>  <span class="hljs-comment">#!/bin/bash  </span><br>  Inotfiy = <span class="hljs-string">&quot;inotifywait -mrq -e create,delete,modify /filesrc&quot;</span><br>  Rsync = <span class="hljs-string">&quot;rsync -avz /filesrc/* root<span class="hljs-variable">@192</span>.168.37.20:/filedst&quot;</span><br>  <span class="hljs-variable">$Inotfiy</span> | <span class="hljs-keyword">while</span> <span class="hljs-keyword">read</span> directory event file<br>  <span class="hljs-keyword">do</span><br>     <span class="hljs-variable">$Rsync</span><br>  done  <br></code></pre></td></tr></table></figure><h3id="rsync基于xinetd-unison-inotify-实现双向实时同步">rsync(基于xinetd) +unison + inotify 实现双向实时同步：</h3><h4 id="服务端192.168.37.10">服务端(192.168.37.10)</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs perl">[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># tar -xzvf inotify-tools-3.14.tar.gz  </span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># cd inotify-tools-3.14</span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># ./configure &amp;&amp; make &amp;&amp; make install  </span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># tar -xzvf ocaml-3.10.1.tar.gz </span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># cd ocmal-3.10.1</span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># ./configure</span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># make world opt</span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># make install</span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># tar -xzvf unison-2.13.16.tar.gz</span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># cd unison-2.13.16</span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># make UISTYLE=text THREADS=true STATIC=true  </span><br>[root<span class="hljs-variable">@xy</span> ~]<span class="hljs-comment"># cp unison /usr/local/bin </span><br>  <span class="hljs-comment">#!/bin/bash  </span><br>  Inotfiy = <span class="hljs-string">&quot;inotifywait -mrq -e create,delete,modify /filesrc&quot;</span><br>  Unison = <span class="hljs-string">&quot;/usr/local/bin/unison -batch /filesrc ssh://192.168.37.20/filedst&quot;</span><br>  <span class="hljs-variable">$Inotfiy</span> | <span class="hljs-keyword">while</span> <span class="hljs-keyword">read</span> directory event file<br>  <span class="hljs-keyword">do</span><br>     <span class="hljs-variable">$Unison</span><br>  done<br></code></pre></td></tr></table></figure><h4 id="客户端192.168.37.20">客户端(192.168.37.20)</h4><blockquote><p>安装inotify-tools-3.14.tar.gz，ocaml-3.10.1.tar.gz，unison-2.13.16.tar.gz</p></blockquote><p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash  </span><br>Inotfiy = <span class="hljs-string">&quot;inotifywait -mrq -e create,delete,modify /filesrc&quot;</span><br>Unison = <span class="hljs-string">&quot;/usr/local/bin/unison -batch /filedst ssh://192.168.37.10/filesrc&quot;</span><br><span class="hljs-variable">$Inotfiy</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> directory event file<br><span class="hljs-keyword">do</span><br>  <span class="hljs-variable">$Unison</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></p><h2 id="linux-日志概述">Linux 日志概述</h2><h3 id="系统常见日志文件">系统常见日志文件</h3><ul><li>syslog服务<ul><li>syslogd：系统</li><li>klogd：内核</li></ul></li></ul><table><thead><tr><th>日志文件</th><th>说明</th></tr></thead><tbody><tr><td>/var/log/cron</td><td>定时任务log</td></tr><tr><td>/var/log/cpus</td><td>打印信息log</td></tr><tr><td>/var/log/dmesg</td><td>内核自检log, <code>dmesg</code></td></tr><tr><td>/var/log/btmp</td><td>错误登录log, 二进制格式, 用<code>lastb</code>查看</td></tr><tr><td>/var/log/lastlog</td><td>最后一次登录时间log, <code>lastlog</code>查看</td></tr><tr><td>/var/log/mailog</td><td>邮件log</td></tr><tr><td><strong>/var/log/messages</strong></td><td>系统重要信息log</td></tr><tr><td>/var/log/secure</td><td>验证与授权log</td></tr><tr><td>/var/log/wtmp</td><td>永久记录所有用户登录, <code>last</code>查看</td></tr><tr><td>/var/run/utmp</td><td>当前已经登录用户信息, <code>w who users</code>查看</td></tr><tr><td>/var/log/httpd</td><td>RPM安装apache服务默认日志目录</td></tr></tbody></table><h3 id="日志格式-syslog-服务">日志格式: syslog 服务</h3><p>配置路径: <code>/etc/syslog.conf</code><br />配置格式: <code>日志服务[链接符号]日志等级   日志记录位置</code><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">35 </span># Include all config <span class="hljs-keyword">files</span> in /etc/rsyslog.d/<br><span class="hljs-symbol">36 </span>$IncludeConfig /etc/rsyslog.d/*.conf<br><span class="hljs-symbol">54 </span>*.info;mail.none;authpriv.none;cron.none      /var/<span class="hljs-keyword">log</span>/messages <br><span class="hljs-symbol">55 </span>authpriv.*                                   /var/<span class="hljs-keyword">log</span>/secure<br><span class="hljs-symbol">56 </span>*.emerg                                      *   # 每个用户<br><span class="hljs-symbol">60 </span>mail.*                                      -/var/<span class="hljs-keyword">log</span>/maillog    # 异步写入<br></code></pre></td></tr></table></figure></p><table><thead><tr><th>日志等级（从低到高）</th><th>说明(级别越低，信息越详细)</th></tr></thead><tbody><tr><td>debug</td><td>一般调试信息</td></tr><tr><td>info</td><td>基本通知信息</td></tr><tr><td>notice</td><td>普通信息</td></tr><tr><td>wraning</td><td>警告信息</td></tr><tr><td>err/error</td><td>错误信息</td></tr><tr><td>crit</td><td>大于err</td></tr><tr><td>alert</td><td>警告,大于crit</td></tr><tr><td>emerg/panic</td><td>会导致系统不可用</td></tr><tr><td>*</td><td>所有日志等级</td></tr><tr><td>none</td><td>和* 相反</td></tr></tbody></table><h3 id="日志轮替-logrotate切割轮替">日志轮替 logrotate(切割,轮替)</h3><blockquote><p>旧日志移动开改名,同时建立新的空日志文件,当旧日志文件超出保存范围,会进行删除,系统自带配置文件<code>/etc/logrotate.conf</code></p></blockquote><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">20 </span># no packages own wtmp <span class="hljs-keyword">and</span> btmp -- we<span class="hljs-comment">&#x27;ll rotate them here</span><br><span class="hljs-symbol">21 </span>/var/<span class="hljs-keyword">log</span>/wtmp &#123;<br><span class="hljs-symbol">22 </span>    monthly<br><span class="hljs-symbol">23 </span>    create <span class="hljs-number">0664</span> root utmp<br><span class="hljs-symbol">24 </span>    minsize <span class="hljs-number">1</span>M<br><span class="hljs-symbol">25 </span>    rotate <span class="hljs-number">1</span><br><span class="hljs-symbol">26 </span>&#125;<br></code></pre></td></tr></table></figure><table><thead><tr><th>配置参数</th><th>说明</th></tr></thead><tbody><tr><td>daily</td><td>日志轮替周期是每天</td></tr><tr><td>weekly</td><td>每周</td></tr><tr><td>monthly</td><td>每月</td></tr><tr><td>compress</td><td>日志轮替时,压缩旧日志</td></tr><tr><td>rotate</td><td>保留日志个数</td></tr><tr><td>create mode owner group</td><td>建立新日志,指定权限与所有者/所属组</td></tr><tr><td>mail address</td><td>发送邮件</td></tr><tr><td>missingok</td><td>日志不存在忽略日志警告信息</td></tr><tr><td>notifempty</td><td>若日志为空,不进行轮替</td></tr><tr><td>minsize</td><td>轮替最小值</td></tr><tr><td>size</td><td>大于size才会轮替</td></tr><tr><td>dateext</td><td>使用日期作为轮替文件后缀</td></tr><tr><td>sharedscripts</td><td>此关键字后脚本只执行一次</td></tr><tr><td>prerotate/endscript</td><td>轮替前执行脚本</td></tr><tr><td>postrotate/endscript</td><td>轮替后执行脚本</td></tr></tbody></table><h2id="elkelasticsearchlogstashkibana">ELK(Elasticsearch+Logstash+Kibana)</h2>### ELK日志分析：<div id="ELK"></div><blockquote><p><strong>ELK</strong>是三个开源软件的缩写，分别表示：<strong>Elasticsearch、Logstash、Kibana</strong>它们都是开源软件,新增了<strong>FileBeat</strong>，轻量级的日志收集处理工具；</p></blockquote><ul><li><strong>Filebeat</strong>：属于Beats<ul><li><strong>Filebeat</strong>：搜集文件数据 √</li><li><strong>Packetbeat</strong>：搜集网络流量数据</li><li><strong>Topbeat</strong>：搜集系统、进程和文件系统级别的CPU和内存使用情况<br /></li><li><strong>Winlogbeat</strong>：搜集Windows事件日志数据</li></ul></li><li><strong>Logstash(5044)</strong>：负责日志的收集、分析、功率，支持大量数据获取方式，C/S架构，client端安装在需要收集日志的主机上，server端负责将收集到的节点日志进行过滤发至Elastiserach上;</li><li><strong>ElastiSearch(9200)</strong>：开源分布式搜索引擎，提供搜集、分析、存储数据三大功能;</li><li><strong>Kibana(5601)</strong>：为 Logstash 和 Elasticserach 提供Web界面;</li></ul><img src="/posts/3eb5a9f1/ELK.jpg" class="" title="[ELK]"><img src="/posts/3eb5a9f1/ELK-Filebeat.jpg" class="" title="[ELK-Filebeat]"><h3 id="数据存储">数据存储</h3><h4 id="索引-分片-副本">索引 分片 副本</h4><ul><li><a href="https://my.oschina.net/kenblog/blog/3009800">参考</a></li><li><code>index索引</code>:就类似于关系型数据库的<code>数据库</code>，数据库建立好，然后就把数据存到index中；<ul><li><code>Mapping</code>:定义文档字段的类型；</li><li><code>Settimt</code>:定义不同数据分布；</li></ul></li><li><code>shard分片</code>:对于分布式的搜索引擎,<strong>索引通常都会分解成不同部分</strong>,而这些分布在不同节点的数据就是分片,<code>一个分片只存储一部分数据</code>，所有分片加起来就是一个完整的索引数据；<ul><li>分片分为primaryshard主分片和replica副本分片,一个索引可以创建多个分片数量，es默认创建的就是5个主分片数量，可以根据自己的实际业务确定主分片数量;</li><li>注意的是主分片数量一旦确定创建就无法进行修改。</li></ul></li><li><code>replica副本</code>:就是对主分片（Primary shard）的备份；<ul><li>每个主分片（primary shard）不会和副本分片（replicashard）存在于同一个节点中，有效的保证es的数据高可用性；</li></ul></li></ul><h3 id="elk-服务端部署192.168.37.10">ELK 服务端部署(192.168.37.10)</h3><ul><li><ahref="https://blog.csdn.net/wo18237095579/article/details/103880397/">Docker部署01</a></li><li><ahref="https://www.cnblogs.com/dalianpai/p/11986481.html">Docker部署02</a></li><li><ahref="https://www.cnblogs.com/cocowool/p/deploy_elk_and_collect_logs_via_filebeat.html">K8S部署</a></li></ul><h4 id="配置java环境">配置JAVA环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy elk]# <span class="hljs-built_in">mkdir</span> /usr/local/java<br>[root@xy elk]# tar -xzvf  jdk-8u261-linux-x64.tar.gz -C /usr/local/java<br>[root@xy ~]# vim /etc/profile<br>  <span class="hljs-comment"># JAVA ENVIRONMENT</span><br>  <span class="hljs-built_in">export</span> JAVA_HOME=/usr/local/java/jdk1.8.0_261<br>  <span class="hljs-built_in">export</span> CLASSPATH=.:<span class="hljs-variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib/dt.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib/tools.jar<br>  <span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin<br>[root@xy ~]# <span class="hljs-built_in">source</span> /etc/profile<br>[root@xy ~]# java -version   <span class="hljs-comment"># 验证</span><br></code></pre></td></tr></table></figure><h4 id="安装包">安装包</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@xy</span> ~]<span class="hljs-meta"># mkdir /elk<span class="hljs-comment">;cd /elk  </span></span><br>[root<span class="hljs-symbol">@xy</span> elk]<span class="hljs-meta"># wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.3.tar.gz</span><br>[root<span class="hljs-symbol">@xy</span> elk]<span class="hljs-meta"># wget https://artifacts.elastic.co/downloads/logstash/logstash-6.2.3.tar.gz</span><br>[root<span class="hljs-symbol">@xy</span> elk]<span class="hljs-meta"># wget https://artifacts.elastic.co/downloads/kibana/kibana-6.2.3-linux-x86_64.tar.gz</span><br>[root<span class="hljs-symbol">@xy</span> elk]<span class="hljs-meta"># tar -xzvf elasticsearch-6.2.3.tar.gz </span><br>[root<span class="hljs-symbol">@xy</span> elk]<span class="hljs-meta"># tar -xzvf logstash-6.2.3.tar.gz</span><br>[root<span class="hljs-symbol">@xy</span> elk]<span class="hljs-meta"># tar -xf kibana-6.2.3-linux-x86_64.tar.gz  </span><br></code></pre></td></tr></table></figure><h4 id="配置-elasticserch">配置 elasticserch</h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs crystal">[root<span class="hljs-variable">@xy</span> elk]<span class="hljs-comment"># chown -Rf root:root kibana-6.2.3-linux-x86_64</span><br>[root<span class="hljs-variable">@xy</span> elk]<span class="hljs-comment"># cp -a elasticsearch-6.2.3/ logstash-6.2.3/ kibana-6.2.3-linux-x86_64/ /usr/local</span><br>[root<span class="hljs-variable">@xy</span> elk]<span class="hljs-comment"># yum install -y java-1.8*   # JAVA 环境</span><br>[root<span class="hljs-variable">@xy</span> elk]<span class="hljs-comment"># useradd elasticsearch   </span><br>[root<span class="hljs-variable">@xy</span> elk]<span class="hljs-comment"># chown elasticsearch:elasticsearch /usr/local/elasticsearch-6.2.3/</span><br>[root<span class="hljs-variable">@xy</span> elk]<span class="hljs-comment"># su elasticsearch  # 以elasticsearch 用户运行</span><br>[elasticsearch<span class="hljs-variable">@xy</span> elasticsearch-<span class="hljs-number">6.2</span>.<span class="hljs-number">3</span>]<span class="hljs-variable">$ </span>./bin/elasticsearch -d  <br>[elasticsearch<span class="hljs-variable">@xy</span> elasticsearch-<span class="hljs-number">6.2</span>.<span class="hljs-number">3</span>]<span class="hljs-variable">$ </span>netstat -antp  <span class="hljs-comment"># 9200端口  </span><br>[elasticsearch<span class="hljs-variable">@xy</span> elasticsearch-<span class="hljs-number">6.2</span>.<span class="hljs-number">3</span>]<span class="hljs-variable">$ </span>cat /usr/local/elasticserch-<span class="hljs-number">6.2</span>.<span class="hljs-number">3</span>/logs/elasticsearch.log<br>[elasticsearch<span class="hljs-variable">@xy</span> elasticsearch-<span class="hljs-number">6.2</span>.<span class="hljs-number">3</span>]<span class="hljs-variable">$ </span>curl <span class="hljs-symbol">localhost:</span><span class="hljs-number">9200</span>  <br></code></pre></td></tr></table></figure><h4 id="配置-logstash">配置 logstash</h4><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@xy logstash-<span class="hljs-number">6.2</span>.<span class="hljs-number">3</span>]<span class="hljs-comment"># vim /vendor/bundle/jruby/2.3.0/gems/logstash-patterns-core-4.1.2/patterns/grok-patterns   </span><br>  <span class="hljs-comment"># Nginx log</span><br>  WZ ([^ ]*)<br>  NGINXACCESS %&#123;IP:remote_ip&#125; <span class="hljs-string">\-</span> <span class="hljs-string">\-</span> <span class="hljs-string">\[%&#123;HTTPDATE:timestamp&#125;\]</span> <span class="hljs-string">&quot;%&#123;WORD:method&#125; %&#123;WZ:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;&quot;</span> %&#123;NUMBER:status&#125; %&#123;NUMBER:bytes&#125; %&#123;QS:referer&#125; %&#123;QS:agent&#125; %&#123;QS:xforward&#125;<br>   <br>[root@xy logstash-<span class="hljs-number">6.2</span>.<span class="hljs-number">3</span>]<span class="hljs-comment"># vim /usr/local/logstash-6.2.3/default.conf </span><br>  input &#123;<br>      beats&#123;<br>          port =&gt; <span class="hljs-string">&quot;5044&quot;</span><br>      &#125;<br>  &#125;<br>  <span class="hljs-comment"># 数据过滤</span><br>  filter &#123;<br>      grok &#123;<br>          match =&gt; &#123; <span class="hljs-string">&quot;message&quot;</span> =&gt; <span class="hljs-string">&quot;%&#123;NGINXACCESS&#125;&quot;</span> &#125;<br>      &#125;<br>      geoip &#123;<br>          <span class="hljs-comment"># nginx 客户端 ip</span><br>          source =&gt; <span class="hljs-string">&quot;192.168.37.20&quot;</span><br>      &#125;<br>  &#125;<br>  <span class="hljs-comment"># 输出配置为本机的 9200 端口,这是elasticsearch 服务的监听端口</span><br>  output &#123;<br>      elasticsearch &#123;<br>          hosts =&gt; [<span class="hljs-string">&quot;127.0.0.1:9200&quot;</span>]<br>      &#125;<br>  &#125;<br>    <br>[root@xy logstash-<span class="hljs-number">6.2</span>.<span class="hljs-number">3</span>]<span class="hljs-comment"># nohup ./bin/logstash -f default.conf &amp;</span><br>[root@xy logstash-<span class="hljs-number">6.2</span>.<span class="hljs-number">3</span>]<span class="hljs-comment"># tail -f nohup.out</span><br>[root@xy logstash-<span class="hljs-number">6.2</span>.<span class="hljs-number">3</span>]<span class="hljs-comment"># netstat -antp | grep 5044    </span><br></code></pre></td></tr></table></figure><h4 id="配置-kibana">配置 Kibana</h4><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs llvm">[root<span class="hljs-title">@xy</span> kibana<span class="hljs-number">-6.2</span>.<span class="hljs-number">3</span>-linux-<span class="hljs-keyword">x</span><span class="hljs-number">86</span>_<span class="hljs-number">64</span>]# vim /usr/local/kibana<span class="hljs-number">-6.2</span>.<span class="hljs-number">3</span>-linux-<span class="hljs-keyword">x</span><span class="hljs-number">86</span>_<span class="hljs-number">64</span>/config/kibana.yml  <br>  server.host: <span class="hljs-string">&quot;192.168.37.10&quot;</span><br>[root<span class="hljs-title">@xy</span> kibana<span class="hljs-number">-6.2</span>.<span class="hljs-number">3</span>-linux-<span class="hljs-keyword">x</span><span class="hljs-number">86</span>_<span class="hljs-number">64</span>]# nohup ./bin/kibana &amp;<br>[root<span class="hljs-title">@xy</span> kibana<span class="hljs-number">-6.2</span>.<span class="hljs-number">3</span>-linux-<span class="hljs-keyword">x</span><span class="hljs-number">86</span>_<span class="hljs-number">64</span>]# <span class="hljs-keyword">tail</span> -f nohup.out<br>[root<span class="hljs-title">@xy</span> kibana<span class="hljs-number">-6.2</span>.<span class="hljs-number">3</span>-linux-<span class="hljs-keyword">x</span><span class="hljs-number">86</span>_<span class="hljs-number">64</span>]# netstat -antp | grep <span class="hljs-number">5601</span>  <br># 测试：<span class="hljs-number">192.168</span>.<span class="hljs-number">37.10</span>:<span class="hljs-number">5601</span>   # Kibana 测试地址<br></code></pre></td></tr></table></figure><h4 id="问题解决">问题解决：</h4><ul><li><p>max file descriptors [4096] for elasticsearch process is too low,increase to at least [65535] <figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stata">[elasticsearch@xy ~]$ sudo vim /etc/security/limits.<span class="hljs-keyword">conf</span><br><span class="hljs-comment">  * soft    nofile          65536</span><br><span class="hljs-comment">  *    hard    nofile          65536</span><br></code></pre></td></tr></table></figure></p></li><li><p>dockercompose部署ES遇到 Error opening log file ‘logs/gc.log’:Permission denied</p><ul><li><ahref="https://blog.csdn.net/qq_15256981/article/details/88605824">参考</a><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">- TAKE_FILE_OWNERSHIP=<span class="hljs-literal">true</span>  <span class="hljs-comment">#volumes 挂载权限问题</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h4 id="nginx部署192.168.37.20">Nginx部署(192.168.37.20)</h4><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@xy ~]<span class="hljs-comment"># yum install -y nginx  </span><br>[root@xy ~]<span class="hljs-comment"># wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.2.3-linux-x86_64.tar.gz  </span><br>[root@xy ~]<span class="hljs-comment"># tar -xzf ./filebeat-6.2.3-linux-x86_64.tar.gz -C /usr/local/  </span><br>[root@xy filebeat<span class="hljs-number">-6.2</span><span class="hljs-number">.3</span>-linux-x86_64]<span class="hljs-comment"># vim filebeat.yml  </span><br>  enable：<span class="hljs-literal">false</span>                 <span class="hljs-comment">#修改为true</span><br>  paths：<span class="hljs-regexp">/var/log/</span>*.log         <span class="hljs-comment">#修改为/var/log/nginx/*.log</span><br>  <span class="hljs-comment">#output.elasticsearch:        #将此行注释掉</span><br>  <span class="hljs-comment">#hosts: [&quot;localhost:9200&quot;]    #将此行注释掉</span><br>  output.logstash:              <span class="hljs-comment">#取消此行注释</span><br>  hosts: [<span class="hljs-string">&quot;192.168.37.10:5044&quot;</span>] <span class="hljs-comment">#取消此行注释并修改IP 地址为ELK 服务器地址</span><br>[root@xy filebeat<span class="hljs-number">-6.2</span><span class="hljs-number">.3</span>-linux-x86_64]<span class="hljs-comment"># nohup ./filebeat -e -c filebeat.yml &amp;  </span><br>[root@xy filebeat<span class="hljs-number">-6.2</span><span class="hljs-number">.3</span>-linux-x86_64]<span class="hljs-comment"># tailf nohup.out  </span><br></code></pre></td></tr></table></figure><img src="/posts/3eb5a9f1/ELK.png" class="" title="[ELK]"><img src="/posts/3eb5a9f1/ELK01.png" class="" title="[ELK配置-01]"><img src="/posts/3eb5a9f1/ELK02.png" class="" title="[ELK配置-02]"><h3 id="设置服务自启动">设置服务自启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#!bin/bash</span><br><span class="hljs-comment"># chkconfig: 2345 21  89</span><br><span class="hljs-comment"># description: elasticsearch</span><br><br><span class="hljs-comment"># JAVA_HOME=/usr/local/jdk1.8</span><br>ES_HOME=/usr/local/elasticsearch<br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span><br>    start) <span class="hljs-built_in">sudo</span> -iu elasticsearch <span class="hljs-variable">$ES_HOME</span>/bin/elasticsearch &amp;;;<br>    *)  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;require start&quot;</span>;;<br><span class="hljs-keyword">esac</span><br>------------------------------------<br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># chkconfig: 2345 50  50</span><br><span class="hljs-comment"># description: logstash</span><br><br>LS_HOME=/usr/local/logstash<br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span><br>    start)<span class="hljs-built_in">sudo</span> -iu elasticsearch <span class="hljs-variable">$LS_HOME</span>/bin/logstash -f <span class="hljs-variable">$LS_HOME</span>/config &amp;;;<br>    *) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;require start&quot;</span>;;<br><span class="hljs-keyword">esac</span><br>-----------------------------------<br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># chkconfig: 2345 98  02</span><br><span class="hljs-comment"># description: kibana</span><br><br>KIBANA_HOME=/usr/local/kibana<br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span><br>    start) <span class="hljs-variable">$KIBANA_HOME</span>/bin/kibana &amp;;;<br>    *) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;require start&quot;</span>;;<br><span class="hljs-keyword">esac</span><br></code></pre></td></tr></table></figure><h3 id="tomcat-服务自启动">tomcat 服务自启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment"># description: Tomcat8 Start Stop Restart</span><br><span class="hljs-comment"># processname: tomcat8</span><br><span class="hljs-comment"># chkconfig: 234 20 80</span><br><br>CATALINA_HOME=/usr/local/tomcat8/<br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span><br>    start)<br>        sh <span class="hljs-variable">$CATALINA_HOME</span>/bin/startup.sh<br>        ;;<br>    stop)<br>        sh <span class="hljs-variable">$CATALINA_HOME</span>/bin/shutdown.sh<br>        ;;<br>    restart)<br>        sh <span class="hljs-variable">$CATALINA_HOME</span>/bin/shutdown.sh<br>        sh <span class="hljs-variable">$CATALINA_HOME</span>/bin/startup.sh<br>        ;;<br>    *)<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;please use : tomcat &#123;start | stop | restart&#125;&#x27;</span><br>        ;;<br><span class="hljs-keyword">esac</span><br><span class="hljs-built_in">exit</span> 0<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops, linux, ES</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Devops</tag>
      
      <tag>ES</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python</title>
    <link href="/posts/a4d4b8b8.html"/>
    <url>/posts/a4d4b8b8.html</url>
    
    <content type="html"><![CDATA[<p>2019-09-10-python <span id="more"></span></p><h2 id="python">python</h2><blockquote><p>注释： <code>单行#comment  多行'''comment''' """comment"""</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">python2 -m pip install --upgrade pip  <br>pip install virtualenv virtualenvwrapper  <br>virtualenv testvir  <br>active.bat 或者 deactive.bat  <br>pip install flask  <br>pip freeze &gt;requirements.txt  <br></code></pre></td></tr></table></figure><h2 id="基础语法">基础语法</h2><img src="/posts/a4d4b8b8/python01.png" class="" title="[python01]"><img src="/posts/a4d4b8b8/python02.png" class="" title="[python02]"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> package <span class="hljs-keyword">import</span> module  <br><span class="hljs-keyword">import</span> module <span class="hljs-keyword">as</span> alias<br></code></pre></td></tr></table></figure><h3 id="变量和数据类型">变量和数据类型</h3><blockquote><p>对象（object）是内存中专门用来存储数据的一块区域，<code>id</code>&amp;&amp; <code>type</code> &amp;&amp; <code>value</code></p></blockquote><blockquote><p>变量和对象：</p><p>(1)对象并没有直接存储到变量中，Python中<code>变量更像是给对象起了一个别名</code>；</p><p>(2)<code>变量中存储的不是对象的值，而是对象的id（内存地址）</code>，使用变量时，实际上就是在<code>通过对象id在查找对象</code>；</p><p>(3)变量中保存的对象，只有在为变量重新赋值时才会改变；</p><p>(4)变量和变量之间是相互独立的，修改一个变量不会影响另一个变量</p></blockquote><blockquote><p>python中的数据类型: 不可变(<code>Number/String/Tuple</code>) 和可变(<code>list/dict/set</code>)，不可变值得是不允许变量的值发生变化，如果改变变量的值，相当于新建了一个对象，而对于相同值的对象，在内存中只有一个对象。</p></blockquote><blockquote><p>如果改变数字数据类型的值，意味着是一个新的对象，将会重新分配内存空间</p></blockquote><blockquote><p>判断是否引用的是同一个对象: x is y,类似于id(x)===id(y)</p></blockquote><h4 id="数据类型">数据类型</h4><ul><li><p>整数、浮点数(1.23x10^9: 1.23e9)</p></li><li><p>字符串 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-string">&quot;xyz&quot;</span>         &gt;&gt; abc xyz<br><span class="hljs-string">&#x27;I\&#x27;m\&quot;OK\&quot;!&#x27;</span>        &gt;&gt; I<span class="hljs-string">&#x27;m OK！</span><br><span class="hljs-string">r&#x27;</span>\\\t\\<span class="hljs-string">&#x27;            &gt;&gt; &#x27;</span>\\\t\\<span class="hljs-string">&#x27;  # 原始字符串r</span><br><span class="hljs-string">r&#x27;</span><span class="hljs-string">&#x27;&#x27;</span>hello,\nworld<span class="hljs-string">&#x27;&#x27;&#x27; &gt;&gt; &#x27;hello,\\nworld&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p>布尔值 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">and</span>: ture <span class="hljs-keyword">and</span> flase  &gt;&gt; false<br><span class="hljs-keyword">or</span>:  false <span class="hljs-keyword">or</span> true   &gt;&gt; true<br><span class="hljs-keyword">not</span>: <span class="hljs-keyword">not</span> false       &gt;&gt; true<br></code></pre></td></tr></table></figure></p></li></ul><h4 id="变量">变量</h4><blockquote><p>变量名必须是<code>大小写英文、数字和_</code>的组合，且不能用数字开头,Python支持多种数据类型，在计算机内部，可以把任何数据都看成一个<code>“对象”</code>，而<code>变量</code>就是在程序中用来<code>指向这些数据对象</code>的，对变量赋值就是把数据和变量给关联起来.</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br>a = <span class="hljs-string">&#x27;ABC&#x27;</span><span class="hljs-comment"># 内存中创建&#x27;ABC&#x27;字符串</span><br>b = a<span class="hljs-comment"># 内存创建变量b指向&#x27;ABC&#x27;</span><br>a = <span class="hljs-string">&#x27;XYZ&#x27;</span>   <span class="hljs-comment"># 创建&#x27;XYZ&#x27;, 将a指向此字符串</span><br><span class="hljs-built_in">print</span>(b)<br><br>&gt;&gt; ABC<br></code></pre></td></tr></table></figure><h3 id="字符串和编码">字符串和编码</h3><h4 id="python-3版本中字符串是以unicode编码">Python3版本中，字符串是以<code>Unicode</code>编码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;中&#x27;</span>)  &gt;&gt; <span class="hljs-number">20013</span><br><span class="hljs-built_in">chr</span>(<span class="hljs-number">25991</span>) &gt;&gt; <span class="hljs-string">&#x27;文&#x27;</span><br><br><span class="hljs-string">&#x27;中文&#x27;</span>.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>&gt;&gt; <span class="hljs-string">b&#x27;\xe4\xb8\xad\xe6\x96\x87&#x27;</span><br><br><span class="hljs-string">b&#x27;\xe4\xb8\xad\xff&#x27;</span>.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>&gt;&gt; <span class="hljs-string">&#x27;中&#x27;</span><br><br><span class="hljs-built_in">len</span>(<span class="hljs-string">b&#x27;ABC&#x27;</span>)  &gt;&gt; <span class="hljs-number">3</span><span class="hljs-comment"># 字节</span><br><span class="hljs-built_in">len</span>(<span class="hljs-string">&#x27;中文&#x27;</span>.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))  &gt;&gt; <span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><h4 id="格式化输出">格式化输出(<code>%</code>)</h4><ul><li><p>%s %d %? <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;Hello, %s&#x27;</span> % <span class="hljs-string">&#x27;world&#x27;</span>    &gt;&gt; <span class="hljs-string">&#x27;Hello, world&#x27;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%2d-%02d&#x27;</span> % (<span class="hljs-number">3</span>, <span class="hljs-number">1</span>))  &gt;&gt; 补空格<span class="hljs-number">3</span>-01<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%.2f&#x27;</span> % <span class="hljs-number">3.1415926</span>)   &gt;&gt; <span class="hljs-number">3.14</span><br></code></pre></td></tr></table></figure></p></li><li><p>format() <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;Hello, &#123;0&#125;, 成绩提升了&#123;1:.1f&#125;%&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;小明&#x27;</span>, <span class="hljs-number">17.125</span>)  &gt;&gt; <span class="hljs-string">&#x27;Hello, 小明, 成绩提升了17.1%&#x27;</span> <br></code></pre></td></tr></table></figure></p></li><li><p>格式化字符串</p><ul><li>格式化字符串，可以通过在字符串前添加一个f来创建一个格式化字符串</li><li>在格式化字符串中可以直接嵌入变量 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">c = <span class="hljs-string">f&#x27;hello <span class="hljs-subst">&#123;a&#125;</span> <span class="hljs-subst">&#123;b&#125;</span>&#x27;</span> \ <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;a = <span class="hljs-subst">&#123;a&#125;</span>&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="list-tuple-dict-set">list tuple dict set</h3><h4 id="list">list[]</h4><p>Python内置的数据类型列表：<code>list</code>是一种有序的集合，可以随时<code>添加</code>和<code>删除</code>其中的元素</p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>list.append()</td><td>追加元素到末尾</td></tr><tr><td>list.insert()</td><td>插入到指定位置</td></tr><tr><td>list.pop()方法</td><td>删除指定位置元素</td></tr><tr><td>list.len()</td><td>列表元素个数</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">classmates = [<span class="hljs-string">&#x27;Michael&#x27;</span>, <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-string">&#x27;Tracy&#x27;</span>]  &gt;&gt; [<span class="hljs-string">&#x27;Michael&#x27;</span>, <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-string">&#x27;Tracy&#x27;</span>]<br><span class="hljs-built_in">len</span>(classmates)  &gt;&gt; <span class="hljs-number">3</span><br>classmates[-<span class="hljs-number">1</span>]   &gt;&gt; <span class="hljs-string">&#x27;Tracy&#x27;</span><br>classmates[-<span class="hljs-number">2</span>]   &gt;&gt; <span class="hljs-string">&#x27;Bob&#x27;</span><br>classmates.append(<span class="hljs-string">&#x27;Adam&#x27;</span>)  &gt;&gt; [<span class="hljs-string">&#x27;Michael&#x27;</span>, <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-string">&#x27;Tracy&#x27;</span>, <span class="hljs-string">&#x27;Adam&#x27;</span>]<br>classmates.insert(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>)  &gt;&gt; [<span class="hljs-string">&#x27;Michael&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-string">&#x27;Tracy&#x27;</span>, <span class="hljs-string">&#x27;Adam&#x27;</span>]<br>classmates.pop(<span class="hljs-number">3</span>)          &gt;&gt; <span class="hljs-string">&#x27;Tracy&#x27;</span> --&gt;[<span class="hljs-string">&#x27;Michael&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-string">&#x27;Adam&#x27;</span>]<br>classmates[<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;Sarah&#x27;</span>       &gt;&gt; [<span class="hljs-string">&#x27;Michael&#x27;</span>, <span class="hljs-string">&#x27;Sarah&#x27;</span>, <span class="hljs-string">&#x27;Tracy&#x27;</span>]<br><br>L = [<span class="hljs-string">&#x27;Apple&#x27;</span>, <span class="hljs-number">123</span>, <span class="hljs-literal">True</span>]<br>s = [<span class="hljs-string">&#x27;python&#x27;</span>, <span class="hljs-string">&#x27;java&#x27;</span>, [<span class="hljs-string">&#x27;asp&#x27;</span>, <span class="hljs-string">&#x27;php&#x27;</span>], <span class="hljs-string">&#x27;scheme&#x27;</span>]<br></code></pre></td></tr></table></figure><h4 id="tuple">tuple()</h4><p>Python内置的数据类型<code>有序列表</code>叫元组：<code>tuple</code>，tuple和list非常类似，但是<code>tuple一旦初始化就不能修改</code><br /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">classmates = (<span class="hljs-string">&#x27;Michael&#x27;</span>, <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-string">&#x27;Tracy&#x27;</span>)<br>t = (<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, [<span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>])<br>&gt;&gt; t[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;X&#x27;</span><br>&gt;&gt; t[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;Y&#x27;</span><br></code></pre></td></tr></table></figure></p><h4 id="dict">dict</h4><blockquote><p>字典的<code>键</code>可以是任意的<code>不可变对象</code>(int, str,bool, tuple…), 不能重复；字典的值可以是任何对象<br />{key1:value1,key2:value2,…}</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">d = <span class="hljs-built_in">dict</span>(name=<span class="hljs-string">&#x27;Li&#x27;</span>,age=<span class="hljs-string">&#x27;1&#x27;</span>,gender=<span class="hljs-string">&#x27;boy&#x27;</span>)<br>d = <span class="hljs-built_in">dict</span>([(<span class="hljs-string">&#x27;name&#x27;</span>,<span class="hljs-string">&#x27;Li&#x27;</span>),(<span class="hljs-string">&#x27;age&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)])<br>d = &#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Li&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;boy&#x27;</span>&#125;<br><br>d[<span class="hljs-string">&#x27;name&#x27;</span>]&gt;&gt; Li<br>d[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&quot;Xing&quot;</span><span class="hljs-comment"># 修改</span><br>d.get(<span class="hljs-string">&#x27;name&#x27;</span>, default)&gt;&gt; Li <span class="hljs-comment"># key存在返回对应值，不存在返回默认值</span><br>d.pop(<span class="hljs-string">&#x27;name&#x27;</span>)&gt;&gt; 删除name对应的值<br><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> d.keys():<span class="hljs-comment"># keys()  返回序列，保存由字典所有键</span><br><span class="hljs-built_in">print</span>(k,d[k])<br><br>&gt;&gt; name Li<br>   age <span class="hljs-number">1</span><br>   gender by<br><br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> d.values():  <span class="hljs-comment"># values()  返回序列，保存由字典所有值</span><br><span class="hljs-built_in">print</span>(v)<br><br><span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> d.items(): <span class="hljs-comment"># items() dict_item([(&#x27;name&#x27;,&#x27;Li&#x27;), (&#x27;age&#x27;, &#x27;1&#x27;), (&#x27;gender&#x27;, &#x27;boy&#x27;)])</span><br><span class="hljs-built_in">print</span>(k , <span class="hljs-string">&#x27;=&#x27;</span> , v)<br><br>&gt;&gt; name = Li<br>   age = <span class="hljs-number">18</span><br>   gender = boy<br></code></pre></td></tr></table></figure><h4 id="set">set</h4><blockquote><p>集合中只能存储不可变对象，<code>不重复且无序</code>;将字典转为集合只包含字典中键<br />对于不变对象来说，调用对象自身的任意方法，也不会改变该对象自身的内容。相反，这些方法会创建新的对象并返回，这样，就保证了不可变对象本身永远是不可变的</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">s = &#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;1,&#x27;</span> <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>&#125;  &gt;&gt; &#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>s = <span class="hljs-built_in">set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>])&gt;&gt; &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;<br>s.add(<span class="hljs-number">5</span>)<br>s.remove(<span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><h3 id="条件判断循环注意缩进">条件判断&amp;&amp;循环(注意缩进)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 判断水仙花数(n&gt;=3)</span><br>i = <span class="hljs-number">100</span><br><span class="hljs-keyword">while</span> i &lt; <span class="hljs-number">1000</span>:<br>bai = i // <span class="hljs-number">100</span><br><span class="hljs-comment"># shi = (i -a * 100) // 10</span><br>shi = i // <span class="hljs-number">10</span> % <span class="hljs-number">10</span><br>ge = i % <span class="hljs-number">10</span><br><span class="hljs-keyword">if</span> bai**<span class="hljs-number">3</span> + shi**<span class="hljs-number">3</span> + ge**<span class="hljs-number">3</span> == i:<br><span class="hljs-built_in">print</span>(i)<br>i += <span class="hljs-number">1</span><br>----------------------------------------<br><span class="hljs-comment"># 判断质数(只能被1和它自身整除)</span><br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> *<br>begin = time()<br>num = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;输入大于1的整数：&#x27;</span>))<br>i = <span class="hljs-number">2</span> <br><span class="hljs-keyword">while</span> i &lt;= num: <span class="hljs-comment"># 取出 2-num 所有数</span><br>flag = <span class="hljs-literal">True</span> <span class="hljs-comment"># </span><br>j = <span class="hljs-number">2</span><br><span class="hljs-keyword">while</span> j &lt;= i ** <span class="hljs-number">0.5</span>:<br><span class="hljs-keyword">if</span> i % j == <span class="hljs-number">0</span>:<span class="hljs-comment"># num不是质数 </span><br>flag = <span class="hljs-literal">False</span><br><span class="hljs-keyword">break</span><br>j += <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> flag:<br><span class="hljs-comment"># pass</span><br><span class="hljs-built_in">print</span>(i)<br>i += <span class="hljs-number">1</span><br>end = time()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;use time=&quot;</span>,end - begin, <span class="hljs-string">&#x27;秒&#x27;</span>)<br>----------------------------------------------<br><span class="hljs-comment"># 99乘法表(嵌套)</span><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> i &lt; <span class="hljs-number">9</span>:<br>i += <span class="hljs-number">1</span><span class="hljs-comment"># 外层高度</span><br><span class="hljs-keyword">while</span> j &lt; i:<span class="hljs-comment"># 内层宽度</span><br>j += <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;j&#125;</span>*<span class="hljs-subst">&#123;i&#125;</span>=<span class="hljs-subst">&#123;i*j&#125;</span> &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-built_in">print</span>()<br>----------------------------------------------<br><span class="hljs-comment"># break &amp;&amp; continue(对就近循环起作用)</span><br>i = <span class="hljs-number">0</span> <br><span class="hljs-keyword">while</span> i &lt; <span class="hljs-number">5</span>:<br>i += <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> i == <span class="hljs-number">2</span>:<br><span class="hljs-keyword">break</span><span class="hljs-comment"># 结束整个循环</span><br><span class="hljs-keyword">continue</span> <span class="hljs-comment"># 结束当次循环</span><br><span class="hljs-built_in">print</span>(i)<br>i += <span class="hljs-number">1</span><br><span class="hljs-keyword">else</span>:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;循环结束&#x27;</span>)<br>---------------------------------------------<br>names = [<span class="hljs-string">&#x27;Michael&#x27;</span>, <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-string">&#x27;Tracy&#x27;</span>]<br><span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> names:<br>    <span class="hljs-built_in">print</span>(name)<br></code></pre></td></tr></table></figure><h3 id="迭代器iter和生成器yield">迭代器：iter和生成器：yield</h3><blockquote><p>迭代器是访问集合元素的一种方式，是可以记住遍历的位置的对象，从集合第一个元素开始到所有元素被访问完结束，只能往前不会后退；基本方法<code>iter()和next()</code>，字符串、列表和元组均可用于创建迭代器</p></blockquote><blockquote><p><code>生成器</code>是一个<code>返回迭代器的函数</code>，只能用于迭代操作，更简单点理解生成器就是一个迭代器，调用一个<code>生成器函数</code>，返回的是一个<code>迭代器对象</code>，在调用生成器运行的过程中，每次遇到yield 时函数<code>会暂停并保存当前所有的运行信息</code>，返回 yield的值, 并在下一次执行 next() 方法时从当前位置继续运行。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fibonaci</span>(<span class="hljs-params">n,w=<span class="hljs-number">0</span></span>):<span class="hljs-comment"># 生成器函数:斐波那契</span><br>    a, b, counter = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">if</span>(counter &gt;n):<br>    <span class="hljs-keyword">return</span> <br>    <span class="hljs-keyword">yield</span> a<br>    a, b = b, a + b<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%d,%d&#x27;</span> % (a,b))<br>    counter +=<span class="hljs-number">1</span><br><br>f = fibonaci(<span class="hljs-number">3</span>,<span class="hljs-number">0</span>) <span class="hljs-comment"># f 是一个迭代器，由生成器返回生成</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br><span class="hljs-keyword">try</span>:<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(f), enf=<span class="hljs-string">&quot; &quot;</span>)<br><span class="hljs-keyword">except</span>:<br>sys.exit()<br>------------<br>Output:<br><span class="hljs-number">0</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span><br><span class="hljs-number">1</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span><br><span class="hljs-number">1</span> <span class="hljs-number">2</span>,<span class="hljs-number">3</span><br><span class="hljs-number">2</span> <span class="hljs-number">3</span>,<span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><h3 id="函数">函数</h3><h4 id="概念">概念</h4><ul><li>函数是一个对象，在内存中专门用来存储数据的一块区域；如果形参执行的是一个对象，当通过形参去改对象时，会影响到所有指向该对象的变量；<em>print(fn)，fn是函数对象，实际是打印函数对象；而print(fn())，则是在打印fn()函数的返回值</em><br /></li><li>定义:<br /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">functionName</span>(<span class="hljs-params">argu1, argu2, ...</span>):<br>  code block<br></code></pre></td></tr></table></figure></li></ul><h4 id="函数的参数">函数的参数:</h4><ul><li><p>位置参数，调用函数时，传入的两个值按照位置顺序依次赋给参数x和n<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">power</span>(<span class="hljs-params">x,n</span>):<br>  s = <span class="hljs-number">1</span><br>  <span class="hljs-keyword">while</span> n &gt; <span class="hljs-number">0</span>:<br>  n = n -<span class="hljs-number">1</span><br>  s = s * x<br>  <span class="hljs-keyword">return</span> s<br></code></pre></td></tr></table></figure></p></li><li><p>默认参数，必须指向不变对象 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_end</span>(<span class="hljs-params">L=<span class="hljs-literal">None</span></span>):<br>  <span class="hljs-keyword">if</span> L <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>     L = []<br>     L.append(<span class="hljs-string">&#x27;END&#x27;</span>)<br>  <span class="hljs-keyword">return</span> L<br></code></pre></td></tr></table></figure></p></li><li><p>可变参数，允许传入0个或任意个参数，这些可变参数在函数调用时自动组装为一个<code>tuple</code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">calc</span>(<span class="hljs-params">*numbers</span>):<span class="hljs-comment"># *nums表示把nums这个list的所有元素作为可变参数传进去</span><br>  <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> numbers:<br>    <span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span> + n * n<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>calc(*nums)<br>    <span class="hljs-number">14</span><br></code></pre></td></tr></table></figure></p></li><li><p>关键字参数，允许传入0个或任意个含参数名的参数，这些关键字参数在函数内部自动组装为一个<code>dict</code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">person</span>(<span class="hljs-params">name, age, **kw</span>):<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;name:&#x27;</span>, name, <span class="hljs-string">&#x27;age:&#x27;</span>, age, <span class="hljs-string">&#x27;other:&#x27;</span>, kw)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>person(<span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-number">35</span>, city=<span class="hljs-string">&#x27;Beijing&#x27;</span>)<br>    name: Bob age: <span class="hljs-number">35</span> other: &#123;<span class="hljs-string">&#x27;city&#x27;</span>: <span class="hljs-string">&#x27;Beijing&#x27;</span>&#125;<br></code></pre></td></tr></table></figure></p></li></ul><h4 id="递归">递归：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">factorial</span>(<span class="hljs-params">n</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">求任意数的阶乘</span><br><span class="hljs-string">参数: </span><br><span class="hljs-string">n: 要求阶乘的数字</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>  <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>:<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> n * factorial(n-<span class="hljs-number">1</span>)<br>------------------------------<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">huiWen</span>(<span class="hljs-params">s</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">判断是否为回文字符串</span><br><span class="hljs-string">参数：</span><br><span class="hljs-string">s：要检查的字符串</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(s) == <span class="hljs-number">2</span>:<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><span class="hljs-keyword">elif</span> s[<span class="hljs-number">0</span>] != s[-<span class="hljs-number">1</span>]:<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><span class="hljs-keyword">return</span> huiWen(s[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure><h4 id="filter匿名函数-lambda-与-map">filter、匿名函数: lambda 与map</h4><ul><li><p><code>filter(function,iterable)</code>:可以从序列中过滤出符合条件的元素，保存到一个新的序列对象中，<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">a = <span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>))<br><span class="hljs-meta">&gt;&gt;&gt; </span>&lt;<span class="hljs-built_in">filter</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x0000027939040390</span>&gt;<br></code></pre></td></tr></table></figure></p></li><li><p><code>lambda 参数列表 : 返回值</code>: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> i:i&gt;<span class="hljs-number">5</span>,l)<br></code></pre></td></tr></table></figure></p></li><li><p><code>map(function, iterable, ...)</code>:可以对可迭代对象中的所有元素做指定操作，然后将其添加到一个新的对象中返回，<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x, y: x + y, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>]) <br><span class="hljs-meta">&gt;&gt;&gt; </span>&lt;<span class="hljs-built_in">map</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x0000027939040CF8</span>&gt;<br></code></pre></td></tr></table></figure></p></li></ul><h4id="闭包函数嵌套-将内部函数作为返回值返回-内部函数必须使用到外部函数的变量">闭包：<code>函数嵌套</code>&amp;&amp; <code>将内部函数作为返回值返回</code> &amp;&amp;<code>内部函数必须使用到外部函数的变量</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">makeAverager</span>():<br>  nums = []<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">averager</span>(<span class="hljs-params">n</span>):<br>  nums.append(n)<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(nums)/<span class="hljs-built_in">len</span>(nums)<br><span class="hljs-keyword">return</span> averager<br><br>averager = makeAverager()<br></code></pre></td></tr></table></figure><h4 id="装饰器-在不改变函数代码的情况下扩展函数功能">装饰器:在不改变函数代码的情况下，扩展函数功能</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">old</span>):<br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kw</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;call %s():&#x27;</span> % func.__name__)<br>    <span class="hljs-keyword">return</span> func(*args, **kw)<br><span class="hljs-keyword">return</span> wrapper<br><br><span class="hljs-meta">@log</span><span class="hljs-comment"># now = log(now)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">now</span>():<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;2015-3-25&#x27;</span>)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>now()<br>  call now():<br>  <span class="hljs-number">2015</span>-<span class="hljs-number">3</span>-<span class="hljs-number">25</span><br></code></pre></td></tr></table></figure><h3 id="面向对象编程">面向对象编程</h3><h4 id="基础">基础</h4><ul><li><p>类：对<code>对象</code>的抽象，是创建对象的模板；属性&amp;&amp;方法</p></li><li><p>对象：则是由类创建的一个<code>实例</code>，而变量是指向对象的内容，如：<code>a='abc'</code>，经常说的对象a的内容是’abc’，其实是指，a本身是一个变量，它指向的对象的内容才是’abc’</p></li><li><p>定义类: <code>p1 = Person('an')</code>执行流程</p><ul><li>(1)创建一个变量；</li><li>(2)在内存中创建新对象；</li><li>(3)<code>__init__(self)</code>方法执行，init在对象创建以后执行，用来初始化新创建的对象</li><li>(4)将对象的id赋值给变量</li><li>(5)self指的是类实例对象本身(注意：不是类本身)</li><li><ahref="https://www.cnblogs.com/chownjy/p/8663024.html">self参考</a><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:<br>   <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<span class="hljs-comment"># 在对象初始化时执行</span><br>     <span class="hljs-variable language_">self</span>.name = name    <span class="hljs-comment"># self为调用该属性/方法实例对象自身 </span><br>  <span class="hljs-comment"># self.__name = name    # 隐藏属性 __name ==&gt; _Person__name</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sayHello</span>(<span class="hljs-params">self</span>):<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我是：%s&#x27;</span> %<span class="hljs-variable language_">self</span>.name)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_name</span>(<span class="hljs-params">self</span>):<br>  <span class="hljs-comment"># print(&#x27;读取属性&#x27;)</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.name<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_name</span>(<span class="hljs-params">self, name</span>):<br>     <span class="hljs-comment"># print(&#x27;设置属性&#x27;)</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.name = name<br><br>p1 = Person(<span class="hljs-string">&#x27;an&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ul></li></ul><h4 id="特征">特征：</h4><ul><li><p>封装:隐藏对象中一些不希望被外部所访问到的属性或方法，确保对象中的数据安全</p><ul><li>getter 获取对象中的指定属性（get_属性名）</li><li>setter 用来设置对象的指定属性（set_属性名） <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:<br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,name</span>):<br>    <span class="hljs-variable language_">self</span>._name = name<br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_name</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._name<br><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_name</span>(<span class="hljs-params">self , name</span>):<br>    <span class="hljs-variable language_">self</span>._name = name   <br><br> p = Person(<span class="hljs-string">&#x27;孙悟空&#x27;</span>)<br> <span class="hljs-built_in">print</span>(p._name)<br></code></pre></td></tr></table></figure></li></ul></li><li><p>继承：实现子类的属性和方法的功能扩展，保证了对象的可扩展性<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span>:<br>   <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>     <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;动物会跑~~~&#x27;</span>)<br>   <span class="hljs-keyword">def</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-params">self</span>):<br>     <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;动物睡觉~~~&#x27;</span>)<br><span class="hljs-meta">   @property</span><br>   <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self</span>):<br>     <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._name<br><span class="hljs-meta">   @name.setter    </span><br>   <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self,name</span>):<br>     <span class="hljs-variable language_">self</span>._name = name<br><br> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-title class_ inherited__">Animal</span>):<br>   <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,name,age</span>):<br>       <span class="hljs-comment"># 调用父类的__init__来初始化父类中定义的属性</span><br>       <span class="hljs-comment"># super() 可以用来获取当前类的父类，</span><br>       <span class="hljs-comment"># 并且通过super()返回对象调用父类方法时，不需要传递self</span><br>     <span class="hljs-built_in">super</span>().__init__(name)<br>     <span class="hljs-variable language_">self</span>._age = age<br>   <span class="hljs-keyword">def</span> <span class="hljs-title function_">bark</span>(<span class="hljs-params">self</span>):<br>     <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;汪汪汪~~~&#x27;</span>) <br>   <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>     <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;狗跑~~~~&#x27;</span>) <br><span class="hljs-meta">   @property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">age</span>(<span class="hljs-params">self</span>):<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._age<br><span class="hljs-meta">@age.setter    </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">age</span>(<span class="hljs-params">self,age</span>):<br>  <span class="hljs-variable language_">self</span>._age = name<br><br> d = Dog(<span class="hljs-string">&#x27;旺财&#x27;</span>,<span class="hljs-number">18</span>) <br> <span class="hljs-built_in">print</span>(d.name)       <br> <span class="hljs-built_in">print</span>(d.age)<br></code></pre></td></tr></table></figure></p></li><li><p>多态：一个对象可以以不同的形态去呈现，保证了程序的灵活性</p></li></ul><h3 id="模块python文件-包文件">模块(python文件) 包(文件)</h3><ul><li>导入模块: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> 模块名 <br><span class="hljs-keyword">import</span> 模块名 <span class="hljs-keyword">as</span> 模块别名<br></code></pre></td></tr></table></figure></li><li>访问模块变量：模块名.变量名</li><li>导入模块部分内容: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> 模块名 <span class="hljs-keyword">import</span> 变量 <span class="hljs-keyword">as</span> 别名<br></code></pre></td></tr></table></figure></li></ul><h3 id="异常">异常</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;异常出现前&#x27;</span>)<br>l = []<br><span class="hljs-keyword">try</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-number">10</span>/<span class="hljs-number">0</span>)<br><span class="hljs-keyword">except</span> NameError:<br>  <span class="hljs-comment"># 如果except后不跟任何的内容，则此时它会捕获到所有的异常</span><br>  <span class="hljs-comment"># 如果在except后跟着一个异常的类型，那么此时它只会捕获该类型的异常</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;出现 NameError 异常&#x27;</span>)<br><span class="hljs-keyword">except</span> ZeroDivisionError:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;出现 ZeroDivisionError 异常&#x27;</span>)<br><span class="hljs-keyword">except</span> IndexError:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;出现 IndexError 异常&#x27;</span>)<br><br><span class="hljs-comment"># Exception 是所有异常类的父类，所以如果except后跟的是Exception，他也会捕获到所有的异常</span><br><span class="hljs-comment"># 可以在异常类后边跟着一个 as xx 此时xx就是异常对象</span><br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e :<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;未知异常&#x27;</span>,e,<span class="hljs-built_in">type</span>(e))<br><span class="hljs-keyword">finally</span> :<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;无论是否出现异常，该子句都会执行&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;异常出现后&#x27;</span>)<br>----------------------------------------------------------------------------------<br><span class="hljs-comment"># 自定义异常类，创建一个类继承Exception</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyError</span>(<span class="hljs-title class_ inherited__">Exception</span>):<br>  <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a,b</span>):<br><span class="hljs-comment"># 如果a和b中有负数，就向调用处抛出异常</span><br>  <span class="hljs-keyword">if</span> a &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> b &lt; <span class="hljs-number">0</span>:<br>  <span class="hljs-comment"># raise用于向外部抛出异常，后边可以跟一个异常类，或异常类的实例</span><br>  <span class="hljs-comment"># raise Exception    </span><br>  <span class="hljs-comment"># 抛出异常的目的</span><br>  <span class="hljs-comment"># raise Exception(&#x27;两个参数中不能有负数！&#x27;)  </span><br>  <span class="hljs-keyword">raise</span> MyError(<span class="hljs-string">&#x27;自定义的异常&#x27;</span>)<br><br>  <span class="hljs-comment"># 也可以通过if else来代替异常的处理</span><br>  <span class="hljs-comment"># return None</span><br>  r = a + b<br>  <span class="hljs-keyword">return</span> r<br><br><span class="hljs-built_in">print</span>(add(-<span class="hljs-number">123</span>,<span class="hljs-number">456</span>))<br></code></pre></td></tr></table></figure><h3 id="文件">文件</h3><blockquote><p>文件打开 –&gt;操作文件(读/写) –&gt;关闭文件</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python">file_name = <span class="hljs-string">&#x27;demo.txt&#x27;</span><br>file_obj = <span class="hljs-built_in">open</span>(file_name)<br>content = file_obj.read()<br>file_obj.close()<br><br><span class="hljs-comment"># with ... as 语句</span><br><span class="hljs-comment"># with open(file_name) as file_obj :</span><br><span class="hljs-comment"># 在with语句中可以直接使用file_obj来做文件操作</span><br><span class="hljs-comment"># 此时这个文件只能在with中使用，一旦with结束则文件会自动close()</span><br><span class="hljs-comment"># print(file_obj.read())</span><br><br>file_name = <span class="hljs-string">&#x27;demo.txt&#x27;</span><br><span class="hljs-keyword">try</span>: <br>  <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_name,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file_obj:<br>    file_content = <span class="hljs-string">&#x27;&#x27;</span><br>    chunk = <span class="hljs-number">100</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>      content = file_obj.read(chunk)<br>      <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> content:<br>        <span class="hljs-keyword">break</span><br>      <span class="hljs-comment"># print(content,end=&#x27;&#x27;)</span><br>      file_content += content<br><br><span class="hljs-keyword">except</span> FileNotFoundError :<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;file_name&#125;</span> 这个文件不存在！&#x27;</span>)<br><span class="hljs-built_in">print</span>(file_content)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>apache-nginx-tomcat</title>
    <link href="/posts/c9dd20a7.html"/>
    <url>/posts/c9dd20a7.html</url>
    
    <content type="html"><![CDATA[<p>2019-09-09-ANT <span id="more"></span></p><h2 id="进程与线程">进程与线程</h2><blockquote><p><a href="https://www.zhihu.com/question/25532384">参考文章</a><br />进程是<code>资源分配</code>的最小单位，线程是<code>CPU调度</code>的最小单位；</p></blockquote><h3 id="二者关系">二者关系</h3><blockquote><p>一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程（通常说的主线程）;<br />资源分配给进程，<code>同一进程的所有线程共享该进程的所有资源</code>;<br />线程在执行过程中，需要协作同步。不同进程的线程间要利用<code>消息通信</code>的办法实现同步;<br />处理任务分给线程，即真正在处理任务上运行的是线程;<br />线程是指进程内的一个执行单元，也是进程内的可调度实体;</p></blockquote><img src="/posts/c9dd20a7/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B.png" class="" title="[进程与线程]"><img src="/posts/c9dd20a7/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B01.png" class="" title="[进程与线程01]"><h2 id="同步异步-阻塞非阻塞">同步/异步 &amp;&amp; 阻塞/非阻塞</h2><h3 id="同步异步被调用者">同步/异步（被调用者）</h3><ul><li><code>描述网络通信模式，适用于请求-响应模型</code></li><li>同步：发送方发送请求后，需要等待接收响应，否则将一直等待</li><li>异步：发送方发送请求后，不需要等待响应，可以继续发送下一个请求，或者主动挂起线程并释放CPU</li></ul><h3 id="阻塞非阻塞调用者-应用程序">阻塞/非阻塞（调用者-应用程序）</h3><ul><li><code>描述进程的函数调用方式</code><br /></li><li>阻塞：IO 调用会一直阻塞，直至结果返回才能继续执行</li><li>非阻塞：IO 调用会立即返回，不需要等待结果，并可以执行下一个 I/O调用</li></ul><h2id="io多路复用的三种模型selectpollepoll">IO多路复用的三种模型:Select，Poll，Epoll</h2><ul><li><ahref="https://www.cnblogs.com/javalyy/p/8882066.html">参考文章</a><br /></li><li>IO有<code>内存IO</code>、<code>网络IO</code>和<code>磁盘IO</code>三种，通常说的IO指的是后两者;以文件IO为例,一个IO读过程是文件数据从<code>磁盘→内核缓冲区→用户内存</code>的过程。同步与异步的区别主要在于数据从内<code>核缓冲区→用户内存</code>这个过程需不需要用户进程等待，即实际的IO读写是否阻塞请求进程。(网络IO把磁盘换做网卡即可)</li></ul><table><thead><tr><th>项目</th><th>select</th><th>poll</th><th>epoll</th></tr></thead><tbody><tr><td>操作方式</td><td>遍历</td><td>遍历</td><td>回调</td></tr><tr><td>底层实现</td><td>数组</td><td>链表</td><td>哈希表</td></tr><tr><td>IO效率</td><td>线性遍历,时间复杂度O(n)</td><td>线性遍历, O(n)</td><td>事件通知方式,O(1)</td></tr><tr><td>最大连接数</td><td>1024(x86)/2048(x64)</td><td>无上限</td><td>无上限</td></tr><tr><td>fd拷贝</td><td>每次调用,fd集合从用户态拷贝到内核态</td><td>同select</td><td>拷贝进内核保存</td></tr></tbody></table><h2 id="apachenginx与tomcat区别">apache、nginx与tomcat区别</h2><blockquote><p>Apache和nginx应该叫做<code>HTTP Server</code>，而tomcat是一个<code>Application Server</code>，JSP/Servlet容器应用的容器;Apache HTTPServer和Nginx都能够将某一个<code>静态资源</code>的内容通过HTTP协议返回到客户端，但是这个文本文件的内容是固定的——也就是说无论何时、任何人访问它得到的内容都是完全相同的;Tomcat能够<code>动态的生成资源</code>并返回到客户端;</p></blockquote><h2 id="apache">apache</h2><h3 id="官方网站"><a href="http://httpd.apache.org/">官方网站</a></h3><img src="/posts/c9dd20a7/httpd_logo.png" class="" title="[https_logo]"><h3 id="原理浅析">原理浅析</h3><ul><li>Apache基于<code>多进程的HTTP服务器</code>，它需要对每个用户请求创建一个子进程进行响应，并发的请求量大就会需要非常多的进程，从而占用极多的cpu资源和内存;</li><li>Apache是基于<code>模块化</code>设计的，<code>MPM</code>（Multi-ProcessingModules，多重处理模块）是Apache的核心组件之一，Apache通过MPM来使用操作系统的资源，对进程和线程池进行管理;</li><li>MPM有三种工作方式：<ul><li><a href="http://httpd.apache.org/docs/2.4/mod/prefork.html">PreforkMPM</a></li><li><a href="http://httpd.apache.org/docs/2.4/mod/worker.html">WorkerMPM</a></li><li><a href="http://httpd.apache.org/docs/2.4/mod/event.html">EventMPM</a></li></ul></li></ul><h4 id="prefork-模式预派生子进程">prefork 模式(预派生子进程)</h4><ul><li><code>prefork</code>是一个<code>非线程型的、预派生的MPM</code>，使用多个进程彼此独立，且<code>每个进程只有一个线程</code>，每个进程在某个确定的时间只单独处理一个连接，<code>效率高</code>，但<code>内存使用比较大</code>。</li><li>优点：适合于没有线程安全库，需要避免线程兼容性问题的系统。它是要求将每个请求相互独立的情况下最好的MPM，这样若一个请求出现问题就不会影响到其他请求。</li><li>缺点：一个进程相对占用更多的系统资源，消耗更多的内存。而且，它并不擅长处理高并发请求，在这种场景下，它会将请求放进队列中，一直等到有可用进程，请求才会被处理。</li></ul><h4 id="worker-模式">worker 模式</h4><ul><li><code>worker</code>基于多进程,但是使用了<code>多进程和多线程</code>的混合模式，worker模式也同样会先预派生一些子进程，然后<code>每个子进程创建一些线程</code>，同时包括一个监听线程，每个请求过来会被分配到一个线程来服务。</li><li>优点：线程比起进程会更轻量，因为<code>线程是通过共享父进程的内存空间</code>，因此，内存的占用会减少一些，在高并发，高流量的场景下会比prefork有更多可用的线程，表现会更优秀一些；</li><li>缺点：如果一个线程出现了问题也会导致同一进程下的线程出现问题，如果是多个线程出现问题，也只是影响Apache的一部分，而不是全部。由于用到多进程多线程，需要考虑到线程的安全了，在使用keep-alive长连接的时候，某个线程会一直被占用，即使中间没有请求，需要等待到超时才会被释放（该问题在prefork模式下也存在）。</li></ul><h4 id="event-模式">event 模式</h4><ul><li>Apache最新的工作模式，它和worker模式很像</li><li>优点：不同的是在于它解决了<code>keep-alive长连接</code>的时候占用线程资源被浪费的问题（HTTP的Keepalive方式能减少TCP连接数量和网络负载），在event工作模式中，会有一些专门的线程用来管理这些keep-alive类型的线程，当有真实请求过来的时候，将请求传递给服务器的线程，执行完毕后，又允许它释放。这增强了在高并发场景下的请求处理；</li></ul><h2 id="nginx">nginx</h2><h3 id="参考文章"><ahref="https://www.cnblogs.com/strick/p/9336948.html">参考文章</a></h3><h3 id="官方网站-1"><ahref="http://nginx.org/en/docs/">官方网站</a></h3><h3 id="原理浅析-1">原理浅析</h3><h4 id="组成">组成</h4><blockquote><p>Nginx由一个<code>master进程和多个worker进程</code>组成，主进程接收客户端请求，再转交给工作进程处理，从而很好地利用多核心CPU的计算能力。</p></blockquote><img src="/posts/c9dd20a7/nginx.png" class="" title="[nginx_logo]"><h4 id="编译安装">编译安装</h4><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-comment"># ./configure --prefix=/srv/nginx \</span><br>  --<span class="hljs-keyword">with</span>-file-aio <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_auth_request_module <span class="hljs-string">\</span>  <br>  --<span class="hljs-keyword">with</span>-http_ssl_module <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_v2_module <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_realip_module <span class="hljs-string">\</span> <br>  --<span class="hljs-keyword">with</span>-http_addition_module <span class="hljs-string">\</span> <br>  --<span class="hljs-keyword">with</span>-http_xslt_module=dynamic <span class="hljs-string">\</span> <br>  --<span class="hljs-keyword">with</span>-http_geoip_module=dynamic <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_sub_module <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_dav_module <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_flv_module <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_mp4_module <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_gunzip_module <span class="hljs-string">\</span> <br>  --<span class="hljs-keyword">with</span>-http_gzip_static_module <span class="hljs-string">\</span> <br>  --<span class="hljs-keyword">with</span>-http_random_index_module <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_secure_link_module <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_degradation_module <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_slice_module <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-http_stub_status_module <span class="hljs-string">\</span> <br>  --<span class="hljs-keyword">with</span>-http_perl_module=dynamic <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-pcre <span class="hljs-string">\</span><br>  --<span class="hljs-keyword">with</span>-pcre-jit <span class="hljs-string">\</span> <br>  --<span class="hljs-keyword">with</span>-stream=dynamic <span class="hljs-string">\</span> <br>  --<span class="hljs-keyword">with</span>-stream_ssl_module <span class="hljs-string">\</span><br></code></pre></td></tr></table></figure><h4 id="配置">配置</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">sed</span> -i <span class="hljs-string">&#x27;/^[[:space:]]*#/d&#x27;</span> nginx.conf <br>  user nginx;<br>  <span class="hljs-attribute">worker_process</span> auto; <br>  <span class="hljs-attribute">error_log</span> /var/log/nginx/<span class="hljs-literal">error</span>.log;<br>  <span class="hljs-attribute">pid</span> /run/nginx.pid;<br>  <span class="hljs-attribute">include</span> /usr/share/nginx/modules/<span class="hljs-regexp">*.conf</span>;<br><br>  <span class="hljs-section">event</span> &#123;<br>      <span class="hljs-attribute">worker_connections</span> <span class="hljs-number">1024</span>;<br>  &#125;<br>  <span class="hljs-section">http</span> &#123;<br>      <span class="hljs-attribute">include</span>         mime.types;<br>      <span class="hljs-attribute">default_type</span>    application/octet-stream;<br><br>      <span class="hljs-attribute">sendfile</span>         <span class="hljs-literal">on</span>;<br>      <span class="hljs-attribute">keepalived</span>       <span class="hljs-number">65</span>;<br>      <br>      <span class="hljs-attribute">include</span> /etc/nginx/conf.d/<span class="hljs-regexp">*.conf</span>;<br>      <span class="hljs-attribute">include</span> /etc/nginx/conf.d/vhosts/<span class="hljs-regexp">*.conf</span>;    <span class="hljs-comment"># </span><br><br>      <span class="hljs-section">server</span> &#123;<br>          <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>          <span class="hljs-attribute">server_name</span>  localhost;<br><br>          <span class="hljs-section">location</span> / &#123;                <span class="hljs-comment"># localhost:80/ </span><br>              <span class="hljs-attribute">root</span>     html;          <span class="hljs-comment"># 路径</span><br>              <span class="hljs-attribute">index</span>    index.html index.htm;<br>          &#125;<br>          <br>          <span class="hljs-section">location</span> /demo &#123;        <span class="hljs-comment"># localhost:80/demo/</span><br>              <span class="hljs-attribute">root</span> /opt/test;     <span class="hljs-comment"># 实际访问 /opt/test/demo</span><br>              <span class="hljs-attribute">alias</span> /opt/test;    <span class="hljs-comment"># 实际访问 /opt/test</span><br>          &#125;<br><br>          <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;<br>          <span class="hljs-section">location</span> = /50x.html &#123;<br>              <span class="hljs-attribute">root</span> html;<br>          &#125;<br>      &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><h3 id="cgifastcgiphp-fpm">CGI、FastCGI、PHP-FPM</h3><ul><li>CGI（CommonInterface，公共网关接口）是<strong>Web服务器与外部程序之间</strong>的接口标准，用于<code>两种不同程序之间的信息传递</code>。CGI规范允许Web服务器根据浏览器请求调用CGI程序，并将其输出结果通过响应发送给浏览器，从而使Web服务器支持处理复杂的网站业务需求;</li><li><code>FastCGI</code>主要用于解决CGI性能上的缺陷。传统CGI方式是每当客户端请求CGI时，Web服务器就通过操作系统创建一个新的CGI进程，一个CGI进程完成一个请求处理后就退出，下次请求再创建一个新CGI进程。由于这种方式需要不断为每个请求创建进程，因此在网站并发量很大时显得非常低效。FastCGI优化了这种工作方式，它由一个<code>常驻的CGI进程管理器</code>，通过管理<code>一个进程池</code>来处理Web服务器的请求，由此提高了性能;</li><li>PHP提供的<code>PHP-FPM</code>（FastCGI ProcessManager）就是一个<code>FastCGI进程管理器</code>，其可执行文件位于PHP安装的目录中;</li></ul><h2 id="tomcat">tomcat</h2><h3 id="参考文章-1"><ahref="https://www.cnblogs.com/hggen/p/6264475.html">参考文章</a></h3><h3 id="官方网站-2"><ahref="http://tomcat.apache.org/">官方网站</a></h3><img src="/posts/c9dd20a7/tomcat.png" class="" title="[tomcat_logo]">]]></content>
    
    
    <categories>
      
      <category>apache</category>
      
      <category>nginx</category>
      
      <category>tomcat</category>
      
    </categories>
    
    
    <tags>
      
      <tag>devops</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ansible</title>
    <link href="/posts/a71433d.html"/>
    <url>/posts/a71433d.html</url>
    
    <content type="html"><![CDATA[<p>2019-08-28-Ansible <span id="more"></span></p><h1 id="ansible">Ansible</h1><h2 id="前话">前话</h2><ul><li><code>IAAS</code>(Infrastucture as a Service)‘’基础设施即服务’’<br /></li><li><code>PAAS</code>(Platform as a Service) ‘’平台即服务’’<br /></li><li><code>SAAS</code>(Service as a Service) ‘’软件即服务’’</li></ul><h2 id="简介">简介</h2><blockquote><p>ansible是新出现的<code>自动化运维工具</code>，<code>基于Python</code>开发，集合了众多运维工具（puppet、cfengine、chef、func、fabric）的优点，实现了<code>批量系统配置、批量程序部署、批量运行命令</code>等功能。</p></blockquote><blockquote><p>ansible是<code>基于模块</code>工作的，本身没有批量部署的能力。真正具有批量部署的是ansible所运行的模块，ansible只是提供一种框架。主要包括：<br />(1)<code>connection plugins</code>：负责和被监控端实现通信；<br />(2)<code>host inventory</code>：指定操作的主机，是一个配置文件里面定义监控的主机；<br />(3)各种模块核心模块、command模块、自定义模块；(4)借助于插件完成记录日志邮件等功能；<br />(5)<code>playbook</code>：剧本执行多个任务时，非必需可以让节点一次性运行多个任务。</p></blockquote><h2 id="架构与原理">架构与原理</h2><blockquote><p>ansible通过<code>ssh实现</code>配置管理、应用部署、任务执行等功能</p></blockquote><img src="/posts/a71433d/ansible%E6%9E%B6%E6%9E%84.png" class="" title="[ansible架构]"><img src="/posts/a71433d/ansible%E5%8E%9F%E7%90%86.png" class="" title="[ansible原理]"><h2 id="安装">安装:</h2><h3 id="rpm-方式">RPM 方式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.backup<br><span class="hljs-built_in">mv</span> /etc/yum.repos.d/epel-testing.repo /etc/yum.repos.d/epel-testing.repo.backup<br>wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo<br><br>yum install ansible<br></code></pre></td></tr></table></figure><h3 id="git-方式">Git 方式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> git://github.com/ansible.git --recursive<br><span class="hljs-built_in">cd</span> ./ansible<br><span class="hljs-built_in">source</span> ./hacking/env-setup<br></code></pre></td></tr></table></figure><h3 id="相关文件">相关文件</h3><ul><li><p>配置文件 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/ansible/ansible.cfg <span class="hljs-comment"># 主配置文件</span><br>/etc/ansible/hosts <span class="hljs-comment"># 主机清单</span><br>/etc/ansible/roles <span class="hljs-comment"># 存放角色</span><br></code></pre></td></tr></table></figure></p></li><li><p>程序 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/bin/ansible <span class="hljs-comment"># 主程序</span><br>/usr/bin/ansible-doc  <span class="hljs-comment"># 帮助文档</span><br>/usr/bin/ansible-galaxy <span class="hljs-comment"># Download/Upload Role Module</span><br>/usr/bin/ansible-playbook <span class="hljs-comment"># 定制自动化任务编排剧本工具</span><br>/usr/bin/ansible-pull <span class="hljs-comment"># 远程执行命令工具</span><br>/usr/bin/ansible-vault<span class="hljs-comment"># 文件加密tool</span><br>/usr/bin/ansible-console     <span class="hljs-comment"># Terminal Tool</span><br></code></pre></td></tr></table></figure></p></li></ul><h2 id="基本使用">基本使用</h2><h3 id="ansible-options">ansible <host-pattern> [options]</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@anyue ~]# /etc/ansible/ansible.cfg  <br>  61 host_key_checking = False         <span class="hljs-comment"># 启用  </span><br>  101 log_path = /var/log/ansible.log  <span class="hljs-comment"># 启用日志  </span><br>[root@anyue ~]# /etc/ansible/hosts<br>  [group1]  <br>  hostIP1  <br>  hostIP2  <br><br>  [group2]  <br>  hostIP1  <br><br>  [group:children]  <br>  group1   <br>  group2<br></code></pre></td></tr></table></figure><h3 id="命令">命令</h3><table><thead><tr><th>命令</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>ansible-doc</code></td><td>-a</td><td>显示所有模块文档</td></tr><tr><td>–</td><td><code>-l,--list</code></td><td>列出可用模块,也可以指定模块</td></tr><tr><td>–</td><td><code>-s,--snippet</code></td><td>指定模块playbook片段</td></tr><tr><td><code>ansible</code></td><td>-m</td><td>指定模块,默认command模块</td></tr><tr><td>–</td><td>-a</td><td>传递命令</td></tr><tr><td>–</td><td><code>-k,--ask-pass</code></td><td>提示输入ssh密码,默认Key验证</td></tr><tr><td>–</td><td>–list</td><td>显示主机</td></tr><tr><td>–</td><td><code>-C,--check</code></td><td>测试执行过程</td></tr><tr><td><code>ansible-galaxy</code></td><td>list</td><td>列出所装角色</td></tr><tr><td>–</td><td>info</td><td>角色信息</td></tr><tr><td>–</td><td>remove</td><td>删除角色</td></tr><tr><td><code>ansible-pull</code></td><td>–</td><td>推送命令至远程</td></tr><tr><td><code>ansible-playbook</code></td><td>-C</td><td>检查,不执行</td></tr><tr><td>–</td><td><code>--limit hosts</code></td><td>在指定主机执行</td></tr><tr><td>–</td><td><code>--list-hosts</code></td><td>列出运行任务的主机</td></tr><tr><td><code>ansible-vault</code></td><td>encrypt</td><td>加密playbook</td></tr><tr><td>–</td><td>decrypt</td><td></td></tr><tr><td><code>ansible-console</code></td><td>–</td><td>–</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@anyue ansible]# ansible dbser --list<br>[root@anyue ansible]# ansible dbser -m ping -u root -k  <br>[root@anyue ansible]# ansible dbser -m <span class="hljs-built_in">command</span> -u xy -k -a <span class="hljs-string">&#x27;ls/root&#x27;</span> -b -K <span class="hljs-comment"># 默认为command   </span><br></code></pre></td></tr></table></figure><h3 id="host-pattern">Host-pattern</h3><ul><li><p>all: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible all -m ping<br></code></pre></td></tr></table></figure></p></li><li><p><code>*</code>: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible <span class="hljs-string">&quot;*&quot;</span> -m ping<br></code></pre></td></tr></table></figure></p></li><li><p>与或非关系: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible <span class="hljs-string">&#x27;dbser:webser&#x27;</span> -m ping  <span class="hljs-comment"># 或</span><br>ansible <span class="hljs-string">&#x27;dbser:&amp;webser&#x27;</span> -m ping <span class="hljs-comment"># 与</span><br>ansible <span class="hljs-string">&#x27;dbser:!webser&#x27;</span> -m ping <span class="hljs-comment"># 非</span><br></code></pre></td></tr></table></figure></p></li></ul><h2 id="常见模块">常见模块</h2><h3 id="文件类操作模块">文件类操作模块</h3><blockquote><p>copy file blockinline lineinfile find replace fetch</p></blockquote><h4 id="copy">1.copy</h4><p>选项: src dest force backup owner group mode <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible all -m copy -a <span class="hljs-string">&#x27;src=/root/ansible/selinux dest=/etc/selinux/config backup=yes&#x27;</span><br>ansible all -m copy -a <span class="hljs-string">&#x27;src=/etc/shadow dest=/data/ mode=000 owner=xy&#x27;</span> <br>ansible all -m copy -a <span class="hljs-string">&#x27;content=&quot;hello\world\n&quot; dest=/data/f2 backup=yes mode=755 owner=root&#x27;</span><br></code></pre></td></tr></table></figure></p><h4 id="filepathdestname">2.file(path,dest,name)</h4><p>选项: path state src force owner group mode recurse<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible dbsrv -m file <span class="hljs-string">&#x27;path=/root/a.sh owner=xy mode=755&#x27;</span>  <br>ansible dbsrv -m file <span class="hljs-string">&#x27;src=/etc/fstab dest=/data/fstab-link state=link&#x27;</span>  <br>ansible dbsrv -m file <span class="hljs-string">&#x27;path=/home/state/test te=directory owner=xy group=xy recuser=yes&#x27;</span><br></code></pre></td></tr></table></figure></p><h4 id="blockinfile-在指定的文件中插入一段文本">3.blockinfile:在指定的文件中插入”一段文本”</h4><p>选项: path block marker state insertafter insertbefore backupcreate<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible dbsvr -m blockfile -a <span class="hljs-string">&#x27;path=/test/rc.local block=&quot;systemctl start mariadb\nsystemctl start httpd&quot; marker=&quot;#&#123;mark&#125; service to start&quot;&#x27;</span><br>ansible dbsvr -m blockfile -a <span class="hljs-string">&#x27;path=/test/rc.local marker=&quot;#&#123;mark&#125; service to start&quot; state=absent&#x27;</span><br></code></pre></td></tr></table></figure></p><h4 id="lineinfile">4.lineinfile:</h4><p>选项: path line regexp state backrefs inserafter insertbefore backupcreate <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 确保某一行文本存在指定的文件中，若存在不做任何操作，默认在文件的末尾插入这行文本  </span><br>ansible dbsvr -m lineinfile -a <span class="hljs-string">&#x27;path=/test/test.txt regexp=&quot;^line&quot; line=&quot;test text&quot;&#x27;</span>  <br>ansible dbsvr -m -m lineinfile -a <span class="hljs-string">&#x27;path=/test/test.txt regexp=&quot;(H.&#123;4&#125;).*(H.&#123;4&#125;)&quot; line=&quot;\2&quot; backrefs=yes&#x27;</span><br></code></pre></td></tr></table></figure></p><h4 id="find">5.find</h4><p>选项: path recurse hidden file_type patterns<br />use_regex contains age(s m h d w)<br />age_stamp(atime ctime mtime) size(t g m k b) get_checksum<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible dbsvr -m find -a <span class="hljs-string">&#x27;path=/test patterns=&quot;*.sh&quot; file_type=any hidden=yes&#x27;</span> <br>ansible dbsvr -m find -a <span class="hljs-string">&#x27;path=/test age=-4d age_stamp=atime recurse=yes&#x27;</span>  <span class="hljs-comment"># 4天以内</span><br></code></pre></td></tr></table></figure></p><h4 id="replace">6.replace</h4><p>选项: path regexp replace backup <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible dbsvr -m replace -a <span class="hljs-string">&#x27;path=/test regexp=&quot;ASM&quot; replace=asm backup=yes&#x27;</span>  <br></code></pre></td></tr></table></figure></p><h4 id="fetch远程单个文件可以先tar">7.fetch(远程单个文件,可以先tar)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible all -m fetch -a <span class="hljs-string">&#x27;src=/var/log/message dest=/data&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="命令类操作模块">命令类操作模块</h3><blockquote><p>command shell script</p></blockquote><h4 id="command默认">1.command(默认)</h4><p>选项: free_form chdir creates removes <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 该模块不支持`$、&lt;、&gt;、|、;、&amp;`等</span><br>ansible dbser -m <span class="hljs-built_in">command</span> -a <span class="hljs-string">&#x27;chdir=/data/f1.sh&#x27;</span><br>ansible dbser -a <span class="hljs-string">&#x27;echo 123456 |passwd --stdin user1&#x27;</span> <span class="hljs-comment"># fail</span><br>ansible dbuser -k all -m <span class="hljs-built_in">command</span> -a <span class="hljs-string">&quot;ping -c 1 www.baidu.com&quot;</span><br></code></pre></td></tr></table></figure></p><h4 id="shell">2.shell</h4><p>选项: free_form chdir creates removes executable<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible dbser -m shell -a <span class="hljs-string">&#x27;cat /etc/passwd |awk -F: &#123;print $1,$2&#125;&#x27;</span> &amp;&gt;/tmp/test.txt  <br></code></pre></td></tr></table></figure></p><h4 id="script">3.script</h4><p>选项: free_form chdir creates removes<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hostname is <span class="hljs-variable">$HOSTNAME</span>&quot;</span><br>ansible all -m script -a <span class="hljs-string">&#x27;/root/ansible/host.sh&#x27;</span><br></code></pre></td></tr></table></figure></p><h3 id="系统类模块">系统类模块</h3><blockquote><p>cron service user group hostname yum setup synchronize debugyum_repository</p></blockquote><h4 id="cron">1.cron</h4><p>选项: minute hour day month weekday<br />special_time user job name<br />state disabled backup<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible all -m cron -a <span class="hljs-string">&#x27;minute=* weekday=1,3,5 job=&quot;/usr/bin/wall FBI warnning&quot; name=broadcast&#x27;</span>  <br>ansible all -m cron -a <span class="hljs-string">&#x27;disabled=true job=&quot;/usr/bin/wall FBI warnning&quot; name=broadcast&#x27;</span>  <br>ansible all -m cron -a <span class="hljs-string">&#x27;job=&quot;/usr/bin/wall FBI warnning&quot; name=broadcast state=absent&#x27;</span> <br></code></pre></td></tr></table></figure></p><h4 id="service">2.service</h4><p>选项: name state enabled <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible dbsvr -m service -a <span class="hljs-string">&#x27;name=vsftpd state=started/stopped/reloaded/restarted enabled=true&#x27;</span> <br></code></pre></td></tr></table></figure></p><h4 id="user">3.user</h4><p>选项: name group gourps append shell uid<br />expires(指定用户过期时间) comment state<br />remove password update_passowrd(always on_create)<br />generate_ssh_key ssh_key_file ssh_key_passphrase ssh_key_type<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible dbsvr -m user -a <span class="hljs-string">&#x27;name=nginx shell=/sbin/nologin system=true home=/usr/local/nginx groups=root,bin uid=80 comment=&quot;nginx service&quot;&#x27;</span><br>ansible dbsvr -m user -a <span class="hljs-string">&#x27;name=nginx state=absent remove=true&#x27;</span><br></code></pre></td></tr></table></figure></p><h4 id="group">4.group</h4><p>选项: name state gid<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible dbsvr -m group -a <span class="hljs-string">&#x27;name=nginx system=true gid=80&#x27;</span><br>ansible dbsvr -m  -a <span class="hljs-string">&#x27;getent group nginx&#x27;</span><br>ansible dbsvr -m group -a <span class="hljs-string">&#x27;name=nginx state=absent&#x27;</span><br></code></pre></td></tr></table></figure></p><h4 id="hostname">5.hostname</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible 192.168.30.103 -m hostname -a <span class="hljs-string">&#x27;name=node1&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="yum_repository-yum">6.yum_repository &amp;&amp; yum</h4><p>选项: name baseurl description file enabled gpgcheck gpgcakeystate<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible dbsvr -m yum_repository -a <span class="hljs-string">&#x27;name=AliEpel description=&quot;alibaba EPEL&quot; baseurl=https://mirrors.aliyun.com/epel/$releasever\Server/$basearch/&#x27;</span><br>ansible dbsvr -m yum_repository -a <span class="hljs-string">&#x27;name=local baseurl=file://media description=&quot;local cd yum&quot; enabled=no&#x27;</span>  <br></code></pre></td></tr></table></figure></p><p>选项: name state disable_gpg_check enablerepo disablerepo<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible dbsvr -m yum -a <span class="hljs-string">&#x27;name=vsftpd,httpd state=installed&#x27;</span>  <br>ansible dbsvr -m yum -a <span class="hljs-string">&#x27;name=vsftpd,httpd state=removed&#x27;</span><br>ansible dbsvr -m yum -a <span class="hljs-string">&#x27;list=installed&#x27;</span>  <br>ansible dbsvr -m yum -a <span class="hljs-string">&#x27;name=dstat update_cache=yes&#x27;</span>  <br></code></pre></td></tr></table></figure></p><h4 id="setup内部变量">7.setup(内部变量)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible all -m setup -a <span class="hljs-string">&quot;filter=*memtotal*&quot;</span>  <span class="hljs-comment"># 查看 内部变量</span><br>ansible_memetotal_mb<span class="hljs-comment"># 4  </span><br>ansible all -m -a <span class="hljs-string">&#x27;filter=ansible_memory_mb&#x27;</span><br></code></pre></td></tr></table></figure><h4id="synchronize目录文件同步基于rsync命令工具">8.synchronize(目录文件同步,基于rsync命令工具)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible -k all -m synchronize -a <span class="hljs-string">&#x27;src=/tmp/ dest=/tmp compress=yes rsync_opts=--no-motd,--exclude=.txt&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="debug">9.debug</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-string">ansible</span> <span class="hljs-string">dbsvr</span> <span class="hljs-string">-m</span> <span class="hljs-string">debug</span> <span class="hljs-string">-a</span> <span class="hljs-string">&quot;msg=<span class="hljs-template-variable">&#123;&#123;ansible_version&#125;&#125;</span>&quot;</span><br><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-string">test01</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">vars:</span> <br>    <span class="hljs-attr">testvar:</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-string">test</span> <span class="hljs-string">variable</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">debug</span> <span class="hljs-string">demo</span><br>      <span class="hljs-attr">debug:</span> <br>        <span class="hljs-attr">var:</span> <span class="hljs-string">testvar</span><br>        <span class="hljs-attr">msg:</span> <span class="hljs-string">&quot;value of testvar is: <span class="hljs-template-variable">&#123;&#123;testvar&#125;&#125;</span>&quot;</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">test02</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">vars_prompt:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Your_name&quot;</span><br>      <span class="hljs-attr">prompt:</span> <span class="hljs-string">&quot;What is your name&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Your_age&quot;</span><br>      <span class="hljs-attr">prompt:</span> <span class="hljs-string">&quot;How old are you&quot;</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">output</span> <span class="hljs-string">vars</span><br>      <span class="hljs-attr">debug:</span><br>        <span class="hljs-attr">msg:</span> <span class="hljs-string">Your</span> <span class="hljs-string">name</span> <span class="hljs-string">is</span> &#123;&#123;<span class="hljs-string">Your_name</span>&#125;&#125;<span class="hljs-string">,You</span> <span class="hljs-string">are</span> &#123;&#123;<span class="hljs-string">Your_age</span>&#125;&#125; <span class="hljs-string">years</span> <span class="hljs-string">old.</span><br></code></pre></td></tr></table></figure><h2 id="ansible-playbook">ansible-playbook</h2><blockquote><p>PlayBook是由一个或多个”play”组成的列表，play的主要功能是为Ansible中的task定义好角色–指定剧本对应的服务器组；task是一个任务，调用Ansible各种模块，将多个play组织在一个PlayBook剧本中，组成非常完整的流程控制集合。</p></blockquote><blockquote><p>剧本 &lt;–task &lt;–modules</p></blockquote><h3 id="usage">Usage</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible-playbook [options] playbook.yml [playbook2 ...]<br>ansible-playbook --syntax-check sample.yml<span class="hljs-comment"># 测试是否由语法错误  </span><br></code></pre></td></tr></table></figure><h3 id="语法">语法</h3><blockquote><p>在YAML语法中，<code>---</code>表示文档开始，<code>-</code>作为开头也表示一个块序列的节点；列表 - 字典 key: value 或者 { key1: value1, key2: value2, …}</p></blockquote><blockquote><p>Ansible的幂等性:幂等性能够<code>保持重复执行一项操作</code>时，<code>得到的结果是相同的</code>，ansible是以<code>“结果为导向的”</code>，指定一个状态，ansible会自动判断，“当前状态”是否一致，如果一致，则不进行任何操作，不一致将当前状态变为目标指定状态。</p></blockquote><blockquote><p>key: value 可同行写也可换行写, 值可是字符串，也可是列表；</p></blockquote><h4 id="基础">基础</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-meta">---</span><br><span class="hljs-comment"># test yml</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">websrv</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">create</span> <span class="hljs-string">new</span> <span class="hljs-string">file</span>  <span class="hljs-comment"># describe</span><br>      <span class="hljs-attr">file:</span> <span class="hljs-string">name=/data/newfile</span> <br>            <span class="hljs-string">state=touch</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">create</span> <span class="hljs-string">new</span> <span class="hljs-string">user</span><br>      <span class="hljs-attr">user:</span> <br>        <span class="hljs-string">name=test2</span> <br>        <span class="hljs-string">system=yes</span> <br>        <span class="hljs-string">shell=/sbin/nologin</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install</span> <span class="hljs-string">package</span><br>      <span class="hljs-attr">yum:</span> <span class="hljs-string">name=httpd</span><br></code></pre></td></tr></table></figure><h4 id="handler-notify-tags">handler &amp;&amp; notify || tags</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-meta">---</span><br><span class="hljs-comment"># apache service</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">websrvs</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install</span> <span class="hljs-string">httpd</span> <span class="hljs-string">package</span><br>      <span class="hljs-attr">yum:</span> <span class="hljs-string">name=httpd</span><br>      <span class="hljs-attr">tags:</span> <span class="hljs-string">inshttpd</span>            <span class="hljs-comment"># 标签，指定执行哪些任务</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">copy</span> <span class="hljs-string">conf</span> <span class="hljs-string">file</span><br>      <span class="hljs-attr">copy:</span> <span class="hljs-string">src=files/httpd.conf</span> <span class="hljs-string">dest=/etc/httpd/conf</span> <span class="hljs-string">backup=yes</span><br>      <span class="hljs-attr">notify:</span> <span class="hljs-string">restart</span> <span class="hljs-string">service</span>   <span class="hljs-comment"># 触发特性条件，跳过以下命令，执行指定handlers任务</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">start</span> <span class="hljs-string">service</span><br>      <span class="hljs-attr">service:</span> <span class="hljs-string">name=httpd</span> <span class="hljs-string">state=started</span> <span class="hljs-string">enabled=true</span><br>      <span class="hljs-attr">tags:</span> <span class="hljs-string">reshttpd</span>     <span class="hljs-comment"># 标签</span><br>  <span class="hljs-attr">handlers:</span>         <span class="hljs-comment"># 触发器，另一种形式的task</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">restart</span> <span class="hljs-string">service</span><br>      <span class="hljs-attr">service:</span> <span class="hljs-string">name=httpd</span> <span class="hljs-string">state=restarted</span><br> <br><span class="hljs-string">ansible-playbook</span> <span class="hljs-string">-t</span> <span class="hljs-string">inshttpd,reshttpd</span> <span class="hljs-string">httpd.yml</span>  <span class="hljs-comment"># -t,--tags 指定执行标签  </span><br></code></pre></td></tr></table></figure><h4 id="var-变量">var 变量</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-meta">---</span><br><span class="hljs-comment"># var</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">appserv</span><br>  <span class="hljs-attr">remote:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">vars:</span>  <span class="hljs-comment"># 变量</span><br>    <span class="hljs-attr">nginx:</span><br>    <span class="hljs-attr">conf80:</span> <span class="hljs-string">/etc/nginx/conf.d/80.conf</span><br>    <span class="hljs-attr">conf8080:</span> <span class="hljs-string">/etc/nginx/conf.d/8080.conf</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">task1</span><br>      <span class="hljs-attr">file:</span> <br>        <span class="hljs-string">path=&quot;&#123;&#123;nginx.conf80&#125;&#125;&quot;</span> <br>        <span class="hljs-string">state=touch</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">task2</span><br>      <span class="hljs-attr">file:</span> <br>        <span class="hljs-string">path=&quot;&#123;&#123;nginx[&#x27;conf8080&#x27;]&#125;&#125;&quot;</span><br>        <span class="hljs-string">state=touch</span><br><span class="hljs-comment">#############################</span><br><span class="hljs-string">cat</span> <span class="hljs-string">vars.yml</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">var1:</span> <span class="hljs-string">httpd</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">var2:</span> <span class="hljs-string">nginx</span><br><span class="hljs-comment">######</span><br><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">web</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">vars_files:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">vars.yml</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">vreate</span> <span class="hljs-string">httpd</span> <span class="hljs-string">log</span><br>      <span class="hljs-attr">file:</span> <span class="hljs-string">name=/app/&#123;&#123;</span> <span class="hljs-string">var1</span> <span class="hljs-string">&#125;&#125;.log</span> <span class="hljs-string">state=touch</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">vreate</span> <span class="hljs-string">httpd</span> <span class="hljs-string">log</span><br>      <span class="hljs-attr">file:</span> <span class="hljs-string">name=/app/&#123;&#123;</span> <span class="hljs-string">var2</span> <span class="hljs-string">&#125;&#125;.log</span> <span class="hljs-string">state=touch</span> <br></code></pre></td></tr></table></figure><h2 id="templatejinja2">Template(Jinja2)</h2><h3 id="when">when</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-meta">---</span><br><span class="hljs-comment"># test template</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">websrvs</span><br>  <span class="hljs-attr">remove_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">vars:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">http_port:</span> <span class="hljs-number">88</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install</span> <span class="hljs-string">package</span><br>      <span class="hljs-attr">yum:</span> <span class="hljs-string">name=nginx</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">copy</span> <span class="hljs-string">template</span><br>      <span class="hljs-attr">template:</span> <span class="hljs-string">src=nginx.conf.j2</span> <span class="hljs-string">dest=/etc/nginx/nginx.conf</span>  <span class="hljs-comment"># 模板</span><br>      <span class="hljs-attr">when:</span> <span class="hljs-string">ansible_distribution_major_version</span> <span class="hljs-string">==</span> <span class="hljs-string">&quot;7&quot;</span>   <span class="hljs-comment"># 判断</span><br>      <span class="hljs-attr">notify:</span> <span class="hljs-string">restart</span> <span class="hljs-string">service</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">copy</span> <span class="hljs-string">template</span><br>      <span class="hljs-attr">template:</span> <span class="hljs-string">src=nginx.conf.j2</span> <span class="hljs-string">dest=/etc/nginx/nginx.conf</span>  <span class="hljs-comment"># 模板</span><br>      <span class="hljs-attr">when:</span> <span class="hljs-string">ansible_distribution_major_version</span> <span class="hljs-string">==</span> <span class="hljs-string">&quot;6&quot;</span> <br>      <span class="hljs-attr">notify:</span> <span class="hljs-string">restart</span> <span class="hljs-string">service</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">start</span> <span class="hljs-string">service</span><br>      <span class="hljs-attr">service:</span> <span class="hljs-string">name=nginx</span> <span class="hljs-string">state=started</span> <span class="hljs-string">enables=true</span><br>  <span class="hljs-attr">handlers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">restart</span> <span class="hljs-string">service</span><br>      <span class="hljs-attr">service:</span> <span class="hljs-string">name=nginx</span> <span class="hljs-string">state=restarted</span> <br><br><span class="hljs-comment"># 查看内置变量, 修改 nginx 模板, 其它配置不变</span><br><span class="hljs-string">ansible</span> <span class="hljs-string">websrvs/all</span> <span class="hljs-string">-m</span> <span class="hljs-string">setup</span> <span class="hljs-string">|grep</span> <span class="hljs-string">cpu</span>    <br><br><span class="hljs-string">vim</span> <span class="hljs-string">templates/nginx.conf.j2</span><br>  <span class="hljs-string">user</span> <span class="hljs-string">nginx;</span>  <br>  <span class="hljs-string">worker_processes</span> &#123;&#123; <span class="hljs-string">ansible_processor_vcpu**2</span> &#125;&#125;<span class="hljs-string">;</span>  <span class="hljs-comment">#</span><br>  <span class="hljs-string">server</span> &#123; <span class="hljs-string">listen</span>[<span class="hljs-string">::</span>]<span class="hljs-string">:<span class="hljs-template-variable">&#123;&#123; http_port &#125;&#125;</span></span> <span class="hljs-string">default_server;</span> &#125;<br><br><span class="hljs-comment"># vim /etc/ansible/hosts  </span><br>[<span class="hljs-string">websrvs</span>]  <br><span class="hljs-number">192.168</span><span class="hljs-number">.30</span><span class="hljs-number">.101</span> <span class="hljs-string">http_port=81</span>  <br><span class="hljs-number">192.168</span><span class="hljs-number">.30</span><span class="hljs-number">.102</span> <span class="hljs-string">http_port=82</span>    <br><br><span class="hljs-string">ansible-playbook</span> <span class="hljs-string">-e</span> <span class="hljs-string">&quot;http_port=99&quot;</span> <span class="hljs-string">testtempl.yml</span><br></code></pre></td></tr></table></figure><h3 id="循环">循环</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">websrvs</span> <br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">create</span> <span class="hljs-string">groups</span><br>    <span class="hljs-comment"># item 用的是with_item的内容</span><br>    <span class="hljs-attr">group:</span> <span class="hljs-string">name=&#123;&#123;</span> <span class="hljs-string">item</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-string">state=present</span> <br>    <span class="hljs-attr">with_items:</span> <span class="hljs-comment"># 列表循环 [], with_items: [1, 2, 3]</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">group1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">group2</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">group3</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">create</span> <span class="hljs-string">users</span><br>    <span class="hljs-attr">user:</span> <span class="hljs-string">name=&#123;&#123;</span> <span class="hljs-string">item.name</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-string">group=&#123;&#123;</span> <span class="hljs-string">item.group</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-string">state=present</span><br>    <span class="hljs-attr">with_items:</span>  <span class="hljs-comment"># 字典&#123;key.value&#125;</span><br>      <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;user1&#x27;</span>, <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;group1&#x27;</span> &#125; <br>      <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;user2&#x27;</span>, <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;group2&#x27;</span> &#125; <br>      <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;user3&#x27;</span>, <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;group3&#x27;</span> &#125;  <br></code></pre></td></tr></table></figure><h3 id="for">for</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">websrvs</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">vars:</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">web1:</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-number">81</span><br>        <span class="hljs-comment"># name: web1.xy.com</span><br>        <span class="hljs-attr">rootdir:</span> <span class="hljs-string">/data/website1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">web2:</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-number">82</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">web2.xy.com</span><br>        <span class="hljs-attr">rootdir:</span> <span class="hljs-string">/data/website2</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">web1:</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-number">83</span><br>        <span class="hljs-comment"># name: web3.xy.com</span><br>        <span class="hljs-attr">rootdir:</span> <span class="hljs-string">/data/website2</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">copy</span> <span class="hljs-string">conf</span><br>      <span class="hljs-attr">templte:</span> <span class="hljs-string">src=for1.conf.j2</span> <span class="hljs-string">dest=/data/for1.conf</span><br><span class="hljs-comment">###########</span><br><span class="hljs-string">vim</span> <span class="hljs-string">for1.conf.j2</span><br>    &#123;<span class="hljs-string">%</span> <span class="hljs-string">for</span> <span class="hljs-string">i</span> <span class="hljs-string">in</span> <span class="hljs-string">ports</span> <span class="hljs-string">%</span>&#125;<br>      <span class="hljs-string">server</span> &#123;<br>          <span class="hljs-string">listen</span> &#123;&#123; <span class="hljs-string">i.port</span> &#125;&#125;<br>          <span class="hljs-string">servername</span> &#123;&#123; <span class="hljs-string">i.name</span> &#125;&#125;<br>          <span class="hljs-string">documemtroot</span> &#123;&#123; <span class="hljs-string">i.rootdir</span> &#125;&#125;<br>      &#125;<br>    &#123;<span class="hljs-string">%</span> <span class="hljs-string">endfor</span> <span class="hljs-string">%</span>&#125;<br><br><span class="hljs-string">vim</span> <span class="hljs-string">testfor.yml</span><br><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">websrvs</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">vars:</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">81</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">82</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">83</span><br>  <span class="hljs-attr">task:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">name:copy</span> <span class="hljs-string">conf</span><br>      <span class="hljs-attr">templtate:</span> <span class="hljs-string">src=for1.conf.j2</span> <span class="hljs-string">dest=/data/for1.conf</span><br></code></pre></td></tr></table></figure><h3 id="if">if</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">vim</span> <span class="hljs-string">for4.conf.j2</span><br>  &#123;<span class="hljs-string">%</span> <span class="hljs-string">for</span> <span class="hljs-string">i</span> <span class="hljs-string">in</span> <span class="hljs-string">ports</span> <span class="hljs-string">%</span>&#125;<br>    <span class="hljs-string">server</span> &#123;<br>      <span class="hljs-string">listen</span> &#123;&#123; <span class="hljs-string">i.port</span> &#125;&#125;<br>    &#123;<span class="hljs-string">%</span> <span class="hljs-string">if</span> <span class="hljs-string">i.name</span> <span class="hljs-string">defined</span> <span class="hljs-string">%</span>&#125;<br>        <span class="hljs-string">servername</span> &#123;&#123; <span class="hljs-string">i.name</span> &#125;&#125;<br>      &#123;<span class="hljs-string">%</span> <span class="hljs-string">endif</span> <span class="hljs-string">%</span>&#125;<br>      <span class="hljs-string">documemtroot</span> &#123;&#123; <span class="hljs-string">i.rootdir</span> &#125;&#125;<br>    &#125;<br>  &#123;<span class="hljs-string">%</span> <span class="hljs-string">endfor</span> <span class="hljs-string">%</span>&#125;<br></code></pre></td></tr></table></figure><h3 id="roles-角色">Roles 角色</h3><p><a href="https://www.freesion.com/article/5487161337/">参考</a></p>]]></content>
    
    
    <categories>
      
      <category>Ansible</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Ansible</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Js</title>
    <link href="/posts/824395f6.html"/>
    <url>/posts/824395f6.html</url>
    
    <content type="html"><![CDATA[<p>2019-08-21-JS <span id="more"></span></p><h2 id="js相关知识点">Js相关知识点</h2><h3 id="js代码运行阶段">Js代码运行阶段:</h3><ol type="1"><li>解析阶段: 检查是否由语法错误及变量、函数的声明<br /></li><li>运行阶段: 变量的赋值，代码流程的执行</li></ol><h3 id="数据类型">数据类型</h3><blockquote><p>Number String Boolen undefined null Objec(function, 数组)</p></blockquote><h3 id="关于this">关于this：</h3><ul><li>指的是调用当前方法 / 函数 的那个对象 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn1</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>;<br>&#125;<br><span class="hljs-title function_">fn1</span>();<span class="hljs-comment">// this =&gt; window</span><br>------------------------------------------------------<br>oDiv.<span class="hljs-property">onclick</span> = fn1;  <span class="hljs-comment">// this =&gt; oDiv, 事件调用不加 ();</span><br>------------------------------------------------------    <br>oDiv.<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">fn1</span>();<span class="hljs-comment">// fn1() 里的this =&gt; window</span><br>&#125;<br>------------------------------------------------------<br><span class="hljs-keyword">var</span> obj = &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Li&#x27;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,<br>    <span class="hljs-attr">fun</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-keyword">var</span> s = <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>;   <span class="hljs-comment">// this =&gt;obj</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(s);<br>    &#125;<br>&#125;<br>obj.<span class="hljs-title function_">fun</span>();      <br></code></pre></td></tr></table></figure></li><li>1.以<code>函数</code>的形式调用时, this永远都是window, 比如fun();相当于window.fun();</li><li>2.以<code>方法</code>的形式调用时, this是调用方法的那个对象</li><li>3.以<code>构造函数</code>的形式调用时, this是新创建的那个对象</li><li>4.以<code>使用call和apply</code>调用时, this是指定的那个对象</li></ul><h3 id="关于函数返回值">关于函数返回值：</h3><ul><li><p>函数名+括号: fn1() ==&gt; return 后面的的值，函数返回值</p></li><li><p>仅仅 是函数名调用：fn1==&gt;函数体对象为参数，即整个函数代码</p></li><li><p>所有函数默认返回值：未定义</p></li><li><p>return 之后任何代码都不执行</p></li><li><p>函数声明：</p><p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">    <span class="hljs-keyword">function</span> 函数名(形参<span class="hljs-number">1</span>,形参<span class="hljs-number">2</span>,...)&#123;         <br>        code;                                        <br>        <span class="hljs-keyword">return</span> 返回值;                           <br>&#125; <br>    <br>    <span class="hljs-keyword">var</span> fun = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>        code;<br>&#125;  <br>    <br>    (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>        code;<br>    &#125;)();        匿名函数(立即执行函数,自调用匿名函数) <br></code></pre></td></tr></table></figure></p></li></ul><h3 id="关于定时器">关于定时器：</h3><ul><li>var timer = setInterval(函数名， 毫秒);<ul><li>clearInterval(timer); // 重复执行</li><li>clearTimout(timer); // 执行一次</li></ul></li></ul><h3 id="关于oop">关于OOP：</h3><ul><li>特点：<ul><li>抽象：抓问题核心</li><li>封装：不考虑内部实现原理，只考虑功能使用</li><li>继承：从已有对象，继承出新的对象，多重继承，多态</li></ul></li><li>组成：<ul><li>方法：函数(过程、动态的)</li><li>属性：变量(状态、静态的) <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">People</span> (<span class="hljs-params">name</span>) &#123;  <span class="hljs-comment">// 构造</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<span class="hljs-comment">//  属性</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">showName</span> = showName;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">showName</span> (<span class="hljs-params"></span>) &#123;<span class="hljs-comment">// 方法</span><br>    <span class="hljs-title function_">alert</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>&#125;<br><span class="hljs-keyword">var</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>(<span class="hljs-string">&#x27;Jhon&#x27;</span>);<br>p1.<span class="hljs-title function_">showName</span>();<br>=========================================<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">People</span> (<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>&#125;<br><span class="hljs-title class_">People</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">showName</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>&#125;<br><span class="hljs-keyword">var</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>(<span class="hljs-string">&#x27;Jhon&#x27;</span>);<br>p1.<span class="hljs-title function_">showName</span>();<br>=========================================<br><span class="hljs-keyword">var</span> obj = &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;Li&#x27;</span>, <span class="hljs-attr">age</span>:<span class="hljs-number">12</span>, <span class="hljs-attr">fly</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;&#125;&#125;;<br><span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="关于-dom-对像.属性-操作的各种尺寸宽高">关于 DOM 对像.属性操作的各种尺寸宽高：</h3><ul><li><strong>offset</strong><ul><li><code>offsetWidth[Height]</code> –&gt; 元素(盒子)的 <ahref="">宽高+padding+borde</a></li><li><code>offsetLeft[Top]</code> –&gt; 元素(盒子)的<ahref="">父级带有定位属性，左侧(顶部)距离数字</a>，<strong>从父亲的padding 开始算，父亲的 border不算</strong>；若没有定位，则以body为准<br /></li></ul></li><li><strong>offsetParent</strong><ul><li>带有定位的父级元素节点，若<ahref="">没有定位，返回结果为body</a>；若有<ahref="">返回最近的父级元素</a></li><li>本身定位为<code>fixed</code><ul><li>offsetParent:null (非火狐)</li><li>offsetParent:body（火狐）</li></ul></li><li>本身定位不为<code>fixed</code><ul><li>父级没有定位：offsetParent:body</li><li>父级有定位：offsetParent:定位父级</li></ul></li></ul></li><li><strong>scroll</strong><ul><li><p><code>scrollWidth[Height]</code> –&gt; 元素(盒子)的宽高，<ahref="">不包括border+margin</a>，<code>scrollWidth[Height]=width[Height]+padding</code></p><blockquote><p>scrollHeight有一个特点：如果文字超出了盒子，高度为内容的高（包括超出的内容）；不超出，则是盒子本身高度。</p></blockquote></li><li><p><code>scrollTop[Left]</code> –&gt;网页被卷去的头部与左部的距离，<a href="">兼容写法：</a><code>window.pageYOffset || document.body.scrollTop || document.documentElement.scrollTop</code></p></li></ul></li><li><strong>client</strong><ul><li><code>clientWidth[Height]</code> –&gt; 元素(盒子)的宽高，<ahref="">padding + width[height]</a>，调用body / html为获取网页可视区的宽高</li><li><code>clientX[]Y]</code> –&gt; 鼠标距离可视区<a href="">左侧 /上侧的距离</a></li><li><code>clientTop[Left]</code> –&gt; 元素(盒子)的<a href="">上 /左border</a></li></ul></li><li>总结：<ul><li><p>区别：宽高 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">offsetWidth = width + padding + border  <span class="hljs-comment">//  占位宽</span><br>offsetHeight = height + padding + border     <span class="hljs-comment">//  占位高</span><br><br>scrollWidth = 内容宽度（不包含border） <span class="hljs-comment">//  内容宽</span><br>scrollHeight = 内容高度（不包含border） <span class="hljs-comment">// 内容高</span><br><br>clientWidth = width + padding   <span class="hljs-comment">//  可视区宽</span><br>clientHeight = height + padding <span class="hljs-comment">//  可视区高</span><br></code></pre></td></tr></table></figure></p></li><li><p>区别：上左<br /><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript">offsetTop/offsetLeft：<br>调用者：任意元素。(盒子为主)<br>作用：距离父系盒子中带有定位的距离。<br><br>scrollTop/scrollLeft：<br>调用者：<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollTop</span>（<span class="hljs-variable language_">window</span>调用）(盒子也可以调用，但必须有滚动条)<br>作用：浏览器无法显示的部分（被卷去的部分）。<br><br>clientY/clientX：<br>调用者：event   <span class="hljs-comment">// 重要</span><br>作用：鼠标距离浏览器可视区域的距离（左、上）<br></code></pre></td></tr></table></figure></p></li><li><img src="/posts/824395f6/BOM.png" class="" title="[BOM]"></li></ul></li></ul><h3 id="获取元素的样式">获取元素的样式：</h3><ul><li><p>currentStyle –&gt;该属性获取当前元素的样式，只有IE支持</p><ul><li>box1.currentStyle.width</li></ul></li><li><p>getComputerStyle() –&gt;该方法获取当前元素样式，</p><ul><li>getComputerStyle((box1, null).width);</li></ul></li><li><p><ahref="https://blog.csdn.net/qq_20069429/article/details/83267887">参看{}、[]、()区别</a></p></li><li><p><code>&#123;&#125;</code>–&gt;表示对象;<code>[]</code>–&gt;表示对象的属性、方法;<code>()</code>–&gt;如果用在方法名后面</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getStyle</span>(<span class="hljs-params">obj, attr</span>) &#123;<br><span class="hljs-keyword">return</span> obj.<span class="hljs-property">currentStyle</span>?obj.<span class="hljs-property">currentStyle</span>[attr]:obj.<span class="hljs-property">getComputerStyle</span>[attr];<br>&#125;<br>showMsg.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&quot;x = &quot;</span>+x + <span class="hljs-string">&quot;, y = &quot;</span>+y; <span class="hljs-comment">// x, 均为变量</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="关于闭包">关于闭包：</h3><ul><li>嵌套的内部函数引用了嵌套的外部函数的变量，就产生了闭包</li><li>闭包 存在于嵌套的内部函数中 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn1</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">var</span> a = <span class="hljs-number">2</span>;<br>  <span class="hljs-keyword">var</span> b = <span class="hljs-string">&#x27;abc&#x27;</span>;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn2</span>(<span class="hljs-params"></span>)&#123; <span class="hljs-comment">// 执行函数定义产生闭包(不用调用内部函数)</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);<br>  &#125; <br>&#125;<br><span class="hljs-title function_">fn1</span>();  <span class="hljs-comment">//</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="关于es6">关于ES6</h3><blockquote><p>变量的解构赋值, 给多个形参赋值</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">对象的解构赋值: <br><span class="hljs-keyword">let</span> obj = &#123;<span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;anyue&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">39</span>&#125;;<br><span class="hljs-comment">// let username = obj.username;</span><br><span class="hljs-keyword">let</span> &#123;username, age&#125; = obj;<br><br>数组的解构赋值:<br><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-literal">true</span>];<br><span class="hljs-keyword">let</span> [, , c, d, e] =arr;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">&#123;username, age&#125;</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(username, age);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="模版字符串">模版字符串</h3><p><strong>必须用 `` 包含</strong><br /><strong>变化的部分使用 {xxx} 定义</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> obj = &#123;<span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;anyue&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">39</span>&#125;;<br><span class="hljs-keyword">let</span> str = <span class="hljs-string">&#x27;我的名字是: &#x27;</span> + obj.<span class="hljs-property">username</span> + <span class="hljs-string">&#x27;, 我今年的年龄是: &#x27;</span> + obj.<span class="hljs-property">age</span>;<br>str = <span class="hljs-string">`我的名字是: $(obj.username), 我今年的年龄是: &#123;obj.age&#125;`</span>;<br><br></code></pre></td></tr></table></figure></p><h3 id="对象的简写方式">对象的简写方式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> username = <span class="hljs-string">&#x27;anyue&#x27;</span>;<br><span class="hljs-keyword">let</span> age = <span class="hljs-number">39</span>;<br><span class="hljs-keyword">let</span> obj = &#123;<br>    <span class="hljs-comment">// username: username,</span><br>    <span class="hljs-comment">// age: age,</span><br>    <span class="hljs-comment">// getName: function()&#123;&#125;</span><br><br>    username,   <span class="hljs-comment">// 省略同名的属性值</span><br>    age,<br>    <span class="hljs-title function_">getName</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">// 省略方法的 function</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">username</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="箭头函数">箭头函数</h3><p>不是调用的时候决定的, 而是在定义的时候处在的对像就是 它的this,常规函数则相反 箭头函数的<code>this</code>确定: 外层有函数,则外层函数的this就是内部箭头函数的this, 若没有, 则this是window 参数=&gt; 语句/表达式 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// let fun = function() &#123;&#125;;</span><br><span class="hljs-keyword">let</span> <span class="hljs-title function_">fun</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">console</span>(<span class="hljs-string">&#x27;我是箭头函数&#x27;</span>);<br><span class="hljs-title function_">fun</span>();<br>形参:<br>  <span class="hljs-number">1.</span>没有形参:<br>    <span class="hljs-keyword">let</span> <span class="hljs-title function_">fun1</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;我是箭头函数&#x27;</span>);<br>    fun1;<br>  <span class="hljs-number">2.</span>只有一个形参:<br>    <span class="hljs-keyword">let</span> <span class="hljs-title function_">fun2</span> = a =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a); <span class="hljs-comment">// 形参的()可以省略</span><br>    <span class="hljs-title function_">fun2</span>(aaa);<br>  <span class="hljs-number">3.</span>两个及以上:<br>    <span class="hljs-keyword">let</span> <span class="hljs-title function_">fun3</span> = (<span class="hljs-params">x, y</span>) =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x, y); <br>    <span class="hljs-title function_">fun3</span>(<span class="hljs-number">25</span>, <span class="hljs-number">36</span>);<br>函数体:<br>  <span class="hljs-number">1.</span>函数体只有一条执行语句/表达式, &#123;&#125;可以省略, 会自动返回执行的结果:<br>    <span class="hljs-keyword">let</span> <span class="hljs-title function_">fun4</span> = (<span class="hljs-params">x, y</span>) =&gt; x+y; <span class="hljs-comment">// let fun1 = (x, y) =&gt; &#123;return x+y&#125;;</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">fun4</span>(<span class="hljs-number">25</span>, <span class="hljs-number">36</span>));<br>  <span class="hljs-number">2.</span>函数体不只一条执行语句/表达式:<br>    <span class="hljs-keyword">let</span> <span class="hljs-title function_">fun5</span> = (<span class="hljs-params">x, y</span>) =&gt; &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x, y);<br>        <span class="hljs-keyword">return</span> x + y;<br>    &#125;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">fun5</span>(<span class="hljs-number">25</span>, <span class="hljs-number">36</span>));<br>测试箭头函数的<span class="hljs-attr">this</span>:<br><span class="hljs-keyword">let</span> btn1 = doucument.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;btn1&#x27;</span>);<br><span class="hljs-keyword">let</span> btn2 = doucument.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;btn2&#x27;</span>);<br><br>btn1.<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-title function_">alert</span>(<span class="hljs-variable language_">this</span>)&#125;;    <span class="hljs-comment">// this = btn1</span><br>btn2.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> &#123;<span class="hljs-title function_">alert</span>(<span class="hljs-variable language_">this</span>)&#125;  <span class="hljs-comment">// this = Window</span><br><br><span class="hljs-keyword">let</span> obj = &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;箭头函数&#x27;</span>,<br>    <span class="hljs-attr">getName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>        btn2.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> &#123;<span class="hljs-title function_">alert</span>(<span class="hljs-variable language_">this</span>)&#125;;<br>    &#125;<br>&#125;<br>obj.<span class="hljs-title function_">getName</span>();  <span class="hljs-comment">// this = obj</span><br></code></pre></td></tr></table></figure></p><h3 id="三点运算符-数组扩展方法">三点运算符 &amp;&amp; 数组扩展方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">...value</span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);<br>    value.<span class="hljs-title function_">foreach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">item, index</span>)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item, index);<br>    &#125;)<br>&#125;<br><br><span class="hljs-keyword">var</span> arr = [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>];<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">indexOf</span>(<span class="hljs-number">4</span>));    <span class="hljs-comment">// 1 得到值在数组中的第一个下标</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-number">4</span>));    <span class="hljs-comment">// 7 </span><br><br>arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">item, index</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item, index);   <span class="hljs-comment">// 遍历数组</span><br>&#125;);<br><br><span class="hljs-keyword">var</span> arr1 = arr.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">item, index</span>) &#123;<br>    <span class="hljs-keyword">return</span> item+<span class="hljs-number">10</span>;<br>&#125;);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr1, arr);  <span class="hljs-comment">// 遍历数组返回新的数组, 返回加工之后的值</span><br><br><span class="hljs-keyword">var</span> arr2 = arr.<span class="hljs-title function_">filter</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">item, index</span>) &#123;<br>    <span class="hljs-keyword">return</span> item &gt; <span class="hljs-number">3</span>;<br>&#125;)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr2, arr); <span class="hljs-comment">// 4, 6, 5, 4</span><br></code></pre></td></tr></table></figure><h3 id="promise-对象">Promise 对象</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getNews</span>(<span class="hljs-params">url</span>) &#123;<br>    <span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">// 状态: 初始化</span><br><br>        <span class="hljs-comment">// 执行异步任务</span><br>        <span class="hljs-keyword">let</span> xmlHttp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br>        xmlHttp.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-keyword">if</span>(xmlHttp.<span class="hljs-property">readyState</span> ===<span class="hljs-number">4</span>)&#123;<br>                <span class="hljs-keyword">if</span>(xmlHttp.<span class="hljs-property">status</span> == <span class="hljs-number">200</span>)&#123;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(xmlHttp.<span class="hljs-property">reponseText</span>);<br>                    <span class="hljs-title function_">resolve</span>(xmlHttp.<span class="hljs-property">reponseText</span>);  <span class="hljs-comment">// 修改</span><br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;暂时没有数据&#x27;</span>);<br>                &#125;<br>            &#125;<br>        &#125;;<br>        xmlHttp.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;GET&#x27;</span>, url);<br>        xmlHttp.<span class="hljs-title function_">send</span>();<br>    &#125;)<br>    <span class="hljs-keyword">return</span> promise;<br>&#125;<br><span class="hljs-title function_">getNews</span>(<span class="hljs-string">&#x27;http://localhost:1080/news?id=2&#x27;</span>)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);<br>        <span class="hljs-keyword">let</span> commentsUrl = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data).<span class="hljs-property">commentsUrl</span>;<br>        <span class="hljs-keyword">let</span> url = <span class="hljs-string">&#x27;http://localhost:1080&#x27;</span> + commentsUrl;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getNews</span>(url);<br>    &#125;, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span>&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);<br>    &#125;)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Js</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HTML</tag>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>shell</title>
    <link href="/posts/4592b2fd.html"/>
    <url>/posts/4592b2fd.html</url>
    
    <content type="html"><![CDATA[<p>2019-08-12-Shell <span id="more"></span></p><h1 id="shell">Shell</h1><h2 id="第一个shell">第一个Shell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello World!&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -x file.sh        <span class="hljs-comment">#单步执行  </span><br>/etc/motd &amp;&amp; /etc/issue  <br><span class="hljs-built_in">printenv</span> <span class="hljs-built_in">env</span> <span class="hljs-built_in">export</span>    <span class="hljs-comment"># 查看当前shell中的环境变量</span><br><span class="hljs-built_in">set</span>                    <span class="hljs-comment"># 查看shell中的变量</span><br><span class="hljs-built_in">unset</span>                  <span class="hljs-comment"># 撤销变量</span><br></code></pre></td></tr></table></figure><table><thead><tr><th style="text-align: left;">选项</th><th style="text-align: left;">说明</th></tr></thead><tbody><tr><td style="text-align: left;">-e</td><td style="text-align: left;">支持</td></tr><tr><td style="text-align: left;">-n</td><td style="text-align: left;">输出不换行</td></tr></tbody></table><h2 id="变量">变量</h2><h3 id="定义变量">定义变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">your_name=<span class="hljs-string">&quot;anyue967&quot;</span>,  <span class="hljs-comment"># 变量名前不加$，不能有空格  </span><br><br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> `<span class="hljs-built_in">ls</span> /etc`<span class="hljs-comment"># 显示直接俄赋值/语句赋值</span><br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">ls</span> /etc)  <br></code></pre></td></tr></table></figure><table><thead><tr><th style="text-align: left;">特殊符号</th><th style="text-align: left;">说明</th></tr></thead><tbody><tr><td style="text-align: left;">()</td><td style="text-align: left;">重新开子shell中执行<code>$( ls;cd /etc/ )</code></td></tr><tr><td style="text-align: left;">{}</td><tdstyle="text-align: left;">当前shell中执行<code>$&#123; ls;cd /etc/; &#125;</code></td></tr><tr><td style="text-align: left;">“”</td><td style="text-align: left;">–</td></tr><tr><td style="text-align: left;">’’</td><td style="text-align: left;">–</td></tr><tr><td style="text-align: left;">`` / $()</td><td style="text-align: left;">执行命令</td></tr><tr><td style="text-align: left;">[]</td><td style="text-align: left;">变量测试</td></tr><tr><td style="text-align: left;">#</td><td style="text-align: left;">注释</td></tr><tr><td style="text-align: left;">$</td><td style="text-align: left;">引用变量</td></tr><tr><td style="text-align: left;">\</td><td style="text-align: left;">转义符</td></tr></tbody></table><h3 id="使用变量">使用变量</h3><p><strong>引用变量时, 变量名前要加<code>$</code></strong>,建议变量名外加<code>&#123;&#125;</code>, 一种习惯 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> skill <span class="hljs-keyword">in</span> Ada Coffe Action Java Shell; <span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;I am good at <span class="hljs-variable">$&#123;skill&#125;</span>Script&quot;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></p><h3 id="变量类型-局部环境shell变量三种">变量类型:局部、环境、Shell变量三种</h3><ul><li><p><strong>local 局部变量</strong> 在脚本或命令中定义,仅在当前shell实例中有效, 其他shell启动的程序不能访问局部变量；</p></li><li><p><strong>export 环境变量</strong>作用范围：当前shell及子shell；<br /></p></li><li><p><strong>shell变量</strong> shell变量是由shell程序设置的特殊变量,shell变量中有一部分是环境变量，有一部分是局部变量，这些变量保证了shell的正常运行；</p></li><li><p><strong>只读变量</strong><code>readonly name 或 declare -r name  readonly -p</code>；</p></li><li><p>各个环境变量配置文件(<code>source &lt;==&gt; .</code>)</p><ul><li>profile: <code>设定环境变量，运行命令/脚本</code></li><li>bashrc: <code>设定本地变量，定义命令别名</code> #### 配置文件<img src="/posts/4592b2fd/bash.png" class="" title="[bash 配置]"><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">登录shell：/etc/profile --&gt;/etc/profile.d/*.sh --&gt;~/.bash_profile --&gt;~/.bashrc --&gt;/etc/bashrc<br>非登录shell：~/.bashrc --&gt;/etc/bashrc --&gt;/etc/profile.d/*.sh   <br></code></pre></td></tr></table></figure></li></ul></li><li><p>位置变量 | 符号 | 说明 | | :——– | :———————————— | | $1,$2,… |对应位置参数 | | $0 | 脚本名称 | | $* |传递所有参数,全部参数合为一个字符串 | | $@ |传递所有参数,每个参数表现为独立字符串 | | $# | 参数个数 | | $? |返回最后一条命令执行的状态 | | $$ | 当前进程PID | | $! |后台运行最后一个进程的PID | | set | 清空所有位置变量 | | shift n |移动参数,前n位参数被销毁 |</p></li><li><p>关于<code>()、(())、[]、[[]]、&#123;&#125;</code></p></li><li><p><ahref="https://www.cnblogs.com/splendid/p/11201733.html">参考</a> | 类型| 说明 | | :—— | :——————————————————– | | () |用于<code>多个命令组</code>、命令替换<code>cmd</code>、初始化数组<code>$(cmd)</code>| | (()) |<code>算数</code>:整数扩展、运算符、重定义变量值、算数运算比较 | | [[]]| 支持数学运算，支持逻辑测试: <code>&amp;&amp; || !</code> | | []/test |不支持数学运算，比较运算:<code>== !=</code>，逻辑测试使用:<code>-a -o !</code> | | {} | 用于命令合集或者范围，mkdir -p/data/201{7,8} |</p></li></ul><h2 id="字符串">字符串</h2><h3 id="字符串-可以用-也可以用"><strong>字符串, 可以用<code>''</code>,也可以用<code>""</code></strong></h3><ul><li><p><strong>单引号</strong>里的任何字符都会原样输出,单引号字符串中的变量是无效的;</p></li><li><p><strong>单引号</strong>字串中不能出现单独一个的单引号(对单引号使用转义符后也不行),但可成对出现，作为字符串拼接使用</p></li><li><p><strong>双引号</strong>里可以有变量, 可以出现转义字符</p></li><li><p><strong>获取字串长度</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">string=<span class="hljs-string">&quot;abcd&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;#string&#125;</span><span class="hljs-comment"># 4</span><br></code></pre></td></tr></table></figure></p></li><li><p><strong>提取字符串</strong> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">string=<span class="hljs-string">&quot;anyue967 is a good website&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;string:1:4&#125;</span><span class="hljs-comment"># nyue</span><br></code></pre></td></tr></table></figure></p></li><li><p><strong><code># ##</code>表示去掉左边,<code>#</code>表示从左边删除到第一个指定的字符;<code>##</code>表示从左边删除到最后一个指定的字符</strong><br /></p></li><li><p><strong><code>% %%</code>表示去掉右边,<code>%</code>表示从右边删除到第一个指定的字符;<code>%%</code>表示从右边删除到最后一个指定的字符</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#!bin/bash</span><br>var=<span class="hljs-string">&quot;http://www.runoob.com/linux/linux-shell-variable.html&quot;</span><br><br>s1=<span class="hljs-variable">$&#123;var%%t*&#125;</span>     <span class="hljs-comment"># h</span><br>s2=<span class="hljs-variable">$&#123;var%t*&#125;</span>      <span class="hljs-comment"># http://www.runoob.com/linux/linux-shell-variable.h</span><br>s3=<span class="hljs-variable">$&#123;var%%.*&#125;</span>     <span class="hljs-comment"># http://www</span><br>s4=<span class="hljs-variable">$&#123;var#*/&#125;</span>      <span class="hljs-comment"># /www.runoob.com/linux/linux-shell-variable.html</span><br>s5=<span class="hljs-variable">$&#123;var##*/&#125;</span>     <span class="hljs-comment"># 空</span><br></code></pre></td></tr></table></figure></p></li></ul><h2 id="数组">数组</h2><h3id="bash支持一维数组不支持多维数组并且没有限定数组的大小">bash支持一维数组(不支持多维数组),并且没有限定数组的大小</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">定义: arrName=(value1 value2 ... n)<br><br>array_name=(<br>  value0<br>  value1<br>  value2<br>)<br>array_name[0]=value0  <span class="hljs-comment"># 引用数组  </span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;数组元素: <span class="hljs-variable">$&#123;array_name[@]&#125;</span>&quot;</span>  <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;数组元素: <span class="hljs-variable">$&#123;array_name[*]&#125;</span>&quot;</span>  <br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;数组元素个数为: <span class="hljs-variable">$&#123;#array_name[*]&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><h2 id="注释">注释</h2><p><code>#</code>开头单行注释 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">:&lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">comment...</span><br><span class="hljs-string">comment...</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure></p><h2 id="read命令-用于获取键盘输入信息">read命令,用于获取键盘输入信息</h2><p><code>read [-option] [variable ...]</code></p><table><thead><tr><th style="text-align: left;">选项</th><th style="text-align: left;">说明</th></tr></thead><tbody><tr><td style="text-align: left;">-p</td><td style="text-align: left;">“提示信息”</td></tr><tr><td style="text-align: left;">-t</td><td style="text-align: left;">时间</td></tr><tr><td style="text-align: left;">-s</td><td style="text-align: left;">隐藏输入</td></tr><tr><td style="text-align: left;">-n</td><td style="text-align: left;">只接收一个输入字符就会执行</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;input a val:&quot;</span> a<br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;input a val:&quot;</span> b<br><br>c=$((<span class="hljs-variable">$a</span>+<span class="hljs-variable">$b</span>))          <span class="hljs-comment"># $((exp))</span><br>c=$[<span class="hljs-variable">$a</span>+<span class="hljs-variable">$b</span>]            <span class="hljs-comment"># $[exp]</span><br><span class="hljs-built_in">let</span> c=<span class="hljs-variable">$a</span>+<span class="hljs-variable">$b</span>           <span class="hljs-comment"># let exp</span><br>c=<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> + <span class="hljs-variable">$b</span>        <span class="hljs-comment"># expr 算数表达式  </span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;result=<span class="hljs-variable">$&#123;r&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><h2 id="传递参数">传递参数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Shell 传递参数实例！&quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;执行的文件名：<span class="hljs-variable">$0</span>&quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第一个参数为：<span class="hljs-variable">$1</span>&quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第二个参数为：<span class="hljs-variable">$2</span>&quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第三个参数为：<span class="hljs-variable">$3</span>&quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;参数个数：<span class="hljs-variable">$#</span>&quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;进程号：$$&quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;后台运行的最后一个进程号：$!&quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;传递参数作为字串显示：$*&quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;命令推出状态：$?&quot;</span>;<br></code></pre></td></tr></table></figure><h2 id="shell基本运算符">Shell基本运算符</h2><h3 id="let-命令用于指定算术运算-即let-expretion">let命令用于指定算术运算, 即let expretion</h3><ul><li>let var=$[exp] 算数表达式 $((exp))</li><li><code>echo $[$RANDOM%50]</code>: 0-49之间随机数<ul><li><code>COLOR=$[$RANDOM%7+31]; echo -e "\e[1;$&#123;COLOR&#125;mcolor\e[0m"</code></li></ul></li></ul><h3 id="declare">declare</h3><ul><li>declare -i I=1 # 整型变量声明</li></ul><h3 id="算数运算-用">算数运算, 用<code>(())</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>a=10<br>b=20<br><br>val=<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> + <span class="hljs-variable">$b</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a + b : <span class="hljs-variable">$val</span>&quot;</span><br><br>val=<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> - <span class="hljs-variable">$b</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a - b : <span class="hljs-variable">$val</span>&quot;</span><br><br>val=<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> \* <span class="hljs-variable">$b</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a * b : <span class="hljs-variable">$val</span>&quot;</span><br><br>val=<span class="hljs-built_in">expr</span> <span class="hljs-variable">$b</span> / <span class="hljs-variable">$a</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;b / a : <span class="hljs-variable">$val</span>&quot;</span><br><br>val=<span class="hljs-built_in">expr</span> <span class="hljs-variable">$b</span> % <span class="hljs-variable">$a</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;b % a : <span class="hljs-variable">$val</span>&quot;</span><br><br><span class="hljs-keyword">if</span> [<span class="hljs-variable">$a</span> == <span class="hljs-variable">$b</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a 等于 b&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a 不等于 b&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="关系运算-eq--ne--gt--lt--le">关系运算(-eq -ne -gt -lt -le)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>a=10<br>b=20<br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> -eq <span class="hljs-variable">$b</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -eq <span class="hljs-variable">$b</span> : a 等于 b&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -eq <span class="hljs-variable">$b</span>: a 不等于 b&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> -ne <span class="hljs-variable">$b</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -ne <span class="hljs-variable">$b</span>: a 不等于 b&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -ne <span class="hljs-variable">$b</span> : a 等于 b&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> -gt <span class="hljs-variable">$b</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -gt <span class="hljs-variable">$b</span>: a 大于 b&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -gt <span class="hljs-variable">$b</span>: a 不大于 b&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> -lt <span class="hljs-variable">$b</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -lt <span class="hljs-variable">$b</span>: a 小于 b&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -lt <span class="hljs-variable">$b</span>: a 不小于 b&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> -ge <span class="hljs-variable">$b</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -ge <span class="hljs-variable">$b</span>: a 大于或等于 b&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -ge <span class="hljs-variable">$b</span>: a 小于 b&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> -le <span class="hljs-variable">$b</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -le <span class="hljs-variable">$b</span>: a 小于或等于 b&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> -le <span class="hljs-variable">$b</span>: a 大于 b&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="布尔运算--a--o">布尔运算(!= -a -o)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>a=10<br>b=20<br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span> : a 不等于 b&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> == <span class="hljs-variable">$b</span>: a 等于 b&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> -lt 100 -a <span class="hljs-variable">$b</span> -gt 15 ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> 小于 100 且 <span class="hljs-variable">$b</span> 大于 15 : 返回 true&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> 小于 100 且 <span class="hljs-variable">$b</span> 大于 15 : 返回 false&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> -lt 100 -o <span class="hljs-variable">$b</span> -gt 100 ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> 小于 100 或 <span class="hljs-variable">$b</span> 大于 100 : 返回 true&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> 小于 100 或 <span class="hljs-variable">$b</span> 大于 100 : 返回 false&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> -lt 5 -o <span class="hljs-variable">$b</span> -gt 100 ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> 小于 5 或 <span class="hljs-variable">$b</span> 大于 100 : 返回 true&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> 小于 5 或 <span class="hljs-variable">$b</span> 大于 100 : 返回 false&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="逻辑运算">逻辑运算(&amp;&amp; || )</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>a=10<br>b=20<br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$a</span> -lt 100 &amp;&amp; <span class="hljs-variable">$b</span> -gt 100 ]]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;返回 true&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;返回 false&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$a</span> -lt 100 || <span class="hljs-variable">$b</span> -gt 100 ]]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;返回 true&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;返回 false&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="文件测试-r--w--x--f--d--s--e">文件测试(-r -w -x -f -d -s-e)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>file=<span class="hljs-string">&quot;/var/www/runoob/test.sh&quot;</span><br><br><span class="hljs-keyword">if</span> [ -r <span class="hljs-variable">$file</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件可读&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件不可读&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ -w <span class="hljs-variable">$file</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件可写&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件不可写&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ -x <span class="hljs-variable">$file</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件可执行&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件不可执行&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ -f <span class="hljs-variable">$file</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件为普通文件&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件为特殊文件&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ -d <span class="hljs-variable">$file</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件是个目录&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件不是个目录&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ -s <span class="hljs-variable">$file</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件不为空&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件为空&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ -e <span class="hljs-variable">$file</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件存在&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件不存在&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="字符串运算--z--n">字符串运算(= != -z -n)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>a=<span class="hljs-string">&quot;abc&quot;</span><br>b=<span class="hljs-string">&quot;efg&quot;</span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> = <span class="hljs-variable">$b</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> = <span class="hljs-variable">$b</span> : a 等于 b&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> = <span class="hljs-variable">$b</span>: a 不等于 b&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span> : a 不等于 b&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span>: a 等于 b&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ -z <span class="hljs-variable">$a</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;-z <span class="hljs-variable">$a</span> : 字符串长度为 0&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;-z <span class="hljs-variable">$a</span> : 字符串长度不为 0&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ -n <span class="hljs-string">&quot;<span class="hljs-variable">$a</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;-n <span class="hljs-variable">$a</span> : 字符串长度不为 0&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;-n <span class="hljs-variable">$a</span> : 字符串长度为 0&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> : 字符串不为空&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span> : 字符串为空&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h2 id="shell-printf">Shell printf</h2><h3id="print-format-str-arguments..."><code>print format-str [arguments...]</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%-10s %-8s %-4s\n&quot;</span> 姓名 性别 体重kg  <br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%-10s %-8s %-4.2f\n&quot;</span> 郭靖 男 66.1234 <br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%-10s %-8s %-4.2f\n&quot;</span> 杨过 男 48.6543 <br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%-10s %-8s %-4.2f\n&quot;</span> 郭芙 女 47.9876 <br><br>姓名     性别   体重kg<br>郭靖     男      66.12<br>杨过     男      48.65<br>郭芙     女      47.99<br></code></pre></td></tr></table></figure><h2 id="流程控制">流程控制</h2><h3 id="if-elif-else-fi">if-elif-else-fi</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>ratio = $(<span class="hljs-built_in">df</span> -h |grep /dev/sda3 |awk <span class="hljs-string">&#x27;&#123;print $5&#125;&#x27;</span> |<span class="hljs-built_in">cut</span> -d <span class="hljs-string">&quot;%&quot;</span> -f1)<br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$ratio</span>&quot;</span> -ge 80 ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;钉钉报警!&quot;</span> <br><span class="hljs-keyword">fi</span><br>----------------------------------------------------<br><span class="hljs-comment">#!/bin/bash</span><br>ntpdate asia.pool.ntp.org &amp;&gt;/dev/null<br><span class="hljs-built_in">date</span> = $(<span class="hljs-built_in">date</span> +%Y%m%d)<br>size = $(<span class="hljs-built_in">du</span> -sh /var/lib/mysql)<br><span class="hljs-keyword">if</span> [ -d /tmp/dbbak ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Date: <span class="hljs-variable">$date</span>!&quot;</span> &gt;/tmp/dbbak/dbinfo.txt<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Date: <span class="hljs-variable">$size</span>!&quot;</span> &gt;&gt;/tmp/dbbak/dbinfo.txt<br>  <span class="hljs-built_in">cd</span> /tmp/dbbak<br>  tar -czf mysql-lib-<span class="hljs-variable">$date</span>.tar.gz /var/lib/mysql dbinfo.txt &amp;&gt;/dev/null<br>  <span class="hljs-built_in">rm</span> -rf /tmp/dbbak/dbinfo.txt<br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">mkdir</span> /tmp/dbbak<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Date: <span class="hljs-variable">$date</span>!&quot;</span> &gt;/tmp/dbbak/dbinfo.txt<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Date: <span class="hljs-variable">$size</span>!&quot;</span> &gt;&gt;/tmp/dbbak/dbinfo.txt<br><span class="hljs-keyword">fi</span><br>-----------------------------------------------------<br><span class="hljs-comment">#!/bin/bash</span><br>port = `nmap -sT 192.168.137.129 |grep tcp |grep http |awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$port</span>&quot;</span> == <span class="hljs-string">&quot;open&quot;</span>]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(date)</span> httpd is ok!&quot;</span> &gt;&gt;/tmp/autostart-acc.log<br>  <span class="hljs-keyword">else</span><br>    /etc/init.d/httpd start &amp;&gt;/dev/null<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(date)</span> restart ok!&quot;</span> &gt;&gt;/tmp/autostart-acc.log<br><span class="hljs-keyword">fi</span><br>-----------------------------------------------------<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">read</span> -t 30 -p <span class="hljs-string">&quot;Input num1:&quot;</span> num1<br><span class="hljs-built_in">read</span> -t 30 -p <span class="hljs-string">&quot;Input num2:&quot;</span> num2<br><span class="hljs-keyword">if</span> [ -n <span class="hljs-string">&quot;<span class="hljs-variable">$num1</span>&quot;</span> -a -n <span class="hljs-string">&quot;<span class="hljs-variable">$num2</span>&quot;</span> -a -n <span class="hljs-string">&quot;<span class="hljs-variable">$opt</span>&quot;</span> ]; <span class="hljs-keyword">then</span> <br>  test1 = $(<span class="hljs-built_in">echo</span> num1 |sed <span class="hljs-string">&#x27;s/[0-9]//g&#x27;</span>)<br>  test2 = $(<span class="hljs-built_in">echo</span> num2 |sed <span class="hljs-string">&#x27;s/[0-9]//g&#x27;</span>)<br>  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$test1</span>&quot;</span> -a -z <span class="hljs-string">&quot;<span class="hljs-variable">$test2</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$opt</span>&quot;</span> == <span class="hljs-string">&#x27;+&#x27;</span> ]; <span class="hljs-keyword">then</span><br>      value = $(( <span class="hljs-variable">$num1</span> + <span class="hljs-variable">$num2</span> ))<br>    <span class="hljs-keyword">elif</span> [ <span class="hljs-string">&quot;opt&quot;</span> == <span class="hljs-string">&#x27;-&#x27;</span> ]; <span class="hljs-keyword">then</span> <br>      value = $(( <span class="hljs-variable">$num1</span> - <span class="hljs-variable">$num2</span> ))<br>    <span class="hljs-keyword">elif</span> [ <span class="hljs-string">&quot;opt&quot;</span> == <span class="hljs-string">&#x27;*&#x27;</span> ]; <span class="hljs-keyword">then</span> <br>      value = $(( <span class="hljs-variable">$num1</span> * <span class="hljs-variable">$num2</span> ))<br>    <span class="hljs-keyword">elif</span> [ <span class="hljs-string">&quot;opt&quot;</span> == <span class="hljs-string">&#x27;/&#x27;</span> ]; <span class="hljs-keyword">then</span><br>      value = $(( <span class="hljs-variable">$num1</span> / <span class="hljs-variable">$num2</span> ))<br>    <span class="hljs-keyword">else</span><br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Please enter a valid symbol&quot;</span><br>      <span class="hljs-built_in">exit</span> 10<br>  <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">else</span> <br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Please input content&quot;</span><br>  <span class="hljs-built_in">exit</span> 12<br><span class="hljs-keyword">fi</span> <br></code></pre></td></tr></table></figure><h3 id="for-do-done">for-do-done</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">cd</span> /root/tar<br><span class="hljs-built_in">ls</span> *.tar.gz &gt;tar.log<br><span class="hljs-built_in">ls</span> *.tgz &gt;&gt;tar.log &amp;&gt;/dev/null<br>line = $(<span class="hljs-built_in">cat</span> tar.log |<span class="hljs-built_in">wc</span> -l)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">$line</span><br><span class="hljs-keyword">do</span> <br>  tar -xzvf <span class="hljs-variable">$i</span> -C /root/tar<br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">rm</span> -rf tar.log<br><br><span class="hljs-keyword">for</span> (( i=<span class="hljs-number">1</span>; i&lt;&quot;<span class="hljs-variable">$line</span>&quot;; i++))<br><span class="hljs-keyword">do</span><br>  num = $(<span class="hljs-built_in">cat</span> tar.log |awk <span class="hljs-string">&#x27;NR==&#x27;</span><span class="hljs-variable">$i</span><span class="hljs-string">&#x27; &#123;print $1&#125;&#x27;</span>)<br>  tar -xzvf <span class="hljs-variable">$num</span> -C /root/tar<br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">rm</span> -rf tar.log<br>---------------------------------------------------------<br><span class="hljs-comment">#!/bin/bash</span><br>grep <span class="hljs-string">&quot;&lt;\([0-9]\&#123;1,3\&#125;\.\)\&#123;3\&#125;[0-9]\&#123;1,3\&#125;\&gt;&quot;</span> /root/ip.txt &gt;/root/iptest_1.txt<br>grep <span class="hljs-string">&quot;^[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;$&quot;</span> /root/ip.txt &gt;/root/iptest_1.txt<br>line = $(<span class="hljs-built_in">wc</span> -l /root/iptest_1.txt awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span> &gt;/root/iptest.txt<br><span class="hljs-keyword">for</span> (( i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-variable">$line</span>; i++))<br><span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">cat</span> /root/iptest_1.txt |awk <span class="hljs-string">&#x27;NR==&#x27;</span><span class="hljs-variable">$i</span><span class="hljs-string">&#x27; &#123;print&#125;&#x27;</span> &gt;/root/iptest_2.txt<br>  a = $(<span class="hljs-built_in">cat</span> /root/iptest_2.txt |<span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;.&#x27;</span> -f1)<br>  b = $(<span class="hljs-built_in">cat</span> /root/iptest_2.txt |<span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;.&#x27;</span> -f2)<br>  c = $(<span class="hljs-built_in">cat</span> /root/iptest_2.txt |<span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;.&#x27;</span> -f3)<br>  d = $(<span class="hljs-built_in">cat</span> /root/iptest_2.txt |<span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;.&#x27;</span> -f4)<br>  <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$a</span>&quot;</span> -lt 1 -o <span class="hljs-string">&quot;<span class="hljs-variable">$a</span>&quot;</span> -gt 255 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">continue</span><br>  <span class="hljs-keyword">fi</span><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$b</span>&quot;</span> -lt 0 -o <span class="hljs-string">&quot;<span class="hljs-variable">$b</span>&quot;</span> -gt 255 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">continue</span><br>  <span class="hljs-keyword">fi</span><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$c</span>&quot;</span> -lt 0 -o <span class="hljs-string">&quot;<span class="hljs-variable">$c</span>&quot;</span> -gt 255 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">continue</span><br>  <span class="hljs-keyword">fi</span><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$d</span>&quot;</span> -lt 0 -o <span class="hljs-string">&quot;<span class="hljs-variable">$d</span>&quot;</span> -gt 255 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">continue</span><br>  <span class="hljs-keyword">fi</span><br>  <span class="hljs-built_in">cat</span> /root/iptest_2.txt &gt;&gt;/root/iptest.txt<br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">rm</span> -rf /root/iptest_1.txt<br>---------------------------------------------------------<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">read</span> -t 30 -p <span class="hljs-string">&quot;Please input users name:&quot;</span> NAME<br><span class="hljs-built_in">read</span> -t 30 -p <span class="hljs-string">&quot;Please input the number of users:&quot;</span> NUM<br><span class="hljs-built_in">read</span> -t 30 -p <span class="hljs-string">&quot;Please input the password of users name:&quot;</span> PASS<br><span class="hljs-keyword">if</span> [ ! -z <span class="hljs-string">&quot;<span class="hljs-variable">$NAME</span>&quot;</span> -a ! -z <span class="hljs-string">&quot;<span class="hljs-variable">$NUM</span>&quot;</span> -a ! -z <span class="hljs-string">&quot;<span class="hljs-variable">$PASS</span>&quot;</span>]; <span class="hljs-keyword">then</span><br>  TMP = $(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$NUM</span> |sed <span class="hljs-string">&#x27;s/[0-9]//g&#x27;</span>)<br>  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$TMP</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">for</span>(( i=<span class="hljs-number">1</span>; i&lt;<span class="hljs-variable">$NUM</span>; i=i+<span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">do</span><br>      /usr/sbin/useradd $NAME<span class="hljs-variable">$i</span> &amp;&gt;/dev/null<br>      <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PASS</span> |/usr/bin/passwd --stdin $NAME<span class="hljs-variable">$i</span> &amp;&gt;/dev/null<br>      chage -d 0 $NAME<span class="hljs-variable">$i</span> &amp;&gt;/dev/null<br>    <span class="hljs-keyword">done</span> <br>  <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br>---------------------------------------------------------<br><span class="hljs-comment">#！/bin/bash</span><br>user = $(<span class="hljs-built_in">cat</span> /etc/passwd |grep <span class="hljs-string">&quot;/bin/bash&quot;</span> |grep -v <span class="hljs-string">&quot;root&quot;</span> |<span class="hljs-built_in">cut</span> -d <span class="hljs-string">&quot;:&quot;</span> -f1)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">$user</span><br><span class="hljs-keyword">do</span> <br>  userdel -r <span class="hljs-variable">$i</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h3 id="while-do-done">while-do-done</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>i = 1<br>s = 0<br><span class="hljs-keyword">while</span> [ <span class="hljs-variable">$i</span> -le 100 ]<br><span class="hljs-keyword">do</span><br>  s = $(( <span class="hljs-variable">$s</span> + <span class="hljs-variable">$i</span> ))<br>  i = $(( <span class="hljs-variable">$i</span> + <span class="hljs-variable">$1</span> ))<br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;The sum is: <span class="hljs-variable">$s</span>&quot;</span><br><br><span class="hljs-keyword">while</span>    <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span><span class="hljs-keyword">for</span>(( ; ; ))<br><span class="hljs-keyword">do</span>         <span class="hljs-keyword">do</span><br><span class="hljs-keyword">done</span>       <span class="hljs-keyword">done</span> <br></code></pre></td></tr></table></figure><h3 id="case-in-esac">case-in-esac</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;输入 1 到 4 之间的数字:&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;你输入的数字为:&#x27;</span><br><span class="hljs-built_in">read</span> aNum<br><span class="hljs-keyword">case</span> <span class="hljs-variable">$aNum</span> <span class="hljs-keyword">in</span><br>  1)  <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;你选择了 1&#x27;</span><br>  ;;<br>  1)  <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;你选择了 2&#x27;</span><br>  ;;<br>  1)  <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;你选择了 3&#x27;</span><br>  ;;<br>  1)  <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;你选择了 4&#x27;</span><br>  ;;<br>  *)  <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;你没有输入 1 到 4 之间的数字&#x27;</span><br>  ;;<br><span class="hljs-keyword">esac</span><br></code></pre></td></tr></table></figure><h3 id="关于-break-与-continue">关于 <code>break</code> 与<code>continue</code></h3><ul><li><strong>break命令允许跳出所有循环（终止执行后面的所有循环）</strong></li><li><strong>continue命令与break命令类似，只有一点差别，它不会跳出所有循环，仅仅跳出当前循环</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-keyword">while</span> :<br><span class="hljs-keyword">do</span><br>   <span class="hljs-built_in">echo</span> -n <span class="hljs-string">&quot;输入 1 到 5 之间的数字:&quot;</span><br>   <span class="hljs-built_in">read</span> aNum<br><span class="hljs-keyword">case</span> <span class="hljs-variable">$aNum</span> <span class="hljs-keyword">in</span><br>   1|2|3|4|5) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;你输入的数字为 <span class="hljs-variable">$aNum</span>!&quot;</span><br>   ;;<br>   *) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;你输入的数字不是 1 到 5 之间的! 游戏结束&quot;</span><br>      <span class="hljs-built_in">break</span><br>   ;;<br><span class="hljs-keyword">esac</span><br><span class="hljs-keyword">done</span><br><br>输入 1 到 5 之间的数字:3<br>你输入的数字为 3!<br>输入 1 到 5 之间的数字:7<br>你输入的数字不是 1 到 5 之间的! 游戏结束<br>------------------------------------------------<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-keyword">while</span> :<br><span class="hljs-keyword">do</span><br>   <span class="hljs-built_in">echo</span> -n <span class="hljs-string">&quot;输入 1 到 5 之间的数字: &quot;</span><br>   <span class="hljs-built_in">read</span> aNum<br>   <span class="hljs-keyword">case</span> <span class="hljs-variable">$aNum</span> <span class="hljs-keyword">in</span><br>      1|2|3|4|5) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;你输入的数字为 <span class="hljs-variable">$aNum</span>!&quot;</span><br>      ;;<br>      *) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;你输入的数字不是 1 到 5 之间的!&quot;</span><br>            <span class="hljs-built_in">continue</span><br>            <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;游戏结束&quot;</span><br>      ;;<br>   <span class="hljs-keyword">esac</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="shell-function">Shell function</h2><h3 id="定义函数">定义函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-function"><span class="hljs-title">funWithReturn</span></span>()&#123;<br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;这个函数会对输入的两个数字进行相加运算...&quot;</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;输入第一个数字: &quot;</span><br>   <span class="hljs-built_in">read</span> aNum<br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;输入第二个数字: &quot;</span><br>   <span class="hljs-built_in">read</span> anotherNum<br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;两个数字分别为 <span class="hljs-variable">$aNum</span> 和 <span class="hljs-variable">$anotherNum</span> !&quot;</span><br>   <span class="hljs-built_in">return</span> $((<span class="hljs-variable">$aNum</span>+<span class="hljs-variable">$anotherNum</span>))<br>&#125;<br>funWithReturn<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;输入的两个数字之和为 $? !&quot;</span><br><br><br><span class="hljs-function"><span class="hljs-title">funWithParam</span></span>()&#123;<br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第一个参数为 <span class="hljs-variable">$1</span> !&quot;</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第二个参数为 <span class="hljs-variable">$2</span> !&quot;</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第十个参数为 <span class="hljs-variable">$10</span> !&quot;</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第十个参数为 <span class="hljs-variable">$&#123;10&#125;</span> !&quot;</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第十一个参数为 <span class="hljs-variable">$&#123;11&#125;</span> !&quot;</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;参数总数有 <span class="hljs-variable">$#</span> 个!&quot;</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;作为一个字符串输出所有参数 $* !&quot;</span><br>&#125;<br>funWithParam 1 2 3 4 5 6 7 8 9 34 73<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Shell</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSS</title>
    <link href="/posts/ee69e452.html"/>
    <url>/posts/ee69e452.html</url>
    
    <content type="html"><![CDATA[<p>2019-08-08-CSS <span id="more"></span></p><h1 id="css">CSS</h1><h2 id="概念">概念:</h2><p><strong>CSS 指层叠样式表 (Cascading Style Sheets),样式定义以何种方式显示 HTML 元素, 外部样式表通常存储在 CSS文件中</strong><br /><img src="/posts/ee69e452/CSS%E8%AF%AD%E6%B3%95.jpg" class="" title="[CSS语法]"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span> &#123;<span class="hljs-attribute">color</span>:blue; <span class="hljs-attribute">font-size</span>:<span class="hljs-number">12px</span>;&#125;<br>选择器 属性:属性值 <br>注释:<br><span class="hljs-comment">/* ... */</span><br></code></pre></td></tr></table></figure><h2 id="选择器">选择器:</h2><ul><li><p>id 选择器(#) <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-id">#para</span>&#123;<br> <span class="hljs-attribute">text-align</span>: center;<br> <span class="hljs-attribute">color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure></p></li><li><p>class 选择器(.) <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.center</span>&#123; <span class="hljs-attribute">text-align</span>: center;&#125;<br></code></pre></td></tr></table></figure></p></li><li><p>子选择器(SS) <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs css"> &lt;style&gt;<br><span class="hljs-selector-tag">div</span> &gt; <span class="hljs-selector-tag">p</span>&#123;   <span class="hljs-comment">/*只能选择作为某元素子元素的元素*/</span><br><span class="hljs-attribute">color</span>:red;<br> &#125;<br> &lt;/style&gt;<br> &lt;<span class="hljs-selector-tag">div</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span>&gt;red <span class="hljs-selector-tag">text</span>&lt;/<span class="hljs-selector-tag">p</span>&gt;  &lt;!--文字是红色的--&gt;<br> &lt;<span class="hljs-selector-tag">table</span>&gt;<br> <span class="hljs-comment">/*文字是非红色的*/</span><br>&lt;<span class="hljs-selector-tag">tr</span>&gt;&lt;<span class="hljs-selector-tag">td</span>&gt;&lt;<span class="hljs-selector-tag">p</span>&gt;no red <span class="hljs-selector-tag">text</span>;&lt;/<span class="hljs-selector-tag">td</span>&gt;&lt;/<span class="hljs-selector-tag">p</span>&gt;&lt;/<span class="hljs-selector-tag">tr</span>&gt;<br> &lt;/<span class="hljs-selector-tag">table</span>&gt;<br> &lt;/<span class="hljs-selector-tag">div</span>&gt;<br></code></pre></td></tr></table></figure></p></li><li><p>相邻兄弟选择器 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;style&gt;<br><span class="hljs-selector-tag">div</span> + <span class="hljs-selector-tag">p</span>&#123;<br>  <span class="hljs-attribute">color</span>: red;<br>&#125;<br>&lt;/style&gt;<br>&lt;<span class="hljs-selector-tag">div</span>&gt;<br>  &lt;<span class="hljs-selector-tag">p</span>&gt;not red <span class="hljs-selector-tag">text</span>&lt;/<span class="hljs-selector-tag">p</span>&gt;<br>  &lt;<span class="hljs-selector-tag">p</span>&gt;not red <span class="hljs-selector-tag">text</span>&lt;/<span class="hljs-selector-tag">p</span>&gt;<br>&lt;/<span class="hljs-selector-tag">div</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span>&gt;red <span class="hljs-selector-tag">text</span>&lt;/<span class="hljs-selector-tag">p</span>&gt;    <br>&lt;<span class="hljs-selector-tag">p</span>&gt;not red <span class="hljs-selector-tag">text</span>&lt;/<span class="hljs-selector-tag">p</span>&gt;<br></code></pre></td></tr></table></figure></p></li><li><p>后续兄弟选择器(BS) <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css"> &lt;style&gt;<br><span class="hljs-selector-tag">div</span> ~ <span class="hljs-selector-tag">p</span>&#123;    <span class="hljs-comment">/*选取所有指定元素之后的相邻兄弟元素*/</span><br><span class="hljs-attribute">color</span>:red;<br> &#125;<br> &lt;/style&gt;<br> &lt;<span class="hljs-selector-tag">div</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span>&gt;no red <span class="hljs-selector-tag">text</span>&lt;/<span class="hljs-selector-tag">p</span>&gt;  <span class="hljs-comment">/*文字是非红色的*/</span><br>&lt;<span class="hljs-selector-tag">div</span>&gt;no red <span class="hljs-selector-tag">text</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span>&gt;red <span class="hljs-selector-tag">text</span>&lt;/<span class="hljs-selector-tag">p</span>&gt;  <span class="hljs-comment">/*文字是红色的*/</span><br> &lt;/<span class="hljs-selector-tag">div</span>&gt;<br></code></pre></td></tr></table></figure></p></li></ul><h2 id="伪类">伪类:</h2><ul><li>语法:<br /><code>选择器.CSS类:伪类&#123;属性:属性值&#125;</code> /<code>选择器:伪类&#123;属性:属性值&#125;</code> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;style&gt;<br>  <span class="hljs-selector-tag">p</span><span class="hljs-selector-pseudo">:after</span>&#123; <span class="hljs-comment">/* p::before &amp;&amp; p::after */</span><br>    <span class="hljs-attribute">content</span>:<span class="hljs-string">&quot;- 注意我&quot;</span>;<br>  &#125;<br>&lt;/style&gt;<br>&lt;<span class="hljs-selector-tag">body</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span>&gt;我的名字是 Donald&lt;/<span class="hljs-selector-tag">p</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span>&gt;我住在 Ducksburg&lt;/<span class="hljs-selector-tag">p</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span>&gt;&lt;<span class="hljs-selector-tag">b</span>&gt;注意：&lt;/<span class="hljs-selector-tag">b</span>&gt; <span class="hljs-selector-pseudo">:after</span>在IE8中运行，必须声明 !DOCTYPE &lt;/<span class="hljs-selector-tag">p</span>&gt;<br></code></pre></td></tr></table></figure></li></ul><img src="/posts/ee69e452/jieGouWeilei.jpg" class="" title="[结构伪类]"><h2 id="多重样式优先级">多重样式优先级</h2><p><strong><ahref="www.runoob.com/w3cnote/css-style-priority.html">参考文章</a></strong><br /><strong>插入样式表的方法有三种:</strong><br />+ <code>外部样式表</code>(External style sheet) +<code>内部样式表</code>(Internal style sheet) +<code>内联样式</code>(Inline style)<br />+ <strong>行内样式(1000)&gt; id选择器(100)&gt; 类选择器(10)&gt;标签选择器(1)</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;head&gt;<span class="hljs-comment">/*外部*/</span><br>&lt;link rel=&quot;stylesheet&quot; type=&quot;<span class="hljs-selector-tag">text</span>/css&quot; href=&quot;mystyle<span class="hljs-selector-class">.css</span>&quot;&gt;<br>&lt;/head&gt;<br><br>&lt;head&gt;<span class="hljs-comment">/*内部*/</span><br>&lt;style&gt;<br>  hr &#123;<span class="hljs-attribute">color</span>:sienna;&#125;<br>  <span class="hljs-selector-tag">p</span> &#123;<span class="hljs-attribute">margin-left</span>:<span class="hljs-number">20px</span>;&#125;<br>  <span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">background-image</span>:<span class="hljs-built_in">url</span>(<span class="hljs-string">&quot;images/back40.gif&quot;</span>);&#125;<br>&lt;/style&gt;<br>&lt;/head&gt;<br><br>&lt;<span class="hljs-selector-tag">p</span> style=&quot;<span class="hljs-attribute">color</span>:sienna;<span class="hljs-attribute">margin-left</span>:<span class="hljs-number">20px</span><span class="hljs-string">&quot;&gt;这是一个段落。&lt;/p&gt;/*内联*/</span><br></code></pre></td></tr></table></figure><h2 id="background背景-要设置宽高">background(背景,<strong>要设置宽高</strong>)</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span>&#123;<br>  <span class="hljs-attribute">background</span>: all;<br>  backdround-<span class="hljs-attribute">color</span>: <span class="hljs-number">#FFFFFF</span>;<span class="hljs-comment">/*rgb(255,255,255)*/</span><br>  <span class="hljs-attribute">background</span>-imgage: <span class="hljs-built_in">url</span>(<span class="hljs-string">&#x27;url&#x27;</span>);<br>  <span class="hljs-attribute">background-repeat</span>: repeat-x / repeat-y / no-repeat;<br>  <br>  // 水平位置(<span class="hljs-attribute">left</span> center <span class="hljs-attribute">right</span>) 垂直位置(<span class="hljs-attribute">top</span> center <span class="hljs-attribute">bottom</span>)<br>  <span class="hljs-attribute">background-position</span>: 固定值 / 百分比 / 单词; <br>  <span class="hljs-attribute">background-attachment</span>: scroll / fixed / inherit;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="text文本">Text(文本)</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span>&#123;<br>  <span class="hljs-attribute">color</span>: red;<br>  <span class="hljs-attribute">text-align</span>: center / right / justify;<br>  <span class="hljs-attribute">text-decoration</span>: none;<br>  <span class="hljs-attribute">text-transform</span>: uppercase / lowercase / capitalize;<br>  <span class="hljs-attribute">text-indent</span>: <span class="hljs-number">10px</span>; <span class="hljs-comment">/*指定文本的第一行的缩进*/</span><br>  <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">#ff0000</span>; <span class="hljs-comment">/*CSS3: 水平阴影的位置 垂直阴影的位置 模糊的距离(blur) 阴影的颜色(color)*/</span><br>  <span class="hljs-attribute">vertical-align</span>: text-top; <span class="hljs-comment">/*设置元素的垂直对齐*/</span><br>  <span class="hljs-attribute">word-spacing</span>: <span class="hljs-number">30px</span>;<span class="hljs-comment">/*设置英文单词之间的间距*/</span><br>  <span class="hljs-attribute">letter-spacing</span>:<span class="hljs-number">30px</span>;<span class="hljs-comment">/*设置字母与字母之间的间距*/</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="font字体">Font(字体)</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span>&#123;<br>  <span class="hljs-attribute">font</span>: all;<br>  <span class="hljs-attribute">font-style</span>: normal / italic / oblique;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span> / <span class="hljs-number">14px</span>/<span class="hljs-number">16</span>=<span class="hljs-number">0.875em</span>;<br>  <span class="hljs-attribute">font-family</span>:<span class="hljs-string">&quot;Times New Roman&quot;</span>,Georgia,Serif;<br>  <span class="hljs-attribute">font-weight</span>: normal / bold / bolder / lighter;<span class="hljs-comment">/*指定字体的粗细*/</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="链接">链接</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:link</span>: &#123;<span class="hljs-attribute">color</span>: yellow;&#125;<br><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:visited</span>: &#123;<span class="hljs-attribute">color</span>: black;&#125;<br><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span>: &#123;<span class="hljs-attribute">color</span>: blue;&#125;<br><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:active</span>: &#123;<span class="hljs-attribute">color</span>: red;&#125;<br></code></pre></td></tr></table></figure><h2 id="列表">列表</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">ul</span>&#123;<br>  <span class="hljs-attribute">list-style</span>: all;<br>  <span class="hljs-attribute">list-style-type</span>: circle / square / upper-roman / lower-alpha;<br>  <span class="hljs-attribute">list-style-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">&#x27;url&#x27;</span>);<br>  <span class="hljs-attribute">list-style-position</span>: inside / outside / inherit;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="盒子模型上-右-下-左">盒子模型(上 右 下 左)</h2><blockquote><p><strong>所有HTML元素可以看作盒子, 在CSS中, <code>"box model"</code>这一术语是用来<code>设计</code>和<code>布局</code>时使用,CSS盒模型本质上是一个盒子, 封装周围的HTML元素, 它包括:<code>边距</code>, <code>边框</code>, <code>填充</code>,和<code>实际内容</code></strong> 一个盒子的高度一般不用单独设置,由其内容撑开 <strong>不要给元素添加具有指定宽度的内边距,而是尝试将内边距或外边距添加到元素的父元素和子元素</strong></p></blockquote><img src="/posts/ee69e452/CSS-Box-Model.jpg" class="" title="[CSS-Box-Model]"><img src="/posts/ee69e452/Box-Model.jpg" class="" title="[CSS_BOX_MODEL]"><ul><li><code>margin</code> (外边距) - 清除边框外的区域,外边距是透明的(盒子与盒子之间的距离)</li><li><code>border</code> (边框) - 围绕在内边距和内容外的边框</li><li><code>padding</code> (内边距) - 清除内容周围的区域,内边距是透明的(内容填充, 内容到边框之间的距离)</li><li><code>content</code> (内容) - 盒子的内容, 显示文本和图像</li><li><code>说明</code>: margin属性本意描述的<strong>兄弟与兄弟</strong>元素之间的关系,若是父子元素关系, 就最好给其父元素加 padding 属性</li></ul><p><strong>margin 实现水平居中</strong> &gt; 元素要有固定的宽度(未设置,为父元素100%的宽度), 只有块元素可以实现水平居中, 行内元素不能实现;只有标准文档流中的盒子可以使用 margin 实现水平居中 &gt; margin属性是用来实现盒子的水平居中, 而不是文本的水平居中</p><p><strong>注意:</strong> &gt; 在标准文档流中<strong>垂直方向</strong>的margin 值不会叠加, 仅仅会取比较大的值 &gt; 水平方向没有 margin的塌陷现象 &gt; 浮动元素它是没有 margin 的塌陷现象的</p><h2 id="几种属性">几种属性</h2><h3 id="关于尺寸">关于尺寸:</h3><h4 id="width-height设置元素的宽高">width &amp;&amp;height(设置元素的宽高)</h4><p><code>p&#123; height:100px; width:100px;&#125;</code></p><h4 id="line-height设置元素的行高">line-height(设置元素的行高)</h4><p><code>p&#123;line-height: 14px;&#125;</code></p><h4id="display行内与块级相互转化-visibility">display(行内与块级相互转化)&amp;&amp; visibility</h4><blockquote><p>块级元素(block)特性: 总是<em>独占一行</em>, 表现为另起一行开始,而且其后的元素也必须另起一行显示; 宽度(width), 高度(height),内边距(padding)和外边距(margin)都可控制;</p></blockquote><p><code>块级元素: div, h1, h2, h3, h4, h5, h6, hr, dl, ul, li, form, ol, p, pre, table</code></p><blockquote><p>内联元素(inline)特性: 和相邻的内联元素在同一行; 宽度(width),高度(height),内边距的top/bottom(padding-top/padding-bottom)和外边距的top/bottom(margin-top/margin-bottom)都不可改变,就是里面文字或图片的大小, 即宽高有内容撑开;</p></blockquote><p><code>内联元素: a, img, br, input, select, small, span, strong, sub, sup, textarea,</code></p><img src="/posts/ee69e452/%E5%85%83%E7%B4%A0%E5%88%86%E7%B1%BB.png" class="" title="[元素分类]"><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span>&#123; <span class="hljs-attribute">display</span>: none;&#125;<span class="hljs-comment">/*隐藏一个元素, 不会占用空间*/</span><br><span class="hljs-selector-tag">h1</span>&#123; <span class="hljs-attribute">visibility</span>: hidden&#125;<span class="hljs-comment">/*隐藏一个元素, 隐藏的元素仍需占用与未隐藏之前一样的空间*/</span><br><br><span class="hljs-selector-tag">li</span>&#123; <span class="hljs-attribute">display</span>: inline;&#125;<span class="hljs-comment">/*显示为内联元素*/</span><br><span class="hljs-selector-tag">span</span>&#123; <span class="hljs-attribute">display</span>: block;&#125;<span class="hljs-comment">/*显示为块级元素*/</span><br></code></pre></td></tr></table></figure><h4 id="position定位">position(定位)</h4><p><strong>标准文档流: 从左至右, 从上至下; 遇到换行做空格解析；高低不齐, 底部对齐</strong> <strong>定位有四个属性值</strong></p><p><strong>1. <code>static</code></strong>: 默认值, 即没有定位,元素出现在正常的文档流中<br /><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.static</span> &#123;<br>  <span class="hljs-attribute">position</span>: static;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">3px</span> solid <span class="hljs-number">#73AD21</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><p><strong>2. <code>fixed</code></strong>:元素位置相对于<strong>浏览器窗口</strong>是固定位置,即使窗口滚动也不会动,与标准文档流无关, 层级比标准文档流元素高, 且不占据空间<br /><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.pos_fixed</span><br>&#123;<br>  <span class="hljs-attribute">position</span>:fixed;<br>  <span class="hljs-attribute">top</span>:<span class="hljs-number">30px</span>;<br>  <span class="hljs-attribute">right</span>:<span class="hljs-number">5px</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><p><strong>3. <code>relative</code></strong>:<br />1)<strong>相对定位不脱标</strong><br />2)相对定位不改变元素的性质, 不设置偏移属性, 位置不发生改变3)相对定位元素的定位是相对于,<strong>文档流中原先位置进行定位</strong><br />4)元素会<strong>提升一个层级</strong>, 它原本所占的空间并不会改变<br /><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h2</span><span class="hljs-selector-class">.pos_left</span><br>&#123;<br>  <span class="hljs-attribute">position</span>:relative;<br>  <span class="hljs-attribute">left</span>:-<span class="hljs-number">20px</span>;<br>&#125;<br><span class="hljs-selector-tag">h2</span><span class="hljs-selector-class">.pos_right</span><br>&#123;<br>  <span class="hljs-attribute">position</span>:relative;<br>  <span class="hljs-attribute">left</span>:<span class="hljs-number">20px</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><strong>4. <code>absolute</code></strong>:<br />1)绝对定位改变元素的性质, 不设置偏移属性, 位置不发生改变<br />2)绝对定位脱离标准文档流, 定位的元素和其他元素重叠<br />3)绝对定位的元素的位置相对于”最近”的已定位(无论是相对、绝对或固定)的父元素, 如果没有, 则它的位置相对于<body><p>(浏览器窗口)进行定位 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h2</span><br>&#123;<br>  <span class="hljs-attribute">position</span>:absolute;<br>  <span class="hljs-attribute">left</span>:<span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">top</span>:<span class="hljs-number">150px</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><h4 id="z-index-属性">z-index 属性</h4><blockquote><p>z-index 表示层级大小, 数值大的会压盖数值小的, 默认为0只有定位元素才有 z-index 值, 若多个定位元素未设置, 或者值相同,则写在HTML后面的定位元素会压盖前面的的定位元素</p></blockquote><h4 id="float浮动">float(浮动)</h4><p><strong>浮动的特点</strong><br />&gt; 1. <code>脱离文档流</code>, 浮动的<strong>元素互相贴靠</strong>,浮动元素有”字围”效果、收缩; &gt; 2. 一旦元素浮动后, 即脱离文档流,就不受文档流的控制了, 也就没有行内、块级之分了; &gt; 3.<strong>行内元素能够支持宽高, 但浮动元素未设置宽高,其宽高由内容撑开</strong>;</p><p><strong>浮动清除的方法:</strong><br />&gt; 经过浮动的元素, 会影响到它下面元素的布局,浮动元素的父元素没有将浮动元素包裹 &gt; 1.<code>给浮动元素的父级元素加高度</code>: 如果一个元素要浮动,那么它的父级元素一定要有高度, 保证父级高度不能小于子级高度,有高度的盒子, 才能包住浮动的子元素; &gt; 2.追加一个空元素并添加<code>clear: both;</code>:(该元素的左右两侧都不能有浮动元素),但是这种方法有一个非常大的、致命的问题, 它所在的标签,“margin属性失效了”, margin失效的本质原因是: 父级高度为零. &gt; 3.在最后的浮动元素增加<code>&lt;div class="clear&gt;&lt;/div&gt;</code>,并<code>clear: both;</code> &gt; 4. 在父元素上添加:<code>overflow: hidden;</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.clear</span>&#123;<br>   <span class="hljs-attribute">zoom</span>: <span class="hljs-number">1</span>;  <span class="hljs-comment">/*兼容 IE6 利用 hasLayout*/</span><br>&#125;<br><span class="hljs-selector-class">.clear</span><span class="hljs-selector-pseudo">:before</span>, <span class="hljs-selector-class">.clear</span><span class="hljs-selector-pseudo">:after</span>&#123;  <br>  # 父级后边 追加 空内容 <br>   <span class="hljs-attribute">content</span>: <span class="hljs-string">&#x27;&#x27;</span>;<br>   <span class="hljs-attribute">display</span>: block;<br>   <span class="hljs-attribute">clear</span>: both;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="transform-2d效果">transform (2D效果)</h4><blockquote><p>通过CSS3 转换, 可以实现对元素的移动、缩放、转动、拉长或拉伸<code>移动:translate(10px,30px)</code>/<code>旋转:rotate(40deg)</code>/<code>缩放:scale(2,4)</code>/<code>倾斜:skew(30deg,20deg)</code>/<code>矩阵:matrix()</code></p></blockquote><p><ahref="https://www.cnblogs.com/Ivy-s/p/6786622.html">矩阵效果参考</a></p><h4 id="transform-3d效果">transform (3D效果)</h4><blockquote><p>rotateX() rotateY() rotateZ()</p></blockquote><h4 id="transition-过度">transition (过度)</h4><blockquote><p>CSS3 过度是元素从一种样式逐渐改变为另一种的效果 目标属性、时长</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;style&gt;<br>  <span class="hljs-selector-tag">div</span>&#123;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;<br>    <span class="hljs-attribute">background-color</span>: red;<br>    <span class="hljs-attribute">transition</span>: width <span class="hljs-number">3s</span>, height <span class="hljs-number">3s</span>;<br>  &#125;<br>  <span class="hljs-selector-tag">div</span><span class="hljs-selector-pseudo">:hover</span>&#123;<span class="hljs-attribute">width</span>:<span class="hljs-number">400px</span>; <span class="hljs-attribute">height</span>:<span class="hljs-number">400px</span>; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotate</span>(<span class="hljs-number">180deg</span>);&#125;<br>&lt;/style&gt;<br>&lt;<span class="hljs-selector-tag">body</span>&gt;<br>&lt;<span class="hljs-selector-tag">div</span>&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;<br>&lt;/<span class="hljs-selector-tag">body</span>&gt;<br></code></pre></td></tr></table></figure><h4 id="keyframes-animation"><span class="citation"data-cites="keyframes">@keyframes</span> (animation)</h4><blockquote><p>在 <span class="citation" data-cites="keyframes">@keyframes</span>中规定某项 CSS 样式, 可以创建由当前样式逐渐改为新样式的动画效果动画名称、动画时长</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;style&gt;<br>  <span class="hljs-selector-tag">div</span>&#123;<span class="hljs-attribute">width</span>:<span class="hljs-number">100</span>ox; <span class="hljs-attribute">height</span>:<span class="hljs-number">100px</span>; <span class="hljs-attribute">background</span>:red animation:myfirstAnim <span class="hljs-number">3s</span>;&#125;<br>  <span class="hljs-keyword">@keyframes</span> myfirstAnim&#123;<br>    <span class="hljs-comment">/*也可以 0%&#123;&#125; 25%&#123;&#125; 50%&#123;&#125; 75%&#123;&#125; 100%&#123;&#125; 控制*/</span><br>    <span class="hljs-selector-tag">from</span>&#123;<span class="hljs-attribute">background</span>:red;&#125; <br>    <span class="hljs-selector-tag">to</span>&#123;<span class="hljs-attribute">background</span>:yellow;&#125;<br>  &#125;<br>&lt;/style&gt;<br>&lt;<span class="hljs-selector-tag">body</span>&gt;&lt;<span class="hljs-selector-tag">div</span>&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;&lt;/<span class="hljs-selector-tag">body</span>&gt;<br></code></pre></td></tr></table></figure><p><strong>待续…</strong></p>]]></content>
    
    
    <categories>
      
      <category>CSS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CSS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>html-02</title>
    <link href="/posts/82d0dbac.html"/>
    <url>/posts/82d0dbac.html</url>
    
    <content type="html"><![CDATA[<p>2019-08-08-HTML2 <span id="more"></span></p><h1 id="简单介绍-html5">简单介绍 HTML5</h1><h2 id="结构">结构</h2><img src="/posts/82d0dbac/HTML5.png" class="" title="[HTML5]"><h2 id="新元素">新元素</h2><h3 id="一canvas">一、Canvas</h3><blockquote><p><strong><code>&lt;canvas&gt;</code> 元素用于图形的绘制,<code>&lt;canvas&gt;</code> 标签只是图形容器, 通过脚本(通常是JavaScript)来完成</strong></p></blockquote><img src="/posts/82d0dbac/Canvas.jpg" class="" title="[Canvas]"><p><strong><em>如下是一些例子:</em></strong></p><p><strong>1.绘制矩形</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;canvas id=<span class="hljs-string">&quot;canvas&quot;</span> width=<span class="hljs-string">&quot;200&quot;</span> height=<span class="hljs-string">&quot;100&quot;</span> style=<span class="hljs-string">&quot;border: 1px solid #c3c3c3;&quot;</span>&gt;您的浏览器不支持 <span class="hljs-title class_">HTML5</span> canvas 标签。&lt;/canvas&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">   <span class="hljs-keyword">var</span> c=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElemnetById</span>(<span class="hljs-string">&quot;canvas&quot;</span>);  <span class="hljs-comment">//找到 &lt;canvas&gt;</span></span></span><br><span class="language-javascript"><span class="language-xml">   <span class="hljs-keyword">var</span> ctx=c.<span class="hljs-title function_">getContent</span>(<span class="hljs-string">&quot;2d&quot;</span>); <span class="hljs-comment">// 创建 context 对象</span></span></span><br><span class="language-javascript"><span class="language-xml">   ctx.<span class="hljs-property">fillStyle</span>=<span class="hljs-string">&quot;#FF0000&quot;</span>; </span></span><br><span class="language-javascript"><span class="language-xml">   ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">150</span>,<span class="hljs-number">75</span>); <span class="hljs-comment">// fillRect(x,y,width,height) </span></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure></p><p><strong>2.绘制路径</strong><br /><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br>   <span class="hljs-keyword">var</span> c=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;canvas&quot;</span>);<br>   <span class="hljs-keyword">var</span> ctx=c.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&quot;2d&quot;</span>);<br>   ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>); <span class="hljs-comment">// moveTo(x,y) 定义线条开始坐标</span><br>   ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">200</span>,<span class="hljs-number">100</span>); <span class="hljs-comment">// lineTo(x,y) 定义线条结束坐标</span><br>   ctx.<span class="hljs-title function_">stroke</span>(); <span class="hljs-comment">// stroke() 方法来绘制线条</span><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></p><p><strong>3.绘制圆形</strong><br /><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br>   <span class="hljs-keyword">var</span> c=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;canvas&quot;</span>);<br>   <span class="hljs-keyword">var</span> ctx=c.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&quot;2d&quot;</span>);<br>   ctx.<span class="hljs-title function_">beginPath</span>();<br>   ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">95</span>,<span class="hljs-number">50</span>,<span class="hljs-number">40</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>*<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>); <span class="hljs-comment">// arc(x,y,r,start,stop)</span><br>   ctx.<span class="hljs-title function_">stroke</span>();<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></p><p><strong>4.渲染文本</strong><br /><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br>   <span class="hljs-keyword">var</span> c=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;canvas&quot;</span>);<br>   <span class="hljs-keyword">var</span> ctx=c.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&quot;2d&quot;</span>);<br>   ctx.<span class="hljs-property">font</span>=<span class="hljs-string">&quot;30px Arial&quot;</span>;<br>   ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">&quot;Hello World&quot;</span>,<span class="hljs-number">10</span>,<span class="hljs-number">50</span>); <span class="hljs-comment">// 实心 fillText(text,x,y)方法, 空心 storkeText()方法</span><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></p><p><strong>5.渐变</strong><br /><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br>   <span class="hljs-keyword">var</span> c=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;canvas&quot;</span>);<br>   <span class="hljs-keyword">var</span> ctx=c.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&quot;2d&quot;</span>);<br> <br>   <span class="hljs-comment">// createLinearGradient(x,y,x1,y1) - 创建线条渐变</span><br>   <span class="hljs-comment">// createRadialGradient(x,y,r,x1,y1,r1) - 创建一个径向/圆渐变</span><br>   <span class="hljs-keyword">var</span> grd=ctx.<span class="hljs-title function_">createLinearGradient</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">200</span>,<span class="hljs-number">0</span>);<br>   grd.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0</span>,<span class="hljs-string">&quot;red&quot;</span>);<br>   grd.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;white&quot;</span>);<br> <br>   <span class="hljs-comment">// 填充渐变</span><br>   ctx.<span class="hljs-property">fillStyle</span>=grd;<br>   ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-number">150</span>,<span class="hljs-number">80</span>);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></p><p><strong>6.渲染图像</strong><br /><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br>   <span class="hljs-keyword">var</span> c=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;canvas&quot;</span>);<br>   <span class="hljs-keyword">var</span> ctx=c.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&quot;2d&quot;</span>);<br>   <span class="hljs-keyword">var</span> img=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;scream&quot;</span>);<br>   ctx.<span class="hljs-title function_">drawImage</span>(img,<span class="hljs-number">10</span>,<span class="hljs-number">10</span>);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></p><h3 id="二svg">二、SVG</h3><blockquote><p><strong>SVG 指可伸缩矢量图形 (Scalable Vector Graphics),用于定义用于网络的基于矢量的图形, 使用 XML 格式定义图形, SVG图像在放大或改变尺寸的情况下其图形质量不会有损失</strong></p></blockquote><p><strong>五角星</strong><br /><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;svg xmlns=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span> width=<span class="hljs-string">&quot;190&quot;</span> height=<span class="hljs-string">&quot;190&quot;</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">polygon</span> <span class="hljs-attr">points</span>=<span class="hljs-string">&quot;100,10 40,180 190,60 10,60 160,180&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;fill:lime; stroke:purple; stroke-width:5; fill-rule:evenodd;&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span></span><br></code></pre></td></tr></table></figure></p><h3 id="三video-与-audio">三、Video 与 Audio</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;320&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;240&quot;</span> <span class="hljs-attr">controls</span>=<span class="hljs-string">&quot;controls&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;movie.mp4&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;video/mp4&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;movie.ogg&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;video/ogg&quot;</span>&gt;</span><br>  您的浏览器不支持 HTML5 video 标签。<br><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">audio</span> <span class="hljs-attr">controls</span>=<span class="hljs-string">&quot;controls&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;horse.ogg&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;audio/ogg&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;horse.mp3&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;audio/mpeg&quot;</span>&gt;</span><br>您的浏览器不支持 audio 元素。<br><span class="hljs-tag">&lt;/<span class="hljs-name">audio</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="四拖放">四、拖放</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;style&gt;<br>   <span class="hljs-selector-id">#box</span>&#123; <span class="hljs-attribute">width</span>:<span class="hljs-number">100px</span>; <span class="hljs-attribute">height</span>:<span class="hljs-number">100px</span>; <span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#000</span>;&#125;<br>&lt;/style&gt;<br>&lt;script&gt;<br>   function allowDrop(ev)&#123;<br>      ev<span class="hljs-selector-class">.preventDefault</span>();<br>   &#125;<br>   // 拖动<br>   function drag(ev)&#123;<br>      ev<span class="hljs-selector-class">.dataTransfer</span><span class="hljs-selector-class">.setData</span>(&quot;<span class="hljs-selector-tag">Text</span>&quot;, ev<span class="hljs-selector-class">.target</span><span class="hljs-selector-class">.id</span>);<br>   &#125;<br>   // 放置<br>   function drop(ev)&#123;<br>      ev<span class="hljs-selector-class">.preventDefault</span>();<br>      <span class="hljs-selector-tag">var</span> data = ev<span class="hljs-selector-class">.dataTransfer</span><span class="hljs-selector-class">.getData</span>(&quot;<span class="hljs-selector-tag">Text</span>&quot;);<br>      ev<span class="hljs-selector-class">.target</span><span class="hljs-selector-class">.appendChild</span>(document<span class="hljs-selector-class">.getElementById</span>(data));<br>   &#125;<br>&lt;/script&gt;<br>&lt;<span class="hljs-selector-tag">body</span>&gt;<br>   &lt;<span class="hljs-selector-tag">div</span> id=&quot;box&quot; ondrop=&quot;drop(event)&quot; ondragover=&quot;allowDrop(event)&quot;&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;<br>   &lt;<span class="hljs-selector-tag">img</span> id=&quot;drag&quot; <span class="hljs-attribute">src</span>=&quot;images/<span class="hljs-number">1</span><span class="hljs-selector-class">.png</span>&quot; draggable=&quot;true ondragstart=&quot; drag(event)&quot;/&gt;<br>&lt;/<span class="hljs-selector-tag">body</span>&gt;<br></code></pre></td></tr></table></figure><h1 id="待续">待续…</h1>]]></content>
    
    
    <categories>
      
      <category>HTML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HTML</tag>
      
      <tag>Web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>html-01</title>
    <link href="/posts/1bd98a16.html"/>
    <url>/posts/1bd98a16.html</url>
    
    <content type="html"><![CDATA[<p>HTML01 <span id="more"></span></p><h2 id="html">HTML</h2><h3 id="概念">概念:</h3><blockquote><p><code>超文本标记语言</code>(HyperText Markup Language)是一种用于创建网页的标准标记语言</p></blockquote><h3 id="结构">结构:</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;tutorial&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;refresh&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;30&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css.css&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">background</span>: red;&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>我的第一个标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>我的第一个段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span> 声明为 HTML5 文档<br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span> 元素是 HTML 页面的根元素<br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span> 元素包含了文档的元（meta）数据，如 `<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span>` 定义网页编码格式为 utf-8<br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span> 元素描述了文档的标题<br><span class="hljs-tag">&lt;<span class="hljs-name">link</span>&gt;</span> 标签通常用于链接到样式表<br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span> 元素包含了可见的页面内容<br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span> 元素定义一个大标题<br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span> 元素定义一个段落<br></code></pre></td></tr></table></figure><h3 id="基础">基础:</h3><h4 id="注释">注释:</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--&gt;...&lt;--&gt;</span><br></code></pre></td></tr></table></figure><h4 id="元素标签">元素(标签)</h4><ul><li><p>标题(Heading) <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span> - <span class="hljs-tag">&lt;<span class="hljs-name">h6</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h6</span>&gt;</span> 标签进行定义<br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span> 定义最大的标题, <br><span class="hljs-tag">&lt;<span class="hljs-name">h6</span>&gt;</span> 定义最小的标题<br><span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span> 标签进行定义水平线<br></code></pre></td></tr></table></figure></p></li><li><p>段落(Paragraph) <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> 标签进行定义 <br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span> 标签进行定义换行<br></code></pre></td></tr></table></figure></p></li><li><p>文本格式化 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> 定义粗体文本<br><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span> 定义着重文字( em = pixels / 16 )<br><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 定义斜体字<br><span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span> 定义小号字<br><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> 定义加重语气<br><span class="hljs-tag">&lt;<span class="hljs-name">sub</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sub</span>&gt;</span> 定义下标字<br><span class="hljs-tag">&lt;<span class="hljs-name">sup</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sup</span>&gt;</span> 定义上标字<br><span class="hljs-tag">&lt;<span class="hljs-name">ins</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ins</span>&gt;</span> 定义插入字<br><span class="hljs-tag">&lt;<span class="hljs-name">del</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">del</span>&gt;</span> 定义删除字<br><span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span> 定义计算机代码<br><span class="hljs-tag">&lt;<span class="hljs-name">kbd</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">kbd</span>&gt;</span> 定义键盘码<br><span class="hljs-tag">&lt;<span class="hljs-name">samp</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">samp</span>&gt;</span> 定义计算机代码样本<br><span class="hljs-tag">&lt;<span class="hljs-name">var</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">var</span>&gt;</span> 定义变量<br><span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span> 定义预格式文本<br><span class="hljs-tag">&lt;<span class="hljs-name">abbr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">abbr</span>&gt;</span> 定义缩写<br><span class="hljs-tag">&lt;<span class="hljs-name">address</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">address</span>&gt;</span> 定义地址<br><span class="hljs-tag">&lt;<span class="hljs-name">bdo</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bdo</span>&gt;</span> 定义文字方向<br><span class="hljs-tag">&lt;<span class="hljs-name">blockquote</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">blockquote</span>&gt;</span> 定义长的引用<br><span class="hljs-tag">&lt;<span class="hljs-name">q</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">q</span>&gt;</span> 定义短的引用语<br><span class="hljs-tag">&lt;<span class="hljs-name">cite</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">cite</span>&gt;</span> 定义引用、引证<br><span class="hljs-tag">&lt;<span class="hljs-name">dfn</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dfn</span>&gt;</span> 定义一个定义项目<br></code></pre></td></tr></table></figure></p></li><li><p>链接 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">hred</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;noopener noreferrer&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-comment">&lt;!-- 定义链接 --&gt;</span><br></code></pre></td></tr></table></figure></p></li><li><p>图像 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;sone_text&quot;</span> /&gt;</span> <span class="hljs-comment">&lt;!-- 定义图片 --&gt;</span><br></code></pre></td></tr></table></figure></p></li><li><p>表格 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Header1<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Header1<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>row1, cell1<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>row1, cell2<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br></code></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span> 定义行<br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> 定义列<br></code></pre></td></tr></table></figure></p></li><li><p>列表 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html">  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span> 无序<br><span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span> 有序<br><br><span class="hljs-tag">&lt;<span class="hljs-name">dl</span>&gt;</span> 自定义<br>    <span class="hljs-tag">&lt;<span class="hljs-name">dt</span>&gt;</span>Coffee<span class="hljs-tag">&lt;/<span class="hljs-name">dt</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>- black hot drink<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dt</span>&gt;</span>Milk<span class="hljs-tag">&lt;/<span class="hljs-name">dt</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>- white cold drink<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dl</span>&gt;</span>   <br></code></pre></td></tr></table></figure></p></li><li><p>表单 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;action.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;get&quot;</span>&gt;</span><br>     文本框: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;firstname&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>  密码框: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pwd&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;male&quot;</span> /&gt;</span>单选框<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;vehicle&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Bike&quot;</span> /&gt;</span>复选框<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Submit&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure></p></li></ul><h4 id="属性">属性</h4><ul><li><strong>HTML 元素</strong>可以设置属性</li><li>属性可以在元素中添加附加信息</li><li>属性一般描述于开始标签</li><li>属性总是以<strong>属性名/属性值</strong>对的形式出现, 比如:name=“value”<br /></li><li><strong>class 属性</strong>可以多用 class=”“(引号里面可以填入多个class属性)</li><li><strong>id 属性</strong>只能单独设置 id=” “(只能填写一个,多个无效)</li></ul><h1 id="待续">待续…</h1>]]></content>
    
    
    <categories>
      
      <category>HTML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HTML</tag>
      
      <tag>Web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>网站数据备份</title>
    <link href="/posts/f7bab86b.html"/>
    <url>/posts/f7bab86b.html</url>
    
    <content type="html"><![CDATA[<p>2019-08-05-网站数据备份 <span id="more"></span></p><h2 id="将网站数据备份至github">将网站数据备份至GitHub</h2><p><ahref="https://blog.csdn.net/u012195214/article/details/72721065">CSDN参考文章</a><br /><ahref="https://www.zhihu.com/question/21193762">使用hexo，如果换了电脑怎么更新博客？</a></p><h3 id="具体操作">具体操作:</h3><h4 id="情况1-新建博客">情况1, 新建博客</h4><ul><li><p>创建仓库: http://username.github.io</p></li><li><p>创建两个分支: <code>master</code> 与 <code>hexo</code></p></li><li><p>设置 hexo为默认分支(只需要手动管理这个分支上的Hexo网站文件)</p></li><li><p>使用 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> git@github.com:username/username.github.io.git  <span class="hljs-comment"># 拷贝仓库</span><br></code></pre></td></tr></table></figure></p></li><li><p>在本地 http://username.github.io文件夹下通过Git bash依次执行<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hexo -g<br>hexo init<br>npm install<br>npm install hexo-deployer-git <span class="hljs-comment"># 此时当前分支应显示为hexo</span><br></code></pre></td></tr></table></figure></p></li><li><p>修改<code>_config.yml</code>中的deploy参数,分支应为master;</p></li><li><p>依次执行 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add .<br>git commit -m <span class="hljs-string">&quot;XXXX&quot;</span><br>git push origin hexo <span class="hljs-comment"># 提交网站相关的文件</span><br></code></pre></td></tr></table></figure></p></li><li><p>执行<code>hexo g -d</code>生成网站并部署到 GitHub 上</p></li></ul><h4 id="情况2-已经有部分博文部署到git但没有备份分支">情况2,已经有部分博文部署到git但没有备份分支</h4><ul><li><p>创建 hexo 分支, 并设置为默认分支</p></li><li><p><code>git clone git@github.com:username/username.github.io.git</code>到本地,删除除了 .git 以外的文件;</p></li><li><p>复制原有的博客源文件, 注意除了<code>.deploy_git</code>, 并创建<code>.gitignore</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">.DS_Store<br>Thumbs.db<br>db.json<br>*.<span class="hljs-built_in">log</span><br>node_modules/<br>public/<br>.deploy*/<br></code></pre></td></tr></table></figure></p></li><li><p>然后执行 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add .<br>git commit -m <span class="hljs-string">&quot;add hexo branch&quot;</span> <br>git push<br></code></pre></td></tr></table></figure></p></li></ul><h3 id="注意">注意:</h3><blockquote><p>If you’re using <strong><code>GitHub Free</code></strong> and<strong>change</strong> a repository’s visibility <strong>from public toprivate</strong>, <strong>you’ll lose access to features like protectedbranches and GitHub Pages.</strong></p></blockquote><blockquote><p><strong><em>Any published GitHub Pages site will be automaticallyunpublished.</em></strong> If you added a custom domain to the GitHubPages site, you should remove or update your DNS records before makingthe repository private, to avoid the risk of a domain takeover. For moreinformation, see “Adding or removing a custom domain for your GitHubPages site.”</p></blockquote><p><strong><ahref="https://help.github.com/en/articles/setting-repository-visibility">helpgithub</a></strong></p><h3 id="设置域名">设置域名</h3><h3 id="cdn加速github-pages">CDN加速Github Pages</h3><h4 id="又拍云的cdn">又拍云的CDN</h4><ol type="1"><li><p><ahref="https://help.upyun.com/knowledge-base/cdn-create-service/">又拍云CDN配置文档</a></p><ul><li><p><a href="https://www.upyun.com/league">又拍云联盟</a></p><blockquote><p>又拍云联盟用户每月独享优惠加入又拍云联盟，按步骤完成申请，即可获得<strong>10GB免费存储空间</strong>+<strong>15GB免费CDN流量</strong></p></blockquote></li></ul></li><li><p>配置CDN服务</p><ul><li>upyun配置</li></ul><img src="/posts/f7bab86b/upyun1.png" class="" title="upyun配置1"><img src="/posts/f7bab86b/upyun2.png" class="" title="upyun配置2"><ul><li>智能压缩 开启 Gzip 和 Brotli</li><li>HTTP 302 调度</li><li>HTTPS 配置</li><li>TLS 1.3</li><li>WebP 自适应</li></ul></li><li><p>腾讯云域名配置</p><ul><li>增加又拍云提供的CDN域名</li><li>国外增加GitHub分配的域名</li><li><a href="https://www.hananoryu.cn/posts/221113/">参考文档</a></li></ul></li><li><p>Github Pages配置</p><ul><li>source目录下增加CNAME文件写上域名</li><li>Github Pages的settings下Custom domain配置域名，开启htpps</li></ul><img src="/posts/f7bab86b/upyun5.png" class="" title="upyun配置5"></li></ol>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github</tag>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>tools</title>
    <link href="/posts/eafade77.html"/>
    <url>/posts/eafade77.html</url>
    
    <content type="html"><![CDATA[<p>2019-07-29-tools <span id="more"></span></p><h2 id="转自httpsgithub.comshenzekun">## 转自<ahref="">https://github.com/shenzekun</a></h2><h1 id="useful-tools">useful-tools</h1><blockquote><p>🔨一些有用的工具网站（<strong>注意</strong>：有些网站可能需要翻墙才能看到）</p></blockquote><h2 id="浏览器兼容类">浏览器兼容类🌎</h2><ul><li><a href="https://caniuse.com/">caniuse</a>(网站开发浏览器兼容性查询)</li><li><a href="http://browserhacks.com/">browserhacks</a>(一些浏览器兼容写法)</li></ul><h2 id="图片类">图片类😎</h2><ul><li><a href="https://tinypng.com/">Tinypng</a> | <ahref="http://zhitu.isux.us/">智图</a> (压缩图片)</li><li><a href="http://www.biaonimeia.com/login">标你妹啊</a> (psd标注)</li><li><a href="https://coolbackgrounds.io/">Cool Backgrounds</a>(生成好看的渐变背景图)</li><li><ahref="https://carbon.now.sh/?bg=rgba(171,%20184,%20195,%201)&amp;t=seti&amp;wt=none&amp;l=auto&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=48px&amp;ph=32px&amp;ln=false&amp;fm=Hack&amp;fs=14px&amp;si=false&amp;es=2x&amp;wm=false">carbon</a>(生成类似 mac 风格的代码图片，用于分享)<br /></li><li><a href="https://source.unsplash.com/">Unsplash Source</a>(生成随机图片)</li><li><a href="https://spritegen.website-performance.org/">CSS SpriteGenerator</a> (生成雪碧图)</li><li><a href="http://www.iconfont.cn/plus">iconfont</a>(阿里巴巴矢量图标库)</li><li><a href="https://icons8.com/preloaders/">Preloaders</a> | <ahref="https://loading.io/">LOADING.IO</a>(加载图，<strong>有些是收费的</strong>)</li><li><a href="https://www.desktoppr.co/wallpapers">desktoppr</a>(好看的壁纸)</li><li><a href="https://material.io/tools/icons/?style=baseline">Materialicons</a> (Material icons图标)</li><li><a href="https://www.iloveimg.com/zh-cn">Iloveimg</a>(批量编辑图片的所有工具。包括压缩图片，剪裁图片，图片加水印，转化至jpg图片等等)</li><li><a href="https://www.pkgif.net/">pkgif</a> (任意GIF添加字幕)</li><li><a href="https://imagecyborg.com/">ImageCyborg</a>(一键下载当前网页的所有图片)</li><li><a href="http://emblemmatic.org/markmaker/#/">MarkMaker</a> (在线logo 随机生成工具)</li><li><a href="https://www.remove.bg/">Removebg</a>(在线移除背景工具，想改图片的背景可以用这个，证件照必备😀)</li><li><a href="https://jakearchibald.github.io/svgomg/">SVGOMG</a>(SVG图形压缩优化)</li></ul><p>## 代码类⌨️</p><ul><li><a href="https://paste.ubuntu.com/">Ubuntu pastebin</a>(代码分享)</li><li><a href="https://codepen.io/pens/">Codepen</a> | <ahref="http://jsbin.com/">Jsbin</a> (在线代码编辑)</li><li><a href="https://codesandbox.io/">CodeSandbox</a>(在线写React,自动编译,有代码提示)</li><li><a href="http://www.colorzilla.com/gradient-editor/">Ultimate CSSGradient Generator</a> (生成 css 渐变)</li><li><a href="https://www.grabient.com/">Grabient</a> (生成漂亮的 css渐变)</li><li><a href="https://dev.w3.org/html5/html-author/charref">CharacterEntity Reference Chart</a> (各种符号的转义字符)</li><li><ahref="http://apps.eky.hk/css-triangle-generator/zh-hant">css三角形产生器</a>| <a href="http://www.cssarrowplease.com/">CSS ARROW PLEASE</a>(生成CSS小三角)</li><li><ahref="https://easings.net/zh-cn?tuyiyi.com">缓动函数速查表</a></li><li><a href="https://regexper.com/">Regexper</a> (正则可视化)</li><li><a href="https://regex101.com/">Regex101</a> (正则表达式测试)</li><li><a href="https://visualgo.net/en">Visualgo</a>(数据结构，算法可视化)</li><li><a href="http://animista.net/">Animista</a> (在线生成 css 动画)</li><li><ahref="https://developers.google.com/speed/pagespeed/insights/">PageSpeedInsights</a> (测试网站速度，优化性能)</li><li><a href="https://learngitbranching.js.org/">Learn Git Branching</a>(以动画的形式让你学习 git)</li><li><a href="http://asciiflow.com/">Asciiflow</a>(生成类似代码注释里那种佛祖的代码。。自己画😄)</li><li><a href="http://pxtoem.com/">PXtoEM</a> (PX EM 单位换算)</li><li><a href="http://epic-spinners.epicmax.co/#/">epic-spinners</a>(一个好看的css loading 代码库)</li><li><a href="https://www.myintervals.com/emogrifier.php">Emogrifier</a>(邮件模板必备工具-html转换成内联样式)</li></ul><h2 id="效率类">效率类⚡️</h2><ul><li><a href="https://modao.cc/">墨刀</a> (画原型图)</li><li><a href="https://shimo.im/">石墨文档</a> | <ahref="https://docs.qq.com/">腾讯文档</a>(多人实时协作的云端文档与表格)</li><li><a href="https://www.hloom.com/resume-examples/">resume-examples</a>(简历模板)</li><li><a href="https://enhancv.com/">Enhancv</a> (生成简历)</li><li><a href="http://www.koppt.cn/index">KOPPT</a> (ppt 模板)</li><li><a href="https://about.beautiful.ai/">Beautiful.Ai</a> (人工智能 ppt模板创建)</li><li><a href="https://www.canva.com/templates/">Canva</a> (设计模板)</li><li><ahref="https://www.processon.com/;jsessionid=EC0CB59BD105F6FD0294417AB0B0CC22.jvm1">ProcessOn</a>(在线画流程图，思维导图、UI原型图等等)</li><li><a href="https://wakatime.com/">WakaTime</a>(跟踪项目花费的时间，得装插件)</li><li><a href="http://screensiz.es/">Screen Sizes</a> (移动屏幕尺寸)</li><li><a href="https://habitica.com/">Habitica</a> (游戏化Todo)</li><li><a href="https://smallpdf.com/">Smallpdf</a>(非常厉害的一个网站，PDF压缩，PDF转PPT，Word，Excel等等都可以直接通过这个页面实现)</li><li><a href="https://cli.im/">草料二维码</a> (在线生成二维码)</li><li><a href="https://ppt.baomitu.com">声享</a> (在线制作 PPT)</li><li><a href="https://mubu.com/">幕布</a>(极简大纲笔记，一键生成思维导图)</li><li><a href="https://infogram.com/">Infogram</a> (在线图表制作工具)</li><li><a href="https://uzer.me/">UZER.ME</a>(能够在线使用ps，ai，office，xmind，火狐浏览器等多个应用的网站)</li><li><a href="http://www.nicetool.net/">NiceTool</a>(在线工具集合网站)</li><li><a href="https://unbug.github.io/codelf/">codelf</a>(开发变量命名神器)</li><li><a href="https://tableconvert.com/">表格转换</a>(Markdown表格生成,LaTex表格生成)</li><li><a href="https://www.rdtoc.com/tools/jsonpath">JSONPath</a>(在线JSON提取工具)</li><li><a href="https://www.rdtoc.com/tools/jmespath">JMESPath</a>(在线JSON提取工具)</li></ul><h2 id="查询类">查询类🔎</h2><ul><li><a href="https://devhints.io/">devhints</a>(常用速查表，快速查询各类框架和库的常用方法，很实用)</li><li><a href="https://docschina.org/">印记中文</a>(快速查询各类框架和周边库的中文文档)</li><li><a href="https://csstriggers.com/">Css Triggers</a>(列出了哪些CSS属性在不同的渲染引擎中是否会触发重排或重绘)</li><li><a href="https://securityheaders.com/">Security Headers</a>(搜索网站是否有不安全的头部 header 设置，并会评分)</li><li><a href="https://devdocs.io/">devdocs</a> (各种编程语言 API文档)</li><li><a href="http://www.speedtest.cn/">Seepdtest</a>(测速网站)<ul><li>300M的家庭带宽，家庭网络需要使用<code>千兆无线路由器、千兆网线组网</code></li><li><code>1Mbps=1024Kbps=128KB/s, 300Mbps=300x128=38400KB/s=37.5MB/s</code></li></ul></li><li>关于网线:<ul><li><code>五类线</code>：该类电缆增加了绕线密度，传输带宽为100MHz，用于语音传输和最高传输速率为<code>100Mbps</code>的数据传输，主要用于100BASE-T和10BASE-T网络，已被超五类线替代。</li><li><code>超五类线</code>：具有衰减小，串扰少，比五类线增加了近端串音功率和的测试要求，并且具有更高的衰减串扰比（ACR)和信噪比、更小的时延误差，性能得到很大提高。超五类线的最大带宽为100MHz。</li><li><code>六类线</code>：的传输性能远远高于超五类标准，最适用于传输速率为<code>1Gbps</code>的应用。六类与超五类的一个重要的不同点在于：改善了在串扰以及回波损耗方面的性能，对于新一代全双工的高速网络应用而言，优良的回波损耗性能是极重要的。</li><li><code>超六类线</code>：是六类线的改进版，发布于2008年，同样是ANSI/TIA-568C.2和ISO/IEC11801超六类/EA级标准中规定的一种双绞线电缆，主要应用于万兆位网络中。传输频率500MHz，最大传输速度也可达到10Gbps ，在外部串扰等方面有较大改善</li><li><code>七类线</code>：该线是ISO/IEC 11801 7类/F级标准中于2002年,认可的一种双绞线，它主要为了适应万兆以太网技术的应用和发展。但它不再是一种非屏蔽双绞线了，而是一种屏蔽双绞线，所以它的传输频率至少可达600MHz，传输速率可达10 Gbps。</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>CRH</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>review</title>
    <link href="/posts/794381c6.html"/>
    <url>/posts/794381c6.html</url>
    
    <content type="html"><![CDATA[<p>2019-07-26-Review <span id="more"></span></p><h2 id="linux">Linux</h2><h3 id="linux启动过程"><strong>linux启动过程</strong>？</h3><ul><li><p><ahref="https://www.runoob.com/linux/linux-system-boot.html">文档参考链接</a></p></li><li><p><strong>POST–&gt; BIOS(Boot Sequence)–&gt;MBR(bootloader,446)–&gt; Kernel–&gt; initrd(initramfs)–&gt;[ROOTFS]–&gt; /sbin/init(/etc/inittab)</strong></p></li><li><p>initrd：Linux初始RAM磁盘（initrd）是在系统引导过程中挂载的一个临时根文件系统；</p></li><li><p>init进程是系统所有进程的起点 | 类型 | 名称 | 位置 | | :—— | :—— |:—————————————————- | | SysV | init | CentOS5之前: /etc/inittab | |Upstart | init | CentOS6: /etc/inittab, /etc/init/*.conf | | Systemd |systemd | CentOS7: /usr/lib/systemd/system, /etc/systemd/system|</p></li><li><p>Linux允许为不同的场合, 分配不同的开机启动程序,这就叫做”运行级别”（runlevel）, 也就是说，启动时根据”运行级别”,确定要运行哪些程序</p></li><li><p>系统初始化, 在init的配置文件中有这么一行:<code>si::sysinit:/etc/rc.d/rc.sysinit</code>,完成一些系统初始化的工作(<strong>rc启动脚本实际上都是放在/etc/rc.d/init.d/目录下</strong>)　</p></li></ul><h3id="apache有几种工作模式-各有什么优缺点"><strong>Apache</strong>有几种<strong>工作模式</strong>,各有什么优缺点?</h3><ul><li><p><ahref="https://www.cnblogs.com/zhichaoma/articles/7784688.html">文档参考链接1</a></p></li><li><p><ahref="https://www.cnblogs.com/qiujun/p/6861773.html">文档参考链接2</a></p></li><li><p>三种工作模式:<code>MPM: (Multi-Processing Module, 多进程处理模块), 它们分别是 prefork, worker, event</code></p><ul><li><strong>prefork</strong>: 是一个<strong>多进程, 非线程型</strong>的,预派生的MPM, 使用多个进程, 每个进程在某个确定的时间只单独处理一个连接,<em>效率高</em>, 但<em>内存使用比较大</em></li><li><strong>worker</strong>:使用了<strong>多进程和多线程</strong>的混合模式, <em>占用内存少</em>,但<em>由于多个子进程共享父进程内存地址, 易发生阻塞</em></li><li><strong>event</strong>: 类似于worker模式, <strong>多进程, 多线程,epoll</strong>, 解决了keep-live场景下,长期占用线程的资源浪费问题(某些线程因为被keep-alive，挂在那里等待，中间几乎没有请求过来，一直等到超时)</li></ul></li></ul><h3 id="apache设置虚拟目录的字段">Apache设置虚拟目录的字段?</h3><ul><li><p><code>vim /etc/httpd/conf/httpd.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">  基于IP地址:<br>  &lt;VirtualHost IP&gt;<br>  DocumentRoot /home/wwwroot/10<br>  ServerName www.anyue.com<br>  &lt;Directory /home/wwwroot/10 &gt;<br>  AllowOverride None<br>  Require all granted<br>&lt;/VirtualHOst&gt;<br>  <br>  基于主机域名:<br>  &lt;VirtualHost IP&gt;<br>  DocumentRoot /home/wwwroot/www<br>  ServerName www.anyue.com<br>  &lt;Directory /home/wwwroot/www &gt;<br>  AllowOverride None<br>  Require all granted<br>&lt;/VirtualHOst&gt;<br>  <br>  基于端口号:<br>  &lt;VirtualHost IP:8080&gt;<br>  DocumentRoot /home/wwwroot/8080<br>  ServerName www.anyue.com<br>  &lt;Directory /home/wwwroot/8080 &gt;<br>  AllowOverride None<br>  Require all granted<br>  &lt;/VirtualHOst&gt;<br></code></pre></td></tr></table></figure></li></ul><h3id="列出linux打包工具并写出相应解压参数-至少3种">列出Linux打包工具并写出相应解压参数,至少3种</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -czvf     <span class="hljs-comment"># -z gzip(.tar.gz)  -j bzip(.bz2) </span><br>zip test.txt.zip test.zip  <span class="hljs-comment">#压缩文件</span><br>unzip test.zip -d /tmp   <span class="hljs-comment"># -l 查看</span><br></code></pre></td></tr></table></figure><h3id="利用sed命令将test.txt中所有的回车换成空格">利用sed命令将test.txt中所有的回车换成空格?</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sed -i s/\r/ /g test.txt<br><span class="hljs-built_in">seq</span> 10 |<span class="hljs-built_in">tr</span> <span class="hljs-string">&quot;\n&quot;</span> <span class="hljs-string">&quot; &quot;</span><br><span class="hljs-built_in">seq</span> 10 |awk -v ORS=<span class="hljs-string">&quot; &quot;</span> <span class="hljs-string">&#x27;&#123;print $0&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h3id="在每周六的凌晨315执行homeshellcollect.pl-并将标准输出和标准错误输出到devnull设备-写出crontab中的语句">在每周六的凌晨3:15执行/home/shell/collect.pl,并将标准输出和标准错误输出到/dev/null设备, 写出crontab中的语句?</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">15 3 * * 6 /home/shell/collect.pl &gt; /dev/null 2&gt;&amp;1<br></code></pre></td></tr></table></figure><h3id="计划每星期天早上8点服务器定时重启如何实现">计划每星期天早上8点服务器定时重启，如何实现？</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">00 8 * * 7 /sbin/init 6<br></code></pre></td></tr></table></figure><h3id="当用户在浏览器输入网址计算机对dns解释经过哪些流程注本机跟本地dns还没有缓存">当用户在浏览器输入网址，计算机对DNS解释经过哪些流程？（注：本机跟本地DNS还没有缓存）</h3><ul><li>a.用户输入网址到浏览器；</li><li>b.浏览器发出DNS请求信息；</li><li>c.计算机<code>首先查询本机HOST文件</code>，看是否存在，存在直接返回结果，不存在，继续下一步；</li><li>d.计算机按照<code>本地DNS</code>的顺序，向合法dns服务器查询IP结果；</li><li>e.合法dns返回dns结果给本地dns，本地dns并缓存本结果，直到TTL过期，才再次查询此结果；</li><li>f.返回IP结果给浏览器；</li><li>g.浏览器根据IP信息，获取页面；</li></ul><h3id="iptables是否支持time时间控制用户行为请写出步骤">iptables是否支持time时间控制用户行为，请写出步骤</h3><p>支持，需要增加相关支持的内核补丁，并且要重新编译内核。或者使用crontab配合iptables，首先：<code>vi /deny.bat</code>输入<code>/sbin/iptables -A OUTPUT -p tcp -s 192.168.1.0/24 --dport 80 -j DROP</code>保存退出，打开crontab-e<code>00 21＊　＊　＊ /bin/sh /deny.bat</code></p><h3id="源码编译apache-要求安装目录为usrlocalapache-需有压缩模块-rewrtie-worker模式-并说明apache的worker-mpm中为什么serverlimit要放到配置段最前面">源码编译apache,要求安装目录为/usr/local/apache, 需有压缩模块, rewrtie, worker模式,并说明apache的worker MPM中,为什么ServerLimit要放到配置段最前面?</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -xzvf apr-1.6.3.tar.gz <br><span class="hljs-built_in">cd</span> apache-1.6.3<br>./configure --prefix=/usr/local/apache --enable-so --with-rewrite --with-mpm-worker  <span class="hljs-comment"># 不放在最前面, client会忽略掉的</span><br>make<br>make install<br></code></pre></td></tr></table></figure><h3 id="匹配文本中的key-并打印出该行及下面5行">匹配文本中的key,并打印出该行及下面5行？</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep -A5 key filename<br></code></pre></td></tr></table></figure><h3id="dmseg命令中看到ip_conntracktable-full-dropping-packet.如何解决">dmseg命令中看到ip_conntrack:tablefull, dropping packet.如何解决？</h3><ul><li><ahref="http://www.ttlsa.com/linux/ip_conntrack-table-full-dropping-packet-solution/">参考链接</a></li><li>更改ip_conntrack大小</li><li>不加载ip_conntrack模块</li></ul><h3 id="简述21-22-23-25-110-143-873-3306端口运行的服务">简述21, 22, 23,25, 110, 143, 873, 3306端口运行的服务?</h3><ul><li>23–&gt; telnet 服务使用</li><li>110–&gt; POP3 服务</li><li>143–&gt; IMAP v2</li><li>873–&gt; rsync 文件传输服务</li><li>3306–&gt; MySQL 数据库服务</li></ul><h3id="如何在linux上重建初始化内存盘镜像文件">如何在Linux上重建初始化内存盘镜像文件？</h3><ul><li>CentOS 5.X / RHEL 5.X:<code>mkinitrd -f -v /boot/initrd-$(uname -r).img $(uname -r)</code></li><li>CentOS 6.X / RHEL 6.X: <code>dracut -f</code></li></ul><h3 id="如何查看bond0的状态">如何查看bond0的状态?</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /proc/net/bonding/bond0<br></code></pre></td></tr></table></figure><h3id="linux中的proc文件系统有什么用">linux中的/proc文件系统有什么用？</h3><ul><li>/proc 文件系统是一个虚拟文件系统, 它只存在内存当中,而不占用外存空间, Linux 内核提供了一种通过 /proc 文件系统,在运行时访问内核内部数据结构, 改变内核设置的机制. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">查看proc信息: <span class="hljs-built_in">ls</span> /proc/<br>查看内核信息: <span class="hljs-built_in">ls</span> /proc/sys<br>查看网卡信息: <span class="hljs-built_in">ls</span> /proc/net<br>查看SCSI信息: <span class="hljs-built_in">ls</span> /proc/scsi<br>查看已加载模块: <span class="hljs-built_in">cat</span> /proc/modules<br></code></pre></td></tr></table></figure></li></ul><h3id="lvs的工作模式及工作过程lb-集群是-load-balance-集群的简写">lvs的工作模式及工作过程(LB集群是 load balance 集群的简写)？</h3><ul><li>DR(Direct Routing)模式: LB收到请求包后,将请求包中<code>目标MAC地址</code>转换为<code>某个选定RS的MAC地址</code>后将包转发出去,<code>RS收到请求包后, 可直接将应答内容传给用户.</code>此时要求LB和所有RS都必须在一个物理段内, 且LB与RS群共享一个虚拟IP.</li><li>NAT(Network Address Translation)模式: LB收到用户请求包后,LB将<code>请求包中虚拟服务器的IP地址</code>转换为某个选定<code>RS的IP地址</code>,转发给RS; RS将应答包发给 LB, LB将应答包中RS的IP转为虚拟服务器的IP地址,回送给用户.</li><li>IP隧道(IP Tunneling)模式: LB收到用户请求包后,根据IP隧道协议封装该包, 然后传给某个选定的RS; RS解出请求信息,直接将应答内容传给用户。此时要求RS和LB都要支持IP隧道协议.</li></ul><h3 id="mysql数据库的备份和还原">Mysql数据库的备份和还原？</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysqldump -hhostname -uusername -ppassword databasename &gt; backupfile.sql<br>mysql -hhostname -uusername -ppassword databasename &lt; backupfile.sql<br></code></pre></td></tr></table></figure><h3 id="linux系统是由哪些部分组成">Linux系统是由哪些部分组成？</h3><ul><li>Linux系统一般有4个主要部分：<code>内核、shell、文件系统和应用程序</code><ul><li>Linux内核:内核是操作系统的核心，具有很多最基本功能，如虚拟内存、多任务、共享库、需求加载、可执行程序和TCP/IP网络功能。Linux内核的模块分为以下几个部分：存储管理、CPU和进程管理、文件系统、设备管理和驱动、网络通信、系统的初始化和系统调用等。</li><li>Linux shell:shell是系统的用户界面，提供了用户与内核进行交互操作的一种接口。它接收用户输入的命令并把它送入内核去执行，是一个命令解释器。另外，shell编程语言具有普通编程语言的很多特点，用这种编程语言编写的shell程序与其他应用程序具有同样的效果。</li><li>Linux文件系统:文件系统是文件存放在磁盘等存储设备上的组织方法。Linux系统能支持多种目前流行的文件系统，如EXT2、EXT3、FAT、FAT32、VFAT和ISO9660。</li><li>Linux应用程序:标准的Linux系统一般都有一套都有称为应用程序的程序集，它包括文本编辑器、编程语言、XWindow、办公套件、Internet工具和数据库等。</li></ul></li></ul><h3id="用一条命令查看目前系统已经启动服务监听的端口">用一条命令查看目前系统已经启动服务监听的端口？</h3><ul><li><code>netstat -antl |grep "LISTEN"</code></li></ul><h3id="统计出一台web-srver上各个状态establishedsyn_sentsyn-recv等的个数">统计出一台websrver上各个状态(ESTABLISHED/SYN_SENT/SYN-RECV等)的个数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> access_log | awk ‘&#123;<span class="hljs-built_in">print</span> <span class="hljs-variable">$1</span>&#125;’ | <span class="hljs-built_in">uniq</span> -c|<span class="hljs-built_in">sort</span> -rn|<span class="hljs-built_in">head</span> -10<br>netstat -antl |grep <span class="hljs-string">&quot;ESTABLISHED&quot;</span> |<span class="hljs-built_in">wc</span> -l<br>netstat -antl |grep <span class="hljs-string">&quot;SYN_SENT&quot;</span> |<span class="hljs-built_in">wc</span> -l<br>netstat -antl |grep <span class="hljs-string">&quot;SYN_RECV&quot;</span> |<span class="hljs-built_in">wc</span> -l<br>netstat -n |grep ^tcp |awk <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span> |<span class="hljs-built_in">sort</span> -r |<span class="hljs-built_in">uniq</span> -c<br></code></pre></td></tr></table></figure><h3 id="什么是默认登录shell">什么是默认登录shell?</h3><ul><li>一般Linux默认的用户shell都是bash, 可以登录进去敲命令, 修改<code>usermod -s /bin/zsh username</code>;<code>useradd -s /bin/zsh username</code></li></ul><h3id="shell中可以使用那些类型的变量">shell中可以使用那些类型的变量?</h3><ul><li>set: 查看所有变量(全局、局部和函数), 删除: unset name</li><li>局部(标准、普通)变量: 生效范围为当前shell进程,对当前shell之外的其他shell进程, 包括当前shell的子进程均无效</li><li>环境(全局)变量: 生效范围为当前shell进程及其子进程(export=declare-x|env命令可以查看系统中环境变量)</li><li>本地变量: 生效范围为当前shell进程中某代码片断，通常指函数</li><li>位置变量: <code>$1 $2 $3...</code></li><li>特殊变量: <code>$? $0 $* $@ $# $$</code></li></ul><h3 id="监控特点">监控？特点</h3><ul><li>使用nagios对服务器进行监控，其特点可实时实现手机短信、电子邮件、MSN、飞信报警。</li><li>使用cacti对流量进行监控。zabbix可以执行脚本监视，图形界面监控。</li></ul><h3 id="shell如何定义函数">shell如何定义函数?</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">sum</span></span>()&#123;<br>    val1=<span class="hljs-variable">$1</span><br>    val2=<span class="hljs-variable">$2</span><br>    val3=$((<span class="hljs-variable">$1</span>+<span class="hljs-variable">$2</span>))<br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$val3</span><br>&#125;<br>ret_val=$(<span class="hljs-built_in">sum</span> 10 20)<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ret_val</span><br></code></pre></td></tr></table></figure><h3id="osi七层模型tcp三次握手过程tcp连接断开过程什么情况下tcp进入time_wait">OSI七层模型，tcp三次握手过程，tcp连接断开过程，什么情况下tcp进入time_wait?</h3><ul><li><p>物理层 数据链路层 网络层 传输层 会话层 表示层 应用层</p></li><li><p>TCP三次握手的过程:</p><ul><li><code>第一次握手：</code>客户端发送syn包(seq=x)到服务器，并进入SYN_SEND状态，等待服务器确认;</li><li><code>第二次握手：</code>服务器收到syn包，必须确认客户的SYN(ack=x+1)，同时自己也发送一个SYN包(seq=y)，即SYN+ACK包，此时服务器进入SYN_RECV状态;</li><li><code>第三次握手：</code>客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=y+1)，此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手。</li></ul></li><li><p>TCP四次挥手:</p><ul><li><code>第一次挥手：</code>主动关闭方发送一个FIN，用来关闭主动方到被动关闭方的数据传送，也就是主动关闭方告诉被动关闭方：我已经不会再给你发数据了(当然，在fin包之前发送出去的数据，如果没有收到对应的ack确认报文，主动关闭方依然会重发这些数据)，但此时主动关闭方还可以接受数据。</li><li><code>第二次挥手：</code>被动关闭方收到FIN包后，发送一个ACK给对方，确认序号为收到序号+1(与SYN相同，一个FIN占用一个序号)。</li><li><code>第三次挥手：</code>被动关闭方发送一个FIN，用来关闭被动关闭方到主动关闭方的数据传送，也就是告诉主动关闭方，我的数据也发送完了，不会再给你发数据了。</li><li><code>第四次挥手：</code>主动关闭方收到FIN后，发送一个ACK给被动关闭方，确认序号为收到序号+1，至此，完成四次挥手。</li><li>time_wait状态是四次挥手中服务器向客户端发送FIN终止连接后进入的状态</li></ul></li></ul><h3id="什么是跨站脚本攻击有何危害sql注入攻击如何防范">什么是跨站脚本攻击，有何危害，sql注入攻击如何防范</h3><ul><li>跨站脚本攻击(也称为XSS)：指利用网站漏洞从用户那里恶意盗取信息。用户在浏览网站、使用即时通讯软件、甚至在阅读电子邮件时，通常会点击其中的链接。攻击者通过在链接中插入恶意代码，就能够盗取用户信息。</li><li>sql注入：即通过把SQL命令插入到Web表单递交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令</li></ul><h3 id="重置mysql-root密码">重置MySQL root密码？</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/my.cnf, 在[mysqld]下添加skip-grant-tables<br>UPDATE mysql.user SET password=PASSWORD(<span class="hljs-string">&#x27;新密码&#x27;</span>) <span class="hljs-built_in">where</span> USER=<span class="hljs-string">&#x27;root&#x27;</span>;<br>flush privileges<br></code></pre></td></tr></table></figure><h3id="apache-和-mysql两种服务能否装在同一台机器上如何查看apache和mysql端口和进程">apache和MySQL两种服务能否装在同一台机器上，如何查看apache和MySQL端口和进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -an |grep :80   ps -ef |grep httpd   ps -aux |grep httpd<br>netstat -an |grep :3306<br></code></pre></td></tr></table></figure><h3id="统计varlognginxaccess.log日志访问量最多的前十个ip">统计/var/log/nginx/access.log日志访问量最多的前十个IP</h3><ul><li>nginx <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> urlogfile |<span class="hljs-built_in">sort</span> |<span class="hljs-built_in">uniq</span> -c |<span class="hljs-built_in">sort</span> -nr -k1 |<span class="hljs-built_in">head</span> -n 1<br>awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> /usr/local/nginx/logs/localhost.access.log |<span class="hljs-built_in">sort</span> |<span class="hljs-built_in">uniq</span> -c |<span class="hljs-built_in">sort</span> -nr -k1 |<span class="hljs-built_in">head</span> -n 10<br></code></pre></td></tr></table></figure></li><li>apache <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /var/log/httpd/; <span class="hljs-built_in">cat</span> access_log |awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> |<span class="hljs-built_in">uniq</span> -c |<span class="hljs-built_in">sort</span> -rn -k1 |<span class="hljs-built_in">head</span> -n 10<br></code></pre></td></tr></table></figure></li></ul><h3id="怎么查看当前系统中每个ip的连接数怎么查看当前磁盘iosysstat怎么查看当前网络的ioiftop-iotop">怎么查看当前系统中每个IP的连接数，怎么查看当前磁盘IO(sysstat)，怎么查看当前网络的IO(iftopiotop)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -n |awk <span class="hljs-string">&#x27;/^tcp/ &#123;print $5&#125;&#x27;</span> |awk -F: <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> |<span class="hljs-built_in">sort</span> |<span class="hljs-built_in">uniq</span> -c |<span class="hljs-built_in">sort</span> -rn<br>iostat<br>iftop<br></code></pre></td></tr></table></figure><h3id="如何将本地80-端口的请求转发到8080-端口本地主机ip-为192.168.16.1">如何将本地80端口的请求转发到8080 端口，本地主机IP 为192.168.16.1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">iptables -t nat -A PREROUTING -d 192.168.16.1 -p tcp --dport 80 -j DNAT --to-destination 192.168.16.1:8080  <br>iptables -t nat -A PREROUTING -d 192.168.16.1 -i eth0 -p tcp -dport 80 -j REDIRECT --to-port 8080<br></code></pre></td></tr></table></figure><h3id="什么是nat常见的分为哪几种dnat和snat有什么不同应用示例有哪些">什么是NAT?常见的分为哪几种？DNAT和SNAT有什么不同，应用示例有哪些？</h3><p><code>SNAT，DNAT，MASQUERADE</code>都是NAT，MASQUERADE是SNAT的一个特例。<code>SNAT</code>是指在数据包从网卡发送出去的时候，把数据包中的源地址部分替换为指定的IP，这样，接收方就认为数据包的来源是被替换的那个IP的主机；<code>MASQUERADE</code>是用发送数据的网卡上的IP来替换源IP，因此，对于那些<code>IP不固定的场合</code>，比如拨号网络或者通过dhcp分配IP的情况下，就得用MASQUERADE；<code>DNAT</code>，就是指数据包从网卡发送出去的时候，修改数据包中的目的IP，表现为如果你想访问A，可是因为网关做了DNAT，把所有访问A的数据包的目的IP全部修改为B，那么，你实际上访问的是B；</p><p>因为，路由是按照目的地址来选择的，因此，<code>DNAT是在PREROUTING链</code>上来进行的，而SNAT是在数据包发送出去的时候才进行，因此是在POSTROUTING链上进行的</p><p>### 磁盘显示有空间但是却不能touch文件？原因及解决方法？ <ahref="https://www.cnblogs.com/kevingrace/p/5577201.html">参考</a></p><ul><li><p>两种情况，一种是<code>磁盘配额</code>问题，另外一种就是EXT3文件系统的设计不适合很多小文件跟大文件的一种文件格式，出现很多小文件时，容易导致<code>inode耗尽</code>了</p></li><li><p><code>df -h</code>命令查看磁盘占用空间，若显示充足的空间，用<code>df -i</code>查看索引节点(inode)是否用尽，<code>inode译成中文就是索引节点，每个存储设备（例如硬盘）或存储设备的分区被格式化为文件系统后，应该有两部份，一部份是inode，另一部份是Block，Block是用来存储数据用的。而inode呢，就是用来存储这些数据的信息，这些信息包括文件大小、属主、归属的用户组、读写权限等。inode为每个文件进行信息索引，所以就有了inode的数值。操作系统根据指令，能通过inode值最快的找到相对应的文件。</code></p></li><li><p>解决方案:1）查找<code>find /var/spool/clientmqueue/ -type f -exec rm {} \;</code>删除/data/cache目录中的部分文件2）用软连接将空闲分区目录连接到inode占满的目录</p></li></ul><h3 id="top-命令">top 命令？</h3><ul><li>系统运行时间和平均负载（uptime），当前时间，系统已运行的时间，当前登录用户的数量，相应最近5、10和15分钟内的平均负载；<code>load average</code>数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了；</li><li>CPU 状态：us, user： 运行(未调整优先级的)用户进程的CPU时间，sy，system: 运行内核进程的CPU时间</li></ul><h3 id="rzy">RZY</h3><ul><li>命令运行时使用CTRL+c，强制终止当前进程</li><li>命令运行时使用CTRL+z，强制当前进程转为后台，并使之挂起（暂停）</li><li><code>find perl5/ -name "*.pm" -print |xargs wc -l</code></li><li><code>find perl5/ -name "*.pm" -print -exec wc -l {} \;</code></li><li>wc -l `find ./perl5 -name “*.pm”`</li><li><code>wc -l $(find ./perl5 -name "*.pm")</code></li></ul><h3id="如何实现nginx代理的节点访问日志记录是真实访客ip不是代理的ip配置nginx.conf配置文件增加不同的标记内容">如何实现nginx代理的节点访问日志记录是真实访客IP，不是代理的IP配置nginx.conf配置文件增加不同的标记内容</h3><h3id="如何在linux上重建初始化内存盘镜像文件-1">如何在linux上重建初始化内存盘镜像文件？</h3><h3id="如何让shell就脚本得到来自终端的输入">如何让shell就脚本得到来自终端的输入？</h3><h3id="web服务器的调优要点web服务器负载架构">web服务器的调优要点？web服务器负载架构？</h3><h3 id="linux-优化的12个步骤">linux 优化的12个步骤</h3><h3 id="linux-运行级别0-6含义">linux 运行级别0-6含义</h3><ul><li>0：halt</li><li>1：single user mode，直接以管理员身份切入</li><li>2：multi user mode，no NFS</li><li>3：multi user mode，text</li><li>4：保留未定义</li><li>5：multi user mode，graphic mode</li><li>6：reboot</li></ul><h3id="a文件编写脚本判断a文件大于5的数字">A文件，编写脚本判断A文件大于5的数字</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `sed s/[^0-9]//g ./A`<br><span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$i</span> -gt 5]; <span class="hljs-keyword">then</span> <br>        <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span><br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `grep -oE <span class="hljs-string">&quot;[1-9][0-9]&#123;0,9&#125;&quot;</span> ./A`<br><span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$i</span> -gt 5 ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$i</span> &gt; 5&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$i</span> &lt; 5&quot;</span><br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h3 id="linux-服务中程序经常自动停止如何处理">linux服务中程序经常自动停止如何处理</h3><h3 id="nginx-如何配置多域名防盗链">nginx 如何配置多域名？防盗链</h3><h3id="apachenginxlighttpd有哪些优缺点">Apache、nginx、Lighttpd有哪些优缺点</h3><h3id="什么是7层负载均衡和4层负载均衡访问请求经过这两种负载均衡都做了那些处理">什么是7层负载均衡和4层负载均衡，访问请求经过这两种负载均衡都做了那些处理</h3><h3id="如何将标准输出与错误输出同时重定向到同一位置">如何将标准输出与错误输出同时重定向到同一位置？</h3><h3 id="tcp和udp分别有什么优缺点">TCP和UDP分别有什么优缺点？</h3><ul><li><p><ahref="https://blog.csdn.net/xiaobangkuaipao/article/details/76793702">参考</a></p></li><li><p><code>TCP面向连接</code>（如打电话要先拨号建立连接）；<code>UDP是无连接</code>的，即发送数据之前不需要建立连接；</p></li><li><p><code>TCP提供可靠的服务</code>，通过TCP连接传送的数据，无差错，不丢失，不重复，且按序到达；UDP尽最大努力交付，即不保证可靠交付；</p></li><li><p>UDP具有较好的实时性，工作效率比TCP高，适用于对高速传输和实时性有较高的通信或广播通信；</p></li><li><p>每一条TCP连接只能是点到点的；UDP支持一对一，一对多，多对一和多对多的交互通信；</p></li><li><p>TCP对系统资源要求较多，UDP对系统资源要求较少；</p></li></ul><h3 id="http请求过程与原理">HTTP请求过程与原理？</h3><ul><li>首先作为发送端的客户端在<code>应用层（HTTP协议）</code>发出一个想看某个web也页面的HTTP请求；</li><li>接着，为了传输方便，在<code>传输层（TCP协议）</code>把从应用层处收到的数据（HTTP请求报文）进行分割，并在各个报文上打上标记序号及端口号后转发给网络层；</li><li>在<code>网络层（IP协议）</code>，增加作为通信目的MAC地址后转发给链路层。这样一来，发往网络的通信请求就准备齐全了。</li><li>接收端的服务器在链路层接收到数据，按序往上层发送，一直到应用层。当传输层到应用层才能算真正接收到由客户端发送来的HTTP请求；</li></ul><h3id="影响mysql主从同步因素可能有哪些">影响mysql主从同步因素可能有哪些？</h3><h3id="mysql的主从复制过程是同步的还是异步的mysql主从同步原理是什么mysql是通过什么来保证主从数据的同步">MySQL的主从复制过程是同步的还是异步的？MySQL主从同步原理是什么？MySQL是通过什么来保证主从数据的同步?</h3><h3id="存储引擎innodb和myisam有什么区别">存储引擎InnoDB和MyISAM有什么区别？</h3><h3id="nginx代理负载均衡的调度算法有哪些具体实现时的现象是什么">Nginx代理负载均衡的调度算法有哪些?具体实现时的现象是什么？</h3><h3 id="为mysql添加一个新用户">为MySQL添加一个新用户</h3><ul><li><code>create user 'xy'@'%' identified by '123456';</code><br /></li><li><code>insert into mysql.user(Host,User,Password) values('%','xy','password('123456')')</code></li></ul><h3id="mysql数据库主从同步延迟解决方案">MySQL数据库主从同步延迟解决方案</h3><h3 id="什么是冷热备份各自优缺点">什么是冷热备份？各自优缺点？</h3><h3id="实现一键还原前提条件还原后有什么后果">实现一键还原前提条件？还原后有什么后果？</h3><h3id="除dns外还可以通过什么方式进行域名解析缺点">除DNS外，还可以通过什么方式进行域名解析，缺点？</h3><h3 id="dns的空间结构是怎样的">DNS的空间结构是怎样的？</h3><h3 id="排障">排障</h3><h4 id="步骤">步骤:</h4><ul><li>故障特征；复现故障</li><li>排除不可能原因</li><li>定位<ul><li>从简单问题入手</li><li>一次尝试一种方式</li></ul></li><li>备份源文件；借助工具 #### 例如</li><li>MBR损坏<ul><li>借助别的主机修复</li><li>使用紧急模式<ul><li>boot.iso</li><li>使用完整的系统光盘，<code>boot: linux rescure /mnt/sysimage</code></li></ul></li></ul></li><li>grub文件丢失<ul><li>grub&gt; find (hd0, 0)/ # 找到内核</li><li>grub&gt; root (hd0, 0)</li><li>grub&gt; kernel /vmlinuz</li><li>grub&gt; initrd /initrd-</li><li>grub&gt; boot</li></ul></li><li>另外故障<ul><li>单用户模式编辑inittab文件</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Devops, linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Devops</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes</title>
    <link href="/posts/9acacb00.html"/>
    <url>/posts/9acacb00.html</url>
    
    <content type="html"><![CDATA[<p>2019-07-25-K8S <span id="more"></span></p><h1 id="kubernetes">Kubernetes</h1><h2 id="kubernetes-简介">kubernetes 简介:</h2><blockquote><p><strong>Kubernetes</strong>由Google团队发起并维护的基于Docker的开源容器集群管理系统,目标是管理跨多个主机的容器, 它不仅支持常见的云平台,而且支持内部数据中心. 核心概念是 <strong>Container Pod</strong>–&gt;一个 Pod（容器集合）由<code>一组工作于同一物理工作节点的容器构成</code>,组容器拥有相同的网络命名空间, IP以及存储配额, 也可以根据实际情况对每一个Pod 进行端口映射. kubernetes 组件构成:</p></blockquote><img src="/posts/9acacb00/k8s.jpg" class="" title="[kubernetes组件]"><h2 id="kubernetes-组件构成">kubernetes 组件构成:</h2><h3 id="master组件">Master组件:</h3><ul><li><code>kube-apiserver</code>: <strong>Kubernetes API</strong>,<strong>集群统一入口</strong>, <strong>各组件协调者</strong>, 以HTTPAPI提供接口服务,<strong>所有对象资源的增删查改</strong>和监听操都交给APIServer处理后再提交给<strong>Etcd存储</strong>;</li><li><code>kube-scheduler</code>: （调度器）负责对资源进行调度,分配未分发 Pod绑定到可用的Node节点上, 存储到etcd中;</li><li><code>kube-controller-manager</code>: 负责管理控制器,一个资源对应一个控制器, CotrolerManager负责管理监控pod运行状态, 根据etcd中的信息, 调用 node中的kubelet创建Pod;</li></ul><h3 id="node组件">Node组件:</h3><ul><li><code>kubelet</code>: 是 Master在 Node节点上的 Agent,负责具体的容器生命周期管理, 根据从数据库中获取的信息来管理容器, 并上报pod运行状态等, 下载secret、获取容器与节点状态, kubelet将每个Pod装换成一组容器;</li><li><code>kube-proxy</code>: 在 Node节点实现 Pod网络代理;</li><li><code>docker/rocker/rkt</code>: 运行容器</li></ul><h3 id="第三方服务master-node">第三方服务(master &amp;&amp; node):</h3><ul><li><code>etcd</code>: 用来保存集群所有状态的Key/Value<code>存储系统</code>, 所有 Kubernetes组件会通过 API Server来跟Etcd进行沟通从而保存或读取资源状态。如Pod、service等对象信息;</li></ul><h3 id="kubectl">kubectl:</h3><blockquote><p>kubectl 是 Kubernetes 自带的客户端, 可以用它来直接操作 Kubernetes</p></blockquote><table><thead><tr><th>command</th><th>mean</th></tr></thead><tbody><tr><td>get</td><td>显示一个或多个资源</td></tr><tr><td>describe</td><td>显示特定资源的详细信心</td></tr><tr><td>create</td><td>通过filename或stdin创建资源</td></tr><tr><td>update</td><td>通过filename或stdin更新资源</td></tr><tr><td>delete</td><td>删除资源</td></tr><tr><td>namespace</td><td>设置并查看当前的Kubernetes命名空间</td></tr><tr><td>log</td><td>在容器中打印容器的日志</td></tr><tr><td>rolling-update</td><td>执行给定ReplicationController的滚动更新</td></tr><tr><td>resize</td><td>为Replication Controller设置新大小</td></tr><tr><td>exec</td><td>在容器中执行命令</td></tr><tr><td>port-forward</td><td>将一个或多个本地端口转发到容器</td></tr><tr><td>proxy</td><td>运行代理到Kubernetes API服务器</td></tr><tr><td>run-container</td><td>在群集(cluster)上运行特定映像</td></tr><tr><td>stop</td><td>通过id或filename正常关闭资源</td></tr><tr><td>expose</td><td>获取replicated application并将其公开为Kubernetes Service</td></tr><tr><td>lable</td><td>更新资源标签</td></tr><tr><td>config</td><td>更改kuber相关配置文件</td></tr><tr><td>cluster-info</td><td>查看集群信息</td></tr><tr><td>api-version</td><td>打印可用的API版本</td></tr><tr><td>version</td><td>查看客户端和服务端版本信息</td></tr><tr><td>help</td><td>查看关于某个命令的帮助信息</td></tr></tbody></table><h3 id="kubernetes-cni网络最强对比flannelcalicocanal和weave">KubernetesCNI网络最强对比：Flannel、Calico、Canal和Weave</h3><ul><li><strong><ahref="https://blog.csdn.net/RancherLabs/article/details/88885539">Kubernetes网络</a></strong></li></ul><h2 id="搭建">搭建</h2><ul><li><strong><ahref="https://www.kubernetes.org.cn/5462.html">参考文章2</a></strong><br />### 社区方案: <code>优点</code>是搭建简单、参考文档细致;<code>缺点</code>是太杂乱, 升级不便 ### 官方推荐1:<code>Kubeadm</code></li><li><code>优点</code>: 简单、官方推荐、升级方便、支持高可用;<code>缺点</code>: 不易维护 ### 官方推荐2: <code>Binary</code></li><li><code>优点</code>: 易于维护、灵活、升级方便; <code>缺点</code>:搭建太过复杂, 相关文档太少</li></ul><h2 id="kubeadm">Kubeadm:</h2><h3 id="环境准备">环境准备:</h3><h4 id="硬件信息">1.硬件信息:</h4><table><thead><tr><th style="text-align: left;">系统类型</th><th style="text-align: left;">IP</th><th style="text-align: left;">节点</th><th style="text-align: left;">Hostname</th></tr></thead><tbody><tr><td style="text-align: left;">CentOS7.2</td><td style="text-align: left;">192.168.137.13</td><td style="text-align: left;">master</td><td style="text-align: left;">m1</td></tr><tr><td style="text-align: left;">CentOS7.2</td><td style="text-align: left;">192.168.137.14</td><td style="text-align: left;">master</td><td style="text-align: left;">m2</td></tr><tr><td style="text-align: left;">CentOS7.2</td><td style="text-align: left;">192.168.137.15</td><td style="text-align: left;">master</td><td style="text-align: left;">m3</td></tr><tr><td style="text-align: left;">CentOS7.2</td><td style="text-align: left;">192.168.137.30</td><td style="text-align: left;">worker</td><td style="text-align: left;">n1</td></tr><tr><td style="text-align: left;">CentOS7.2</td><td style="text-align: left;">192.168.137.32</td><td style="text-align: left;">worker</td><td style="text-align: left;">n2</td></tr></tbody></table><img src="/posts/9acacb00/k8s%E5%8D%95master.jpg" class="" title="[单-master]">#### 2.设置主机名<code>hostname</code>,每一台配置<code>hosts</code>文件域名解析:<div id="kubeadm"></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt;&gt;/etc/hosts   # 追加</span><br><span class="hljs-string">  192.168.137.13 m1</span><br><span class="hljs-string">  192.168.137.13 m2</span><br><span class="hljs-string">  192.168.137.13 m3</span><br><span class="hljs-string">  192.168.137.30 n1</span><br><span class="hljs-string">  192.168.137.32 n2</span><br><span class="hljs-string">  EOF</span><br></code></pre></td></tr></table></figure><h4id="关闭防火墙selinux及swap">3.关闭<code>防火墙</code>、<code>SELinux</code>及<code>swap</code>:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl stop firewalld<br>systmectl <span class="hljs-built_in">disable</span> firewalled<br><br>iptables -F<br>iptables -X &amp;&amp; iptables -F -t nat<br>iptables -X -t nat &amp;&amp; iptables -P FORWARD ACCEPT<br><br>setenforce 0<br>sed -i <span class="hljs-string">&quot;s/^SELINUX=enforcing/SELINUX=disabled/g&quot;</span> /etc/selinux/config<br><br>swapoff -a<br>sed -i <span class="hljs-string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab <br>sed -i <span class="hljs-string">&#x27;/swap/s/^\(.*\)$/#\1/g&#x27;</span> /etc/fstab<br></code></pre></td></tr></table></figure><h4id="配置内核参数将桥接的ipv4流量传递到iptables的链">4.配置内核参数，将桥接的IPv4流量传递到iptables的链</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/sysctl.d/k8s.conf   # 多行输入</span><br><span class="hljs-string">  net.bridge.bridge-nf-call-iptables=1</span><br><span class="hljs-string">  net.bridge.bridge-nf-call-ip6tables=1</span><br><span class="hljs-string">  net.ipv4.ip_forward=1</span><br><span class="hljs-string">  vm.swappiness=0</span><br><span class="hljs-string">  vm.overcommit_memory=1</span><br><span class="hljs-string">  vm.panic_on_oom=0</span><br><span class="hljs-string">  fs.inotify.max_user_watches=89100</span><br><span class="hljs-string">  EOF</span><br><br>sysctl --system<br>sysctl -p /etc/sysctl.d/kubernetws.conf<br></code></pre></td></tr></table></figure><h4id="配置国内yum源docker源及kubernets源">5.配置国内yum源、Docker源及Kubernets源:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install -y wget<br><span class="hljs-built_in">mkdir</span> /etc/yum.repos.d/bak &amp;&amp; <span class="hljs-built_in">mv</span> /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak<br>wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.cloud.tencent.com/repo/centos7_base.repo<br>wget http://mirrors.cloud.tencent.com/repo/epel-7.repo -O /etc/yum.repos.d/epel.repo <br>yum clean all &amp;&amp; yum makecache<br><br>wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo<br><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/yum.repo.d/kubernetes.repo</span><br><span class="hljs-string">  [kubernetes]</span><br><span class="hljs-string">  name=Kubernetes</span><br><span class="hljs-string">  baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="hljs-string">  enabled=1</span><br><span class="hljs-string">  gpgcheck=1</span><br><span class="hljs-string">  repo_gpgcheck=1</span><br><span class="hljs-string">  gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="hljs-string">  EOF</span><br></code></pre></td></tr></table></figure><h3 id="软件安装">软件安装:</h3><h4id="所有节点安装dockerkuberadmkubelet及kubectl">6.所有节点安装docker、kuberadm、kubelet及kubectl</h4><ul><li>kubeadm: 部署集群用的命令</li><li>kubelet:在集群中每台机器上都要运行的组件，负责管理pod、容器的生命周期<br /></li><li>kubectl: 集群管理工具(可选, 只要在控制集群的节点上安装即可)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum update <br>yum install -y conntrack ipvsadm ipset jq sysstat curl iptables libseccomp<br><br>yum remove -y docker* container-selinux<br>yum install -y docker-ce-18.06.1.ce-3.el7<br><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/docker/daemon.json</span><br><span class="hljs-string">  &#123;</span><br><span class="hljs-string">    &quot;graph&quot;: &quot;/docker/data/path&quot;,# df -h 找空间比较大的, 默认 /var/lib/docker</span><br><span class="hljs-string">    &quot;exec-opts&quot;: [&quot;native.cgroupdrive=systemd&quot;]// 默认 cgroups</span><br><span class="hljs-string">    &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;] </span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">  EOF</span><br><br>systemctl <span class="hljs-built_in">enable</span> docker &amp;&amp; systemctl start docker<br>docker -version<br>yum list kubeadm --showduplicates | <span class="hljs-built_in">sort</span> -r  <span class="hljs-comment"># 找到要安装的版本号</span><br>yum install -y kubelet-1.13.3 kubeadm-1.13.3 kubectl-1.13.3<br><br><span class="hljs-comment"># 设置kubelet的cgroupdriver (kubelet的cgroupdriver默认为systemd, 如果上面没有设置docker的exec-opts为systemd, 这里就需要将kubelet的设置为cgroupfs)</span><br>sed -i <span class="hljs-string">&quot;s/cgroup-driver=systemd/cgroup-driver=cgroupfs/g&quot;</span> /etc/systemd/system/kubelet.service.d/10-kubeadm.conf <br>systemctl <span class="hljs-built_in">enable</span> kubelet<span class="hljs-comment"># 设置开机启动暂时不启动</span><br></code></pre></td></tr></table></figure><h3 id="部署配置">部署配置:</h3><h4 id="下载参考配置文件">7.下载参考配置文件</h4><ul><li><strong><ahref="https://www.jianshu.com/p/74a6673ff78b">关于镜像下载问题</a></strong><br /></li><li><strong><ahref="https://github.com/HikoQiu/kubeadm-install-k8s">kubeadm-config.yaml配置参考</a></strong><br /></li><li><strong><ahref="https://github.com/anjia0532/gcr.io_mirror/tree/master/google-containers">gcr.io_mirror</a></strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment"># 下载镜像</span><br>images=(kube-proxy-amd64:v1.13.3 kube-apiserver-amd64:v1.13.3 kube-controller-manager-amd64:v1.13.3 kube-scheduler-amd64:v1.13.3 pause:3.1 etcd-amd64:3.2.18 coredns:1.1.3)<br><span class="hljs-keyword">for</span> imageName <span class="hljs-keyword">in</span> <span class="hljs-variable">$&#123;images[@]&#125;</span><br><span class="hljs-keyword">do</span><br>    docker pull anjia0532/google-containers.<span class="hljs-variable">$imageName</span><br>    docker tag anjia0532/google-containers.<span class="hljs-variable">$imageName</span> k8s.gcr.io/<span class="hljs-variable">$imageName</span><br>    docker rmi anjia0532/google-containers.<span class="hljs-variable">$imageName</span><br><span class="hljs-keyword">done</span><br>./k8s-docker-images.sh<br></code></pre></td></tr></table></figure><h4 id="部署mater节">8.部署mater节</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubeadm init \<br>  --kubernetes-version=1.13.3 \<br>  <span class="hljs-comment"># 单master: api server地址是master本机IP地址</span><br>  --apiserver-advertise-address=192.168.137.13 \ <br>  --image-repository registry.aliyuncs.com/google_containers \<br>  --service-cidr=10.1.0.0/16 \   <span class="hljs-comment"># 负载均衡虚拟IP</span><br>  --pod-network-cidr=10.244.0.0/16 <br><br>kubeadm <span class="hljs-built_in">join</span> :6443 --token kekvgu.nw1n76h84f4camj6 --discovery-token-ca-cert-hash sha256:4ee74205227c78ca62f2d641635afa4d50e6634acfaa8291f28582c7e3b0e30e<br><br><span class="hljs-built_in">ls</span> /etc/kubernetes/pki <span class="hljs-comment"># 证书路径</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br>  kubectl get node<br>  NAMESTATUSROLESAGEVERSION<br>  m1NotReadymaster5m46sv1.13.3<br></code></pre></td></tr></table></figure><h4 id="部署pod网络-部署flanne-网络插件">9.部署POD网络, 部署Flanne网络插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml<br>kubectl get pods -n kube-ststem<br></code></pre></td></tr></table></figure><h4 id="加入kubernetes-node-即向集群添加新节点">10.加入Kubernetes Node,即向集群添加新节点</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vim">kubeadm <span class="hljs-keyword">join</span> --token <span class="hljs-symbol">&lt;master-ip&gt;</span>:<span class="hljs-symbol">&lt;master-port&gt;</span> --discovery-token-<span class="hljs-keyword">ca</span>-cert-hash <span class="hljs-built_in">sha256</span>:code<br># 在所有 node节点 上执行如下命令:<br>kubeadm <span class="hljs-keyword">join</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">137.13</span>:<span class="hljs-number">6443</span> --token kekvgu.nw1n76h84f4camj6 --discovery-token-<span class="hljs-keyword">ca</span>-cert-hash <span class="hljs-built_in">sha256</span>:<span class="hljs-number">4</span>ee74205227c78ca62f2d641635afa4d50e6634acfaa8291f28582c7e3b0e30e<br><br># master 查看node 状态<br>  kubectl <span class="hljs-built_in">get</span> node<br>  NAMESTATUSROLESAGEVERSION<br>  m1Readymaster<span class="hljs-number">15</span><span class="hljs-keyword">m</span>v1.<span class="hljs-number">13.3</span><br>  n1Ready<span class="hljs-symbol">&lt;none&gt;</span><span class="hljs-number">4</span>sv1.<span class="hljs-number">13.3</span><br>  n2Ready<span class="hljs-symbol">&lt;none&gt;</span><span class="hljs-number">88</span>sv1.<span class="hljs-number">13.3</span><br><br>kubectl <span class="hljs-built_in">get</span> pods -n kube-<span class="hljs-built_in">system</span><br>kubectl <span class="hljs-keyword">delete</span> pods kube-flannel-<span class="hljs-keyword">ds</span>-amd64-<span class="hljs-number">6</span>jf7t -n kube-<span class="hljs-built_in">system</span><br></code></pre></td></tr></table></figure><h4 id="创建pod以验证集群是否正常">11.创建Pod以验证集群是否正常</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl create deployment nginx --image=nginx<br>kubectl get pods<br>  NAMEREADYSTATUSRESTARTSAGE<br>  nginx-5c7588df-fhhb90/1ContainerCreating028s<br>  kubectl expose deployment nginx --port=80 --<span class="hljs-built_in">type</span>=NodePort<br><br>  kubectl get pods,svc -o wide<span class="hljs-comment"># 查看详细信息  </span><br><span class="hljs-comment"># 测试: 192.168.137.30:80</span><br></code></pre></td></tr></table></figure><h4 id="部署dashboardmaster节点">12.部署Dashboard(master节点)</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-string">wget</span> <span class="hljs-string">https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml</span><br><br><span class="hljs-comment"># vim 手动修改yaml文件Dashboard 的获取地址</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes-dashboard</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">loveone/kubernetes-dashboard-amd64:v1.10.1</span><br><br>  <span class="hljs-attr">spec:</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">443</span><br>         <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8443</span><br>         <span class="hljs-comment"># nodePort: 30001定义外部访问端口</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br><br><span class="hljs-string">docker</span> <span class="hljs-string">pull</span> <span class="hljs-string">loveone/kubernetes-dashboard-amd64:v1.10.1</span> <span class="hljs-comment"># 也可以先下载镜像</span><br><span class="hljs-string">kubectl</span> <span class="hljs-string">apply</span> <span class="hljs-string">-f</span> <span class="hljs-string">kubernetes-dashboard.yaml</span><br><span class="hljs-string">kubectl</span> <span class="hljs-string">create</span> <span class="hljs-string">-f</span> <span class="hljs-string">kubernetes-dashboard.yaml</span><br><br><span class="hljs-comment"># 查看服务状态</span><br><span class="hljs-string">kubectl</span> <span class="hljs-string">get</span> <span class="hljs-string">deployment</span> <span class="hljs-string">kubernetes-dashboard</span> <span class="hljs-string">-n</span> <span class="hljs-string">kube-system</span><br><span class="hljs-string">kubectl</span> <span class="hljs-string">get</span> <span class="hljs-string">pods</span> <span class="hljs-string">-n</span> <span class="hljs-string">kube-system</span> <span class="hljs-string">-o</span> <span class="hljs-string">wide</span><br><span class="hljs-string">kubectl</span> <span class="hljs-string">get</span> <span class="hljs-string">services</span> <span class="hljs-string">-n</span> <span class="hljs-string">kube-system</span><br><span class="hljs-string">kubectl</span> <span class="hljs-string">get</span> <span class="hljs-string">pods,svc</span> <span class="hljs-string">-n</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-string">NAME</span><span class="hljs-string">TYPE</span><span class="hljs-string">CLUSTER_IP</span><span class="hljs-string">EXTERNAL_IP</span><span class="hljs-string">PORT(S)</span><span class="hljs-string">AGE</span><br>  <span class="hljs-string">service/kube-dns</span><span class="hljs-string">ClusterIP</span><span class="hljs-number">10.1</span><span class="hljs-number">.0</span><span class="hljs-number">.10</span><span class="hljs-string">&lt;none&gt;</span><span class="hljs-number">53</span><span class="hljs-string">/UDP,53/TCP</span><span class="hljs-string">27m</span><br>  <span class="hljs-string">service/kubernetes-dashboard</span><span class="hljs-string">NodePort</span><span class="hljs-number">10.1</span><span class="hljs-number">.225</span><span class="hljs-number">.37</span><span class="hljs-string">&lt;none&gt;</span><span class="hljs-number">443</span><span class="hljs-string">:32569/TCP</span><span class="hljs-string">53s</span><br><br><span class="hljs-string">nestat</span> <span class="hljs-string">-anltp</span> <span class="hljs-string">|grep</span> <span class="hljs-number">8443</span><br><span class="hljs-comment"># 测试: https://192.168.137.13:32569</span><br></code></pre></td></tr></table></figure><h4 id="登录认证">13.登录认证</h4><img src="/posts/9acacb00/dashboard.jpg" class="" title="[dashboard认证界面]"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看访问Dashboard的认证令牌</span><br>kubectl create serviceaccount dashboard-admin -n kube-system<br>kubectl create clusterrolebinding  dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin<br><br>kubectl get secret -n kube-system<br>  NAMETYPEDATAAGE<br>  dashboard-admin-token-w6rtnkuberbetes.io/service-account-tokendefault-token-82hvk360s<br>kubectl describe secrets dashboard-admin-token-w6rtn -n kube-system<br>kubectl describe secrets -n kube-system $(kubectl -n kube-system get secret | awk <span class="hljs-string">&#x27;/dashboard-admin/&#123;print $1&#125;&#x27;</span>)<br></code></pre></td></tr></table></figure><img src="/posts/9acacb00/dashboard-%E9%A1%B5%E9%9D%A2.jpg" class="" title="[dashboard页面]"><h2 id="二进制部署">二进制部署:</h2>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkins</title>
    <link href="/posts/9a7f448e.html"/>
    <url>/posts/9a7f448e.html</url>
    
    <content type="html"><![CDATA[<p>2019-07-23-Jenkins <span id="more"></span></p><h1 id="jenkins">Jenkins</h1><h2 id="jenkin是什么">Jenkin是什么?</h2><blockquote><p>Jenkins是开源<strong>CI&amp;CD</strong>软件领导者,提供超过1000个插件来支持构建, 部署, 自动化, 满足任何项目的需要,Jenkins是一个独立的基于<strong>Java的程序</strong>, 可以立即运行,包含Windows，Mac OS X和其他类Unix操作系统. ## Jenkins的特点:<strong>持续集成和持续交付</strong>作为一个可扩展的自动化服务器,Jenkins可以用作简单的CI服务器, 或者变成任何项目的连续交付中心.Jenkins可以通过其网页界面<strong>轻松设置和配置</strong>,其中包括即时错误检查和内置帮助.通过更新中心中的1000多个<strong>插件</strong>,Jenkins集成了持续集成和持续交付工具链中几乎所有的工具. Jenkins可以通过其插件架构进行<strong>扩展</strong>, 从而为 Jenkins可以做的事提供几乎无限的可能性.Jenkins可以轻松地在<strong>多台机器</strong>上分配工作，帮助更快速地<strong>跨多个平台</strong>推动构建，测试和部署.## Jenkins部署: ### 选用Ubuntu进行部署 +<strong>建议所有操作在root下部署</strong> + 关于Ubuntu设置永久DNS的方法:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">vim /etc/network/interfaces     <span class="hljs-comment"># dns-nameserver 192.168.137.2</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">vim /etc/systemd/resolved.conf <span class="hljs-comment"># [Resolve] DNS=DNS</span></span> <br></code></pre></td></tr></table></figure></p></blockquote><h3 id="ubuntu的相关配置">Ubuntu的相关配置:</h3><blockquote><p>192.168.37.10: jenkins/SVN; 192.168.37.12: 测试机; 192.168.37.14:生产环境 #### 下载git <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ apt-get install libcurl4-gnutls-dev libexpat1-dev gettext \<br>  libz-dev libssl-dev<br><br>$ wget -O v2.22.0.tar.gz https://github.com/git/git/archive/v2.22.0.tar.gz<br><br>$ tar -xzvf git-v2.22.0.tar.gz<br>$ <span class="hljs-built_in">cd</span> git-1.7.2.2<br>$ make prefix=/usr/local/git all<br><br>$ <span class="hljs-built_in">sudo</span> make prefix=/usr/local/git install<br>$ vim /etc/profie<br>PATH=<span class="hljs-variable">$PATH</span>:/usr/local/bin<br>$ <span class="hljs-built_in">source</span> /etc/profile<br>$ <span class="hljs-built_in">export</span> PATH<br></code></pre></td></tr></table></figure></p></blockquote><h4 id="搭建svnsvniprepos-192.168.37.10">搭建SVN(svn://IP/repos)192.168.37.10</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ apt-get install subversion<br>$ <span class="hljs-built_in">mkdir</span> /home/svn<br>$ svnadmin create /home/svn/repos<br>$ <span class="hljs-built_in">cd</span> /home/svn/repos<br><br>$ vim svnserve.conf<br>    anon-access = none<br>    auth-access = write<br>    password-db = passwd<br>    authz-db = authz<br>$ vim passwd<br>    [<span class="hljs-built_in">users</span>]<br>    <span class="hljs-built_in">test</span> = 123456<br>$ vim authz<br>    [repos:/]<br>    <span class="hljs-built_in">test</span> = rw<br>    * =<br><br>$ svnserve -d -r /home/svn<br></code></pre></td></tr></table></figure><h4 id="安装java-192.168.37.10">安装Java 192.168.37.10</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mkdir</span> /usr/local/java/jdk1.8<br>$ tar -xzvf jdk-8u221-linux-x64.tar.gz<br>$ <span class="hljs-built_in">mv</span> jdk1.8.0_221/ /usr/local/java/jdk1.8<br>$ vim ~/.bashrc<br>    JAVA_HOME=/usr/local/jdk1.8  <br>    CLASSPATH=.:<span class="hljs-variable">$JAVA_HOME</span>/lib/dt.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib/tools.jar<br>    JAVA_JRE=<span class="hljs-variable">$JAVA_HOME</span>/jre<br>    MAVEN_HOME=/usr/local/maven3.6.1<br>    PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$MAVEN_HOME</span>/bin<br>    <span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$MAVEN_HOME</span>/bin<br>$ <span class="hljs-built_in">source</span> ~/.bashrc<br>$ java -verison<br></code></pre></td></tr></table></figure><h4id="安装apache-tomcatjava--jar-jenkins.war-192.168.37.10">安装apache-tomcat(java-jar jenkins.war) 192.168.37.10</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-8/v8.5.43/bin/apache-tomcat-8.5.43.tar.gz<br>$ tar -xzvf apache-tomcat-8.5.43.tar.gz<br>$ <span class="hljs-built_in">mv</span> apache-tomcat-8.5.43 /usr/local/apache-tomcat-8<br>$ <span class="hljs-built_in">chmod</span> 755 -R /usr/local/apache-tomcat-8.5.43<br>$ unzip -d jenkins jenkins.war<br>$ <span class="hljs-built_in">mv</span> jenkins /usr/local/apache-tomcat-8/webapps<br><br>浏览器访问Jenkin: IP:8080/jenkins<br><br>$ <span class="hljs-built_in">cd</span> /usr/local/apache-tomcat-8.5.43/bin/startup.sh<br>$ <span class="hljs-built_in">tail</span> -f ../logs/catalina.out<br>$ <span class="hljs-built_in">cat</span> /root/.jenkins/secrets/initialAdminPassword<br></code></pre></td></tr></table></figure><h4id="搭建私有镜像仓库与构建lnmp基础镜像">搭建私有镜像仓库与构建LNMP基础镜像</h4><ul><li><p>创建nginx php镜像 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d -v /opt/registry:/var/lib/registry -p 5000:5000 --restart=always --name registry registry<br><br>vim /etc/daemon.json<br>&#123;<br>      <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;http://f1361db2.m.daocloud.io&quot;</span>],<br>      <span class="hljs-string">&quot;insecure-registries&quot;</span>: [<span class="hljs-string">&quot;192.168.37.10:5000&quot;</span>]<br>&#125;<br><br>FROM centsos:6<br>MAINTAINER anyu967<br>RUN yum install -y gcc gcc-c++ make openssl-devel pcre-devel &amp;&amp; \<br>yumclaean all <br>ADD nginx-1.12.tar.gz /tmp<br>RUN <span class="hljs-built_in">cd</span> /tmp/nginx-1.12 &amp;&amp; ./configure --prefix=/usr/local/nginx &amp;&amp; make -j 2 &amp;&amp; \<br>make install &amp;&amp; <span class="hljs-built_in">rm</span> -rf /tmp/nginx-1.12.1<br>COPY nginx.cong /usr/local/nginx/conf<br>EXPOSED 80<br>CMD [<span class="hljs-string">&quot;/usr/local/nginx/sbin/nginx&quot;</span>, <span class="hljs-string">&quot;-g&quot;</span>, <span class="hljs-string">&quot;daemon off:&quot;</span>]<br><br>FROM centsos:6<br>MAINTAINER anyu967<br>RUN yum install -y gcc gcc-c++ gd-devel libxml2-devel \<br>libcurl-devel libjpeg-devel libpng-devel openssl-devel &amp;&amp; \ <br>yum claean all <br>ADD php-5.6.31.tar.gz /tmp<br>RUN <span class="hljs-built_in">cd</span> /tmp/php-5.6.31 &amp;&amp; \<br>    ./configure --prefix=/usr/local/php \<br>    --with-config-file-path=/usr/local/php/etc \<br>    --with-mysql --with-mysqli \<br>    --with--openssl --with-zlib --with-curl --with-gd \<br>    --with--jpeg-dir --with-png-dir --with-iconv \<br>    --enable-fpm --enable-zip --enable-mbstring &amp;&amp; \<br>    make -j 4 &amp;&amp; make install &amp;&amp; \<br>    <span class="hljs-built_in">cp</span> /usr/local/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.cong &amp;&amp; \<br>    sed -i <span class="hljs-string">&quot;s/127.0.0.1/0.0.0.0/&quot;</span> /usr/local/php/etc/php-fpm.conf &amp;&amp; \<br>    <span class="hljs-built_in">cp</span> ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm &amp;&amp; \<br>    <span class="hljs-built_in">chmod</span> +x /etc/init.d/php-fpm &amp;&amp; \<br><span class="hljs-built_in">rm</span> -rf /tmp/php-5.6.31<br>COPY php.ini /usr/local/php/etc<br>EXPOSED 9000<br>CMD /etc/init.d/php-fpm start &amp;&amp; <span class="hljs-built_in">tail</span> -F /var/log/messages<br><br>docker build -t 192.168.37.10:5000/lnmp-php:base .<br>docker push 192.168.37.10:5000/lnmp-php:base<br><br>location ~ \.php$ &#123;<br>      root           html;<br>      fastcgi_pass   php-cgi:9000;<br>      fastcgi_param  SCRIPT_FILENAME scripts<span class="hljs-variable">$fastcgi_script_name</span>;<br>      include        fastcgi_params;<br>&#125;<br></code></pre></td></tr></table></figure> #### 创建文件(测试环境的配置)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">|-- /home/anyue/lnmp<br>|-- Dockerfile<br>|   |-- nginx<br>|   |-- php<br>|-- config<br>|   |-- prod.html<br>|   |-- prod.tar.gz<br>|   |-- test.html<br>|   |-- test.tar.gz<br>|-- deploy.sh<br>|-- docker-compose.yml<br>|-- mysql_data<br>|-- push_images.sh<br>|-- revision.svn<br>|-- wwwroot<br></code></pre></td></tr></table></figure></p></li><li><p>deploy.sh <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>REVISION=<span class="hljs-variable">$1</span><br>WORK_ENV=<span class="hljs-built_in">test</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$REVISION</span> &gt;./revision.svn<br><span class="hljs-built_in">cd</span> Dockerfile<br>docker build --build-arg work_env=<span class="hljs-variable">$WORK_ENV</span> -t lnmp-nginx:laste -f nginx ../  <span class="hljs-comment"># tag</span><br>docker build --build-arg work_env=<span class="hljs-variable">$WORK_ENV</span> -t lnmp-php:laste -f php ../<br>docker-compose down<br>docker-compose up -d<br></code></pre></td></tr></table></figure></p></li><li><p>Docker-compose.yml <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">service:</span><br>  <span class="hljs-attr">nginx:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">lnmp_nginx:latest</span><br>      <span class="hljs-attr">ports:</span> <br>        <span class="hljs-bullet">-</span> <span class="hljs-number">80</span><span class="hljs-string">:80</span><br>      <span class="hljs-attr">links:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">php:</span> <span class="hljs-string">php-cgi</span><br>      <span class="hljs-attr">depends_on:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">php</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">mysql</span><br>  <span class="hljs-attr">php:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">lnmp-php:latest</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">mysql:</span> <span class="hljs-string">mysql-db</span><br>  <span class="hljs-attr">mysql:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.6</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">3306</span><span class="hljs-string">:3306</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./mysql_data:/var/lib/mysql</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">--character-set-server=utf8</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-number">123456</span><br>      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">wordpress</span><br>      <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">user</span><br>      <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">user123</span>  <br></code></pre></td></tr></table></figure></p></li><li><p>nginx &amp;&amp; php <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">FROM 192.168.37.10:5000/lnmp-nginx:base<br>MAINTAINER anyue<br>ARG work_env<br>ADD wwwroot /usr/local/nginx/html<br>ADD config/<span class="hljs-variable">$&#123;work_env&#125;</span>.tar.gz /usr/local/nginx/html<br>EXPOSE 80<br><br>FROM 192.168.37.10:5000/lnmp-php:base<br>MAINTAINER anyue<br>ARG work_env<br>ADD wwwroot /usr/local/nginx/html<br>ADD config/<span class="hljs-variable">$&#123;work_env&#125;</span>.tar.gz /usr/local/nginx/html<br>EXPOSE 9000<br></code></pre></td></tr></table></figure></p></li><li><p>push_image.sh <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>IMAGE_REPOS=192.168.37.10:5000<br>REVISION=$(<span class="hljs-built_in">cat</span> revision.svn)<br>WORK_ENV=prod<br><span class="hljs-built_in">cd</span> Dockerfile<br>docker build --build-arg work_env=<span class="hljs-variable">$WORK_ENV</span> -t <span class="hljs-variable">$IMAGE_REPOS</span>/lnmp-nginx:<span class="hljs-variable">$REVISION</span> -f nginx ../<br>docker build --build-arg work_env=<span class="hljs-variable">$WORK_ENV</span> -t <span class="hljs-variable">$IMAGE_REPOS</span>/lnmp-php:<span class="hljs-variable">$REVISION</span> -f php ../<br>docker push <span class="hljs-variable">$IMAGE_REPOS</span>/lnmp-nginx:<span class="hljs-variable">$REVISION</span><br>docker push <span class="hljs-variable">$IMAGE_REPOS</span>/lnmp-php:<span class="hljs-variable">$REVISION</span><br></code></pre></td></tr></table></figure> #### 创建文件(生产环境的配置)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">|-- deploy.sh<br>|-- docker-compose.yml<br>|-- revision.svn<br>|-- roll-back.sh<br></code></pre></td></tr></table></figure></p></li><li><p>deploy.sh <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>REVISION=revison.svn<br>IMAGE_REPOS=http://192.168.37.10:5000/v2<br>LATEST_REVISION=$(curl <span class="hljs-variable">$IMAGE_REPOS</span>/lnmp-nginx/tags/list |grep -Po <span class="hljs-string">&#x27;(?&lt;=&quot;)\d+(?=&quot;)&#x27;</span> |awk <span class="hljs-string">&#x27;BEGIN&#123;max=0&#125; &#123;for(i=0;i&lt;=NF;i++) if($i&gt;max) max=$i&#125;END&#123;print max&#125;&#x27;</span>)<br>sed -i -r <span class="hljs-string">&#x27;/:5000/s/[0-9]+$/&#x27;</span><span class="hljs-variable">$LATEST_REVISION</span><span class="hljs-string">&#x27;/&#x27;</span> docker-compose.yml<br><span class="hljs-keyword">if</span> ! grep <span class="hljs-string">&quot;^<span class="hljs-variable">$LATEST_REVISION</span> &quot;</span> <span class="hljs-variable">$REVISION</span> &amp;&gt;/dev/null; <span class="hljs-keyword">then</span><br>      sed -i -r <span class="hljs-string">&#x27;$s/([0-9]+).*/\1 Previous/&#x27;</span> <span class="hljs-variable">$REVISION</span><br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$LATEST_REVISION</span> Current&quot;</span> &gt;&gt;<span class="hljs-variable">$REVISION</span><br><span class="hljs-keyword">fi</span><br>docker-compose down<br>docker-compose up -d<br></code></pre></td></tr></table></figure></p></li><li><p>docker-compose.yml <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">version: <span class="hljs-string">&#x27;3&#x27;</span><br>services:<br>  nginx:<br>    image: 192.168.37.10:5000/lnmp-nginx:12<br>    ports:<br>      - 80:80<br>    links:<br>      - php: php-cgi<br>    depends_on:<br>      - php<br>  php:<br>    image: 192.168.37.10:5000/lnmp-php:12<br>    links:<br>      - mysql: mysql-db<br>  mysql:<br>    image: mysql:5.6<br>    ports:<br>      - 3306:3306<br>    volumes:<br>      - ./mysql_data:/var/lib/mysql<br>    <span class="hljs-built_in">command</span>: --character-set-server=utf8<br>    environment:<br>      MYSQL_ROOT_PASSWORD: 123456<br>      MYSQL_DATABASE: wordpress<br>      MYSQL_USER: user<br>      MYSQL_PASSWORD: user123  <br></code></pre></td></tr></table></figure></p></li><li><p>roll-back.sh <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>PRE_REVISION=$(awk <span class="hljs-string">&#x27;Previous/&#123;revision=$1&#125; END&#123;print revision&#125;&#x27;</span> revision.svn)<br>sed -i -r <span class="hljs-string">&#x27;/:5000/s/[0-9]+$/&#x27;</span><span class="hljs-variable">$PRE_REVISION</span><span class="hljs-string">&#x27;/&#x27;</span> docker-compose.yml<br>docker-compose down<br>docker-compose up -d<br></code></pre></td></tr></table></figure> ## Jenkins配置 | Manage Jenkin |desc | | :———————— | :———————————————————- | | Configure System |Configure global setting and paths | | Configure Global Security |Secure Jenkins; define who is allowed access/use the system | | GlobalTool Configuration | Configure tools, their location and automaticinstallers | | Manager Users | Create/delete/modify users that can login to this Jenkins |</p></li></ul><h2 id="解决乱码">解决乱码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /opt/tomcat8/bin/catalina.sh   <span class="hljs-comment"># 解决乱码: export LANG=zh_CN.UTF-8</span><br></code></pre></td></tr></table></figure><h2 id="jenkins使用">Jenkins使用</h2><h3 id="原理">原理</h3><img src="/posts/9a7f448e/CI.png" class="" title="[jenkins_CI]"><h3 id="configure-system配置ssh">Configure System(配置SSH)</h3><img src="/posts/9a7f448e/Configure_System.png" class="" title="[Configure_System]"><h3 id="global-tool-configuration配置相关工具路径">Global ToolConfiguration(配置相关工具路径)</h3><img src="/posts/9a7f448e/Global_Tool_Configuration.png" class="" title="[Global_Tool_Configuration]">]]></content>
    
    
    <categories>
      
      <category>CICD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Jenkins</tag>
      
      <tag>CI</tag>
      
      <tag>CD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerFile</title>
    <link href="/posts/b94b563a.html"/>
    <url>/posts/b94b563a.html</url>
    
    <content type="html"><![CDATA[<p>2019-07-16-DockFile <span id="more"></span></p><h3 id="dockerfile-语法">DockerFile 语法</h3><h4 id="docker_practice"><ahref="https://github.com/yeasy/docker_practice">docker_practice</a></h4><h4 id="运行">运行</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -it --<span class="hljs-built_in">rm</span> -p 4000:80 dockerpracticesig/docker_practice<br><span class="hljs-comment"># localhost:4000</span><br></code></pre></td></tr></table></figure><h4 id="from-指定基础image">FROM – 指定基础image</h4><ul><li>构建指令，必须指定且需要在 DockerFile其他指令的前面，后续指令依赖指定的 image，FROM指定的基础 image既可以是本地 Repo 也可以是官方的远程仓 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">FROM</span> <span class="hljs-string">centos:7.2</span><br><span class="hljs-string">FROM</span> <span class="hljs-string">centos</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="maintainer-指定镜像创建者信息">MAINTAINER–指定镜像创建者信息</h4><ul><li>构建指令，用于将 image 的制作者相关信息写入到 image中，当执行<code>docker inspect</code>，输出中有相应的字段记录该信息<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">MAINTAINER</span> username <span class="hljs-string">&quot;username<span class="hljs-variable">@xxx</span>.com&quot;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="run-安装软件用">RUN –安装软件用</h4><ul><li>构建指令，RUN 可以运行任何被基础 image 支持的命令，若基础 image 为centos，则软件管理部分只能使用 centos 的包管理命令 <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">cd</span> /tmp &amp;&amp; curl -L <span class="hljs-string">&#x27;http://archive.apache.org.dist/tomcat/tomcat-7/v7.0.8/bin/apache-tomcat-7.0.8.tar.gz&#x27;</span> | tar -xz</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> [ <span class="hljs-string">&quot;/bin/bash&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;echo helllo&quot;</span> ]</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="cmd-设置-container-启动时执行的操作覆盖">CMD –设置 container启动时执行的操作(覆盖)</h4><ul><li>设置指令，用于 container启动时指定的操作，该操可以是自定义的脚本，也可以是执行系统的命令，该指令只能在文件中存在一次，若有多个，只执行最后一条<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello，World！&quot;</span></span><br></code></pre></td></tr></table></figure></li></ul><h4 id="entrypoint-设置-container-启动执行的操作追加">ENTRYPOINT –设置container 启动执行的操作(追加)</h4><ul><li><p>设置指令，指定容器启动时执行的操作，可以多次设置，但是只有最后一个有效<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> <span class="hljs-built_in">ls</span> -l</span><br></code></pre></td></tr></table></figure></p></li><li><p>该指令独自使用,若还有CMD命令且CMD是一条完整的可执行的命令，则CMD指令和ENTRYPOINT会相互覆盖，只有最后一个CMD或 ENTRYPOINT 有效 <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello World&quot;</span></span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> <span class="hljs-built_in">ls</span> -l</span><br><span class="hljs-comment"># CMD 不会执行, ENTRYPOINT有效</span><br></code></pre></td></tr></table></figure></p></li><li><p>该指令与CMD配合使用指定 ENTRYPOINT 的默认参数，则 CMD指令不是完整的可执行命令，仅仅是参数部分；ENTRYPOINT 指令只能使用 JSON方式 指定执行命令，而不能指定参数 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">FROM</span> ubuntu<br>CMD <span class="hljs-selector-attr">[<span class="hljs-string">&quot;-l&quot;</span>]</span><br>ENTRYPOINT <span class="hljs-selector-attr">[<span class="hljs-string">&quot;/usr/bin/ls&quot;</span>]</span><br></code></pre></td></tr></table></figure></p></li></ul><h4 id="user-设置-container-用户">USER –设置 container 用户</h4><ul><li>设置指令，设置启动容器的用户，默认 root 用户 <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">USER</span> <span class="hljs-title">daemon</span> = ENTRYPOINT [<span class="hljs-string">&quot;memcached&quot;</span>, <span class="hljs-string">&quot;-u&quot;</span>, <span class="hljs-string">&quot;daemon&quot;</span>]<br></code></pre></td></tr></table></figure></li></ul><h4 id="expose-指定容器需要映射到宿主机的端口">EXPOSE–指定容器需要映射到宿主机的端口</h4><ul><li>设置指令，会将容器中端口映射成宿主机中的某个端口 <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">EXPOSE <span class="hljs-number">22</span><br>docker run -<span class="hljs-selector-tag">p</span> port1 <span class="hljs-selector-tag">image</span><br>EXPOSE port1 port2 port3<br>docker run -<span class="hljs-selector-tag">p</span> port1 port2 port3 <span class="hljs-selector-tag">image</span><br>docker run -<span class="hljs-selector-tag">p</span> host_port1:port1 -<span class="hljs-selector-tag">p</span> host_port2:port2 -<span class="hljs-selector-tag">p</span> host_port3:port3 image<br></code></pre></td></tr></table></figure></li></ul><h4 id="env-用于设置环境变量">ENV –用于设置环境变量</h4><ul><li>构建指令，在 image 中设置一个环境变量，后续的 RUN可以使用，container 启动后，通过 <code>docker inspect</code>查看环境变量，或者 <code>docker run --env key=value</code>时设置或修改环境变量 <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ENV JAVA_HOME <span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/java/</span>dirent<br></code></pre></td></tr></table></figure></li></ul><h4 id="add-从-src-复制文件到-container-的-dest-路径解包后拷贝">ADD –从src 复制文件到 container 的 dest 路径(解包后拷贝)</h4><ul><li>ADD [src] [dest]<ul><li>[src] 是相对被构建的源目录的相对路径，可以是 文件或目录路径，也可以是远程的文件 url</li><li>[dest] 是container 中的绝对路径</li></ul></li></ul><h4 id="copy-从-src-复制文件到-container-的-dest-路径">COPY –从 src复制文件到 container 的 dest 路径</h4><ul><li>COPY [src] [dest]</li></ul><h3 id="volume-指定挂载点">VOLUME –指定挂载点</h3><ul><li>设置指令，使容器中的一个目录具有持久化存储数据的功能，该目录可以被容器本身使用，也可以共享给其他容器使用，因为容器使用的是UFS技术，这种文件系统不能持久化，当容器关闭后，所有更改都会丢失<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">FROM</span> base<br>VOLUME <span class="hljs-selector-attr">[<span class="hljs-string">&quot;/tmp/data&quot;</span>]</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="workdir-切换目录">WORKDIR –切换目录</h4><ul><li>设置指令，可以多次切换，等同于 cd，对RUN、CMD、ENTRYPOINT生效<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /p1 WORKDIR p2 RUN vim a.txt  === RUN <span class="hljs-built_in">cd</span> /p1/p2 &amp;&amp; vim a.txt</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="onbuild-在子镜像中执行">ONBUILD –在子镜像中执行</h4><ul><li>在构建镜像时并不执行，而是在它的子镜像中执行 <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-string">ONBUILD</span> <span class="hljs-string">ADD</span> <span class="hljs-string">.</span> <span class="hljs-string">/app/src</span><br><span class="hljs-string">ONBUILD</span> <span class="hljs-string">RUN</span> <span class="hljs-string">/usr/local/bin/python-build</span> <span class="hljs-string">--dir</span> <span class="hljs-string">/app/src</span><br><br><span class="hljs-string">docker</span> <span class="hljs-string">build</span> <span class="hljs-string">-t</span> <span class="hljs-string">imagename</span> <span class="hljs-string">.</span><br><span class="hljs-string">FROM</span> <span class="hljs-string">hub.c.163.com/public/centos:6.7</span><br><span class="hljs-string">MAINTAINER</span> <span class="hljs-string">xingyue@163.com</span><br><span class="hljs-string">ADD</span> <span class="hljs-string">./apache-tomcat-7.0.42.tar.gz</span> <span class="hljs-string">/root</span><br><span class="hljs-string">ADD</span> <span class="hljs-string">./jdk-7u25-linux-x64.tar.gz</span> <span class="hljs-string">/root</span><br><span class="hljs-string">ENV</span> <span class="hljs-string">JAVA_HOME</span> <span class="hljs-string">/root/jdk1.7.0_25</span><br><span class="hljs-string">ENV</span> <span class="hljs-string">PATH</span> <span class="hljs-string">$JAVA_HOME/bin:$PATH</span><br><span class="hljs-string">EXPOSE</span> <span class="hljs-number">8080</span><br><span class="hljs-string">ENTRYPOINT</span> <span class="hljs-string">/root/apache-tomcat-7.0.42/bin/startup.sh</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">tailf</span> <span class="hljs-string">/root/apache-tomcat-7.0.42/logs/catalina.out</span><br></code></pre></td></tr></table></figure></li></ul><table><thead><tr><th>命令</th><th>描述</th><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>FROM</td><td>构建基于的镜像</td><td>COPY</td><td>拷贝文件或目录到镜像</td></tr><tr><td>MAINTAINER</td><td>镜像维护者信息</td><td>ENTRYPOINT</td><td>运行容器执行的shell命令</td></tr><tr><td>RUN</td><td>构建镜像运行的shell命令</td><td>VOLUME</td><td>指定容器挂载点到宿主机自动生成的目录</td></tr><tr><td>CMD</td><td>运行容器执行的shell命令</td><td>USER</td><td>为RUN/CMD/ENTRYPOINT执行命令指定用户</td></tr><tr><td>EXPOSE</td><td>容器运行服务端口</td><td>WORKDIR</td><td>为RUN/CMD/ENTRYPOINT设置工作目录</td></tr><tr><td>ENV</td><td>容器内部环境变量</td><td>HEALTHCHECK</td><td>健康检查</td></tr><tr><td>ADD</td><td>拷贝文件或目录到镜像</td><td>ARG</td><td>构建镜像时指定参数(效果同ENV)</td></tr></tbody></table><h4 id="构建示例构建php">构建示例(构建PHP)</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-string">FROM</span> <span class="hljs-string">centos:7</span><br><span class="hljs-string">MAINTAINER</span> <span class="hljs-string">anyue967</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">yum</span> <span class="hljs-string">install</span> <span class="hljs-string">-y</span> <span class="hljs-string">gcc</span> <span class="hljs-string">gcc-c++</span> <span class="hljs-string">make</span> <span class="hljs-string">gd-devel</span> <span class="hljs-string">libxml2-devel</span> <span class="hljs-string">libcurl-devel</span> <span class="hljs-string">libjpeg-devel</span> <span class="hljs-string">libpng-devel</span> <span class="hljs-string">openssl-devel</span><br><span class="hljs-string">ADD</span> <span class="hljs-string">php-5.6.31.tar.gz</span> <span class="hljs-string">/tmp/</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">cd</span> <span class="hljs-string">/tmp/php-5.6.31</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">./configure</span> <span class="hljs-string">--prefix=/usr/local/php</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">--with-config-file-path=/usr/local/php/etc</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">--with-mysql</span> <span class="hljs-string">--with-mysqli</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">--with-openssl</span> <span class="hljs-string">--with-zlib</span> <span class="hljs-string">--with-curl</span> <span class="hljs-string">--with-gd</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">--with-jpeg-dir</span> <span class="hljs-string">--with-png-dir</span> <span class="hljs-string">--with-iconv</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">--enable-fpm</span> <span class="hljs-string">--enable-zip</span> <span class="hljs-string">--enable-mbstring</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">make</span> <span class="hljs-string">-j</span> <span class="hljs-number">4</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">make</span> <span class="hljs-string">install</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">cp</span> <span class="hljs-string">/usr/local/php/etc/php-fpm.conf.default</span> <span class="hljs-string">/usr/local/php/etc/php-fpm.conf</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">sed</span> <span class="hljs-string">-i</span> <span class="hljs-string">&quot;s/127.0.0.1/0.0.0.0/&quot;</span> <span class="hljs-string">/usr/local/php/etc/php-fpm.conf</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">sed</span> <span class="hljs-string">-i</span> <span class="hljs-string">&quot;21a \daemonize = no&quot;</span> <span class="hljs-string">/usr/local/php/etc/php-fpm.conf</span>  <span class="hljs-comment"># 21行追加 daemonize = no </span><br><span class="hljs-string">COPY</span> <span class="hljs-string">php.ini</span> <span class="hljs-string">/usr/local/php/etc</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">rm</span> <span class="hljs-string">-rf</span> <span class="hljs-string">/tmp/php-5.6.31*</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">yum</span> <span class="hljs-string">clean</span> <span class="hljs-string">all</span><br><span class="hljs-string">WORKDIR</span> <span class="hljs-string">/usr/local/php</span><br><span class="hljs-string">EXPOSE</span> <span class="hljs-number">9000</span><br><span class="hljs-string">CMD</span> [<span class="hljs-string">&quot;./sbin/php-fpm&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;/usr/local/php/etc/php-fpm.conf&quot;</span>]<br></code></pre></td></tr></table></figure><h3 id="构建示例构建java">构建示例(构建JAVA)</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-string">FROM</span> <span class="hljs-string">cnetos:7</span><br><span class="hljs-string">MAINTAINER</span> <span class="hljs-string">anyue967</span><br><span class="hljs-string">ADD</span> <span class="hljs-string">jdk-8u45-linux-64.tar.gz</span> <span class="hljs-string">/usr/local</span><br><span class="hljs-string">ENV</span> <span class="hljs-string">JAVA_HOME</span> <span class="hljs-string">/usr/local/jdk1.8.0_45</span><br><span class="hljs-string">ADD</span> <span class="hljs-string">apache-tomcat-8.0.16.tar.gz</span> <span class="hljs-string">/usr/local</span><br><span class="hljs-string">COPY</span> <span class="hljs-string">server.xml</span> <span class="hljs-string">/usr/local/apache-tomcat-8.0.46/conf</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">rm</span> <span class="hljs-string">-f</span> <span class="hljs-string">/usr/local/*.tar.gz</span><br><span class="hljs-string">WORKDIR</span> <span class="hljs-string">/usr/local/apache-tomcat-8.0.46</span><br><span class="hljs-string">EXPOSE</span> <span class="hljs-number">8080</span><br><span class="hljs-string">ENTRYPOINT</span> [<span class="hljs-string">&quot;./bin/catalina.sh&quot;</span>, <span class="hljs-string">&quot;run&quot;</span>]<br></code></pre></td></tr></table></figure><h4 id="构建示例tomcat">构建示例(tomcat)</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-string">FROM</span> <span class="hljs-string">centos</span><br><span class="hljs-string">MAINTAINER</span> <span class="hljs-string">anyu967@163.com</span><br><span class="hljs-string">COPY</span> <span class="hljs-string">test.txt</span> <span class="hljs-string">/usr/local/container.txt</span><br><span class="hljs-string">ADD</span> <span class="hljs-string">jdk-8u171-linux-x64.tar.gz</span> <span class="hljs-string">/usr/local/</span><br><span class="hljs-string">ADD</span> <span class="hljs-string">apache-tomcat-9.0.8.tar.gz</span> <span class="hljs-string">/usr/local</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">yum</span> <span class="hljs-string">install</span> <span class="hljs-string">-y</span> <span class="hljs-string">vim</span><br><span class="hljs-string">ENV</span> <span class="hljs-string">MYPATH</span> <span class="hljs-string">/usr/local</span><br><span class="hljs-string">WORKDIR</span> <span class="hljs-string">$MYPATH</span><br><span class="hljs-string">ENV</span> <span class="hljs-string">JAVA_HOME</span> <span class="hljs-string">/usr/local/jdk1.8.0_171</span><br><span class="hljs-string">ENV</span> <span class="hljs-string">CLASSPATH</span> <span class="hljs-string">$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="hljs-string">ENV</span> <span class="hljs-string">CATALINA_HOME</span> <span class="hljs-string">/usr/local/apache-tomcat-9.0.8</span><br><span class="hljs-string">ENV</span> <span class="hljs-string">CATALINA_BASE</span> <span class="hljs-string">/usr/local/apache-tomcat-9.0.8</span><br><span class="hljs-string">EXPOSED</span> <span class="hljs-number">8080</span><br><span class="hljs-comment"># ENTRYPOINT [&quot;/usr/local/apache-tomcat-9.0.8/bin/startup.sh&quot;]</span><br><span class="hljs-comment"># CMD [&quot;/usr/local/apache-tomcat-9.0.8/bin/catalina.sh&quot;,&quot;run&quot;]</span><br><span class="hljs-string">CMD</span> <span class="hljs-string">/usr/local/apache-tomcat-9.0.8/bin/startup.sh</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">tail</span> <span class="hljs-string">-F</span> <span class="hljs-string">/usr/local/apache-tomcat-9.0.8/bin/log/catalina.out</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>dockerfile</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker基础</title>
    <link href="/posts/5ae6092.html"/>
    <url>/posts/5ae6092.html</url>
    
    <content type="html"><![CDATA[<p>2019-07-16-Docker <span id="more"></span></p><h2 id="docker">docker</h2><img src="/posts/5ae6092/docker-logo.jpg" class="" title="[docker-logo]"><h3 id="什么是docker">什么是docker?</h3><blockquote><p><strong>Docker</strong>是一个<strong>开源</strong>的应用<strong>容器引擎</strong>，基于Go，Docker使用客户端-服务器 (C/S)架构模式，使用远程API来管理和创建Docker容器。Docker 容器通过 Docker镜像来创建。</p></blockquote><blockquote><p>容器是解决从一个计算环境移动到另一个计算环境时如何使软件可靠运行的问题的解决方案。这可以是从开发人员的笔记本电脑到测试环境，从临时环境到生产，从数据中心的物理机器到私有云或公共云中的虚拟机。<br />一个容器包含了完整的运行时环境：一个应用、这个应用所需的全部依赖、类库、其他二进制文件、配置文件，它们统一被打入了一个包中。通过将应用平台和其依赖容器化，操作系统发行版本和其他基础环境造成的差异，都被抽象掉了。</p></blockquote><h3 id="虚拟化和容器有什么不同">虚拟化和容器有什么不同？</h3><blockquote><p>传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。</p></blockquote><img src="/posts/5ae6092/Container.jpg" class="" title="[Container]"><h2 id="docker三个基本概念">docker三个基本概念：</h2><ul><li>镜像(image)：镜像采用<strong>分层存储UFS</strong>，并不是传统的ISO打包，实际上是由多层文件系统联合组成。镜像构建时，会一层层构建，前一层是后一层的基础。每一层构建完就不会再发生改变后一层上的任何改变只发生在自己这一层。因此每一层尽量只包含该层需要添加的东西，任何额外的东西应该在该层构建结束前清理掉。</li><li>容器(container)：镜像（ Image ）和容器（ Container）的关系，就像是面向对象程序设计中的 <strong>类 和实例</strong>一样，镜像是静态的定义，容器是镜像运行时的实体。<strong>容器可以被创建、启动、停止、删除、暂停等</strong>。<strong>容器的实质是进程</strong>，但与直接在宿主执行的进程不同，<strong>容器进程</strong>运行于属于自己的独立的<strong>命名空间</strong>。<br /></li><li>仓库(repository)：Docker仓库用来保存镜像，可以理解为代码控制中的代码仓库。分为公开与私有。<br /><img src="/posts/5ae6092/dockerStr.jpg" class="" title="[dockerStr]"><br /><img src="/posts/5ae6092/docker-command.jpg" class="" title="[docker-command]"></li></ul><h3 id="docker-的安装">docker 的安装</h3><p><strong><ahref="https://docs.docker.com/">docker官方文档</a></strong> +安装前卸载旧版本(centos7): <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">uname</span> -r<br>$ yum update<br>$ yum remove docker \<br>  docker-client \<br>  docker-client-latest \<br>  docker-common \<br>  docker-latest \<br>  docker-latest-logrotate \<br>  docker-logrotate \<br>  docker-engine<br></code></pre></td></tr></table></figure></p><ul><li><p>安装: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"> $ yum install -y yum-utils \<br>  device-mapper-persistent-data \<br>  lvm2<br> <span class="hljs-comment"># 官方软件源</span><br> $ yum-config-manager --add-repo \ <br>https://download.docker.com/linux/centos/docker-ce.repo<br> <br> <span class="hljs-comment"># 国内阿里软件源</span><br> $ yum-config-manager --add-repo \<br>http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br> <br> $ yum makecache fast<br> $ yum list docker-ce --showduplicates |<span class="hljs-built_in">sort</span> -r<span class="hljs-comment"># 查看所有版本</span><br> $ yum -y install docker-ce<br> $ systemctl start docker<br> $ systemctl <span class="hljs-built_in">enable</span> docker<br> $ docker info// docker version<br> $ docker run hello-world<br></code></pre></td></tr></table></figure></p></li><li><p>安装前卸载旧版本(Ubuntu 18.04): <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">uname</span> -r<br>$ apt-get update<br>$ apt-get remove docker docker-engine docker.io<br></code></pre></td></tr></table></figure></p></li><li><p>安装: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ apt-get install \<br> apt-transport-https \<br> ca-certificates \<br> software-properties-common \<br> curl<br>// 官方证书及软件源<br>$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | <span class="hljs-built_in">sudo</span> apt-key add -<br>$ apt-key fingerprint 0EBFCD88// 验证密钥<br>$ add-apt-repository \<br> <span class="hljs-string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span><br><span class="hljs-string"> <span class="hljs-subst">$(lsb_release -cs)</span> \</span><br><span class="hljs-string"> stable&quot;</span><br> <br><span class="hljs-comment"># 国内证书及软件源(速度比较快)</span><br>$ curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | <span class="hljs-built_in">sudo</span> apt-key add -<br>$ apt-key fingerprint 0EBFCD88<br>$ add-apt-repository \<br> <span class="hljs-string">&quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu \</span><br><span class="hljs-string"> <span class="hljs-subst">$(lsb_release -cs)</span> \</span><br><span class="hljs-string"> stable&quot;</span><br> <br>$ apt-get update <br>$ apt-cache madison docker-ce <span class="hljs-comment"># 查找docker版本</span><br>$ apt-get install docker-ce <br><br>$ systemctl start docker<br>$ systemctl <span class="hljs-built_in">enable</span> docker<br>$ docker info<span class="hljs-comment"># docker version</span><br>$ docker run hello-world<br></code></pre></td></tr></table></figure></p></li><li><p>镜像加速(/etc/docker/daemon.json): <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;registry-mirrors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;https://registry.docker-cn.com&quot;</span><br>        <span class="hljs-string">&quot;https://my5f0mvy.mirror.aliyuncs.com&quot;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br>$ systemctl restart docker<br></code></pre></td></tr></table></figure></p></li></ul><h3 id="docker-的使用docker-help">docker 的使用(docker –help)：</h3><h4 id="management-commands">Management Commands</h4><table><thead><tr><th style="text-align: left;">命令</th><th>描述</th></tr></thead><tbody><tr><td style="text-align: left;">container</td><td>Manage containers</td></tr><tr><td style="text-align: left;">image</td><td>Manage images</td></tr><tr><td style="text-align: left;">volume</td><td>Manage volumes</td></tr><tr><td style="text-align: left;">network</td><td>Manage networks</td></tr><tr><td style="text-align: left;">builder</td><td>Manage builds</td></tr><tr><td style="text-align: left;">config</td><td>Manage Docker configs</td></tr><tr><td style="text-align: left;">engine</td><td>Manage the docker engine</td></tr><tr><td style="text-align: left;">node</td><td>Manage Swarm nodes</td></tr><tr><td style="text-align: left;">plugin</td><td>Manage plugins</td></tr><tr><td style="text-align: left;">secret</td><td>Manage Docker secrets</td></tr><tr><td style="text-align: left;">service</td><td>Manage services</td></tr><tr><td style="text-align: left;">stack</td><td>Manage Docker stacks</td></tr><tr><td style="text-align: left;">swarm</td><td>Manage Swarm</td></tr><tr><td style="text-align: left;">system</td><td>Manage Docker</td></tr><tr><td style="text-align: left;">trust</td><td>Manage trust on Docker images</td></tr></tbody></table><h4 id="镜像管理docker-image">镜像管理(docker image):</h4><table><thead><tr><th style="text-align: left;">命令</th><th>描述</th></tr></thead><tbody><tr><td style="text-align: left;">build</td><td>构建镜像来自DockerFile</td></tr><tr><td style="text-align: left;">push</td><td>推送镜像到仓库</td></tr><tr><td style="text-align: left;">pull</td><td>拉取镜像至本地</td></tr><tr><td style="text-align: left;">ls</td><td>列出镜像</td></tr><tr><td style="text-align: left;">history</td><td>查看镜像历史</td></tr><tr><td style="text-align: left;">inspect</td><td>显示一个或多个镜像信息</td></tr><tr><td style="text-align: left;">rm</td><td>删除镜像</td></tr><tr><td style="text-align: left;">prune</td><td>删除虚悬镜像</td></tr><tr><td style="text-align: left;">tag</td><td>创建一个引用源镜像标记目标镜像</td></tr><tr><td style="text-align: left;">export</td><td>导出容器文件系统到tar归档文件</td></tr><tr><td style="text-align: left;">import</td><td>导入容器文件系统tar创建镜像</td></tr><tr><td style="text-align: left;">save</td><td>保存镜像</td></tr><tr><td style="text-align: left;">load</td><td>加载镜像来自tar归档文件或标准输入</td></tr></tbody></table><h5 id="docker-image-pull"><code>$ docker image pull</code></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker image pull ubuntu:16.04      <span class="hljs-comment"># 获取镜像</span><br>  16.04: Pulling from library/ubuntu<br>  bf5d46315322: Pull complete <br>  9f13e0ac480c: Pull complete<br>  e8988b5b3097: Pull complete<br>  40af181810e7: Pull complete<br>  e6f7c7e5c03e: Pull complete<br>  Digest:<br>  sha256:147913621d9cdea08853f6ba9116c2e27a3ceffecf3b492983ae97c3d643fbbe<br>  Status: Downloaded newer image <span class="hljs-keyword">for</span> ubuntu:16.04 <br></code></pre></td></tr></table></figure><h5 id="docker-image-ls"><code>$ docker image ls</code></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">REPOSITORY      TAG     IMAGE ID        CREATED     SIZE<br>redis           latest  5f515359c7f8    5 days ago  183 MB<br>nginx           latest  05a60462f8ba    5 days ago  181 MB<br>&lt;none&gt;          &lt;none&gt;  00285df0df87    5 days ago  342 MB <span class="hljs-comment"># 虚悬镜像</span><br><br>$ docker image inspect nginx:1.12      <span class="hljs-comment"># 查看镜像信息</span><br>$ docker image <span class="hljs-built_in">rm</span> nginx:1.12<br>$ docker image <span class="hljs-built_in">ls</span> -f dangling=<span class="hljs-literal">true</span>     <span class="hljs-comment"># 查询虚悬镜像(filter)</span><br>$ docker image prune                   <span class="hljs-comment"># 删除虚悬镜像</span><br>$ docker image <span class="hljs-built_in">export</span> ID &gt; ID.tar      <span class="hljs-comment"># 导出容器</span><br></code></pre></td></tr></table></figure><h4 id="容器管理docker-container">容器管理(docker container)</h4><table><thead><tr><th style="text-align: left;">命令</th><th>描述</th></tr></thead><tbody><tr><td style="text-align: left;">create</td><td>Create a new container</td></tr><tr><td style="text-align: left;">run</td><td>运行命令在容器中</td></tr><tr><td style="text-align: left;">exec</td><td>运行命令在容器中</td></tr><tr><td style="text-align: left;">ls</td><td>列出容器</td></tr><tr><td style="text-align: left;">inspect</td><td>显示容器信息</td></tr><tr><td style="text-align: left;">attach</td><td>将本地标准输入、输出和错误流附加到正在运行的容器</td></tr><tr><td style="text-align: left;">commit</td><td>据容器创建镜像</td></tr><tr><td style="text-align: left;">cp</td><td>拷贝文件到容器</td></tr><tr><td style="text-align: left;">logs</td><td>容器日志</td></tr><tr><td style="text-align: left;">port</td><td>列出/指定容器端口映射</td></tr><tr><td style="text-align: left;">stats</td><td>显示容器资源使用统计</td></tr><tr><td style="text-align: left;">top</td><td>显示容器运行进程</td></tr><tr><td style="text-align: left;">update</td><td>更新容器</td></tr><tr><td style="text-align: left;">stop/start</td><td>停止/启动容器</td></tr><tr><td style="text-align: left;">rm</td><td>删除容器</td></tr></tbody></table><table><thead><tr><th style="text-align: left;">选项</th><th>描述</th></tr></thead><tbody><tr><td style="text-align: left;"><code>-i</code>, –interractive</td><td>交互式</td></tr><tr><td style="text-align: left;"><code>-t</code>, –tty</td><td>分配伪终端</td></tr><tr><td style="text-align: left;"><code>-d</code>, –detach</td><td>后台运行容器</td></tr><tr><td style="text-align: left;"><code>-p</code>, –public list</td><td>本地端口映射至容器</td></tr><tr><td style="text-align: left;">-P, –publish-all</td><td>随机映射的端口到内部容器开放的网络端口</td></tr><tr><td style="text-align: left;">–net</td><td>网络配置</td></tr><tr><td style="text-align: left;">–mount mount</td><td>挂载宿主机分区至容器</td></tr><tr><td style="text-align: left;"><code>-v</code>, –volume list</td><td>挂载宿主机目录至容器</td></tr><tr><td style="text-align: left;">-a, –attach list</td><td>附加到运行的容器</td></tr><tr><td style="text-align: left;">–dns list</td><td>设置DNS</td></tr><tr><td style="text-align: left;">-e, –env list</td><td>设置环境变量</td></tr><tr><td style="text-align: left;">–env-file list</td><td>从文件读取环境变量</td></tr><tr><td style="text-align: left;">-h, –hostname=string</td><td>主机名</td></tr><tr><td style="text-align: left;">–ip=string</td><td>设置IP</td></tr><tr><td style="text-align: left;">–link list</td><td>添加链接到另一个容器</td></tr><tr><td style="text-align: left;">–restart=string</td><td>重启</td></tr><tr><td style="text-align: left;">–add-host list</td><td>添加其他主机到容器中</td></tr><tr><td style="text-align: left;">–restart=always</td><td>始终会重启容器</td></tr></tbody></table><h5 id="docker-container-run"><code>docker container run</code></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker container run -itd --name Ubuntu \ <br>  ubuntu:16.04 \  <span class="hljs-comment"># 指定容器版本</span><br>  bash  <br>$ root@e7009c6ce357:/# <span class="hljs-built_in">cat</span> /etc/os-release    <br>  NAME=<span class="hljs-string">&quot;Ubuntu&quot;</span><br>  VERSION=<span class="hljs-string">&quot;16.04.4 LTS, Trusty Tahr&quot;</span><br>  ID=ubuntu<br>  ID_LIKE=debian<br>  PRETTY_NAME=<span class="hljs-string">&quot;Ubuntu 16.04.4 LTS&quot;</span><br>  VERSION_ID=<span class="hljs-string">&quot;16.04&quot;</span><br>  HOME_URL=<span class="hljs-string">&quot;http://www.ubuntu.com/&quot;</span><br>  SUPPORT_URL=<span class="hljs-string">&quot;http://help.ubuntu.com/&quot;</span><br>  BUG_REPORT_URL=<span class="hljs-string">&quot;http://bugs.launchpad.net/ubuntu/&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker container start webserver<br>$ docker container <span class="hljs-built_in">exec</span> -it webserver bash<br>  root@ea4664298c21:/# <span class="hljs-built_in">ls</span><br>  bin   dev   etc   home    proc    sys   tmp<br>$ docker container run -itd -p 8080:80 --name nginx01 nginx  <span class="hljs-comment"># 宿主机8080映射到容器80端口</span><br>$ docker logs nginx01      <span class="hljs-comment"># 查看容器日志</span><br>$ docker container ps -l   <span class="hljs-comment"># 查看运行的容器</span><br></code></pre></td></tr></table></figure><h4id="docker将数据卷挂在至容器中三种方法实现">Docker将数据卷挂在至容器中三种方法实现:</h4><table><thead><tr><th style="text-align: left;">命令</th><th style="text-align: left;">说明</th></tr></thead><tbody><tr><td style="text-align: left;">create</td><td style="text-align: left;">创建数据卷</td></tr><tr><td style="text-align: left;">inspect</td><td style="text-align: left;">显示数据卷信息</td></tr><tr><td style="text-align: left;">ls</td><td style="text-align: left;">列出数据卷</td></tr><tr><td style="text-align: left;">prune</td><td style="text-align: left;">删除未归属的数据卷</td></tr><tr><td style="text-align: left;">rm</td><td style="text-align: left;">删除数据卷</td></tr></tbody></table><h5id="管理volumes-docker管理宿主机文件系统的一部分varlibdockervolumes">管理volumes:Docker管理宿主机文件系统的一部分(/var/lib/docker/volumes)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker volume create nginx-vol<br>$ docker volume <span class="hljs-built_in">ls</span><br>$ docker volume inspect nginx-vol<br>$ docker run -d -it --name=nginx-test -p 88:80 -v nginx-vol:/usr/share/nginx/html/nginx<br>$ docker run -d -it --name=nginx-test -p 88:80 --mount src=nginx-vol,dst=/usr/share/nginx/html nginx<br></code></pre></td></tr></table></figure><h5 id="清理数据卷">清理数据卷</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker container stop nginx-test<br>$ docjer container <span class="hljs-built_in">rm</span> nginx-test<br>$ docker <span class="hljs-built_in">rm</span> -f $(docker ps -q -a) <span class="hljs-comment"># 删除所有容器</span><br>$ docker volume <span class="hljs-built_in">rm</span> nginx-vol<br>  <br>$ <span class="hljs-built_in">bind</span> mounts: <span class="hljs-comment"># 存储于宿主机系统的任意位置(必须先创建好挂载数据卷, 否则会报错)</span><br>$ docker run -itd --name=nginx-test --mount <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bind</span>,src=/app/wwwroot,dst=/usr/share/nginx/html nginx<br><br><span class="hljs-comment"># tmpfs: 挂在存储在宿主机系统内存中, 不会写入宿主机的文件系统</span><br>$ docker image prune     <span class="hljs-comment"># 批量清理临时镜像文件</span><br>$ docker container prune<span class="hljs-comment"># 批量清理已经停止的容器</span><br>$ docker run IMAGE <span class="hljs-built_in">env</span>  <span class="hljs-comment"># 查看镜像支持的环境变量</span><br>$ docker <span class="hljs-built_in">kill</span> $(docker ps -q)<span class="hljs-comment"># 停止所有正则运行的容器</span><br>$ docker inspect --format <span class="hljs-string">&#x27;&#123;&#123; .State.pid&#125;&#125; &lt;CONTAINER ID or NAME&gt;&#x27;</span><span class="hljs-comment"># PID </span><br>$ docker inspect --format <span class="hljs-string">&#x27;&#123;&#123; .Networkings.IPAddress&#125;&#125; &lt;CONTAINER ID or NAME&gt;&#x27;</span><span class="hljs-comment"># IP</span><br></code></pre></td></tr></table></figure><h3 id="镜像构建docker-builder">镜像构建(docker builder)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker build -t image:1.0 -f /root/Dockerfile  <span class="hljs-comment"># tag  </span><br>docker tag mysql:5.6 myregistry/mysql:version  <br></code></pre></td></tr></table></figure><h3 id="搭建lnmp网站平台">搭建LNMP网站平台</h3><ul><li><p>自定义网络 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker network create lnmp<br></code></pre></td></tr></table></figure></p></li><li><p>创建Mysql数据库容器 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker run -it \<br>  --name lnmp_mysql \<br>  --net lnmp \<br>  -p 3306:3306 \<br>  --mount src=mysql-vol,dst=/var/lib/mysql \<br>  -e MYSQL_ROOT_PASSWORD=YourPassword \<br>  -d mysql:5.7<br></code></pre></td></tr></table></figure></p></li><li><p>创建数据库 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker <span class="hljs-built_in">exec</span> lnmp_mysql sh \<br>  -c <span class="hljs-string">&#x27;exec mysql -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot; -e &quot;create database wordpress&quot;&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p>创建PHP环境 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker run -it \<br>  --name lnmp_web \<br>  --net lnmp \<br>  -p 8088:80 \<br>  --mount <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bind</span>,src=/<span class="hljs-variable">$PWD</span>/app/wwwroot, dst=/var/www/html \<br>  -d richarvey/nginx-php-fpm<br></code></pre></td></tr></table></figure></p></li><li><p>用WordPress博客做测试 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wget https://cn.wordpress.org/wordpress-4.7.4-zh_CN.tar.gz<br>$ <span class="hljs-built_in">mkdir</span> -p ./app/wwwroot<br>$ tar -xzvf wordpress-4.7.4-zh_CN.tar.gz -C /app/wwwroot/<br>http://IP:88/wordpress<br></code></pre></td></tr></table></figure></p></li></ul><h3 id="搭建私有镜像仓库">搭建私有镜像仓库:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker pull registry<br>$ docker run -d -v /opt/registry:/var/lib/registry -p 5000:5000 --restart=always --name registry registry<br><br>$ curl http://IP:5000/v2/_catalog<span class="hljs-comment"># 客户端</span><br>$ vim /etc/docker/daemon.json<br>&#123;<br><span class="hljs-string">&quot;registry-mirrors&quot;</span>:[<span class="hljs-string">&quot;https://registry.docker-cn.com&quot;</span>],<br><span class="hljs-string">&quot;insecure-repository&quot;</span>:[<span class="hljs-string">&quot;IP:5000&quot;</span>]<br>&#125;<br>$ docker tag centos:6 IP:5000/centos:6<span class="hljs-comment"># 客户端</span><br>$ docker push IP:5000/centos:6<br>$ docker pull IP:5000/centos:6<br></code></pre></td></tr></table></figure><h3 id="docker-hub-公共镜像仓库">Docker Hub 公共镜像仓库:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker login<br>$ docker tag image username/repository:tag<br>$ docker push username/repository:tag<br></code></pre></td></tr></table></figure><h3 id="企业级docker镜像仓库">企业级Docker镜像仓库:</h3><blockquote><p>Harbor是VMware开源的企业级Dockers Registry项目, <ahref="https://github.com/vmware/harbor">项目地址</a>, 创建自签名证书,<code>yum install openssl</code>,路径<code>/etc/pki/tls/certs/Makefile</code>利用make命令生成自签名证书</p></blockquote><ul><li><p>安装Docker</p></li><li><p><ahref="https://docs.docker.com/install/linux/docker-ce/centos/">Docker安装</a></p></li><li><p>安装docker-compose</p></li><li><p><ahref="https://docs.docker.com/compose/install/">Docker-compose安装</a></p></li><li><p>自签TLS证书</p><ul><li><ahref="https://github.com/goharbor/harbor/blob/master/docs/configure_https.md">证书生成</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">openssl req -newkey rsa:4096 -nodes -sha256 -keyout ca.key -x509 -days 365 -out ca.crt  <span class="hljs-comment"># 生成证书  </span><br>openssl req -newkey rsa:4096 -nodes -sha256 -keyout yourdomain.com.key -out yourdomain.com.csr<span class="hljs-string">&quot;  # 生成证书请求</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>Harbor安装与配置</p><ul><li><ahref="https://github.com/goharbor/harbor/releases">Harbor离线包地址</a></li><li>配置文件<code>vim harbor.cfg</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">hostname = IP或者yourdomain.com<br>ui_url_protocol = https/http<br>harbor_admin_password = Harboe123456 <span class="hljs-comment"># 默认密码</span><br>ssl_cert = /data/cert/server.crt<br>ssl_cert = /data/cert/server.key<br></code></pre></td></tr></table></figure></li><li><code>./prepare &amp;&amp; ./install.sh</code> #安装ving启动Harbor</li><li><code>docker-compose ps</code> # 查看运行状态, /var/log/harbor</li></ul></li><li><p>Docker主机访问Harbor</p></li></ul><h3 id="docker-三剑客">Docker 三剑客</h3><h4 id="docker-compose">docker-compose:</h4><blockquote><p>Docker Compose可以轻松、高效的<code>管理容器</code>，它是一个用于<code>定义和运行多容器</code>Docker 的应用程序工具</p></blockquote><ul><li>安装: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl -L <span class="hljs-string">&quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="hljs-subst">$(uname -s)</span>-<span class="hljs-subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose<br>$ <span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose<br>$ <span class="hljs-built_in">ln</span> -s /usr/local/bin/docker-compose /usr/bin/docker-compose<br>$ docker-compose -v<br><br>$ curl -L https://raw.githubusercontent.com/docker/compose/1.8.0/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose<span class="hljs-comment"># bash 补全</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="使用django">使用Django:</h5><ul><li><p>使用<strong>Docker Compose</strong>配置运行<strong>Django/PostgreSQL</strong>应用<br /></p></li><li><p>应用运行在Docker容器里,通过Dockerfile文件指定Docker容器要安装内容(<strong>构建镜像</strong>)<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-string">FROM</span> <span class="hljs-string">python:3</span><br><span class="hljs-string">ENV</span> <span class="hljs-string">PYTHONUNBUFFERD</span> <span class="hljs-number">1</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">mkdir</span> <span class="hljs-string">/code</span><br><span class="hljs-string">WORKDIR</span> <span class="hljs-string">/code</span><br><span class="hljs-string">ADD</span> <span class="hljs-string">requirements.txt</span> <span class="hljs-string">/code/</span><br><span class="hljs-string">RUN</span>  <span class="hljs-string">pip</span> <span class="hljs-string">install</span> <span class="hljs-string">-r</span> <span class="hljs-string">requirements.txt</span><br><span class="hljs-string">ADD</span> <span class="hljs-string">.</span> <span class="hljs-string">/code/</span><br></code></pre></td></tr></table></figure></p></li><li><p>requirements.txt 指明依赖包: <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Django</span>&gt;=<span class="hljs-number">1</span>.<span class="hljs-number">8</span>,&lt;<span class="hljs-number">2</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">psycopg2</span><br></code></pre></td></tr></table></figure></p></li><li><p>docker-compose.yml文件将所有相关文件关联:<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br> <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">python3</span> <span class="hljs-string">manage.py</span> <span class="hljs-string">runserver</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">:8000</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">.:/code</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8000:8000&quot;</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span><br></code></pre></td></tr></table></figure></p></li><li><p><code>$ docker-compose run web django-admin.py startproject django_example .</code></p><ul><li>替换django_example/settings.py的节点信息: <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json">DATABASES = <span class="hljs-punctuation">&#123;</span><br>  &#x27;default&#x27;<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>    <br>  &#x27;ENGINE&#x27;<span class="hljs-punctuation">:</span>     &#x27;django.db.backends.postgresql&#x27;<span class="hljs-punctuation">,</span>  <br>  &#x27;NAME&#x27;<span class="hljs-punctuation">:</span> &#x27;postgres&#x27;<span class="hljs-punctuation">,</span>  <br>  &#x27;USER&#x27;<span class="hljs-punctuation">:</span> &#x27;postgres&#x27;<span class="hljs-punctuation">,</span>  <br>  &#x27;HOST&#x27;<span class="hljs-punctuation">:</span> &#x27;db&#x27;<span class="hljs-punctuation">,</span>  <br>  &#x27;PORT&#x27;<span class="hljs-punctuation">:</span> <span class="hljs-number">5432</span><span class="hljs-punctuation">,</span>  <br>  <span class="hljs-punctuation">&#125;</span>  <br><span class="hljs-punctuation">&#125;</span><br>$ docker-compose up<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">  <br></code></pre></td></tr></table></figure></li></ul></li></ul><h5 id="构建wordpress">构建WordPress:</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db_data:/var/lib/mysql</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">somewordpress</span><br>      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">wordpress</span><br>      <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">wordpress</span><br>      <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">wordpress</span><br>  <span class="hljs-attr">wordpress:</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">wordpress:latest</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8000:80&quot;</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">WORDPRESS_DB_HOST:</span> <span class="hljs-string">db:3306</span><br>      <span class="hljs-attr">WORDPRESS_DB_USER:</span> <span class="hljs-string">wordpress</span><br>      <span class="hljs-attr">WORDPRESS_DB_PASSWORD:</span> <span class="hljs-string">wordpress</span><br>  <span class="hljs-attr">volumes:</span><br>    <span class="hljs-attr">db_data:</span><br></code></pre></td></tr></table></figure><h4 id="构建elk">构建ELK</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;2.2&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">cerebro:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">lmenezes/cerebro:0.8.3</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">cerebro</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9000:9000&quot;</span><br>    <span class="hljs-attr">command:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">-Dhosts.0.host=http://elasticsearch:9200</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">es7net</span><br>  <span class="hljs-attr">kibana:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">kibana:7.8.0</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">kibana7</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">I18N_LOCALE=zh-CN</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">XPACK_GRAPH_ENABLED=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">TIMELION_ENABLED=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">XPACK_MONITORING_COLLECTION_ENABLED=&quot;true&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;5601:5601&quot;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">es7net</span><br>  <span class="hljs-attr">elasticsearch:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">elasticsearch:7.8.0</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">es7_01</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">cluster.name=geektime</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">node.name=es7_01</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">bootstrap.memory_lock=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">discovery.seed_hosts=es7_01,es7_02</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">cluster.initial_master_nodes=es7_0,es7_02</span><br>    <span class="hljs-attr">ulimits:</span><br>      <span class="hljs-attr">memlock:</span><br>        <span class="hljs-attr">soft:</span> <span class="hljs-number">-1</span><br>        <span class="hljs-attr">hard:</span> <span class="hljs-number">-1</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">es7data1:/usr/share/elasticsearch/data</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">9200</span><span class="hljs-string">:9200</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">es7net</span><br>  <span class="hljs-attr">elasticsearch2:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">elasticsearch:7.8.0</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">es7_02</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">cluster.name=geektime</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">node.name=es7_02</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">bootstrap.memory_lock=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">discovery.seed_hosts=es7_01,es7_02</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">cluster.initial_master_nodes=es7_01,es7_02</span><br>    <span class="hljs-attr">ulimits:</span><br>      <span class="hljs-attr">memlock:</span><br>        <span class="hljs-attr">soft:</span> <span class="hljs-number">-1</span><br>        <span class="hljs-attr">hard:</span> <span class="hljs-number">-1</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">es7data2:/usr/share/elasticsearch/data</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">es7net</span><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">es7data1:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span><br>  <span class="hljs-attr">es7data2:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">es7net:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span><br></code></pre></td></tr></table></figure><h4 id="docker-machine">Docker Machine</h4><blockquote><p>负责在多种平台上快速安负责在多种平台上快速安装Docker环境,驱动类型(<code>virtualbox--linux/Win</code>, <code>xhyve--MacOS</code>,<code>hyperv--Win</code>) Win安装Docker for Windows后,<strong>不能安装virtualbox</strong>, 选择 hyperv + 安装:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> curl -L https://github.com/docker/machine/releases/download/v0.13.0/docker-machine-`<span class="hljs-built_in">uname</span> -s`-`<span class="hljs-built_in">uname</span> -m` &gt; /usr/local/bin/docker-machine<br>$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-machine<br>$ docker-machine -v<br></code></pre></td></tr></table></figure></p></blockquote><ul><li>使用: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker-machine create -d virtualbox <span class="hljs-built_in">test</span> \  <span class="hljs-comment"># 创建test Docker主机 -d --driver</span><br>  --engine-opt dns=114.114.114.114 \  <br>  --engine-registry-mirror https://registry.docker-cn.com \<br>  --virtualbox-memory 2048 \<br>  --virtualbox-cpu-count 2<br>$ docker-machine <span class="hljs-built_in">ls</span><br>$ docker-machine <span class="hljs-built_in">env</span> <span class="hljs-built_in">test</span>   <span class="hljs-comment"># env 命令来让后续操作对象都是目标主机</span><br>$ docker-machine ssh <span class="hljs-built_in">test</span>   <span class="hljs-comment"># 登录到主机</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="docker-swarm">Docker Swarm:</h4><blockquote><p>提供 Docker 容器集群服务，是 Docker官方对容器云生态进行支持的核心方案, 用户可以将多个 Docker主机封装为单个大型的虚拟 Docker 主机，快速打造一套容器云平台<br />Docker 1.12 Swarm mode 已经内嵌入 Docker 引擎, 成为了 docker 子命令<code>docker swarm</code> Swarm 是使用 SwarmKit 构建的 Docker引擎内置（原生）的集群管理和编排工具.</p></blockquote><ul><li>节点:<ul><li>manager 节点: 用于 Swarm 集群的管理,<code>docker swarn</code>作用仅限于管理节点执行,Swarm集群可以有多个管理节点, 但仅只能有一个leader管理节点;</li><li>worker 节点: 是任务执行节点, 管理节点将服务 ( service )下发至工作节点执行;<br /><img src="/posts/5ae6092/docker-swarm.jpg" class="" title="[docker-swarm]"></li><li>服务(Services): 指一组任务的集合，服务定义了任务的属性<ul><li><code>replicated services</code>:按照一定规则在各个工作节点上运行指定个数的任务</li><li><code>global services</code>: 每个工作节点上运行一个任务</li></ul></li><li>任务(Task): Swarm中的最小的调度单位，目前来说就是一个单一的容器</li></ul><img src="/posts/5ae6092/docker-service.jpg" class="" title="[docker-service]"></li><li>创建<strong>Swarm集群</strong><ul><li><p>初始化Swarm集群(管理节点): <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker swarm init --advertise-addr IP   <span class="hljs-comment"># --advertise-addr 指定IP</span><br>Swarm initialized: current node (dxn1zf6l61qsb1josjja83ngz) is now a manager.<br><br>To add a worker to this swarm, run the following <span class="hljs-built_in">command</span>:<br>docker swarm <span class="hljs-built_in">join</span> --token \ SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \ 192.168.99.100:2377<br>To add a manager to this swarm, run <span class="hljs-string">&#x27;docker swarm join-token manager&#x27;</span> and follow the instructions.<br></code></pre></td></tr></table></figure></p></li><li><p>增加工作节点: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker-machine create -d virtualbox worker1<br>$ docker-machine ssh worker1<br>docker@worker1:~$ docker swarm <span class="hljs-built_in">join</span> --token\ SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \ 192.168.99.100:2377<br><br>This node joined a swarm as a worker.<br><br>$ docker-machine create -d virtualbox worker2<br>$ docker-machine ssh worker2<br>docker@worker1:~$ docker swarm <span class="hljs-built_in">join</span> --token\ SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \ 192.168.99.100:2377<br><br>This node joined a swarm as a worker.<br><br>$ docker node <span class="hljs-built_in">ls</span>  <span class="hljs-comment"># 查看集群</span><br>ID                        HOSTNAME  STATUS    AVAILABILITY  MANAGER   STATUS<br>03g1y59jwfg7cf99w4lt0f662 worker2   Ready     Active<br>9j68exjopxe7wfl6yuxml7a7j worker1   Ready     Active<br>dxn1zf6l61qsb1josjja83ngz *         manager1  Ready         Active    Leader<br></code></pre></td></tr></table></figure></p></li></ul></li><li>部署服务(<code>docker service</code>): <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker service create --replicas 3 -p 80:80 --name nginx nginx:1.13.7-alpine  <br>$ docker service <span class="hljs-built_in">ls</span>     <br>$ docker service ps           <span class="hljs-comment"># 查看某个服务的详情  </span><br>$ docker service logs nginx   <span class="hljs-comment"># 查看某个服务的日志</span><br>$ docker service <span class="hljs-built_in">rm</span> nginx<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>容器</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git命令总结及问题解决</title>
    <link href="/posts/4bf6bbf0.html"/>
    <url>/posts/4bf6bbf0.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-15-Git <span id="more"></span></p><h3 id="前言">前言</h3><ul><li><p>关于<code>/etc/profile 、 /etc/bashrc 与 ~/.bashrc、~/.bash_profile</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/profile <span class="hljs-comment"># 用于系统变量</span><br><span class="hljs-comment"># 该文件为系统的每个用户设置环境变量信息, 当用户第一次登录时, 该文件被执行, 并从/etc/profile.d目录的配置文件中搜集shell的设置</span><br></code></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/bashrc  <span class="hljs-comment"># 用于保存bash信息</span><br><span class="hljs-comment"># 为每个运行bash shell的用户执行此文件, 当bash shell 被打开, 该文件被读取</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">~/.bashrc<br><span class="hljs-comment"># 该文件包含专用于你的bash shell 的bash信息, 当登录时以及每次打开新的shell时, 该文件被读取</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">~/.bash_profile<br><span class="hljs-comment"># 每个用户都可使用该文件输入专用于自己使用的shell信息, 当用户登录时, 该文件仅仅执行一次, 默认情况下, 设置一些环境变量, 执行用户的.bashrc文件</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="git-简介">Git 简介</h3><h4 id="git的历史">1.1 Git的历史：</h4><ul><li><p><strong>Linus torvalds</strong>在1991年时发布了Linux操作系统，从那以后Linux系统便不断发展壮大，但因为不断有无数的开源爱好者提供源码，而Linustorvalds每次都是手动合入相关代码。一直到2002年，Linux系统经过十余年的不断发展，代码库已经庞大到无法再通过手工的方式管理了，但是Linus真的很不喜欢类似于<strong>CVS或者Subversion</strong>的一些版本控制系统，于是商业公司BitMover决定将其公司的BitKeeper分布式版本控制系统授权给Linux开发社区来免费使用，当时的BitKeeper可以比较文件内容的不同，还能够将出错的文档还原到历史某个状态，Linus终于放下了心里的石头。就这样平静的度过了三年时间，但是Linux社区聚集着太多的黑客人物，2005年时，那位曾经开发<strong>Samba服务程序的Andrew</strong>因为试图破解BitKeeper软件协议而激怒了BitMover公司，当即决定不再向Linux社区提供免费的软件授权了，此时的Linus其实也早已有自己编写分布式版本控制系统的打算了，于是便用C语言创建了Git分布式版本控制系统，并上传了Linux系统的源代码。</p></li><li><p><strong>CVS/SVN</strong>：集中式的版本控制系统 –版本库是集中存放在中央服务器，工作时用的都是自己的电脑，所以要先从中央服务器取得最新的版本，然后开始干活，干完活了，再把自己的活推送给中央服务器。中央服务器就好比是一个图书馆，你要改一本书，必须先从图书馆借出来，然后回到家自己改，改完了，再放回图书馆。集中式版本控制系统最大的毛病就是必须联网才能工作;</p></li></ul><img src="/posts/4bf6bbf0/%E9%9B%86%E4%B8%AD%E5%BC%8F.jpg" class="" title="[集中式版本控制系统]"><ul><li><strong>Git</strong>：分布式的版本控制系统 –布式版本控制系统根本没有“中央服务器”，每个人的电脑上都是一个完整的版本库，工作时不需要联网。</li></ul><h3 id="git的原理">Git的原理：</h3><ul><li><p>本地工作目录：在工作目录中修改数据文件。<br /></p></li><li><p>暂存区域(stage/index)：将文件的快照放入暂存区域,一般存放在<code>.git</code>目录下的<code>index</code>(.git/index)文件中<br /></p></li><li><p>Git数据库：将暂存区域的文件快照提交到Git仓库中。<br /><img src="/posts/4bf6bbf0/Git%E7%9A%84%E4%B8%89%E7%A7%8D%E5%B7%A5%E4%BD%9C%E7%8A%B6%E6%80%81.jpg" class="" title="[Git的工作原理图示]"></p></li><li><p>文件上传至Git暂存区<br /><img src="/posts/4bf6bbf0/%E5%B0%86%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%B0Git%E6%9A%82%E5%AD%98%E5%8C%BA.jpg" class="" title="[文件上传至Git暂存区]"></p></li><li><p>文件上传至Git版本仓库<br /><img src="/posts/4bf6bbf0/%E5%B0%86%E6%96%87%E4%BB%B6%E6%8F%90%E4%BA%A4%E5%88%B0Git%E7%89%88%E6%9C%AC%E4%BB%93%E5%BA%93.jpg" class="" title="[文件上传至Git版本仓库]"></p></li></ul><h3 id="git-基本使用操作">Git 基本使用操作</h3><h4 id="git-的安装与配置命令">Git 的安装与配置命令：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># git config 命令：</span><br>git config --global user.name <span class="hljs-string">&quot;Your Name&quot;</span><br>git config --global user.email <span class="hljs-string">&quot;email@example.com&quot;</span><br>git config --global core.editor vim<br>git config -e [--global]<br>git config --list<br></code></pre></td></tr></table></figure><h4 id="git-初始化仓库命令">Git 初始化仓库命令：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 首先建立本地版本库并初始化本地版本库：</span><br><span class="hljs-built_in">mkdir</span> anyue<br><span class="hljs-built_in">cd</span> anyue<br>git init [project-name]<br>git <span class="hljs-built_in">clone</span> [url]    <span class="hljs-comment"># 支持ssh、https、git 协议</span><br></code></pre></td></tr></table></figure><h4 id="git-代码提交命令">Git 代码提交命令：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> readme.txt<br>git add redame.txt        <span class="hljs-comment"># 将该文件添加到暂存区，每次修改都要进行文件的add</span><br>git add .                 <span class="hljs-comment"># . 代表全部文件</span><br>git commit -m <span class="hljs-string">&quot;add readme.txt&quot;</span><span class="hljs-comment"># 将暂存区的文件提交到Git版本仓库</span><br></code></pre></td></tr></table></figure><h4 id="git-查看信息命令">Git 查看信息命令：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">git status   <span class="hljs-comment"># 显示变更的文件</span><br><br>git <span class="hljs-built_in">log</span>  <span class="hljs-comment"># 显示当前分支的版本历史</span><br>git <span class="hljs-built_in">log</span> --<span class="hljs-built_in">stat</span>    <span class="hljs-comment"># 显示commit历史, 以及每次commit发生变更的文件</span><br>git <span class="hljs-built_in">log</span> -5 --pretty=oneline   <span class="hljs-comment"># --pretty=format:%s </span><br><br>git diff readme.txt   <span class="hljs-comment"># 查看difference，显示的格式正是Unix通用的diff格式</span><br>  <br>git reflog   <span class="hljs-comment"># 查看所有的历史记录，可以回退到未来</span><br> <br>git reset --hard HEAD^  <span class="hljs-comment"># 回退到上一次提交版本</span><br>git reset --hard 1094a <span class="hljs-comment"># 回退到 1049a 为SHA-1值</span><br></code></pre></td></tr></table></figure><h4 id="git-分支命令">Git 分支命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch      <span class="hljs-comment"># 列出所有本地分支 </span><br>git branch -r   <span class="hljs-comment"># 列出远程分支</span><br>git branch -a   <span class="hljs-comment"># 列出所有本地+远程分支</span><br>git branch --set-upstream [branch] [remote-branch]   <span class="hljs-comment"># 建立追踪关系, 在现有分支与指定的远程分支之间</span><br>git branch anyue <span class="hljs-comment"># 创建anyue分支</span><br><br>git checkout anyue<span class="hljs-comment"># 切换anyue分支， </span><br>git checkout -b anyue  <span class="hljs-comment"># 创建并切换</span><br>git checkout -    <span class="hljs-comment"># 切换到上一个分支</span><br><br>git merge [branch]  <span class="hljs-comment"># 合并指定分支到当前分支</span><br></code></pre></td></tr></table></figure><h4 id="git-标签命令">Git 标签命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">git tag  <span class="hljs-comment"># 列出所有标签</span><br>git tag [tagname] [commit]   <span class="hljs-comment"># 新增一个tag在当前commit, 也可指定</span><br>git tag -d [tagname]   <span class="hljs-comment"># delete</span><br>git show [tag]   <span class="hljs-comment"># 查看tag信息</span><br></code></pre></td></tr></table></figure><h4 id="git-远程同步命令">Git 远程同步命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">git fetch origin hexo     <span class="hljs-comment"># 下载远程仓库的所有变动</span><br>git merge FETCH_HEAD<br><br>git remote -v<br>git remote remove [remote-name]<br><br>git remote add [shortname] [url]<br>git remote add origin git@server-name:path/repo-name.git<span class="hljs-comment"># 关联远程仓库</span><br><br>git pull [remote] [branch]   <span class="hljs-comment"># 取回远程仓库的变化，并与本地分支合并</span><br>git push [remote] [branch]<br>git push [remote] --force<br>git push [remote] --all<br><br><span class="hljs-comment"># 关联remote库地址并与本地库同步合并</span><br>git remote add origin https://github.com/githubusername/demo.git<br>git pull --rebase origin master<br><br><span class="hljs-comment"># 推送本地库并查看状态</span><br>git push -u origin master<br>git status<br>git remote -v  <span class="hljs-comment"># 查看远程库地址</span><br><br>git checkout master<br>git merge anyue    <span class="hljs-comment"># 切换到master主分支，并把anyue分支合入到当前分支</span><br><br>git branch -d anyue <span class="hljs-comment"># 删除anyue分支</span><br>git <span class="hljs-built_in">log</span> --graph --pretty=oneline --abbrev-commit <span class="hljs-comment"># 查看分支变化</span><br></code></pre></td></tr></table></figure><h4 id="git-撤销命令">Git 撤销命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout .   <span class="hljs-comment"># 恢复暂存区的所有文件到工作区</span><br>git checkout [file]<br>git checkout [commit] [file]<br><br>git reset --hard  <span class="hljs-comment"># 重置暂存区与工作区, 与上一次commit保持一致</span><br>git reset [file]  <span class="hljs-comment"># 重置暂存区指定文件,与上一次commit保持一致, 但工作区不变</span><br>git reset [commit] <span class="hljs-comment"># 重置当前分支的指针为指定commit, 同时重置暂存区, 但工作区不变  </span><br>git archive<br></code></pre></td></tr></table></figure><h3 id="git-进阶操作平时使用遇到问题总结">Git进阶操作(平时使用遇到问题总结)</h3><h4id="出现failed-to-connect-to-github.com-port-443-timed-out">1、<strong>2019-05-14出现Failed to connect to github.com port 443: Timed out</strong>：</h4><ul><li><p>原因：</p><ul><li>本地Git仓库和GitHub仓库之间的传输是通过SSH加密的，ssh阻塞了22端口，需要配置验证信息;</li></ul></li><li><p>解决问题方法：</p><ul><li><p><code>ssh-keygen -t rsa -C "youremail@example.com"</code>一路回车，生成公钥/私钥于当前用户的.ssh目录；</p></li><li><p>将此目录下的<code>id_rsa.pub</code>里的内容复制到远端的git配置中(ssh)，在.ssh目录中新建<strong>config文件</strong>，将如下复制其中：<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Host github.com  <br>User git  <br>Hostname ssh.github.com <br>PreferredAuthentications publickey  <br>IdentityFile ~/.ssh/id_rsa <br>Port 443<br></code></pre></td></tr></table></figure></p></li><li><p>测试连接是否通畅： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -T git@github.com  或者  ssh -V git@github.com<br>Hi anyue-1993! You<span class="hljs-string">&#x27;ve successfully authenticated, but GitHub does not provide shell access</span><br></code></pre></td></tr></table></figure></p></li></ul></li></ul><h4 id="fork-后所要进行的操作">2、<strong>2019-5-17 fork后所要进行的操作</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/anyue967/docker_practice.git 　<span class="hljs-comment">#clone至本地库</span><br>git remote add upstream 源仓库地址<span class="hljs-comment">#增加源仓库地址，以便为了同步</span><br>git checkout -b newbranch<span class="hljs-comment"># 切换至创建好的新分支，一般不在主分支上进行操作</span><br>  Pull requests New pull request，<br>git pull upstream master<span class="hljs-comment">#同步源仓  </span><br></code></pre></td></tr></table></figure><p><ahref="https://www.cnblogs.com/southday/p/10010876.html">操作参考文档</a></p><h4 id="git-设置别名的操作">3. <strong>2019-5-18 git设置别名的操作</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --global alias.lol <br><span class="hljs-string">&quot;log --graph --decorate --pretty=oneline --all --abbrev-commit&quot;</span> <span class="hljs-comment"># 实现查看项目提交、合并等记录</span><br></code></pre></td></tr></table></figure><h4 id="git-出现-fatal-refusing-to-merge-unrelated-histories-错误">4.<strong>git 出现 fatal: refusing to merge unrelated histories错误</strong></h4><ul><li>原因:<ul><li>其实这个问题是因为 两个 根本不相干的 git 库, 一个是本地库,一个是远端库, 然后本地要去推送到远端, 远端觉得这个本地库跟自己不相干,所以告知无法合并.</li></ul></li><li>解决方法:<ul><li><code>git pull origin master --allow-unrelated-histories</code></li></ul></li></ul><h4 id="已存在的项目如何git">5. <strong>2019-8-14已存在的项目如何git</strong></h4><ul><li><p>到github创建新仓库</p></li><li><p>cd到已存在项目的目录, <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git init<br>git add .<br>git commit -m <span class="hljs-string">&quot;Initial commit&quot;</span><br></code></pre></td></tr></table></figure></p></li><li><p>如下操作: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">git remote add origin Your<span class="hljs-string">&#x27;s Repo  # 若fatal: remote origin already exits</span><br><span class="hljs-string">git remote rm origin</span><br><span class="hljs-string"></span><br><span class="hljs-string">git push -u origin master  # 失败执行</span><br><span class="hljs-string">git pull --rebase origin master  # 执行 push, 若不能pull代码, 执行</span><br><span class="hljs-string">git branch --set-upstream master origin/master</span><br></code></pre></td></tr></table></figure></p></li></ul><h4 id="关于-git-checkout">6. <strong>关于 git checkout</strong></h4><ul><li>作用:<ul><li>切换分支或恢复工作树文件 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch newbranch  <span class="hljs-comment"># 创建</span><br><br>git checkout newbranch   <span class="hljs-comment"># 切换</span><br>git checkout -b newbranch  <span class="hljs-comment"># 综合</span><br><br>$ <span class="hljs-built_in">cat</span> .git/HEAD   <span class="hljs-comment"># HEAD永远指向当前分支名</span><br>ref: refs/heads/hexo<br><br><span class="hljs-comment"># 恢复暂存区的指定文件到工作区</span><br>git checkout [file]<br></code></pre></td></tr></table></figure></li></ul></li></ul><h4 id="关于git-create-mode-100644">7. <strong>关于git create mode100644</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/HikoQiu/kubeadm-install-k8s.git<br><br>git remote -v<br>  origin  https://github.com/HikoQiu/kubeadm-install-k8s.git (fetch)<br>  origin  https://github.com/HikoQiu/kubeadm-install-k8s.git (push)<br>git submodule init<br>git submodule update<br><br>git remote remove origin<br>git remote add  origin https://github.com/anyue967/Linux.git<br>git remote -v<br>  origin  https://github.com/anyue967/Linux.git (fetch)<br>  origin  https://github.com/anyue967/Linux.git (push)<br><br>git remote add upstream https://github.com/HikoQiu/kubeadm-install-k8s<br>git remote -v<br>  origin  https://github.com/anyue967/Linux.git (fetch)<br>  origin  https://github.com/anyue967/Linux.git (push)<br>  upstream  https://github.com/HikoQiu/kubeadm-install-k8s.git (fetch)<br>  upstream  https://github.com/HikoQiu/kubeadm-install-k8s.git (push)<br><br>git add kubeadm-install-k8s/<br>git commit -m <span class="hljs-string">&quot;add kubeadm-install-k8s&quot;</span><br>  [master 7b23b5d] add kubeadm-install-k8s<br>  57 files changed, 5369 insertions(+)<br>  create mode 100644 docker/k8s/kubeadm-install-k8s/README.md<br>  create mode 100644 docker/k8s/kubeadm-install-k8s/applications/Monocular<br>  create mode 100644 docker/k8s/kubeadm-install-k8s/applications/Monocular<br><br>git push<br></code></pre></td></tr></table></figure><h4 id="svn">8. SVN</h4><ul><li>初始化repo: <code>svnadmin create E:\SVN</code></li><li>修改配置文件(conf): <code>E:\SVN\conf</code><ul><li><p><code>svnserve.conf</code>: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">anon-access = <span class="hljs-built_in">read</span> <br>auth-access = write<br>password-db = passwd <br>authz-db = authz<br></code></pre></td></tr></table></figure></p></li><li><p><code>authz</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[/]<br>anyu967 = rw<br><span class="hljs-comment"># [/foo/bar]</span><br>anyu967 =rw<br>* =<br><span class="hljs-comment"># [repository:/baz/fuz]</span><br>* =<br></code></pre></td></tr></table></figure></p></li><li><p><code>passwd</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[<span class="hljs-built_in">users</span>]<br><span class="hljs-comment"># harry = harryssecret</span><br><span class="hljs-comment"># sally = sallyssecret</span><br>anyu967 = 123456<br></code></pre></td></tr></table></figure></p></li></ul></li><li>启动SVN 服务: <code>svnserve -d -r E:/SVN</code></li><li>流程:<code>checkout(初次) update--&gt; lock--&gt; modified--&gt; commit</code></li></ul><h4 id="关于push后文件夹显示灰色">9.<strong>关于push后文件夹显示灰色</strong></h4><ul><li>删除clone后文件的<code>.git</code>,<code>.gitignore</code>,然后重新add-commit-push</li><li><code>git rm -r --cached FILENAME</code></li></ul>]]></content>
    
    
    <categories>
      
      <category>github</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
      <tag>github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于grep、sed和awk的基础用法</title>
    <link href="/posts/a796df41.html"/>
    <url>/posts/a796df41.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-13-grep/sed/awk <span id="more"></span></p><h4id="linux报-usrbin-is-not-included-in-the-path-environment-variable-的解决方法">Linux报“‘/usr/bin’ is not included in the PATH environment variable”的解决方法:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">利用/usr/bin vi 编辑之前改过环境变量:<br>/usr/bin vi ~/.bashrc<br></code></pre></td></tr></table></figure><h4 id="find文件目录的查找">find(文件目录的查找)</h4><blockquote><p>+n(n天以前), -n(n天以内)</p></blockquote><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-name</td><td>根据文件名匹配</td></tr><tr><td>-iname</td><td>忽略大小写</td></tr><tr><td>-regex pattern</td><td>基于正则进行文件名匹配</td></tr><tr><td>-user</td><td>根据属主匹配</td></tr><tr><td>-group</td><td>根据属组匹配</td></tr><tr><td>-uid</td><td>根据UID匹配</td></tr><tr><td>-gid</td><td>根据GID匹配</td></tr><tr><td>-nouser</td><td>匹配没有属主文件</td></tr><tr><td>-nogroup</td><td>匹配没有属组文件</td></tr><tr><td>-type f d c b l p s</td><td>匹配文件类型</td></tr><tr><td>-size k M G</td><td>根据文件大小</td></tr><tr><td>-atime -mtime -ctime</td><td>访问 修改 改变</td></tr><tr><td>-perm -mode /mode</td><td>根据权限匹配</td></tr><tr><td>-print -ls, ls -l</td><td>–</td></tr><tr><td>-exec/-ok command {} ;</td><td>–</td></tr><tr><td>-a -o -not</td><td>逻辑上的与 或 非</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">find /data/ -name <span class="hljs-string">&quot;*.log&quot;</span> -<span class="hljs-built_in">type</span> f -size +10k -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">cp</span> &#123;&#125; /tmp \;   <span class="hljs-comment"># 区分大小写</span><br>find /data/ -iname <span class="hljs-string">&quot;*.log&quot;</span> -<span class="hljs-built_in">type</span> f -size +10k -m perm 644 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> -rf &#123;&#125; \;  <br>find /data/ -name <span class="hljs-string">&quot;*.log&quot;</span> -<span class="hljs-built_in">type</span> f -mtime +30 -size +10M -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">mv</span> &#123;&#125; /tmp/ \; <span class="hljs-comment"># +30 30天以前，-30 30天之内   </span><br>find /data -not \( -user user1 -a -not -<span class="hljs-built_in">type</span> d \)<br></code></pre></td></tr></table></figure><h4 id="grep文本搜索工具行">grep(文本搜索工具,行)</h4><ul><li>grep [OPTION] PATTERN [FILE]</li><li>Search for PATTERN in each FILE.</li><li>Example: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep -i <span class="hljs-string">&#x27;hello world&#x27;</span> menu.h main.c<br></code></pre></td></tr></table></figure></li></ul><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>--color=auto</code></td><td>对匹配到的文本着色显示</td></tr><tr><td>-v</td><td>反选</td></tr><tr><td>-i</td><td>忽略大小写</td></tr><tr><td>-n</td><td>显示行号</td></tr><tr><td>-c</td><td>统计匹配的行数</td></tr><tr><td>-f</td><td>根据模式文件处理</td></tr><tr><td>-E</td><td>使用ERE</td></tr><tr><td>-w</td><td>匹配整个单词</td></tr><tr><td>-e</td><td>实现多个选项</td></tr><tr><td>-o</td><td>仅显示匹配到的字符串</td></tr><tr><td>-A #</td><td>after, 后#行(tail -n)</td></tr><tr><td>-B #</td><td>before, 前#行(head -n)</td></tr><tr><td>-C #</td><td>前后各#行</td></tr></tbody></table><h5 id="示例">示例:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># -f, --file=FILE    # 从文件每一行获取匹配模式</span><br>grep -f a.txt b.txt  <span class="hljs-comment"># 输出b文件在a文件相同的行</span><br><br><span class="hljs-comment"># -v, --invert-match # 打印不匹配的行</span><br>grep -v -f a.txt b.txt <span class="hljs-comment"># 输出b文件中在a文件不同的行</span><br><br><span class="hljs-comment"># -e, --regexp=PATTERN # 使用模式匹配，可指定多个模式匹配</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a bc de&quot;</span> |xargs -n1 |grep -e <span class="hljs-string">&#x27;a&#x27;</span> -e <span class="hljs-string">&#x27;bc&#x27;</span><br>grep -E -v <span class="hljs-string">&quot;^$|^#&quot;</span> /etc/httpd/conf/httpd.conf<br><br><span class="hljs-comment"># -o, --only-matching  # 只打印匹配的内容</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;this is a test&quot;</span> |grep -o <span class="hljs-string">&#x27;is&#x27;</span>   <span class="hljs-comment"># is</span><br>ifconfig eno16777736 |grep -o <span class="hljs-string">&quot;\&lt;\([0-9]\&#123;1,3\&#125;\.\)\&#123;3\&#125;[0-9]\&#123;1,3\&#125;\&gt;&quot;</span><br>grep -Eo <span class="hljs-string">&quot;(([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\.)&#123;3&#125;([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])&quot;</span><br><br><span class="hljs-comment"># -m, --max-count=NUM # 输出匹配的结果num数</span><br><span class="hljs-built_in">seq</span> 1 20 |grep -m 5 -E <span class="hljs-string">&#x27;[0-9]&#123;2&#125;&#x27;</span>   <span class="hljs-comment"># 10 11 12 13 14 15</span><br><br><span class="hljs-comment"># -w, --word-regexp # 模式匹配整个单词</span><br><span class="hljs-comment"># xargs 能够捕获一个命令的输出，然后传递给另外一个命令</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a ab abc abcd abcde&quot;</span> |xargs -n1 |grep -E -w -o <span class="hljs-string">&#x27;[a-z]&#123;2,3&#125;&#x27;</span> <span class="hljs-comment"># ab abc</span><br><br><span class="hljs-comment"># -c, --count </span><br><span class="hljs-built_in">seq</span> 1 20 |grep -c -E <span class="hljs-string">&#x27;[0-9]&#123;2&#125;&#x27;</span>   <span class="hljs-comment"># 11</span><br><br><span class="hljs-comment"># -n, --line-number</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a ab abc abcd abcde&quot;</span> |xargs -n1 |grep -n <span class="hljs-string">&#x27;de$&#x27;</span>  <span class="hljs-comment"># 5:abcde</span><br><br><span class="hljs-comment"># -B, --before-context=NUM</span><br><span class="hljs-built_in">seq</span> 1 10 |grep 5 -B 3  <span class="hljs-comment"># 2 3 4 5  </span><br></code></pre></td></tr></table></figure><h4 id="sed处理行一次读取一行内容">sed(处理行,一次读取一行内容)</h4><blockquote><p>流编辑器, 过滤和替换文本.<br /><code>sed [选项] '模式1动作1; 模式2动作2; ...' 待处理File</code></p></blockquote><blockquote><p>工作原理:sed命令将当前处理的行存储在临时缓冲区–<strong>模式空间(临时缓冲区)</strong>进行处理,处理完把结果输出, 并清空模式空间.然后再将下一行读入模式空间进行处理输出, 以此类推, 直到最后一行；还有一个空间叫<strong>保持空间, 又称暂存空间</strong>,可以暂时存放一些处理的数据,但不能直接输出,只能放到模式空间输出；这两个空间其实就是在内存中初始化的一个内存区域,存放正在处理的数据和临时存放的数据；<br />默认工作模式输出模式空间内容</p></blockquote><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-n</td><td>只输出命令匹配的内容(不显示模式空间内容)</td></tr><tr><td>-r, –reg</td><td>开启支持扩展正则</td></tr><tr><td>-i</td><td>sed的修改结果直接应用于文件</td></tr><tr><td>-e</td><td>多个命令组合 或者用<code>;</code>分割</td></tr><tr><td>-f 脚本文件名</td><td>从sed脚本读入sed操作</td></tr></tbody></table><table><thead><tr><th>动作(定位)</th><th>说明</th></tr></thead><tbody><tr><td>x,y</td><td>x~y之间的行</td></tr><tr><td>x,+N</td><td>从x行开始向后的N的行</td></tr><tr><td>x,y!</td><td>查询不包括x和y行之间的行</td></tr><tr><td>$</td><td>最后一行</td></tr><tr><td>/pattern1/,/pattern2/</td><td>查询从匹配模式1~模式2之间的行</td></tr><tr><td>/pattern/pattern/</td><td>查询包含两个模式的行</td></tr><tr><td>x,/pattern/</td><td>从与x行~与pattern匹配行之间的行</td></tr></tbody></table><table><thead><tr><th>动作(编辑命令)</th><th>说明</th></tr></thead><tbody><tr><td>p</td><td>打印,输出指定行</td></tr><tr><td>d</td><td>删除指定行</td></tr><tr><td>a </td><td>在指定行后追加</td></tr><tr><td>i </td><td>在指定行前插入</td></tr><tr><td>c </td><td>行替换,用c后边的字符串替换原数据</td></tr><tr><td>r FILE</td><td>指定行后添加文件内容</td></tr><tr><td>w FILE</td><td>指定范围的内容另存至指定文件中</td></tr><tr><td>s/pattern/string/</td><td>查找并替换字串</td></tr><tr><td>n</td><td>读取下一个输入行, 用下一个命令处理新行</td></tr><tr><td>N</td><td>将当前读入行的下一行读取到当前的模式空间</td></tr><tr><td>g</td><td>将保持缓冲区的内容复制到模式缓冲区</td></tr><tr><td>G</td><td>将保持缓冲区的内容追加到模式缓冲区</td></tr></tbody></table><h5 id="示例-1">示例:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># -n, --quiet, --silent # 只输出匹配的字串到屏幕</span><br>sed -n <span class="hljs-string">&#x27;/^blp5/p&#x27;</span> /etc/services     <span class="hljs-comment"># 打印匹配blp5开头的行</span><br><span class="hljs-built_in">tail</span> /etc/services |sed -n <span class="hljs-string">&#x27;1,3p&#x27;</span>   <span class="hljs-comment"># 打印1-3行</span><br>sed -n <span class="hljs-string">&#x27;1p;$p&#x27;</span> test.txt`            <span class="hljs-comment"># 打印第一行与最后一行</span><br><br><span class="hljs-comment"># a i c r w命令</span><br><span class="hljs-built_in">tail</span> /etc/services |sed <span class="hljs-string">&#x27;/blp5/i \test&#x27;</span>   <br><span class="hljs-built_in">tail</span> /etc/services |sed <span class="hljs-string">&#x27;/blp5/a \test&#x27;</span>   <br><span class="hljs-built_in">tail</span> /etc/services |sed <span class="hljs-string">&#x27;/blp5/c \test&#x27;</span>   <span class="hljs-comment"># 在blp5替换新行</span><br><span class="hljs-built_in">tail</span> /etc/services |sed <span class="hljs-string">&#x27;2a \test&#x27;</span>        <span class="hljs-comment"># 在指定行下一行添加</span><br>sed <span class="hljs-string">&#x27;1,2r /etc/issue&#x27;</span> /etc/fstab <br>sed <span class="hljs-string">&#x27;/oot/w /tmp/oot/txt&#x27;</span> /etc/fstab  <br><br><span class="hljs-comment"># d 命令</span><br><span class="hljs-built_in">tail</span> /etc/services |sed <span class="hljs-string">&#x27;/blp5/,$d&#x27;</span>   <span class="hljs-comment"># 删除匹配行直到最后一行 </span><br>sed <span class="hljs-string">&#x27;/^#/d;/^$/d&#x27;</span> /etc/httpd/conf/httpd.conf<br>sed <span class="hljs-string">&#x27;1,3d&#x27;</span> test.txt                   <span class="hljs-comment"># 删除1-3行</span><br><br><span class="hljs-comment"># s 命令</span><br><span class="hljs-comment"># 默认只替换每行中第一次被模式匹配的字串，g-全局替换，i-忽略大小写， </span><br><span class="hljs-built_in">tail</span> /etc/services |sed <span class="hljs-string">&#x27;s/blp5/test/&#x27;</span>  <span class="hljs-comment"># 替换blp5字符串为test s/old/new/g</span><br><span class="hljs-built_in">tail</span> /etc/services |sed <span class="hljs-string">&#x27;1,4s#blp5#test#&#x27;</span><br>sed -i <span class="hljs-string">&#x27;/SELINUX/s/enforceing/disabled/g&#x27;</span> /etc/selinux/config  <br>sed <span class="hljs-string">&#x27;s/l..e/&amp;r/g&#x27;</span><br>sed <span class="hljs-string">&#x27;s#\(l..e\)#\1r#g&#x27;</span>  <br>sed <span class="hljs-string">&#x27;s#l\(..e\)#L\1#g&#x27;</span>    <span class="hljs-comment"># like love</span><br><br><span class="hljs-comment"># N,D,P--处理多行模式空间; H,h,G,g,x--将模式空间内容放入存储空间以便编辑</span><br>  <span class="hljs-comment"># N: 不会清空模式空间内容，并从输入文件中读取下一行数据，追加到模式空间中，两行数据以换行符\n连接；</span><br><br><span class="hljs-comment"># 例子:  </span><br><span class="hljs-built_in">seq</span> 6 |sed <span class="hljs-string">&#x27;/^$/d; 1,3G&#x27;</span>      <span class="hljs-comment"># 前3行每行后加入空行 ^$(空行)</span><br><span class="hljs-built_in">seq</span> 6 |sed <span class="hljs-string">&#x27;n; d&#x27;</span>             <span class="hljs-comment"># 偶数行删除 1 3 5</span><br><span class="hljs-built_in">seq</span> 6 |sed <span class="hljs-string">&#x27;/5/&#123;x; p; x&#125;&#x27;</span>     <span class="hljs-comment"># 匹配内容的前一行插入空行</span><br><span class="hljs-built_in">seq</span> 6 |sed <span class="hljs-string">&#x27;N; s/\n/ /&#x27;</span>       <span class="hljs-comment"># 1 2   3 4    5 6</span><br>sed <span class="hljs-string">&#x27;N;s#\n#=#g&#x27;</span>       <br><span class="hljs-built_in">seq</span> 6 |sed <span class="hljs-string">&#x27;$!N; $!D&#x27;</span>         <span class="hljs-comment"># 5 6</span><br><span class="hljs-built_in">seq</span> 6 |sed -n <span class="hljs-string">&#x27;/3/,/6/&#x27;</span>p      <span class="hljs-comment"># 3 4 5 6</span><br></code></pre></td></tr></table></figure><h4 id="awk-先读取行-再提取列">awk (先读取行, 再提取列)</h4><blockquote><p>awk是一个处理文本的编程语言工具,能用简短的程序处理标准输入或文件、数据排序、计算以及生成报表等等</p></blockquote><blockquote><p>awk 引用shell变量使用 <code>-v</code> 或者<code>双引号+单引号</code>即可</p></blockquote><p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk -v STR=hello <span class="hljs-string">&#x27;&#123;print STR, $NF&#125;&#x27;</span> test.txt`  <br>STR=<span class="hljs-string">&#x27;Hello&#x27;</span>; <span class="hljs-built_in">echo</span> |awk <span class="hljs-string">&#x27;&#123;print &quot;&#x27;</span><span class="hljs-variable">$&#123;STR&#125;</span><span class="hljs-string">&#x27;&quot;&#125;&#x27;</span>`  <br></code></pre></td></tr></table></figure></p><img src="/posts/a796df41/awk.jpg" class="" title="[awk原理说明]"><h4 id="usage">Usage:</h4><ul><li><code>awk 选项 '条件1&#123;动作1&#125; 条件2&#123;动作2&#125; ...' file</code><br /></li><li><code>awk -F: '&#123;print $1 &gt;&gt;"/tmp/awk.log"&#125;' test.txt</code> #-F ‘[ :]’</li><li>条件/模式: 条件也即模式: <code>BEGIN, 空模式, END模式</code></li><li>动作:<ul><li>{ print 动作1,动作2, … } # 打印后则默认空格隔开; 若没有逗号隔开,则会连在一起</li><li>{ print 动作1; print 动作2 } # 多个动作用分号隔开<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk -F <span class="hljs-string">&quot;:&quot;</span> <span class="hljs-string">&#x27;&#123; if($3&lt;500) &#123; print $1,&quot;系统用户&quot; &#125; else&#123; print $1,&quot;普通用户&quot; &#125;&#125;&#x27;</span> /etc/passwd<br></code></pre></td></tr></table></figure></li></ul></li></ul><table><thead><tr><th>变量名</th><th>描述</th></tr></thead><tbody><tr><td>FS, Field Separator</td><td>输入字段(列)分隔符，默认是空格或制表符 BEGIN{FS=“:”}</td></tr><tr><td>OFS</td><td>输出字段(列)分隔符，默认是空格</td></tr><tr><td>RS, Record Separator</td><td>输入记录(行)分隔符，默认是换行符</td></tr><tr><td>ORS</td><td>输出记录(行分隔符，默认是换行符</td></tr><tr><td>–</td><td>–</td></tr><tr><td>NF, Number Field</td><td>统计当前记录中字段(列)个数，列号</td></tr><tr><td>NR, Number Record</td><td>行号，当前处理的文本行的行号</td></tr><tr><td>FNR</td><td>同NR，各文件分别计数的行号</td></tr><tr><td>$0</td><td>当前读入整行数据</td></tr><tr><td>$n</td><td>当前读入行的第n个字段，第n列</td></tr><tr><td>FILENAME</td><td>显示文件名</td></tr></tbody></table><h5 id="示例-2">示例:</h5><ul><li>FS OFS(输入输出字段分割符) <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;print $1,$2&#125;&#x27;</span> /etc/passwd |<span class="hljs-built_in">head</span> -n5        <span class="hljs-comment"># root x</span><br>awk <span class="hljs-string">&#x27;BEGIN&#123;FS=&quot;:&quot;;OFS=&quot;:&quot;&#125;&#123;print $1,$2&#125;&#x27;</span> /etc/passwd |<span class="hljs-built_in">head</span> -n5<span class="hljs-comment"># root:x</span><br>awk <span class="hljs-string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;print $1&quot;#&quot;$2&#125;&#x27;</span> /etc/passwd |<span class="hljs-built_in">head</span> -n5        <span class="hljs-comment"># root#x</span><br></code></pre></td></tr></table></figure></li><li>RS ORS(输入输出记录分隔符) <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;www.baidu.com/user/test.html&quot;</span> |awk <span class="hljs-string">&#x27;BEGIN&#123;RS=&quot;/&quot;&#125;&#123;print $0&#125;&#x27;</span>   <span class="hljs-comment"># user test.html</span><br></code></pre></td></tr></table></figure></li><li>NF(列号,统计当前字段个数) <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a b c d e f&quot;</span>|awk <span class="hljs-string">&#x27;&#123;print NF&#125;&#x27;</span>    <span class="hljs-comment"># 6</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a b c d e f&quot;</span>|awk <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span>   <span class="hljs-comment"># f</span><br></code></pre></td></tr></table></figure></li><li>NR FNR(行号,统计记录编号) <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tail</span> -n5 /etc/services |awk <span class="hljs-string">&#x27;&#123;print NR,$0&#125;&#x27;</span>  <br><span class="hljs-built_in">tail</span> -n5 /etc/services |awk <span class="hljs-string">&#x27;END&#123;print NR&#125;&#x27;</span>   <span class="hljs-comment"># 5</span><br><span class="hljs-built_in">cat</span> /etc/passwd |grep <span class="hljs-string">&quot;/bin/bash&quot;</span> |awk <span class="hljs-string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125; &#123;printf $1 &quot;\t&quot; $3 &quot;\t 行号:&quot;NR &quot;\t 字段数:&quot;NF &quot;\n&quot;&#125;&#x27;</span><br></code></pre></td></tr></table></figure></li><li>格式化输出 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk -F: <span class="hljs-string">&#x27;&#123;print &quot;%-12s %-6s %-8s\n&quot;, $1, $2, $NF&#125;&#x27;</span> /etc/passwd<br>netstat -an |awk <span class="hljs-string">&#x27;$6 ~ /LISTEN/&amp;&amp;NR&gt;=1&amp;&amp;NR&lt;=10 &#123;print NR, $4, $5,$6&#125;&#x27;</span> OFS=<span class="hljs-string">&quot;\t&quot;</span><br></code></pre></td></tr></table></figure></li></ul><blockquote><p>须知: 在awk中, 有3种情况表达式为假: 数字是0, 空字符串和未定义的值.数值运算, 未定义变量初始值为0; 字符运算; 未定义变量初始值为空.</p></blockquote><ul><li><p>awk是按行处理的，每次读取一行，并遍历打印每个字段<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;&#123;i=1;while(i&lt;=NF)&#123;print $1;i++&#125;&#125;&#x27;</span> file<br>awk <span class="hljs-string">&#x27;&#123;for(i=NF;i&gt;=1;i--)&#123;print $i&quot; &quot;&#125;;print&quot;&quot;&#125;&#x27;</span> file<br>awk <span class="hljs-string">&#x27;BEGIN&#123;for(i=1;i&lt;=5;i++)&#123;if(i==3)&#123;break&#125;;print i&#125;&#125;&#x27;</span>file    <span class="hljs-comment"># 1 2</span><br>awk <span class="hljs-string">&#x27;BEGIN&#123;for(i=1;i&lt;=5;i++)&#123;if(i==3)&#123;continue&#125;;print i&#125;&#125;&#x27;</span> file <span class="hljs-comment"># 1 2 4 5</span><br></code></pre></td></tr></table></figure></p></li><li><p>统计passwd文件用户数 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk -F<span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;BEGIN&#123;count=0;&#125; &#123;name[count]=$1; count++;&#125; END&#123;for(i=0; i&lt;NR; i++) print i, name[i]&#125;&#x27;</span> /etc/passwd<br></code></pre></td></tr></table></figure></p></li></ul><h4 id="nginx-日志分析">Nginx 日志分析:</h4><blockquote><p>114.242.26.65 - - [22/Mar/2017:08:41:08 +0800] “GET/css/20151103Style.css HTTP/1.1” 200 9041“http://sz.cdn-my.mobiletrain.org/” “Mozilla/5.0 (Macintosh; Intel MacOS X 10_11_6) ApplwWebKit/537.36 (HTML, like Gecko) Chrome/50.02661.102Safari/537.36”</p></blockquote><ul><li><p>1.统计2017年9月5日 PV量 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep <span class="hljs-string">&#x27;05/Sep/2017&#x27;</span> cd.mobiletrain.org.log |<span class="hljs-built_in">wc</span> -l  <br>awk <span class="hljs-string">&#x27;$4&gt;=&quot;[05/sep/2017:08:00:00&quot; &amp;&amp; &quot;[05/sep/2017:09:00:00&quot; &#123;print $0&#125;&#x27;</span> sz.mobiletrain.log |<span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure></p></li><li><p>2.统计2017年9月5日 一天访问最多的10个IP(top 10)<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep <span class="hljs-string">&#x27;05/Sep/2017&#x27;</span> sz.mobiletrain.org.log |awk <span class="hljs-string">&#x27;&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;print i,ips[i]&#125;&#125;&#x27;</span> |<span class="hljs-built_in">sort</span> -k2 -nr |<span class="hljs-built_in">head</span> -n10    <br>awk <span class="hljs-string">&#x27;05\/Sep\/2017&#x27;</span> sz.mobiletrain.org.log |awk <span class="hljs-string">&#x27;&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;print i,ips[i]&#125;&#125;&#x27;</span> |<span class="hljs-built_in">sort</span> -k2 -nr |<span class="hljs-built_in">head</span> -n10<br></code></pre></td></tr></table></figure></p></li><li><p>3.统计2017年9月5日 访问&gt;100次的IP <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep <span class="hljs-string">&#x27;05/Sep/2017&#x27;</span> sz.mobiletrain.org.log |awk <span class="hljs-string">&#x27;&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;if(ips[i]&gt;100)&#123;print i,ips[i]&#125;&#125;&#125;&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p>4.统计2017年9月5日 访问最多的10个页面($request top 10)<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;/05\/Sep\/2017/ &#123;urls[$7]++&#125; END&#123;for(i in urls)&#123;print i,urls[i]&#125;&#125;&#x27;</span> sz.mobiletrain.org.log |<span class="hljs-built_in">sort</span> -k1 -rn |<span class="hljs-built_in">head</span> -n10<br></code></pre></td></tr></table></figure></p></li><li><p>5.统计2017年9月5日 每个url访问内容总大小($body_bytes_sent)<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;/05\/Sep\/2017/ &#123;urls[$7]++; size[$7]+=$10&#125; END&#123;for(i in urls)&#123;print urls[i],size[i],i&#125;&#125;&#x27;</span> sz.mobiletrain.org.log |<span class="hljs-built_in">sort</span> -k1 -rn |<span class="hljs-built_in">head</span> -n10<br></code></pre></td></tr></table></figure></p></li><li><p>6.统计2017年9月5日 每个IP访问状态码数量($status)<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;/05\/Sep/\2017/ &#123;ip_code[$1&quot; &quot;$9]++&#125; END&#123;for(i in ip_code)&#123;print i,ip_code[i]&#125;&#125;&#x27;</span> sz.mobiletrain.org |<span class="hljs-built_in">sort</span> -k1 -rn |<span class="hljs-built_in">head</span> -n10<br></code></pre></td></tr></table></figure></p></li><li><p>7.统计2017年9月5日 访问状态码为404及出现次数($status)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;/05\/Sep\/2017/ &#123;if($9==&quot;404&quot;)&#123;ip_code[$1&quot; &quot;$9]++&#125; END&#123;for(i in ip_code)&#123;print i,ip_code[i]&#125;&#125;&#125;&#x27;</span> sz.mobiletrain.org.log<br></code></pre></td></tr></table></figure></p></li><li><p>8.统计前一分钟的PV量(带入外部变量) <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">date</span>=$(<span class="hljs-built_in">date</span> -d <span class="hljs-string">&#x27;-1 minute&#x27;</span> +%d/%b/%Y:%H:%M); awk -v <span class="hljs-built_in">date</span>=<span class="hljs-variable">$date</span> <span class="hljs-string">&#x27;$0 ~ date &#123;i++&#125; END&#123;print i&#125;&#x27;</span> sz.mobiletrain.org.log<br></code></pre></td></tr></table></figure></p></li><li><p>9.统计2017年9月5日 8:30-9:00, 访问状态码是404<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;$4&gt;=&quot;[05/Sep/2017:08:30:00 &amp;&amp; [05/Sep/2017:09:00:00&quot; &#123;if($9==&quot;404&quot;)&#123;ip_code[$1&quot; &quot;$9]++&#125; for(i in ip_code)&#123;print i,ip_code[i]&#125;&#125;&#x27;</span> sz.mobiletrain.org.log<br></code></pre></td></tr></table></figure></p></li><li><p>10.统计2017年9月5日各种状态码数量<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;/05\/09\/2017/ &#123;code[$9]++;total++&#125; END&#123;for(i in code)&#123;printf i&quot;\t&quot;; printf code[i]&quot;\t&quot;; printf &quot;%.2f&quot;,code[i]/total*100; print &quot;%&quot;&#125;&#125;&#x27;</span> sz.mobiletrain.org.log<br></code></pre></td></tr></table></figure></p></li><li><p>11.统计独立IP数 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> access.log |<span class="hljs-built_in">sort</span> -r |<span class="hljs-built_in">uniq</span> -c |<span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure></p></li><li><p>12.统计总PV量 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;&#123;print $7&#125;&#x27;</span> access.log |<span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure></p></li><li><p>13.UV统计 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;&#123;print $11&#125;&#x27;</span> access.log |<span class="hljs-built_in">sort</span> -r |<span class="hljs-built_in">uniq</span> -c |<span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure></p></li><li><p>14.截至目前为止访问量前20的IP <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> access.log |<span class="hljs-built_in">sort</span> |<span class="hljs-built_in">uniq</span> -c |<span class="hljs-built_in">sort</span> -nr |<span class="hljs-built_in">head</span> -n20<br></code></pre></td></tr></table></figure></p></li><li><p>15.早上9-12总请求量 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sed -n <span class="hljs-string">&quot;/2019:09:00&quot;</span>/,/2019:12:00/<span class="hljs-string">&quot;p access.log</span><br><span class="hljs-string">`awk &#x27;/2019:09:00/,/2019:12:00&#x27; access.log |wc -l</span><br></code></pre></td></tr></table></figure></p></li><li><p>16.状态码404、502、503、500、499等错误信息页面，打错误出现次数大于20的IP地址<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;&#123;if($9~/502|499|500|503|404/) print $1, $9&#125;&#x27;</span> access.log |<span class="hljs-built_in">sort</span> |<span class="hljs-built_in">uniq</span> -c |<span class="hljs-built_in">sort</span> -nr |awk <span class="hljs-string">&#x27;&#123;if($1&gt;20) print $2&#125;&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p>17.访问最多的页面 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;&#123;print $7&#125;&#x27;</span> access.log |<span class="hljs-built_in">sort</span> |<span class="hljs-built_in">uniq</span> -c |<span class="hljs-built_in">sort</span> -nr |<span class="hljs-built_in">head</span> -n20<br></code></pre></td></tr></table></figure></p></li><li><p>18.请求处理时间大于5s的URL，打印出时间、URL、访客、IP<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;&#123;if($NF&gt;5) print $NF, $7, $1&#125;&#x27;</span> access.log |<span class="hljs-built_in">sort</span> -nr |more<br></code></pre></td></tr></table></figure></p></li><li><p>continue:在循环中不执行continue下面的代码，转而进入下一轮循环</p></li><li><p>break: 结束并退出整个循环</p></li><li><p>exit: 退出脚本，常带一个整数给系统，如 exit 0</p></li><li><p>return: 在函数中将数据返回或返回一个结果给调用函数的脚本</p></li><li><p>break: 是立马跳出循环, continue: 是跳出当前条件循环,继续下一轮条件循环, exit: 是直接退出整个脚本</p></li></ul><h4 id="琐碎知识点">琐碎知识点:</h4><table><thead><tr><th>项目</th><th>说明</th></tr></thead><tbody><tr><td>$0</td><td>脚本自身名字</td></tr><tr><td>$?</td><td>返回上条命令是否执行成功, 0执行成功, 非零失败</td></tr><tr><td>S#</td><td>参数总数</td></tr><tr><td>$*</td><td>参数都被看作一个字符串</td></tr><tr><td>$@</td><td>每个参数被看作独立字符串</td></tr><tr><td>$$</td><td>当前进程PID</td></tr><tr><td>$!</td><td>上一条运行后台进程PID</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于正则表达式</title>
    <link href="/posts/a6e6cc3d.html"/>
    <url>/posts/a6e6cc3d.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-13-正则表达式 <span id="more"></span></p><h2 id="关于正则规则">关于正则(规则)</h2><blockquote><p>字符:<code>\</code><br />意义：对于字符, 通常表示按字面意义, 指出接着的字符为特殊字符<br />例如：<code>/b</code>, 通过在 b 前面加一个反斜杠，也就是<code>/\b/</code>, 则该字符变成特殊字符, 表示匹配一个单词的分界线。</p></blockquote><h3 id="基本正则表达式元字符">基本正则表达式元字符</h3><table><thead><tr><th style="text-align: left;">基本正则元字符1</th><th style="text-align: left;">说明<strong>次数匹配(贪婪模式)</strong></th></tr></thead><tbody><tr><td style="text-align: left;">.</td><td style="text-align: left;">匹配除换行符外的任意单个的字符</td></tr><tr><td style="text-align: left;">*</td><td style="text-align: left;">匹配前面字符<code>任意次</code>,包括0次{0,}</td></tr><tr><td style="text-align: left;">.*</td><td style="text-align: left;">任意长度的任意字符</td></tr><tr><td style="text-align: left;"><code>\?</code></td><td style="text-align: left;">匹配其前面字符0或1次</td></tr><tr><td style="text-align: left;"><code>\+</code></td><td style="text-align: left;">匹配其前面字符至少1次</td></tr><tr><td style="text-align: left;"><code>\{n\}</code></td><td style="text-align: left;">匹配其前面字符n次</td></tr><tr><td style="text-align: left;"><code>\{m,n\}</code></td><td style="text-align: left;">匹配其前面字符至少m次, 至多n次</td></tr><tr><td style="text-align: left;"><code>\{,n\}</code></td><td style="text-align: left;">匹配其前面字符至多n次</td></tr><tr><td style="text-align: left;"><code>\{n,\}</code></td><td style="text-align: left;">匹配其前面字符至少n次</td></tr></tbody></table><table><thead><tr><th style="text-align: left;">基本正则元字符2</th><th style="text-align: left;">说明 <strong>位置锚定</strong></th></tr></thead><tbody><tr><td style="text-align: left;">^</td><td style="text-align: left;">行首定位</td></tr><tr><td style="text-align: left;">$</td><td style="text-align: left;">行尾定位</td></tr><tr><td style="text-align: left;">^$</td><td style="text-align: left;">匹配空白行</td></tr><tr><td style="text-align: left;"><code>^PATTERN$</code></td><td style="text-align: left;">用于匹配整行, 空白行:<a href="#fn1"class="footnote-ref" id="fnref1"role="doc-noteref"><sup>1</sup></a>*$</td></tr><tr><td style="text-align: left;">&lt;或者 词首, 用于单词模式左侧</td><td style="text-align: left;"></td></tr><tr><td style="text-align: left;"><code>\&gt;</code>或者 词尾,用于单词模式右侧</td><td style="text-align: left;"></td></tr><tr><td style="text-align: left;"><code>\&lt;PATTERN&gt;\</code></td><tdstyle="text-align: left;">匹配整个单词(数字、字母与下划线都算单词)</td></tr><tr><td style="text-align: left;"><code>\(\)</code></td><tdstyle="text-align: left;">当作一个整体处理,E:<code>\(root\)</code></td></tr></tbody></table><table><thead><tr><th style="text-align: left;">基本正则元字符3</th><th style="text-align: left;">说明 <strong>字符匹配</strong></th></tr></thead><tbody><tr><td style="text-align: left;">[]</td><td style="text-align: left;">匹配指定范围内的任意单个字符</td></tr><tr><td style="text-align: left;">[^]</td><td style="text-align: left;">匹配指定范围外的任意单个字符</td></tr><tr><td style="text-align: left;">[:alnum:]</td><td style="text-align: left;">匹配任何英文大小写字母, [a-zA-Z]</td></tr><tr><td style="text-align: left;">[:alpha:]</td><td style="text-align: left;">字母与数字[a-zA-Z0-9]</td></tr><tr><td style="text-align: left;">[:lower:]</td><td style="text-align: left;">小写字母[a-z] [:upper:]</td></tr><tr><td style="text-align: left;">[:blank:]</td><td style="text-align: left;">空白字符(空格和制表符)</td></tr><tr><td style="text-align: left;">[:space:]</td><td style="text-align: left;">水平和垂直的空白字符</td></tr><tr><td style="text-align: left;">[:cntrl:]</td><td style="text-align: left;">不可打印的控制字符(退格, 删除…)</td></tr><tr><td style="text-align: left;">[:digit:]</td><td style="text-align: left;">[0-9] [:xdigit:]十六进制</td></tr><tr><td style="text-align: left;">[:graph:]</td><td style="text-align: left;">可打印的非空白字符</td></tr><tr><td style="text-align: left;">[:print:]</td><td style="text-align: left;">可打印字符</td></tr><tr><td style="text-align: left;">[:punct:]</td><td style="text-align: left;">标点符号</td></tr></tbody></table><ul><li><p><code>*</code> – {0,}, 匹配前导符任意次 <figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">1.</span> /<span class="hljs-keyword">a</span>*/意味匹配<span class="hljs-number">0</span>个或多个<span class="hljs-keyword">a</span><br><span class="hljs-number">2.</span> 为了匹配字面上的*，在<span class="hljs-keyword">a</span>前面加一个反斜杠；例如：/<span class="hljs-keyword">a</span>\*/匹配<span class="hljs-string">&#x27;a*&#x27;</span><br><span class="hljs-number">3.</span> /bo*/匹配<span class="hljs-string">&quot;A ghost booooed&quot;</span>中的<span class="hljs-string">&#x27;boooo&#x27;</span>或<span class="hljs-string">&quot;A bird warbled&quot;</span>中的<span class="hljs-string">&#x27;b&#x27;</span>，但不匹配<span class="hljs-string">&quot;A goat grunted&quot;</span>中的任何字符。<br></code></pre></td></tr></table></figure></p></li><li><p><code>.</code> （点）– 匹配除换行符外的所有单个的字符Shell(?)<br /><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-number">1</span>. <span class="hljs-regexp">/&lt;[^&lt;&gt;]+&gt;/g</span><br><span class="hljs-number">2</span>. <span class="hljs-regexp">/.n/</span>匹配<span class="hljs-string">&quot;nay, an apple is on the tree&quot;</span>中的<span class="hljs-string">&#x27;an&#x27;</span>和<span class="hljs-string">&#x27;on&#x27;</span>，但不匹配<span class="hljs-string">&#x27;nay&#x27;</span> <br><span class="hljs-number">3</span>. 匹配<span class="hljs-number">123</span>：echo -e <span class="hljs-string">&quot;123\n456&quot;</span> |<span class="hljs-keyword">grep</span> <span class="hljs-number">1.3</span>  <br><span class="hljs-number">4</span>. <span class="hljs-regexp">/&lt;.*&gt;/</span>     <br></code></pre></td></tr></table></figure></p></li><li><p><code>.*</code> – 任意多个字符</p></li><li><p><code>[xyz]</code> 匹配任意字符, 指定范围的一个字符<br /><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs inform7">1. /1<span class="hljs-comment">[abc]</span>2/`<br>2. <span class="hljs-comment">[abcd]</span>跟<span class="hljs-comment">[a-c]</span>一样,匹配<span class="hljs-string">&quot;brisket&quot;</span>中的&#x27;b&#x27;和<span class="hljs-string">&quot;ache&quot;</span>中的&#x27;c<br>3. <span class="hljs-comment">[a-z]</span>、<span class="hljs-comment">[0-9]</span>、<span class="hljs-comment">[^a]</span><br></code></pre></td></tr></table></figure></p></li><li><p><code>[^xyz]</code> – 匹配除了列出的字符外的所有东西<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-number">1.</span> [^abc]和[^a-c]等价，它们最早匹配<span class="hljs-string">&quot;brisket&quot;</span>中的<span class="hljs-string">&#x27;r&#x27;</span>和<span class="hljs-string">&quot;chop.&quot;</span>中的<span class="hljs-string">&#x27;h&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p><code>^ --行首，$ --行尾</code> <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-number">1</span>. 匹配以<span class="hljs-keyword">abc</span>开头的行：<span class="hljs-keyword">echo</span> -<span class="hljs-keyword">e</span> <span class="hljs-string">&quot;abc\nxyz&quot;</span> |<span class="hljs-keyword">grep</span> ^<span class="hljs-keyword">abc</span><br><span class="hljs-number">2</span>. 匹配以xyz结尾的行：<span class="hljs-keyword">echo</span> -<span class="hljs-keyword">e</span> <span class="hljs-string">&quot;abc\nxyz&quot;</span> |<span class="hljs-keyword">grep</span> xyz$<br><span class="hljs-number">3</span>. /^\<span class="hljs-keyword">w</span>+@[<span class="hljs-keyword">a</span>-z0-<span class="hljs-number">9</span>]+\.[<span class="hljs-keyword">a</span>-<span class="hljs-keyword">z</span>]&#123;<span class="hljs-number">2</span>,<span class="hljs-number">4</span>&#125;$/ -- 邮箱验证<br><span class="hljs-number">4</span>. /^\s*|\s*$/ -- 去掉首尾Space<br><span class="hljs-number">5</span>. /[\u4e00-\u9fa5]/ -- 匹配中文 <br></code></pre></td></tr></table></figure></p></li><li><p><code>\&lt;</code> – 词首定位符: &lt;love<br /><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lsl">匹配开始是<span class="hljs-number">123</span>和<span class="hljs-number">1234</span>：echo -e <span class="hljs-string">&quot;1<span class="hljs-subst">\n</span>12<span class="hljs-subst">\n</span>123<span class="hljs-subst">\n</span>1234&quot;</span> |grep &#x27;\&lt;<span class="hljs-number">123</span>&#x27;<br></code></pre></td></tr></table></figure></p></li><li><p><code>\&gt;</code> – 词尾定位符: love&gt; <figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lsl">匹配结束是<span class="hljs-number">1234</span>：echo -e <span class="hljs-string">&quot;1<span class="hljs-subst">\n</span>12<span class="hljs-subst">\n</span>123<span class="hljs-subst">\n</span>1234&quot;</span> |grep &#x27;<span class="hljs-number">4</span>\&gt;&#x27;<br></code></pre></td></tr></table></figure></p></li><li><p><code>\(\)</code> – 匹配稍后使用的字符标签 \1, \2, \3<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">:% s/172.16.130.1/172.16.130.5/<br>:% s/<span class="hljs-symbol">\(</span>172.16.130.<span class="hljs-symbol">\)</span>1\15/<br>:% s/<span class="hljs-symbol">\(</span>172.<span class="hljs-symbol">\)</span><span class="hljs-symbol">\(</span>16.<span class="hljs-symbol">\)</span><span class="hljs-symbol">\(</span>130.<span class="hljs-symbol">\)</span>1/\1\2\35/<br>:3,9 s/<span class="hljs-symbol">\(</span>.*<span class="hljs-symbol">\)</span>/#\1/ -- 添加注释<br></code></pre></td></tr></table></figure></p></li></ul><h3 id="扩展正则表达式元字符">扩展正则表达式元字符</h3><ul><li><p><code>+</code> – {1,}, 匹配一个或多个前导字符<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. <span class="hljs-regexp">/a+/</span>匹配<span class="hljs-string">&quot;candy&quot;</span>中的<span class="hljs-string">&#x27;a&#x27;</span>和<span class="hljs-string">&quot;caaaaaaandy.&quot;</span>中的所有<span class="hljs-string">&#x27;a&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p><code>?</code> – {0,1}, 匹配零个或一个前导字符<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. <span class="hljs-regexp">/e?le?/</span>匹配<span class="hljs-string">&quot;angel&quot;</span>中的<span class="hljs-string">&#x27;el&#x27;</span>和<span class="hljs-string">&quot;angle.&quot;</span>中的<span class="hljs-string">&#x27;le&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p><code>字符x|y</code> <figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-number">1.</span> /<span class="hljs-built_in">green</span>|<span class="hljs-built_in">red</span>/匹配<span class="hljs-string">&quot;green apple&quot;</span>中的<span class="hljs-string">&#x27;green&#x27;</span>和<span class="hljs-string">&quot;red apple.&quot;</span>中的<span class="hljs-string">&#x27;red&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p><code>(expr1) (expr2) \1 \2</code> – 标签匹配字符</p></li><li><p><code>{n,m}</code> – 字符重复出现m到n次 <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. <span class="hljs-regexp">/a&#123;1,3&#125;/</span>不匹配<span class="hljs-string">&quot;cndy&quot;</span>中的任何字符，但匹配 <span class="hljs-string">&quot;candy,&quot;</span>中的<span class="hljs-string">&#x27;a&#x27;</span>，<span class="hljs-string">&quot;caandy,&quot;</span> 中的前面两个<span class="hljs-string">&#x27;a&#x27;</span>和<span class="hljs-string">&quot;caaaaaaandy&quot;</span>中前面的三个<span class="hljs-string">&#x27;a&#x27;</span>，<br><span class="hljs-number">2</span>. 注意：即使<span class="hljs-string">&quot;caaaaaaandy&quot;</span> 中有很多个<span class="hljs-string">&#x27;a&#x27;</span>，但只匹配前面的三个<span class="hljs-string">&#x27;a&#x27;</span>即<span class="hljs-string">&quot;aaa&quot;</span><br></code></pre></td></tr></table></figure></p></li><li><p><code>{n,}</code> – 字符重复出现n次以上, 匹配至少n个前面的字符<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">1. /a&#123;2,&#125;不匹配<span class="hljs-string">&quot;candy&quot;</span>中的<span class="hljs-string">&#x27;a&#x27;</span>，但匹配<span class="hljs-string">&quot;caandy&quot;</span>中的所有<span class="hljs-string">&#x27;a&#x27;</span>和<span class="hljs-string">&quot;caaaaaaandy.&quot;</span>中的所有<span class="hljs-string">&#x27;a&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p><code>{,m}</code> – 至少不限， 至多m次</p></li><li><p><code>{n}</code> – 正好n次,匹配前面的n个字符 <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. <span class="hljs-regexp">/a&#123;2&#125;/</span>不匹配<span class="hljs-string">&quot;candy,&quot;</span>中的<span class="hljs-string">&#x27;a&#x27;</span>,但匹配<span class="hljs-string">&quot;caandy&quot;</span>中的所有<span class="hljs-string">&#x27;a&#x27;</span>和<span class="hljs-string">&quot;caaandy.&quot;</span>中前面的两个<span class="hljs-string">&#x27;a&#x27;</span><br></code></pre></td></tr></table></figure>—</p></li><li><p><code>\D 等价于 [^0-9]、\W 等价于 [^a-z0-9_]、\S</code><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. <span class="hljs-regexp">/\D/</span>或<span class="hljs-regexp">/[^0-9]/</span>匹配<span class="hljs-string">&quot;B2 is the suite number.&quot;</span>中的<span class="hljs-string">&#x27;B&#x27;</span><br><span class="hljs-number">2</span>. <span class="hljs-regexp">/\W/</span>或者<span class="hljs-regexp">/[^$A-Za-z0-9_]/</span>匹配<span class="hljs-string">&quot;50%.&quot;</span>中的<span class="hljs-string">&#x27;%&#x27;</span><br><span class="hljs-number">3</span>. \S --匹配除white空格符以外的一个单个的字符，等价于[^ \f\n\r\t\v]<span class="hljs-regexp">/\S/</span>\w*匹配<span class="hljs-string">&quot;foo bar.&quot;</span>中的<span class="hljs-string">&#x27;foo&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p><code>\d、\d\d、\d+、g</code> – 获取匹配 / 替换的项目<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>. 匹配一个数字，等价于[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]，/\d/或/[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]/匹配<span class="hljs-string">&quot;B2 is the suite number.&quot;</span>中的&#x27;<span class="hljs-number">2</span>&#x27;<br></code></pre></td></tr></table></figure></p></li><li><p><code>\b</code> –匹配一个单词的分界线，比如一个空格(不要与[混淆)<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. <span class="hljs-regexp">/\bn\w/</span>匹配<span class="hljs-string">&quot;noonday&quot;</span>中的<span class="hljs-string">&#x27;no&#x27;</span>，<span class="hljs-regexp">/\wy\b/</span>匹配<span class="hljs-string">&quot;possibly yesterday.&quot;</span>中的<span class="hljs-string">&#x27;ly&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p><code>\B</code> –匹配一个单词的非分界线 <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. <span class="hljs-regexp">/\w\Bn/</span>匹配<span class="hljs-string">&quot;noonday&quot;</span>中的<span class="hljs-string">&#x27;on&#x27;</span>，<span class="hljs-regexp">/y\B\w/</span>匹配<span class="hljs-string">&quot;possibly yesterday.&quot;</span>中的<span class="hljs-string">&#x27;ye&#x27;</span><br></code></pre></td></tr></table></figure></p></li><li><p><code>\cX</code>–X是一个控制字符。匹配一个字符串的控制字符</p></li><li><p><code>字符[\b]</code> –匹配一个空格</p></li></ul><h2 id="常用正则表达式">常用正则表达式:</h2><h3 id="一校验数字的表达式">一、校验数字的表达式</h3><p>数字：<code>^[0-9]*$</code><br />n位的数字：<code>^\d{n}$</code><br />至少n位的数字：<code>^\d{n,}$</code><br />m-n位的数字：<code>^\d{m,n}$</code><br />零和非零开头的数字：<code>^(0|[1-9][0-9]*)$</code><br />非零开头的最多带两位小数的数字：<code>^([1-9][0-9]*)+(\.[0-9]{1,2})?$</code><br />带1-2位小数的正数或负数：<code>^(\-)?\d+(\.\d{1,2})$</code><br />正数、负数、和小数：<code>^(\-|\+)?\d+(\.\d+)?$</code><br />有两位小数的正实数：<code>^[0-9]+(\.[0-9]{2})?$</code><br />有1~3位小数的正实数：<code>^[0-9]+(\.[0-9]{1,3})?$</code><br />非零的正整数：<code>^[1-9]\d*$ 或 ^([1-9][0-9]*){1,3}$</code> 或<code>^\+?[1-9][0-9]*$</code><br />非零的负整数：<code>^\-[1-9][]0-9"*$</code> 或<code>^-[1-9]\d*$</code><br />非负整数：<code>^\d+$</code> 或 <code>^[1-9]\d*|0$</code><br />非正整数：<code>^-[1-9]\d*|0$</code> 或<code>^((-\d+)|(0+))$</code><br />非负浮点数：<code>^\d+(\.\d+)?$</code> 或<code>^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$</code><br />非正浮点数：<code>^((-\d+(\.\d+)?)|(0+(\.0+)?))$</code> 或<code>^(-([1-9]\d*\.\d*|0\.\d*[1-9]\d*))|0?\.0+|0$</code><br />正浮点数：<code>^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$</code> 或<code>^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$</code><br />负浮点数：<code>^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$</code> 或<code>^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$</code><br />浮点数：<code>^(-?\d+)(\.\d+)?$</code> 或<code>^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$</code></p><h3 id="二校验字符的表达式">二、校验字符的表达式</h3><p>汉字：<code>^[\u4e00-\u9fa5]{0,}$</code><br />英文和数字：<code>^[A-Za-z0-9]+$</code> 或<code>^[A-Za-z0-9]{4,40}$</code><br />长度为3-20的所有字符：<code>^.{3,20}$</code><br />由26个英文字母组成的字符串：<code>^[A-Za-z]+$</code><br />由26个大写英文字母组成的字符串：<code>^[A-Z]+$</code><br />由26个小写英文字母组成的字符串：<code>^[a-z]+$</code><br />由数字和26个英文字母组成的字符串：<code>^[A-Za-z0-9]+$</code><br />由数字、26个英文字母或者下划线组成的字符串：<code>^\w+$</code> 或<code>^\w{3,20}$</code><br />中文、英文、数字包括下划线：<code>^[\u4E00-\u9FA5A-Za-z0-9_]+$</code><br />中文、英文、数字但不包括下划线等符号：<code>^[\u4E00-\u9FA5A-Za-z0-9]+$</code>或 <code>^[\u4E00-\u9FA5A-Za-z0-9]{2,20}$</code><br />可以输入含有<code>^%&amp;',;=?$\"</code>等字符：<code>[^%&amp;',;=?$\x22]+</code><br />禁止输入含有<sub>的字符：`[^</sub>]+`</p><h3 id="三特殊需求表达式">三、特殊需求表达式</h3><p>Email地址：<code>^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$</code><br />域名：<code>[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(/.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+/.?</code><br />InternetURL：<code>[a-zA-z]+://[^\s]*</code> 或<code>^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=]*)?$</code><br />手机号码：<code>^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$</code><br />电话号码(“XXX-XXXXXXX”、“XXXX-XXXXXXXX”、“XXX-XXXXXXX”、“XXX-XXXXXXXX”、“XXXXXXX”和”XXXXXXXX)：<code>^(\(\d{3,4}-)|\d{3.4}-)?\d{7,8}$</code><br />国内电话号码(0511-4405222、021-87888822)：<code>\d{3}-\d{8}|\d{4}-\d{7}</code><br />电话号码正则表达式（支持手机号码，3-4位区号，7-8位直播号码，1－4位分机号）:<code>((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)</code><br />身份证号(15位、18位数字), 最后一位是校验位, 可能为数字或字符X:<code>(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)</code><br />帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：<code>^[a-zA-Z][a-zA-Z0-9_]{4,15}$</code><br />密码(以字母开头，长度在6~18之间，只能包含字母、数字和下划线)：<code>^[a-zA-Z]\w{5,17}$</code><br />强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在 8-10之间)：<code>^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[a-zA-Z0-9]{8,10}$</code><br />强密码(必须包含大小写字母和数字的组合，可以使用特殊字符，长度在8-10之间)：<code>^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$</code><br />日期格式：<code>^\d{4}-\d{1,2}-\d{1,2}</code><br />一年的12个月(01～09和1～12)：<code>^(0?[1-9]|1[0-2])$</code><br />一个月的31天(01～09和1～31)：<code>^((0?[1-9])|((1|2)[0-9])|30|31)$</code><br />钱的输入格式： 有四种钱的表示形式我们可以接受:“10000.00” 和 “10,000.00”,和没有 “分” 的 “10000” 和 “10,000”：<code>^[1-9][0-9]*$</code><br />这表示任意一个不以0开头的数字,但是,这也意味着一个字符”0”不通过,所以我们采用下面的形式：<code>^(0|[1-9][0-9]*)$</code><br />一个0或者一个不以0开头的数字.我们还可以允许开头有一个负号：<code>^(0|-?[1-9][0-9]*)$</code><br />这表示一个0或者一个可能为负的开头不为0的数字.让用户以0开头好了.把负号的也去掉,因为钱总不能是负的吧。下面我们要加的是说明可能的小数部分：<code>^[0-9]+(.[0-9]+)?$</code><br />必须说明的是,小数点后面至少应该有1位数,所以”10.”是不通过的,但是 “10” 和“10.2” 是通过的：<code>^[0-9]+(.[0-9]{2})?$</code><br />这样我们规定小数点后面必须有两位,如果你认为太苛刻了,可以这样：<code>^[0-9]+(.[0-9]{1,2})?$</code><br />这样就允许用户只写一位小数.下面我们该考虑数字中的逗号了,我们可以这样：<code>^[0-9]{1,3}(,[0-9]{3})*(.[0-9]{1,2})?$</code><br />1到3个数字,后面跟着任意个逗号+3个数字,逗号成为可选,而不是必须：<code>^([0-9]+|[0-9]{1,3}(,[0-9]{3})*)(.[0-9]{1,2})?$</code><br />备注：这就是最终结果了,别忘了”+“可以用”*“替代如果你觉得空字符串也可以接受的话(奇怪,为什么?)最后,别忘了在用函数时去掉去掉那个反斜杠,一般的错误都在这里</p><p>xml文件：<code>^([a-zA-Z]+-?)+[a-zA-Z0-9]+\\.[x|X][m|M][l|L]$</code><br />中文字符的正则表达式：<code>[\u4e00-\u9fa5]</code><br />双字节字符：<code>[^\x00-\xff]</code>(包括汉字在内，可以用来计算字符串的长度(一个双字节字符长度计2，ASCII字符计1))空白行的正则表达式：<code>\n\s*\r</code>(可以用来删除空白行)<br />HTML标记的正则表达式：<code>&lt;(\S*?)[^&gt;]*&gt;.*?|&lt;.*? /&gt;</code>( 首尾空白字符的正则表达式：<sup>|$或(</sup>)|($)(可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式)<br />腾讯QQ号：<code>[1-9][0-9]{4,}</code> (腾讯QQ号从10000开始)<br />中国邮政编码：<code>[1-9]\d{5}(?!\d)</code>(中国邮政编码为6位数字)<br />IP地址：<code>((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))</code></p><section id="footnotes" class="footnotes footnotes-end-of-document"role="doc-endnotes"><hr /><ol><li id="fn1"><p>[:space:]<a href="#fnref1" class="footnote-back"role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    
    <categories>
      
      <category>Regular</category>
      
    </categories>
    
    
    <tags>
      
      <tag>正则表达式</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux 集群</title>
    <link href="/posts/f8c8020d.html"/>
    <url>/posts/f8c8020d.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-12-集群 <span id="more"></span></p><h2 id="linux-集群">Linux 集群</h2><h3 id="liunx-集群概述">1.liunx 集群概述：</h3><h4 id="集群概念">1.1 集群概念：</h4><blockquote><p>一组协同工作的服务器，对外表现为一个整体，更好的利用现有资源实现服务的高度可用</p></blockquote><h4 id="集群cluster的分类">1.2 集群(Cluster)的分类：</h4><ul><li>LBC(Load Balancing)：负载均衡集群<ul><li>减轻单台服务器的压力，将用户请求分担给多台主机一起处理</li><li>实现方法：<ul><li>软件：LVS、RAC、Ngnix、</li><li><ahref="https://www.cnblogs.com/lipengxiang2009/p/7353373.html">LVS(LinuxVirtual Server)</a></li><li>硬件：F5、BIG-IP</li></ul></li></ul></li><li>HAC(High Availiablity)：高可用集群<ul><li>最大限度的保证用户的应用持久，不间断的提供服务</li><li>实现原理：心跳检测</li><li>实现方法：<ul><li>软件：heartbeat linux-HA、RHCS、ROSE、keepalived</li><li>硬件：F5</li></ul></li></ul></li><li>HPC(High-performance computing)：高性能运算集群</li></ul><img src="/posts/f8c8020d/ARP-Level.png" class="" title="[ARP-Level]"><img src="/posts/f8c8020d/closearp.png" class="" title="[closearp]"><h3 id="负载均衡集群lbc">2.负载均衡集群(LBC)</h3><h4 id="lvs-相关原理">2.1LVS 相关原理：</h4><blockquote><p>LVS运行在系统内核空间<code>netfilter</code>的<code>INPUT</code>钩子上的框架，用户空间无法直接管理，用<strong>IPVSADM命令行工具</strong>管理集群服务；根据用户请求的套接字判断，分流至真实服务器的工作模块</p></blockquote><ul><li>管理集群服务: 增、改、删 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ipvsadm -A|E -t|u|f service-address [-s,scheduler] [-p [<span class="hljs-built_in">timeout</span>]]  <br>ipvsadm -D -t|u|f service-address  <br>service-address: -t|u|f<br>-s,scheduler: <span class="hljs-comment"># 指定集群调度算法, 默认：WLC</span><br></code></pre></td></tr></table></figure></li><li>管理集群的RS: 增、改、删 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ipvsadm -a|e -t|u|f service-address -r service-address [-g|i|m] [-w,weight]  <br>ipvsadm -d -t|u|f service-address -r service-address<br></code></pre></td></tr></table></figure></li></ul><h4 id="lvs工作模式">2.2LVS工作模式：</h4><img src="/posts/f8c8020d/LVS.png" class="" title="[LVS工作模式]"><ul><li>NAT(多目标的DNAT) ✔<ul><li>模式特点：<ul><li><strong>网络层</strong>，替换目标地址；</li><li>集群节点，必须在一个网络中；</li><li>真实服务器网关必须指向负载调度器；</li><li>RIP通常都是私有IP，仅用于各个集群节点通信；</li><li>负载调度器必须位于客户端和真实服务器之间，充当网关；</li><li>支持端口映射，负载调度器操作系统必须是Linux，真实服务器可以使用任意系统;　</li></ul></li></ul></li></ul><img src="/posts/f8c8020d/LVS-NAT.png" class="" title="[LVS-NAT]"><ul><li>DR(Direct Routing) ✔<ul><li>模式特点：<ul><li><strong>数据链路层</strong>，更改MAC地址，关闭ARP广播；</li><li>集群节点，必须在一个网络中；</li><li>真实服务器网关指向路由器；</li><li>RIP既可以是私网地址，又可以是公网地址;</li><li>不支持端口映射;</li></ul></li></ul></li></ul><img src="/posts/f8c8020d/LVS-DR.png" class="" title="[LVS-DR]"><ul><li>TUN<ul><li>模式特点：<ul><li>集群节点不必位于同一个物理网络但必须都拥有公网IP（或都可以被路由）</li><li>真实服务器不能将网管指向负载调度器</li><li>RIP必须是公网地址</li><li>负载调度器只负责入站请求</li><li>不支持端口映射功能</li><li>发送方和接收方必须支持隧道功能</li></ul></li></ul></li></ul><h3 id="集群通用算法">3.集群通用算法</h3><h4 id="静态调度算法">3.1静态调度算法：</h4><ul><li><strong>RR</strong> 轮询算法：第一台服务器开始到N台结束，然后循环:laughing:<br /></li><li><strong>WRR</strong> 加权算法：按权重比例实现多台主机之间进行调度:smile:</li><li><strong>SH</strong>源地址散列：将同一个IP用户请求，发送给同一个服务器<br /></li><li><strong>DH</strong>目标地址散列：将同一个目标地址的用户请求发送给通一个真实服务器(提高缓存服务率)</li></ul><h4 id="动态调度算法">3.2动态调度算法：</h4><ul><li><strong>LC</strong>：Lest-connection，最少连接，将新的连接请求，分配给连接数最少的服务器:smile:<ul><li>活动连接*256 + 非活动连接<br /></li></ul></li><li><strong>WLC</strong>：加权最少连接，特殊的LC算法，权重越大承担请求越多:smile:<ul><li>（活动连接*256 + 非活动连接）/ 权重<br /></li></ul></li><li><strong>SED</strong>：最短期望延迟，特殊的WLC算法<ul><li>（活动连接 + 1）*256 / 权重</li></ul></li><li><strong>NQ</strong>：无需等待，特殊的SED算法，若有正是服务器的连接数等于0就直接分配不需要运算<br /></li><li><strong>LBLC</strong>：特殊的DH算法，即提高缓存命中率，有考虑了服务器性能</li><li><strong>LBLCR</strong>：LBLCR缓存，尽可能提高负载均衡和缓存命中率折中方案</li></ul><h4id="持久化连接类似于sh优先级最高">3.3持久化连接(类似于SH优先级最高)</h4><ul><li><strong>PCC</strong>：持久客户端连接<ul><li>将来自于同一个客户端的所有请求统统定向此前选定的RS，只要IP相同，分配的服务器始终相同</li></ul></li><li><strong>PPC</strong>：持久端口连接<ul><li>将来自于同一个客户端对同一个服务(端口)的请求，始终定向此前选定的RS</li></ul></li><li><strong>PMFC</strong>：持久防火墙标记连接<ul><li>将来自同一个客户端指定服务(端口)的请求，始终定向至此选定的RS，不过它可以将2个不相关的端口定义为一个集群服务</li></ul></li></ul><h4 id="ipvsadm编译安装">3.4ipvsadm编译安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget -c http://www.linuxvirtualserver.org/software/kernel-2.6/ipvsadm-1.24.tar.gz<br><span class="hljs-built_in">ln</span> -s /usr/local/kernels/2.6.* /usr/local/linux<br>tar -xzvf ipvsadm-1.24.tar.gz<br><span class="hljs-built_in">cd</span> ipvsadm-1.24<br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure><table><thead><tr><th>ipvsadm 命令选项</th><th>说明</th></tr></thead><tbody><tr><td>-A</td><td>添加虚拟服务器IP</td></tr><tr><td>-s</td><td>设置调度算法</td></tr><tr><td>-a</td><td>添加真实主机</td></tr><tr><td>-t</td><td>TCP_PORT</td></tr><tr><td>-u</td><td>UDP_PORT</td></tr><tr><td>-f</td><td>标记</td></tr><tr><td>-g</td><td>DR模式(直接路由)</td></tr><tr><td>-m</td><td>NAT模式</td></tr><tr><td>-i</td><td>TUN模式</td></tr><tr><td>-w</td><td>权重</td></tr><tr><td>-Ln</td><td>以数字形式输出地址和端口</td></tr><tr><td>-nS</td><td>重定向保存文件</td></tr><tr><td>-restore</td><td>恢复</td></tr><tr><td>-C</td><td>清空定义所有内容</td></tr><tr><td>-Z</td><td>清空计数器</td></tr></tbody></table><h3 id="lvs工作模式构建">4.LVS工作模式构建：</h3><h4 id="nat-模式构建">4.1 NAT 模式构建：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Client: 172.20.0.123/16  </span><br><span class="hljs-comment"># LVS: eth1:VIP:172.20.0.200   eth0:DIP:192.168.30.200  </span><br><span class="hljs-comment"># RS: 192.168.30.27/24  192.168.30.17/24   GW: 192.168.30.200  </span><br><span class="hljs-comment"># /etc/pki/tls/certs</span><br></code></pre></td></tr></table></figure><h4 id="负载调度器配置vipdip">4.2负载调度器配置(VIP,DIP):</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/sysctl.conf  <span class="hljs-comment"># 开启负载调度器路由转发   </span><br>  net.ipv4.ip_forward=1  <br>[root@xy ~]# sysctl -p                <span class="hljs-comment"># 刷新内核参数  </span><br>[root@xy ~]# service iptables start   <span class="hljs-comment"># 开启防火墙  </span><br>[root@xy ~]# chkconfig iptables on    <br>[root@xy ~]# iptables -F              <span class="hljs-comment"># 清空防火墙默认规则  </span><br>[root@xy ~]# iptables -t nat -A POSTROUTING -s 192.168.30.27 -o eth0 -j SNAT -to-source 172.20.0.100<br>[root@xy ~]# iptables -t nat -L<br>[root@xy ~]# ipvsadm -A -t 172.20.0.200:80 -s rr    <span class="hljs-comment"># 添加 ipvsadm TCP集群    </span><br>[root@xy ~]# ipvsadm -a -t 172.20.0.200:80 -r 192.168.30.17:8080 -m <br><span class="hljs-comment"># 添加ipvsadm节点  -m NAT 模式  </span><br>[root@xy ~]# ipvsadm -a -t 172.20.0.200:80 -r 192.168.30.27:80 -m <br>[root@xy ~]# ipvsadm -Ln<br>[root@xy ~]# service ipvsadm save  <br>[root@xy ~]# chkconfig ipvsadm on  <br><br>[root@xy ~]# ipvsadm -Ln --status <span class="hljs-comment"># 查看集群状态  </span><br>[root@xy ~]# ipvsadm -D -t 外网卡地址:80  <span class="hljs-comment"># 删除集群  </span><br></code></pre></td></tr></table></figure><h4 id="真实服务器配置">4.3真实服务器配置:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# route add default gw IP  <span class="hljs-comment"># 指定真实服务器网关至负载调度器  </span><br>[root@xy ~]# route -n<br>[root@xy ~]# service httpd start  <br>[root@xy ~]# chkconfig httpd on<br></code></pre></td></tr></table></figure><h4 id="dr-模式构建">4.4DR 模式构建：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Client: 172.20.0.222/16      GW: 172.20.0.200  </span><br><span class="hljs-comment"># Route: 172.20.0.200  192.168.30.200</span><br><span class="hljs-comment"># LVS: eth0:VIP:192.168.30.7   GW: 192.168.30.200    </span><br><span class="hljs-comment"># RS: eth0:192.168.30.17/24  eth0:192.168.30.27/24  VIP:192.168.30.7  GW: 192.168.30.200   </span><br></code></pre></td></tr></table></figure><h4 id="负载调度器配置">4.5负载调度器配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# service NetworkManager stop  <br>[root@xy ~]# chkconfig NetworkManager off  <br>[root@xy ~]# vim /etc/sysconfig/network-scripts/  <br>[root@xy ~]# vim /etc/sysctl.conf  <span class="hljs-comment"># 开启负载调度器路由转发   </span><br>  net.ipv4.ip_forward=1  <br>[root@xy ~]# sysctl -p <span class="hljs-comment"># 刷新内核参数 </span><br>[root@xy ~]# vim /etc/sysctl.conf  <span class="hljs-comment"># 关闭网卡重定向  </span><br>  net.ipv4.conf.all.send_redirects = 0  <br>  net.ipv4.conf.default.send_redirects = 0  <br>  net.ipv4.conf.eth0.send_redirects = 0  <br>[root@xy ~]# sysctl -p<br>[root@xy ~]# modprobe ip_vs <span class="hljs-comment"># 重新加载 ipvs 模块  </span><br>[root@xy ~]# rpm -ivh ipvsadm   <span class="hljs-comment"># 安装ipvsadm工具  </span><br>[root@xy ~]# ipvsadm -v         <span class="hljs-comment"># 查看当前集群内容  </span><br>[root@xy ~]# ipvsadm -A -t 192.168.30.7:80 -s rr  <span class="hljs-comment"># 添加TCP集群  </span><br>[root@xy ~]# ipvsadm -a -t  192.168.30.7:80:80 -r 192.168.30.17:80 -g <span class="hljs-comment"># 添加ipvsadm集群子节点  </span><br>[root@xy ~]# ipvsadm -a -t  192.168.30.7:80:80 -r 192.168.30.27:80 -g <span class="hljs-comment"># -g DR模式</span><br>[root@xy ~]# ipvsadm -Ln<br>[root@xy ~]# service ipvsadm save  <br>[root@xy ~]# chkconfig ipvsadm on  <br></code></pre></td></tr></table></figure><h4 id="真实服务器">4.6真实服务器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# service NetworkManager stop  <br>[root@xy ~]# vim /etc/sysctl.conf    <span class="hljs-comment"># 关闭对应ARP 响应及公告功能  </span><br>  net.ipv4.conf.all.arp_ignore = 1  <br>  net.ipv4.conf.all.arp_announce = 2  <br>  net.ipv4.conf.default.arp_ignore = 1  <br>  net.ipv4.conf.default.arp_announce = 2  <br>  net.ipv4.conf.lo.arp_ignore = 1  <br>  net.ipv4.conf.lo.arp_announce = 2  <br>[root@xy ~]# sysctl -p<br>[root@xy ~]# <span class="hljs-built_in">cd</span> /etc/sysconfig/network-scripts/  <br>[root@xy ~]# <span class="hljs-built_in">cp</span> ifcfg-lo ifcfg-lo:0  <br>[root@xy ~]# vim ifcfg-lo:0     <span class="hljs-comment"># 拷贝回环网卡子接口  </span><br>  DEVICE=lo:0  <br>  IPADDR=192.168.30.7 <span class="hljs-comment"># VIP </span><br>  NETMASK=255.255.255.255  <br>[root@xy ~]# ifup lo:0  <br>[root@xy ~]# route add -host 192.168.30.200 dev lo:0 <span class="hljs-comment"># 添加路由记录，网关，当访问 VIP 交给lo:0 网卡接收  </span><br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;route add -host 192.168.30.200 dev lo:0&quot;</span> &gt;&gt; /etc/rc.local  <span class="hljs-comment"># 加入到开机自启中  </span><br>[root@xy ~]# service httpd start<br></code></pre></td></tr></table></figure><h3 id="高可用集群hac">5.高可用集群(HAC)</h3><h4 id="keeplived原理">5.1Keeplived原理：</h4><ul><li>热备方式：VRRP 虚拟路由冗余协议<ul><li>一主+多备，共用同一个IP，但优先级不同</li><li>支持故障自动切换</li><li>支持节点健康状态检查<br />#### 5.2LVS-DR+Keeplived： <img src="/posts/f8c8020d/LVS-DR-Keepalived.png" class="" title="[LVS-DR-Keepalived]"></li></ul></li></ul><h4 id="负载调度器-1">5.3负载调度器 1</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# service NetworkManager stop  <br>[root@xy ~]# chkconfig NetworkManager off    <br>[root@xy ~]# <span class="hljs-built_in">cd</span> /etc/sysconfig/network-scripts/    <br>[root@xy ~]# <span class="hljs-built_in">cp</span> -a ifcfg-eth0 ifcfg-eth0:0<br>[root@xy ~]# vim !$<br>  DEVICE=eth0:0    <br>  IPADDR=10.10.10.100 <span class="hljs-comment">#虚拟IP    </span><br>  NETMASK=255.255.255.0   <br>[root@xy ~]# ifup eth0:0  <br>[root@xy ~]# yum install -y ipvsadm  <br>[root@xy ~]# vim /etc/sysctl.conf  <span class="hljs-comment"># 关闭网卡的广播功能，防止冲突  </span><br>  net.ipv4.conf.all.send_redirects = 0  <br>  net.ipv4.conf.default.send_redirects = 0  <br>  net.ipv4.conf.eth0.send_redirects = 0  <br>[root@xy ~]# sysctl -p<br>[root@xy ~]# ipvsadm -A -t 10.10.10.100:80 -s rr  添加集群  <br>[root@xy ~]# ipvsadm -a -t 10.10.10.100:80 -r 10.10.10.13:80 -g <span class="hljs-comment"># 添加集群子节点，-g DR模式    </span><br>[root@xy ~]# ipvsadm -a -t 10.10.10.100:80 -r 10.10.10.114:80 -g    <br>[root@xy ~]# service ipvsadm save    <br>[root@xy ~]# ipvsadm -Ln   <br>  IP Virtual Server version 1.2.1 (siza=4096)  <br>  Port LocalAddress:Port Scheduler Flags <br>      -&gt; RemoteAddress:Port       Forward     Weight      ActiveConn      InActConn  <br>  TCP 10.10.10.100:80 rr<br>      -&gt;10.10.10.13:80            Route       1           0           0<br>      -&gt;10.10.10.14:80            Route       1           0           0  <br>[root@xy ~]# <span class="hljs-built_in">mkdir</span> /mnt/keepalived    <span class="hljs-comment"># 配置 keepalived 文件  10.10.10.11   </span><br>[root@xy ~]# mount -o loop Keepalived.iso  <br>[root@xy ~]# <span class="hljs-built_in">cp</span> -a /mnt/leepalived/* .  <br>[root@xy ~]# vim /etc/keepalived/keepalived.conf<br>  global_defs &#123;<br>      router_id R1    <span class="hljs-comment">#命名主机名</span><br>  &#125;<br><br>  vrrp_instance VI--1 &#123;<br>      state MASTER        <span class="hljs-comment"># 设置服务类型主/从（MASTER/SLAVE）</span><br>      interface eth0      <span class="hljs-comment"># 指定那块网卡用来监听</span><br>      virtual_router_id 66 <span class="hljs-comment"># 设置组号， 如果是一组就是相同的ID号， 一个主里面只能有一个主服务器和多个从服务器</span><br>      priority 80          <span class="hljs-comment"># 服务器优先级， 主服务器优先级高</span><br>      advert_int 1         <span class="hljs-comment"># 心跳时间， 检测对方存活</span><br>      authenticetion &#123;     <span class="hljs-comment"># 存活验证密码</span><br>          auth_type PASS<br>          auth_pass 1111<br>      &#125;<br>  virtual_ipaddress &#123;<br>      10.10.10.100       <span class="hljs-comment">#设置集群地址</span><br>      &#125;<br>  &#125;<br><br>  virtual_server 10.10.10.100 80 &#123;   <span class="hljs-comment"># 设置集群地址以及端口号</span><br>      delay_loop 2                   <span class="hljs-comment"># 健康检查间隔</span><br>      lb_algo rr                     <span class="hljs-comment"># 使用轮询调度算法</span><br>      lb_kind DR                     <span class="hljs-comment"># DR模式的群集</span><br>      protocol TCP                   <span class="hljs-comment"># 使用的协议</span><br>  real_server 10.10.10.13 80 &#123;       <span class="hljs-comment"># 管理的网站节点以及使用端口</span><br>          weight 1                   <span class="hljs-comment"># 权重， 优先级在原文件基础上删除修改</span><br>          TCP_CHECK &#123;                <span class="hljs-comment"># 状态检查方式</span><br>              connect_port 80        <span class="hljs-comment"># 检查的目标端口</span><br>              connect_timeout 3      <span class="hljs-comment"># 连接超时（秒）</span><br>              nb_get_retry 3         <span class="hljs-comment"># 重试次数</span><br>              delay_before_retry 4   <span class="hljs-comment"># 重试间隔（秒）</span><br>          &#125;<br>      &#125;<br>  real_server 10.10.10.14 80 &#123;    <span class="hljs-comment"># 管理的第二个网站节点以及使用端口</span><br>          weight 1                <span class="hljs-comment"># 权重， 优先级在原文件基础上删除修改</span><br>          TCP_CHECK &#123;             <span class="hljs-comment"># 状态检查方式</span><br>              connect_port 80     <span class="hljs-comment"># 检查的目标端口</span><br>              connect_timeout 3   <span class="hljs-comment"># 连接超时（秒）</span><br>              nb_get_retry 3           <span class="hljs-comment"># 重试次数</span><br>              delay_before_retry 4     <span class="hljs-comment"># 重试间隔（秒）</span><br>          &#125;<br>      &#125;<br>  &#125;<br>[root@xy ~]# service keepalived start  <br>[root@xy ~]# <span class="hljs-built_in">tail</span> -f  /var/log/message  <br></code></pre></td></tr></table></figure><h4 id="负载调度器-2">5.4负载调度器 2</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy network-scripts]# <span class="hljs-built_in">cp</span> -a ifcfg-eth0 ifcfg-eth0:0   10.10.10.12  <br>  DEVICE=eth0:0  <br>  IPADDR=10.10.10.100  <br>  NETMASK=255.255.255.0  <br>[root@xy network-scripts]# vim ifup-eth <span class="hljs-comment"># 256行左右，注释arp命令  </span><br>[root@xy network-scripts]# ifup eth0:0<br>[root@xy network-scripts]# vim /etc/keepalived/keepalived.conf<br>  <span class="hljs-comment"># 修改1：state MASTER 修改至state SLAVE </span><br>  <span class="hljs-comment"># 修改2：priority 100 修改至priority 47 一般建议与主服务器差值为50</span><br>[root@xy network-scripts]# service NetworkManager stop  <span class="hljs-comment"># 启动虚拟借口，必须关闭此服务  </span><br>[root@xy network-scripts]# vim /etc/sysctl.conf  <span class="hljs-comment"># 修改内核参数。防止相同网络地址广播冲突， 如果有多快网卡需要设置多行  </span><br>  net.ipv4.conf.eth0.send_redirects = 0  <br>  net.ipv4.conf.all.send_redirects = 0  <br>  net.ipv4.conf.default.send_redirects = 0   <br>  net.ipv4.conf.eth0.send_redirects = 0   <br>[root@xy network-scripts]# sysctl -p <span class="hljs-comment"># 刷新内核参数  </span><br>[root@xy network-scripts]# modprobe ip_vs      <span class="hljs-comment"># 查看内核是否加载， 无法应则以加载  </span><br>[root@xy network-scripts]# <span class="hljs-built_in">cat</span> /proc/net/ip_vs <span class="hljs-comment"># 参看版本， 确认知否正确加载  </span><br>[root@xy network-scripts]# <span class="hljs-built_in">cd</span> /mnt/cdrom/Packages/  <span class="hljs-comment"># 进入光盘挂载目录  </span><br>[root@xy network-scripts]# rpm -ivh ipvsadm-1.26l......... <span class="hljs-comment"># 安装ipvsadm管理工具  </span><br>[root@xy network-scripts]# ipvsadm -v<br>[root@xy network-scripts]# ipvsadm -A -t 10.10.10.100:80 -s rr  <br>[root@xy network-scripts]# ipvsadm -Ln   <span class="hljs-comment"># 查看设置的ipvsadm如果没有子项， 那么手动添加  </span><br>[root@xy network-scripts]# ipvsadm -a -t 10.10.10.100:80 -r 10.10.10.13:80 -g <br>[root@xy network-scripts]# ipvsadm -a -t 10.10.10.100:80 -r 10.10.10.14:80 -g  <br></code></pre></td></tr></table></figure><h4 id="真实服务器-1">5.5真实服务器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# service httpd start  <span class="hljs-comment"># 真实服务器开启Web服务    </span><br>[root@xy ~]# chkconfig httpd on <br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;this is Server 1&quot;</span> &gt;&gt; /var/www/index.html  <span class="hljs-comment"># 10.10.10.13   </span><br>[root@xy ~]# curl localhost<br>[root@xy ~]# <span class="hljs-built_in">cd</span> /etc/sysconfig/network-scripts/<br>[root@xy ~]# <span class="hljs-built_in">cp</span> ifcfg-lo ifcfg-lo:0    <br>[root@xy ~]# vim ifcfg-lo:0  拷贝回环网卡子接口    <br>  DEVICE=lo:0   <br>  IPADDR=10.10.10.100     <br>  NETMASK=255.255.255.255   <br>[root@xy ~]# vim /etc/sysctl.conf   <span class="hljs-comment"># 关闭对应ARP 响应及公告功能   </span><br>  net.ipv4.conf.all.arp_ignore = 1    <br>  net.ipv4.conf.all.arp_announce = 2    <br>  net.ipv4.conf.default.arp_ignore = 1  <br>  net.ipv4.conf.default.arp_announce = 2   <br>  net.ipv4.conf.lo.arp_ignore = 1   <br>  net.ipv4.conf.lo.arp_announce = 2   <br>[root@xy ~]# sysctl -p <br>[root@xy ~]# ifup lo: 0  <br>[root@xy ~]# route add -host 10.10.10.100 dev lo:0 <span class="hljs-comment"># 添加路由记录，当访问VIP 交给lo:0 网卡接受  </span><br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;route add -host 10.10.10.100 dev lo:0&quot;</span> &gt;&gt; /etc/rc.local <span class="hljs-comment"># 加入到开机自启中  </span><br>[root@xy ~]# ipvsadm -Ln --stats    <br>  IP Virtual Server version 1.2.1 (siza=4096)  <br>  Port LocalAddress:Port   <br>      -&gt; RemoteAddress:Port       Conns       InPkts      OutPkts     InBytes     OutBytes       <br>  TCP 10.10.10.100:80             16          79          0           11036          0<br>      -&gt;10.10.10.13:80            8           39          0           5481           0<br>      -&gt;10.10.10.14:80            8           40          0           5555           0<br></code></pre></td></tr></table></figure><h4 id="heartbeatnginx">5.6Heartbeat+Nginx：</h4><img src="/posts/f8c8020d/Heartbeat-Nginx.png" class="" title="[Heartbeat-Nginx]"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum -y install pcre pcre-devel zlib zlib-devel  <span class="hljs-comment"># 10.10.10.11  </span><br>[root@xy nginx-1.2.6]# useradd -s /sbin/no-login -M nginx  -M 家目录  <br>[root@xy nginx-1.2.6]# ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx  <br>[root@xy nginx-1.2.6]# make &amp;&amp; make install    <br><br>[root@xy ~]# tar -xzvf heartbeat.tar.gz  <br>[root@xy heartbeat]# yum -y install ntp  <span class="hljs-comment"># 安装时间同步服务程序  </span><br>[root@xy heartbeat]# vim /ect/ntp.conf <br>  restrict 10.10.10.0 mask 255.255.255.0 nomodify notrap  <br>  server 127.127.1.0   <br>  fudge 127.127.1.0 stratum 10   <br>[root@xy heartbeat]# service ntpd start  <br>[root@xy heartbeat]# chkconfig ntpd on <br>[root@xy ~] <span class="hljs-comment"># yum install -y ntpdate    # 10.10.10.12  </span><br>[root@xy ~] <span class="hljs-comment"># ntpdate -u 10.10.10.11 </span><br>[root@xy heartbeat]# vim /etc/sysconfig/network  <span class="hljs-comment"># 更改主机名  uname -n</span><br>[root@xy heartbeat]# <span class="hljs-built_in">cd</span> /usr/share/doc/heartbeat-3.0.4<br>[root@xy heartbeat]# <span class="hljs-built_in">cp</span> -a authkeys ha.cf haresources /etc/ha.d <br>[root@xy heartbeat]# <span class="hljs-built_in">cd</span> !$ <br>[root@xy ha.d]# <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/random bs=512 count=1 | openssl md5 <br>  记录了 0+1 的读入  <br>  记录了 0+1 的写入  <br>  16字节(16 B)已复制, 6.5455e-05 秒, 244 kb/秒    <br>  (stdin)=53a0ba829e8a55f7faea1891c850dde8  <br>[root@xy ha.d]#  vim authkeys <br>  auth 3<br>  1 crc   <br>  2 sha1 HI!  <br>  3 md5 53a0ba829e8a55f7faea1891c850dde8     <br>[root@xy ha.d]# <span class="hljs-built_in">chmod</span> 600 authkeys  <br>[root@xy ha.d]# vim ha.cf  <span class="hljs-comment"># /bcast  /node  </span><br>  bcast   eth0    <span class="hljs-comment">#Linux   </span><br>  node    www.centos1.com  <br>  node    www.centos2.com     <br>[root@xy ha.d]# haresoures<br>  www.centos1.com IPaddr::10.10.10.100/24/eth0:0  <span class="hljs-comment"># 切换 IP 地址</span><br>[root@xy ~]# scp ha.cf authkeys haresoures root@10.10.10.12:/etc/ha.d/ <span class="hljs-comment"># 10.10.10.12  </span><br>[root@xy ha.d]#  /etc/init.d/ha.d<br>  <span class="hljs-comment">#!/bin/bash         # 检测脚本</span><br>  PWD=/usr/local/script/<br>  URL=<span class="hljs-string">&quot;http://10.10.10.11/index.html&quot;</span><br>  HTTP_CODE=`curl -o /dev/null -s -w <span class="hljs-string">&quot;%&#123;http_code&#125;&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;URL&#125;</span>&quot;</span>` <br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$HTTP_CODE</span> != 200 ]<br>  <span class="hljs-keyword">then</span><br>     service heartbeat stop<br>  <span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops, linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Devops</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux 监控</title>
    <link href="/posts/48810125.html"/>
    <url>/posts/48810125.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-12-Zabbix <span id="more"></span></p><h2 id="监控服务">监控服务</h2><h3 id="常见的监控平台">1. 常见的监控平台</h3><h4 id="cacti-流量与性能监测为主-cacti">1.1 Cacti 流量与性能监测为主 <ahref="http://www.cacti.net">Cacti</a></h4><ul><li><strong>展示平台 Apache</strong>：B/S</li><li><strong>收集数据</strong>：SNMP(Simple Network ManagementProtocol)</li><li><strong>RRD Tool</strong> 绘图软件</li></ul><h4 id="nagios-服务与性能检测为主-nagios">1.2 Nagios 服务与性能检测为主<a href="http://www.nagios.org">Nagios</a></h4><ul><li><strong>展示平台</strong>：B/S</li><li><strong>收集数据</strong>：C/S (脚本)</li><li>ntop</li></ul><h4 id="zabbix-新型全功能监控软件-zabbix">1.3 Zabbix 新型全功能监控软件<a href="http://www.zabbix.com">Zabbix</a></h4><ul><li><strong>展示平台</strong>：B/S</li><li><strong>收集数据</strong>：C/S (脚本)、SNMP</li></ul><h3 id="cacti-监控平台">2. Cacti 监控平台</h3><img src="/posts/48810125/Cacti.png" class="" title="[Cacti]"><h4 id="cacti-原理">2.1 Cacti 原理</h4><blockquote><p><strong>SNMP(收集数据)</strong> –&gt;<strong>RRD Tool(绘图)</strong>–&gt;<strong>Apache(平台展示)</strong></p></blockquote><h4 id="cacti-监控构建-服务器端10.10.10.11">2.2 Cacti 监控构建服务器端(10.10.10.11)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum -y install httpd mysql \<br>    mysql-server mysql-devel libxml2-devel \<br>    mysql-connector-odbc perl-DBD-MySQL \<br>    unixODBC php php-mysql php-pdo  <br><br>[root@xy ~]# mysqladmin -uroot password anyu<br>[root@xy ~]# yum -y install \<br>    net-snmp net-snmp-utils \<br>    net-snmp-libs lm_sensors       <span class="hljs-comment"># 安装 snmp</span><br><br>[root@xy ~]# yum -y install libart_lgpl-devel \<br>    pango-devel* cairo-devel*  <br><br>[root@xy ~]# mount -o loop cacti.iso /mnt/iso  <br>[root@xy ~]# <span class="hljs-built_in">cp</span> -a /mnt/iso/* .    <br>[root@xy ~]# tar -xzvf rrdtool-1.4.5.tar.gz     <span class="hljs-comment"># 安装 rrdtool  </span><br>[root@xy rrdtool-1.4.5]# ./configure --prefix=/usr/local  <br>[root@xy rrdtool-1.4.5]# make &amp;&amp; make install  <br><br><span class="hljs-comment"># 报错解决方法: </span><br>  tar -xzvf cgilib-0.5.tar.gz<br>  <span class="hljs-built_in">cd</span> cgilib-0.5/<br>  make  <br>  <span class="hljs-built_in">cp</span> libcgi.a /usr/local/lib<br>  <span class="hljs-built_in">cp</span> cgi.h /usr/local/include<br><br>[root@xy cacti]# tar -xzvf cacti-0.8.7g.tar.gz  <br>[root@xy cacti]# <span class="hljs-built_in">mv</span> cacti-0.8.7g/ /var/www/html/  <br>[root@xy www html]# <span class="hljs-built_in">ln</span> -s cacti-0.8.7g/ cacti  <br>[root@xy www cacti]# patch -p1 -N &lt; /root/cacti/data_source_deactivate.patch  <span class="hljs-comment"># 打补丁  </span><br>[root@xy www cacti]# useradd cacti <br>[root@xy www cacti]# <span class="hljs-built_in">chown</span> -R root:root ./  <br>[root@anyue html]# <span class="hljs-built_in">chmod</span> -R 777 cacti/  <br>[root@xy www cacti]# <span class="hljs-built_in">chown</span> -R cacti:cacti rra/ <span class="hljs-built_in">log</span>/    <br>[root@xy www cacti]# mysql -uroot -p    <span class="hljs-comment"># 授权数据库用户，导入初始化数据  </span><br>  mysql&gt; create database cactidb default character <span class="hljs-built_in">set</span> utf8;<br>  mysql&gt; grant all privileges on cactidb.* to cactiuser@localhost identified by <span class="hljs-string">&#x27;cacti&#x27;</span>;<br>  mysql&gt; <span class="hljs-built_in">exit</span><br><br>[root@xy www cacti]# mysql -uroot -p cactidb &lt; cacti.sql <br>[root@xy www cacti]# vim /include/config.php    <span class="hljs-comment"># 设置数据连接参数   </span><br>29 <span class="hljs-variable">$database_type</span>     = <span class="hljs-string">&#x27;mysql&#x27;</span>;<br>30 <span class="hljs-variable">$database_default</span>  = <span class="hljs-string">&#x27;cactidb&#x27;</span>;<br>31 <span class="hljs-variable">$database_hostname</span> = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br>32 <span class="hljs-variable">$database_username</span> = <span class="hljs-string">&#x27;cactiuser&#x27;</span>;<br>33 <span class="hljs-variable">$database_password</span> = <span class="hljs-string">&#x27;cacti&#x27;</span>;<br><br>[root@xy www cacti]# vim /etc/httpd/conf/httpd.conf  <br><br>DocumentRoot <span class="hljs-string">&quot;/var/www/html/cacti&quot;</span>  <br>&lt;Directory <span class="hljs-string">&quot;/var/www/html/cacti&quot;</span>&gt;  <br>DirectoryIndex index.php index.html index.htm.var  <br><br><span class="hljs-comment"># 10.10.10.11 进行安装 </span><br></code></pre></td></tr></table></figure><h4 id="cacti-插件添加-10.10.10.12-客户端">2.3 Cacti 插件添加10.10.10.12 (客户端)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum -y install net-snmp net-snmp-utils net-snmp-libs lm_sensors    <br>[root@xy ~]# vim /etc/snmpd.conf  <br>  com2sec notConfigUser   default public123<br>  view all include .1  <br>  <span class="hljs-comment">#       group   context sec.model   sec.level   prefix  read        write   notif   </span><br>  access  notConfigGroup  <span class="hljs-string">&quot;&quot;</span>  any noauth          exact   all  none    none  <br>[root@xy ~]# service snmpd start  <br>[root@xy ~]# snmpwalk -v 2c -c public123 10.10.10.12 tcp  <span class="hljs-comment"># -c 共同体名称(组号)</span><br>  <span class="hljs-comment"># V1 版 简单，高效，不支持加密及身份认证  </span><br>  <span class="hljs-comment"># V2 版 身份认证  </span><br>  <span class="hljs-comment"># V3 版 加密</span><br>[runct@www html]# php /var/www/html/cacti/poller.php<br>[root@www html]# su -cacti <br>[runct@xy ~]# crontab -e <br>  */5   *   *   *   *   /usr/bin/php    /var/www/html/cacti/poller.php &amp;&gt;/dev/null   <br>[runct@xy ~]# service crond restart  <br>[root@xy cacti-plugin]# tar -xzvf cacti-plugin-0.8.7-PA-v2.8.tar.gz  <br>[root@xy cacti-plugin-arch]# mysql -uroot -p cactidb &lt; pa.aql  <br>[root@xy www cacti]# patch -p1 -N &lt; /root/cacti-plugin/cacti-plugin-arch/cacti-plugin-0.8.7g-PA-v2.8.diff <br><br><span class="hljs-comment"># 启用插件管理器, 下载插件复制到 /var/www/html/cacti/plugins并还原数据库, 用于0.8.7，8  </span><br><span class="hljs-comment"># 1.2.6版本集成了插件管理器  </span><br></code></pre></td></tr></table></figure><h3 id="nagios-监控平台">2. Nagios 监控平台</h3><h4 id="nagios-原理">2.1 Nagios 原理</h4><img src="/posts/48810125/Nagios.png" class="" title="[Nagios原理]"><h4 id="nagios-构建">2.2 Nagios 构建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum -y install httpd php php-cli php-mysql gcc glibc glibc-common gd gd-devel net-snmp openssl-devel wget unzip    <br>[root@xy mnt cdrom]# yum -y insatall *gd*   <span class="hljs-comment"># 在光盘Package里找 *gd* 安装    </span><br>[root@xy ~]# groupadd nagcmd                <span class="hljs-comment"># 必须  </span><br>[root@xy ~]# useradd -m nagios              <span class="hljs-comment"># 必须  </span><br>[root@xy ~]# usermod -a -G nagcmd nagios  <br>[root@xy ~]# usermod -a -G nagcmd apache   <span class="hljs-comment"># 把Apache添加到 nagcmd 组  </span><br>[root@xy ~]# mount -o loop nagios.iso /mnt/iso <br>[root@xy ~]# <span class="hljs-built_in">cp</span> -a /mnt/iso/* . <br>[root@xy ~]# tar -xzvf nagios-3.1.2.tar.gz  <br>[root@xy nagios-3.1.2]# ./configure --with-command-group=nagcmd --enable-event-broker  <span class="hljs-comment"># 开启数据库选项  </span><br>[root@xy nagios-3.1.2]# make all  <br>[root@xy nagios-3.1.2]# make install  <br>[root@xy nagios-3.1.2]# make install-init    <span class="hljs-comment"># - This installs the init script in /etc/rc.d/init.d  </span><br>[root@xy nagios-3.1.2]# make install-config  <span class="hljs-comment"># - This installs and configures permissions on the</span><br>  directory <span class="hljs-keyword">for</span> holding the external <span class="hljs-built_in">command</span> file  <br>[root@xy nagios-3.1.2]# make install-commandmode  <span class="hljs-comment"># - This installs sample config files in /usr/local/nagios/etc  </span><br>[root@xy nagios-3.1.2]# vim /usr/local/nagios/etc/objects/contacts.cfg <br>  email   nagios@localhost    <span class="hljs-comment"># 邮件地址</span><br>[root@xy nagios-3.1.2]# make install-webconf  <br>[root@xy nagios-3.1.2]# vim /etc/httpd/conf.d/nagios.conf <br>[root@xy nagios-3.1.2]# htpasswd -c /usr/local/nagios/etc/htpasswd.users nagiosadmin  <br><br>[root@xy ~]# tar -xzvf nagios-plugins-1.4.15.tar.gz <br>[root@xy nagios-plugins-1.4.15]# ./configure --with-nagios-user=nagios \<br>  --with-nagios-group=nagios --with-mysql \<br>  --enable-perl-modules  <br>[root@xy nagios-plugins-1.4.15]# make all &amp;&amp;  make install  <br>[root@xy nagios-plugins-1.4.15]# chkconfig --add nagios  <br>[root@xy nagios-plugins-1.4.15]# chkconfig nagios on <br>[root@xy nagios-plugins-1.4.15]# /usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg  <span class="hljs-comment"># 检测   </span><br>[root@xy nagios-plugins-1.4.15]# service nagios start  <br>[root@xy nagios-3.1.2]# systemctl restart httpd  <br></code></pre></td></tr></table></figure><h4 id="nagios-添加监控主机">2.3 Nagios 添加监控主机</h4><p><strong>windows 监控插件(MSClient++.msi), windows端</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@anyue objects]# <span class="hljs-built_in">cd</span> /usr/local/nagios/etc/objects  <br>[root@anyue objects]# vim windows.cfg   <span class="hljs-comment"># 填写主机、IP</span><br>[root@anyue objects]# <span class="hljs-built_in">cd</span> /usr/local/nagios/etc  <br>[root@anyue objects]# vim nagios.cfg    <span class="hljs-comment"># 添加模板</span><br>  28 <span class="hljs-comment"># You can specify individual object config files as shown below:</span><br>  29 cfg_file=/usr/local/nagios/etc/objects/commands.cfg<br>  30 cfg_file=/usr/local/nagios/etc/objects/contacts.cfg<br>  31 cfg_file=/usr/local/nagios/etc/objects/timeperiods.cfg<br>  32 cfg_file=/usr/local/nagios/etc/objects/templates.cfg<br>  33 32 cfg_file=/usr/local/nagios/etc/objects/windows.cfg<br></code></pre></td></tr></table></figure></p><p><strong>linux 监控插件(nrpe), linux端</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@anyue ~]# useradd nagios <br>[root@xy ~]# tar -xzvf nagios-plugins-1.4.15.tar.gz <br>[root@xy nagios-plugins-1.4.15]# ./configure --with-nagios-user=nagios --with-nagios-group=nagios   <br>[root@xy nagios-plugins-1.4.15]# make all &amp;&amp;  make install <br>[root@anyue nagios]# tar -xzf nrpe-3.2.1.tar.gz<br>[root@anyue nrpe-3.2.1]# ./configure --enable-ssl --with-ssl-lib=/usr/lib64/  <br>[root@anyue nrpe-3.2.1]# make all <br>[root@anyue nrpe-3.2.1]# make install-plugin<br>[root@anyue nrpe-3.2.1]# make install-daemon<br>[root@anyue nrpe-3.2.1]# make install-daemon-config<br>[root@anyue nrpe-3.2.1]# <span class="hljs-built_in">cd</span> /usr/local/nagios/etc/nrpe.cfg <br>  allowed_hosts=serverIP 127.0.0.1<br>[root@anyue etc]# /usr/local/nagios/bin/nrpe -c /usr/local/nagios/etc/nrpe.cfg -d  <span class="hljs-comment"># tcp/5666</span><br></code></pre></td></tr></table></figure></p><h3 id="zabbix-监控构建">3. Zabbix 监控构建</h3><h4 id="初始化系统">3.1 初始化系统</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# systemctl stop firewalld  <br>[root@xy ~]# systemctl <span class="hljs-built_in">disable</span> firewalld  <br>[root@xy ~]# setenforce 0<br>[root@xy ~]# sed -i <span class="hljs-string">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span> /etc/selinux/config <br></code></pre></td></tr></table></figure><h4 id="构建-lamp-环境">3.2 构建 LAMP 环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# wget http://mirros.163.com/.help/CentOS7-Base-163.repo <br>[root@xy ~]# yum clean all  <br>[root@xy ~]# yum makecache fast   <br>[root@xy ~]# yum -y install mariadb mariadb-server httpd php php-mysql php-mbstring php-gd php-bcmatch php-ldap php=xml   <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> httpd <br>[root@xy ~]# systemctl restart httpd <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> mariadb  <br>[root@xy ~]# systemctl restart mariadb  <br>[root@xy ~]# mysql_secure_installation <br></code></pre></td></tr></table></figure><h4 id="安装配置zabbix-server">3.3 安装配置zabbix-server</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# rpm -ivh http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm  <span class="hljs-comment"># 官方源: repo.zabbix.com  </span><br>[root@xy ~]# rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX<br>[root@xy ~]# yum -y install zabbix-server-mysql zabbix-web zabbix-web-mysql zabbix-agent  <span class="hljs-comment"># 连接数据库方案 Web可视化方案  </span><br>[root@xy ~]# mysql -uroot -p  <span class="hljs-comment"># 还原官方数据库  </span><br>  MariaDB [(none)]&gt; create database zabbix default character <span class="hljs-built_in">set</span> utf8 collate utf8_bin;  <br>  MariaDB [(none)]&gt; grant all privileges on zabbix.* to zabbix@localhost identified by <span class="hljs-string">&#x27;zabbix&#x27;</span>;<br>[root@xy ~]# <span class="hljs-built_in">cd</span> /usr/share/doc/zabbix-server-mysql-3.2.11/  <br>[root@xy zabbix-server-mysql-3.2.11]# zcat create.sql.gz | mysql -uroot -p -Dzabbix  <span class="hljs-comment"># zcat 解压并查看  </span><br>[root@xy zabbix-server-mysql-3.2.11]# vim /etc/zabbix/zabbix_server.conf  ✔<br>  LogFile=/tmp/zabbix_server.log<br>  DBHost=localhost  <span class="hljs-comment"># 82 </span><br>  DBName=zabbix  <br>  DBUser=zabbix  <br>  DBPassword=zabbix  <span class="hljs-comment"># 115</span><br>[root@xy zabbix-server-mysql-3.2.11]# systemctl start zabbix-server  <br>[root@xy zabbix-server-mysql-3.2.11]# systemctl <span class="hljs-built_in">enable</span> zabbix-server<br></code></pre></td></tr></table></figure><h4 id="安装配置zabbix-web">3.4 安装配置zabbix-web</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy zabbix-server-mysql-3.2.11]# vim /etc/httpd/conf.d/zabbix.conf <br>  &lt;virtualHost IP:80&gt;     <span class="hljs-comment"># 采用虚拟主机访问方式</span><br>  servername zabbix.anyu967.com<br>  documentroot /usr/share/zabbix    <br>  ...<br>  php_value date.timezone Asia/Shanghai   <span class="hljs-comment"># 更改时区: 19</span><br>  &lt;/VirtualHost&gt;<br>[root@xy ~]# systemctl restart httpd  <br>[root@xy ~]# yum -y install ntpdate  <br>[root@xy ~]# netstat -anpt | grep :10050  <span class="hljs-comment"># Listenport: 10050  </span><br>[root@xy ~]# vim /usr/share/zabbix/include/locales.inc.php   <span class="hljs-comment"># 中文选项</span><br>  zh_CN =&gt; [<span class="hljs-string">&#x27;name&#x27;</span> =&gt; _(<span class="hljs-string">&#x27;Chinese (zh_CN)&#x27;</span>, <span class="hljs-string">&#x27;display&#x27;</span> =&gt; <span class="hljs-literal">true</span>)],<br>[root@xy ~]# <span class="hljs-built_in">mv</span> simsun.ttc /usr/share/zabbix/fonts    <span class="hljs-comment"># win+r fonts  </span><br>[root@anyue zabbix]# <span class="hljs-built_in">cd</span> !$<br>[root@xy fonts]# chomod a+x song.ttf  <br>[root@xy fonts]# vim /usr/share/zabbix/include/defines.inc.php  <span class="hljs-comment"># /fonts  </span><br>  define(<span class="hljs-string">&#x27;ZBX_GRAPH_FONT_NAME&#x27;</span>,       <span class="hljs-string">&#x27;song&#x27;</span>);  <span class="hljs-comment"># font file name</span><br></code></pre></td></tr></table></figure><h4 id="zabbix-添加监控主机-自动发现-10.10.10.12">3.5 Zabbix添加监控主机 / 自动发现 10.10.10.12</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install zabbix-sender zabbix-agent-3.2.11-1.el7.x86_64.rpm  <span class="hljs-comment"># 被监控服务器</span><br>[root@xy ~]# service httpd start<br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello,HTML~&quot;</span> &gt;&gt; /var/www/html/index.html  <br>[root@xy ~]# curl localhost<br>[root@xy ~]# vim /etc/zabbix/zabbix_agentd.conf  <br>  <span class="hljs-comment">####### GENRAL PARAMETERS</span><br>  PidFile=/var/run/zabbix/zabbix_agent.pid<br>  <span class="hljs-comment"># LogType=file</span><br>  LogFile=/tmp/zabbix_agentd.log<br>  <span class="hljs-comment">####### Passive checks related</span><br>  <span class="hljs-comment">####### Active checks related </span><br>  Server=10.10.10.11     <span class="hljs-comment"># zabbix-server IP</span><br>  ServerActive=10.10.10.11  <br>  Hostname=10.10.10.12  <br>[root@xy ~]# service zabbix-agent start  <br>[root@xy ~]# chkconfig zabbix-agent on   <br>[root@xy ~]# netstat -anptl | grep :10050   <br>[root@xy ~]# yum -y install zabbix-sender zabbix-agent-3.2.1-1.el6.x86_64.rpm  <span class="hljs-comment"># 10.10.10.13 </span><br>[root@xy ~]# vim /etc/zabbix/zabbix_agentd.conf<br>  Server=10.10.10.11  <br>  ServerActive=10.10.10.11  <br>  Hostname=10.10.10.13<br></code></pre></td></tr></table></figure><p><strong>先创建动作–&gt; 自动发现</strong><br /><img src="/posts/48810125/zabbix-autofind.png" class="" title="[zabbix-autofind]"><br /><img src="/posts/48810125/zabbix-autofind1.png" class="" title="[zabbix-autofind1]"><br /><img src="/posts/48810125/zabbix-autofind2.png" class="" title="[zabbix-autofind2]"><br /><img src="/posts/48810125/zabbix-autofind3.png" class="" title="[zabbix-autofind3]"></p><h4 id="zabbix-nginx-并发监控自定义脚本功能-10.10.10.12">3.6 ZabbixNginx 并发监控(自定义脚本功能) 10.10.10.12</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy nginx-1.2.6]# yum -y install pcre pcre-devel zlib zlib-devel  <br>[root@xy nginx-1.2.6]# ./configure --<span class="hljs-built_in">help</span> | grep status  <span class="hljs-comment"># 查询模块  </span><br>[root@xy nginx-1.2.6]# useradd -s /sbin/nologin -M nginx  <br>[root@xy nginx-1.2.6]# ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx --with-htttp_stub_status_module<br>[root@xy nginx-1.2.6]# make &amp;&amp; make install  <br>[root@xy nginx-1.2.6]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;123&quot;</span> &gt;&gt; /usr/local/nginx/html/index.html <br>[root@xy nginx-1.2.6]# /usr/local/nginx/sbin/nginx<br>[root@xy nginx-1.2.6]# vim /usr/local/nginx/conf/nginx.conf  <br>  location    /nginx-status &#123;<br>      stub_status on;<br>  &#125;<br>[root@xy nginx-1.2.6]# /usr/local/nginx/sbin/nginx -t  <br>[root@xy nginx-1.2.6]# <span class="hljs-built_in">kill</span> -HUP $(<span class="hljs-built_in">cat</span> /usr/local/nginx/logs/nginx.pid)<br>  <span class="hljs-comment">#!/bin/bash</span><br>  <span class="hljs-comment"># nginx_status.sh</span><br>  <span class="hljs-comment"># Active connections: 3</span><br>  <span class="hljs-comment"># server accepts handle requests</span><br>  <span class="hljs-comment">#   4   4   5</span><br>  <span class="hljs-comment"># Reading: 1  Writing: 1  Waiting: 1  </span><br><br>  HOST=<span class="hljs-string">&quot;10.10.10.12&quot;</span><br>  PORT=<span class="hljs-string">&quot;80&quot;</span><br>  <span class="hljs-comment"># 检测 nginx 进程是否存在  </span><br>  <span class="hljs-keyword">function</span> ping &#123;<br>      /sbin/pidof nginx | <span class="hljs-built_in">wc</span> -l<br>  &#125;<br>  <span class="hljs-comment"># 检测 nginx 性能</span><br>  <span class="hljs-keyword">function</span> active &#123;<br>      /usr/bin/curl <span class="hljs-string">&quot;http://<span class="hljs-variable">$HOST</span>:<span class="hljs-variable">$PORT</span>/ngx_status&quot;</span> 2&gt;/dev/null | grep <span class="hljs-string">&#x27;Active&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span><br>  &#125;<br>  <span class="hljs-keyword">function</span> reading &#123;<br>      /usr/bin/curl <span class="hljs-string">&quot;http://<span class="hljs-variable">$HOST</span>:<span class="hljs-variable">$PORT</span>/ngx_status&quot;</span> 2&gt;/dev/null | grep <span class="hljs-string">&#x27;Reading&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>  &#125;<br>  <span class="hljs-keyword">function</span> writing &#123;<br>      /usr/local/curl <span class="hljs-string">&quot;http://<span class="hljs-variable">$HOST</span>:<span class="hljs-variable">$PORT</span>/ngx_status&quot;</span> 2&gt;/dev/null | grep <span class="hljs-string">&#x27;Writing&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span><br>  &#125;<br>  <span class="hljs-keyword">function</span> waiting &#123;<br>      /usr/local/curl <span class="hljs-string">&quot;http://<span class="hljs-variable">$HOST</span>:<span class="hljs-variable">$PORT</span>/ngx_status&quot;</span> 2&gt;/dev/null | grep <span class="hljs-string">&#x27;waiting&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $6&#125;&#x27;</span><br>  &#125;<br>  <span class="hljs-keyword">function</span> accepts &#123;<br>      /usr/local/curl <span class="hljs-string">&quot;http://<span class="hljs-variable">$HOST</span>:<span class="hljs-variable">$PORT</span>/ngx_status&quot;</span> 2&gt;/dev/null | awk NR==3 | awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span><br>  &#125;<br>  <span class="hljs-keyword">function</span> handle &#123;<br>      /usr/local/curl <span class="hljs-string">&quot;http://<span class="hljs-variable">$HOST</span>:<span class="hljs-variable">$PORT</span>/ngx_status&quot;</span> 2&gt;/dev/null | awk NR==3 | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>  &#125;<br>  <span class="hljs-keyword">function</span> requests &#123;<br>      /usr/local/curl <span class="hljs-string">&quot;http://<span class="hljs-variable">$HOST</span>:<span class="hljs-variable">$PORT</span>/ngx_status&quot;</span> 2&gt;/dev/null | awk NR==3 | awk <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span><br>  &#125;    <br>  <span class="hljs-comment"># 执行 function </span><br>  <span class="hljs-variable">$1</span><br>  %s/ngx_status/nginx_status/g<br>[root@xy nginx-1.2.6]# <span class="hljs-built_in">chmod</span> a+x nginx-status.sh  <br>[root@xy nginx-1.2.6]# <span class="hljs-built_in">mv</span> nginx-status.sh /etc/zabbix/zabbix_agentd.d/ <br>[root@xy ~]# vim /etc/zabbix/zabbix_agentd.conf  ✔<br>  UnsafeUserParameter=1  <br>  UserParameter=nginx.status[*],/etc/zabbix/zabbix_agentd.d/nginx-status.sh <span class="hljs-variable">$1</span>  <br>[root@xy ~]# service zabbix-agent restart<br>[root@xy ~]# yum -y install zabbix-get      <span class="hljs-comment"># 10.10.10.11 </span><br>[root@xy ~]# zabbix_get -s 10.10.10.12 -k <span class="hljs-string">&#x27;nginx.status[requests]&#x27;</span>  <br></code></pre></td></tr></table></figure><p><ahref="https://monitoringartist.github.io/zabbix-searcher/">Zabbix-templete下载</a></p><h4 id="zabbix-web场景组合图">3.7 Zabbix Web场景、组合图</h4><p><strong>监控主机–&gt; 创建应用集–&gt; 创建web场景–&gt;创建触发器</strong><br /><img src="/posts/48810125/zabbix-web%E5%9C%BA%E6%99%AF.png" class="" title="[zabbix-web场景]"><br /><img src="/posts/48810125/zabbix-web%E5%9C%BA%E6%99%AF1.png" class="" title="[zabbix-web场景1]"></p><p><strong>创建聚合图形–&gt; 编辑聚合图形–&gt; 添加组件</strong><br /><img src="/posts/48810125/zabbix-%E8%81%9A%E5%90%88%E5%9B%BE%E5%BD%A2.png" class="" title="[zabbix-聚合图形]"><br /><img src="/posts/48810125/zabbix-%E8%81%9A%E5%90%88%E5%9B%BE%E5%BD%A21.png" class="" title="[zabbix-聚合图形1]"></p><h4 id="zabbix-报警设置管理-报警媒介类型-创建媒体类型">3.8 Zabbix报警设置(管理–&gt; 报警媒介类型–&gt; 创建媒体类型)</h4><img src="/posts/48810125/%E9%A1%B5%E9%9D%A2%E8%AD%A6%E5%91%8A.png" class="" title="[页面警告]"><h5 id="邮件报警功能脚本指定路径查看-etczabbixzabbix_server.conf">3.8.1邮件报警功能（脚本指定路径查看: /etc/zabbix/zabbix_server.conf）</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>to=<span class="hljs-variable">$1</span><br>subject=<span class="hljs-variable">$2</span><br>context=<span class="hljs-variable">$3</span><br><span class="hljs-comment">#url=$4</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$context</span>&quot;</span> |mail -s <span class="hljs-string">&quot;<span class="hljs-variable">$subject</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$to</span>&quot;</span><br><br>vim /etc/mail.rc<br><span class="hljs-built_in">set</span> from=发件邮箱<br><span class="hljs-built_in">set</span> smtp=smtp服务器<br><span class="hljs-built_in">set</span> smtp-auth-user=发件人邮箱账户<br><span class="hljs-built_in">set</span> smtp-auth-password=发件人邮箱账户密码<br><span class="hljs-built_in">set</span> smtp-auth=login<br></code></pre></td></tr></table></figure><img src="/posts/48810125/mail.png" class="" title="[zabbix_mail]"><blockquote><p>注意: 若某个zabbix用户也想使用邮箱媒介报警，则需要在<code>管理--&gt; 用户--&gt; 报警媒介</code>中添加</p></blockquote><h4 id="创建动作触发器">3.9 创建动作(触发器)</h4><ul><li><p>脚本参数: <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml">&#123;<span class="hljs-string">ALERT.SENDTO</span>&#125;<br>&#123;<span class="hljs-string">ALERT.SUBJECT</span>&#125;<br>&#123;<span class="hljs-string">ALERT.MESSAGE</span>&#125;<br></code></pre></td></tr></table></figure></p></li><li><p>报警参数</p><ul><li><p>标题改为: <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">故障&#123;TRIGGER.STATUS&#125;,服务器:&#123;HOSTNAME1&#125;发生:&#123;TRIGGER.NAME&#125;故障!</span><br></code></pre></td></tr></table></figure></p></li><li><p>信息改为: <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css">告警主机:&#123;HOSTNAME1&#125;<br>告警时间:&#123;EVENT<span class="hljs-selector-class">.DATE</span>&#125; &#123;EVENT<span class="hljs-selector-class">.TIME</span>&#125;<br>告警等级:&#123;TRIGGER<span class="hljs-selector-class">.SEVERITY</span>&#125;<br>告警信息:&#123;TRIGGER<span class="hljs-selector-class">.NAME</span>&#125;<br>告警项目:&#123;TRIGGER<span class="hljs-selector-class">.KEY1</span>&#125;<br>问题详情:&#123;<span class="hljs-selector-tag">TIME</span><span class="hljs-selector-class">.NAME</span>&#125;:&#123;<span class="hljs-selector-tag">TIME</span><span class="hljs-selector-class">.VALUE</span>&#125;<br>当前状态:&#123;TRIGGER<span class="hljs-selector-class">.STATUS</span>&#125;:&#123;<span class="hljs-selector-tag">TIME</span><span class="hljs-selector-class">.VALUE1</span>&#125;<br>事件 ID:&#123;EVENT<span class="hljs-selector-class">.ID</span>&#125;<br></code></pre></td></tr></table></figure></p></li></ul></li><li><p>恢复参数</p><ul><li><p>标题改为: <figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">恢复</span><span class="hljs-template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="language-xml">,服务器:</span><span class="hljs-template-variable">&#123;HOSTNAME1&#125;</span><span class="language-xml">: </span><span class="hljs-template-variable">&#123;TRIGGER.NAME&#125;</span><span class="language-xml">已恢复!</span><br></code></pre></td></tr></table></figure></p></li><li><p>信息改为: <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css">告警主机:&#123;HOSTNAME1&#125;<br>告警时间:&#123;EVENT<span class="hljs-selector-class">.DATE</span>&#125; &#123;EVENT<span class="hljs-selector-class">.TIME</span>&#125;<br>告警等级:&#123;TRIGGER<span class="hljs-selector-class">.SEVERITY</span>&#125;<br>告警信息:&#123;TRIGGER<span class="hljs-selector-class">.NAME</span>&#125;<br>告警项目:&#123;TRIGGER<span class="hljs-selector-class">.KEY1</span>&#125;<br>问题详情:&#123;<span class="hljs-selector-tag">TIME</span><span class="hljs-selector-class">.NAME</span>&#125;:&#123;<span class="hljs-selector-tag">TIME</span><span class="hljs-selector-class">.VALUE</span>&#125;<br>当前状态:&#123;TRIGGER<span class="hljs-selector-class">.STATUS</span>&#125;:&#123;<span class="hljs-selector-tag">TIME</span><span class="hljs-selector-class">.VALUE1</span>&#125;<br>事件 ID:&#123;EVENT<span class="hljs-selector-class">.ID</span>&#125;<br></code></pre></td></tr></table></figure></p></li></ul></li></ul><img src="/posts/48810125/%E9%92%89%E9%92%89%E8%AD%A6%E5%91%8A.png" class="" title="[钉钉警告]"><img src="/posts/48810125/%E9%92%89%E9%92%89%E8%AD%A6%E5%91%8A1.png" class="" title="[钉钉警告1]">]]></content>
    
    
    <categories>
      
      <category>Devops, linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Devops</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Markdown</title>
    <link href="/posts/6fc8eab5.html"/>
    <url>/posts/6fc8eab5.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-11-Markdown <span id="more"></span></p><h2 id="主要内容">主要内容 <a id="back-to-top"></a></h2><blockquote><h4 id="markdown是什么">Markdown<em>是什么</em>？</h4><h4 id="谁创造了它"><em>谁</em>创造了它？</h4><h4 id="为什么要使用它"><em>为什么</em>要使用它？</h4><h4 id="怎么使用"><em>怎么</em>使用？</h4><h4 id="谁在用"><em>谁</em>在用？</h4><h4 id="尝试一下">尝试一下</h4></blockquote><h2 id="正文">正文</h2><h3 id="markdown是什么-1">1. Markdown<em>是什么</em>？</h3><p><strong>Markdown</strong>是一种轻量级<strong>标记语言</strong>，它以纯文本形式(<em>易读、易写、易更改</em>)编写文档，并最终以<ahref="#基于HTML">HTML格式发布</a>。<br /><strong>Markdown</strong>也可以理解为将以MARKDOWN语法编写的语言转换成HTML内容的工具。</p><h3 id="谁创造了它-1">2. <em>谁</em>创造了它？</h3><p>它由<a href="http://www.aaronsw.com/"><strong>AaronSwartz</strong></a>和<strong>John Gruber</strong>共同设计，<strong>AaronSwartz</strong>就是那位于去年（<em>2013年1月11日</em>）自杀,有着<strong>开挂</strong>一般人生经历的程序员。维基百科对他的<ahref="http://zh.wikipedia.org/wiki/%E4%BA%9A%E4%BC%A6%C2%B7%E6%96%AF%E6%B2%83%E8%8C%A8">介绍</a>是：<strong>软件工程师、作家、政治组织者、互联网活动家、维基百科人</strong>。</p><p>他有着足以让你跪拜的人生经历：<br />+ <strong>14岁</strong>参与RSS 1.0规格标准的制订。<br />+ <strong>2004</strong>年入读<strong>斯坦福</strong>，之后退学。<br />+ <strong>2005</strong>年创建<ahref="http://infogami.org/">Infogami</a>，之后与<ahref="http://www.reddit.com/">Reddit</a>合并成为其合伙人。<br />+ <strong>2010</strong>年创立求进会（DemandProgress），积极参与禁止网络盗版法案（SOPA）活动，最终该提案被撤回。<br />+<strong>2011</strong>年7月19日，因被控从MIT和JSTOR下载480万篇学术论文并以免费形式上传于网络被捕。<br />+ <strong>2013</strong>年1月自杀身亡, 天才都有早逝的归途。<img src="/posts/6fc8eab5/Aaron_Swartz.jpg" class="" title="[Aaron Swartz]"></p><h3 id="为什么要使用它-1">3. <em>为什么</em>要使用它？</h3><ul><li>它是易读（看起来舒服）、易写（语法简单）、易更改<strong>纯文本</strong>。处处体现着<strong>极简主义</strong>的影子。</li><li>兼容HTML，可以转换为HTML格式发布。</li><li>跨平台使用。</li><li>越来越多的网站支持Markdown。</li><li>更方便清晰地组织你的电子邮件。（Markdown-here, Airmail）</li><li>摆脱Word（我不是认真的）。</li></ul><h3 id="怎么使用-1">4. <em>怎么</em>使用？</h3><p>如果不算<strong>扩展</strong>，Markdown的语法绝对<strong>简单</strong>到让你爱不释手。</p><p>Markdown语法主要分为如下几大部分：<strong>标题</strong>，<strong>段落</strong>，<strong>区块引用</strong>，<strong>代码区块</strong>，<strong>强调</strong>，<strong>列表</strong>，<strong>分割线</strong>，<strong>链接</strong>，<strong>图片</strong>，<strong>反斜杠<code>\</code></strong>，<strong>符号’`’</strong>。</p><h4 id="标题">4.1 标题</h4><p>两种形式：<br />1）使用<code>=</code>和<code>-</code>标记一级和二级标题。<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">一级标题: =========   </span><br><span class="hljs-section">二级标题: ---------</span><br></code></pre></td></tr></table></figure></p><p>效果： &gt; 一级标题<br />&gt; =========<br />&gt; 二级标题 &gt; ———</p><p>2）使用<code>#</code>，可表示1-6级标题。 <figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs clean"># 一级标题   <br>## 二级标题   <br>### 三级标题   <br>#### 四级标题   <br>##### 五级标题   <br>###### 六级标题   <br></code></pre></td></tr></table></figure></p><p>效果： &gt; # 一级标题<br />&gt; ## 二级标题<br />&gt; ### 三级标题<br />&gt; #### 四级标题<br />&gt; ##### 五级标题<br />&gt; ###### 六级标题</p><h4 id="段落">4.2 段落</h4><p>段落的前后要有空行，所谓的空行是指没有文字内容。若想在段内强制换行的方式是使用<strong>两个以上</strong>空格加上回车（引用中换行省略回车）。</p><h4 id="区块引用">4.3 区块引用</h4><p>在段落的每行或者只在第一行使用符号<code>&gt;</code>,还可使用多个嵌套引用，如：<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&gt; 区块引用  <br><span class="hljs-meta prompt_">&gt;&gt;</span> 嵌套引用  <br></code></pre></td></tr></table></figure></p><p>效果： &gt; 区块引用<br />&gt;&gt; 嵌套引用</p><h4 id="代码区块">4.4 代码区块</h4><p>代码区块的建立是在每行加上4个空格或者一个制表符（如同写代码一样）。如<br />普通段落：</p><p>void main()<br />{<br />printf(“Hello, Markdown.”);<br />}</p><p>代码区块：</p><pre><code class="hljs">void main()&#123;    printf(&quot;Hello, Markdown.&quot;);&#125;</code></pre><p><strong>注意</strong>:需要和普通段落之间存在空行。</p><h4 id="强调">4.5 强调</h4><p>在强调内容两侧分别加上<code>*</code>或者<code>_</code>，如：<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-strong">*斜体*</span>，<span class="hljs-emphasis">_斜体_</span>    <br><span class="hljs-strong">**粗体**</span>，<span class="hljs-emphasis">__粗体__</span><br></code></pre></td></tr></table></figure></p><p>效果： &gt; <em>斜体</em>，<em>斜体</em><br />&gt; <strong>粗体</strong>，<strong>粗体</strong> &gt; <del>删除线</del><s>删除线（开启识别HTML标签时）</s></p><h4 id="列表">4.6 列表</h4><p>使用<code>·</code>、<code>+</code>、或<code>-</code>标记无序列表，如：<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">-（+\*） 第一项<br>-（+\*） 第二项<br><span class="hljs-bullet">- </span>（+\*）第三项<br></code></pre></td></tr></table></figure></p><p><strong>注意</strong>：标记后面最少有一个_空格_或_制表符_。若不在引用区块中，必须和前方段落之间存在空行。</p><p>效果： &gt; + 第一项 &gt; + 第二项 &gt; + 第三项</p><p>有序列表的标记方式是将上述的符号换成数字,并辅以<code>.</code>，如：<figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-number">1</span> . 第一项   </span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-number">2</span> . 第二项    </span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-number">3</span> . 第三项    </span><br></code></pre></td></tr></table></figure></p><p>效果： &gt; 1. 第一项 &gt; 2. 第二项 &gt; 3. 第三项</p><h4 id="分割线">4.7 分割线</h4><p>分割线最常使用就是三个或以上<code>*</code>，还可以使用<code>-</code>和<code>_</code>。</p><h4 id="链接">4.8 链接</h4><p>链接可以形式<br /><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-attr">[anyue967Blog]</span>(<span class="hljs-attribute">https</span>:<span class="hljs-comment">//anyue967.github.io/ &quot;Markdown&quot;)</span><br></code></pre></td></tr></table></figure></p><p>效果： &gt; <a href="https://anyue967.github.io/"title="Markdown">anyue967Blog</a></p><h4 id="图片">4.9 图片</h4><p>添加图片的形式和链接相似，只需在链接的基础上前方加一个<code>！</code>。<br />图片加链接 (Image + Link)<br /><a href="https://www.mdeditor.com/images/logos/markdown.png"title="markdown"><imgsrc="https://www.mdeditor.com/images/logos/markdown.png" /></a></p><h4 id="反斜杠">4.10 反斜杠<code>\</code></h4><p>相当于<strong>反转义</strong>作用。使符号成为普通符号。</p><h4 id="符号">4.11 符号’`’</h4><p>起到标记作用。如： <figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-string">`ctrl+a`</span><br></code></pre></td></tr></table></figure></p><p>效果： &gt;<code>ctrl+a</code></p><h4 id="gfm-task-list">4.12 GFM task list</h4><ul class="task-list"><li><label><input type="checkbox" checked="" />GFM task list1</label></li><li><label><input type="checkbox" checked="" />GFM task list2</label></li><li><label><input type="checkbox" />GFM task list 3</label><ul class="task-list"><li><label><input type="checkbox" />GFM task list 3-1</label></li><li><label><input type="checkbox" />GFM task list 3-2</label></li><li><label><input type="checkbox" />GFM task list 3-3</label></li></ul></li><li><label><input type="checkbox" />GFM task list 4</label><ul class="task-list"><li><label><input type="checkbox" />GFM task list 4-1</label></li><li><label><input type="checkbox" />GFM task list 4-2</label></li></ul></li></ul><h4 id="谁在用-1">5. <em>谁</em>在用？</h4><p>Markdown的使用者： + GitHub + 简书 + Stack Overflow + Apollo + Moodle+ Reddit + 等等</p><h4 id="尝试一下-1">6. 尝试一下</h4><ul><li><strong>Chrome</strong>下的插件诸如<code>stackedit</code>与<code>markdown-here</code>等非常方便，也不用担心平台受限。</li><li><strong>在线</strong>的dillinger.io评价也不错<br /></li><li><strong>Windowns</strong>下的MarkdownPad也用过，不过免费版的体验不是很好。<br /></li><li><strong>Mac</strong>下的Mou是国人贡献的，口碑很好。</li><li><strong>Linux</strong>下的ReText不错。</li></ul><p><strong>当然，最终境界永远都是笔下是语法，心中格式化:)。</strong></p><hr /><p><strong>注意</strong>：不同的Markdown解释器或工具对相应语法（扩展语法）的解释效果不尽相同，具体可参见工具的使用说明。虽然有人想出面搞一个所谓的标准化的Markdown，[没想到还惹怒了健在的创始人JohnGruber](http://blog.codinghorror.com/standard-markdown-is-now-common-markdown/)。 **** 以上基本是所有traditonal markdown的语法。</p><h3 id="表格">7.表格：</h3><p>可以使用<code>|</code>创建表格和连字符<code>-</code>用于创建每个列的标题，而<code>|</code>用于分隔每个列。必须在表格前面加一个空行才能正确呈现。<code>:</code>居中、居左与居右对齐</p><table><thead><tr><th>First Header</th><th>Second Header</th></tr></thead><tbody><tr><td>Content Cell</td><td>Content Cell</td></tr><tr><td>Content Cell</td><td>Content Cell</td></tr></tbody></table><table><thead><tr><th style="text-align: left;">Left-aligned</th><th style="text-align: center;">Center-aligned</th><th style="text-align: right;">Right-aligned</th></tr></thead><tbody><tr><td style="text-align: left;">git status</td><td style="text-align: center;">git status</td><td style="text-align: right;">git status</td></tr><tr><td style="text-align: left;">git diff</td><td style="text-align: center;">git diff</td><td style="text-align: right;">git diff</td></tr></tbody></table><p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p><h3 id="锚点">8.锚点</h3><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-name">这是一个锚点</span>](#锚点在这里)  <br></code></pre></td></tr></table></figure><h1 id="锚点在这里">锚点在这里: <a id="锚点id"></a></h1><h3 id="锚点的使用">8.锚点的使用</h3><p><a href="#正文">回到顶部1</a><br /><a href="#back-to-top">回到顶部2</a><br /><a href="#back-to-top" target="_self">回到顶部</a></p>]]></content>
    
    
    <categories>
      
      <category>markdown</category>
      
    </categories>
    
    
    <tags>
      
      <tag>markdown</tag>
      
      <tag>story</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>wordpress部署</title>
    <link href="/posts/137599dc.html"/>
    <url>/posts/137599dc.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-11-WordPress <span id="more"></span></p><h2 id="redhat系统">redhat系统</h2><h2 id="软件版本">软件版本:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wget https://wordpress.org/latest.tar.gz <br>$ wget https://cdn.mysql.com//Downloads/MySQL-5.7/ mysql-5.7.27-1.el7.x86_64.rpm-bundle.tar <span class="hljs-comment"># rpm</span><br>$ wget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.27-el7-x86_64.tar.gz <span class="hljs-comment"># 二进制包 </span><br>$ wget http://mirrors.tuna.tsinghua.edu.cn/apache//httpd/httpd-2.4.39.tar.gz`  <br>$ wget https://www.php.net/distributions/php-7.3.7.tar.bz2  <br></code></pre></td></tr></table></figure><h2 id="安装依赖">安装依赖:</h2><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs livescript">$ yum install -y apr* <span class="hljs-string">\</span> <br>  autoconf automake bison bzip2 bzip2* <span class="hljs-string">\</span><br>  compat* cpp curl curl-devel fontconfig fontconfig-devel <span class="hljs-string">\</span><br>  freetype freetype* freetype-devel gcc gcc-c++ gd <span class="hljs-string">\</span> <br>  gettext gettext-devel glibc kernel kernel-headers <span class="hljs-string">\</span><br>  keyutils keyutils-libs-devel krb5-devel libcom_err-devel <span class="hljs-string">\</span> <br>  libpng libpng-devel libjpeg* libsepol-devel libselinux-devel <span class="hljs-string">\</span> <br>  libstdc++-devel libtool* libgomp libxml2 libxml2-devel libXpm* <span class="hljs-string">\</span> <br>  libtiff libtiff* make mpfr ncurses* ntp openssl openssl-devel <span class="hljs-string">\</span><br>  patch pcre-devel perl php-common php-gd policycoreutils telnet <span class="hljs-string">\</span><br>  t1lib t1lib* nasm nasm* wget zlib-devel<br>  <br>$ tar -xzvf cmake-<span class="hljs-number">3.15</span>.<span class="hljs-number">1.tar</span>.gz   <br>$ ./configure<br>$ make &amp;&amp; make install  <br></code></pre></td></tr></table></figure><h3 id="部署软件">1. 部署软件:</h3><ul><li><strong><ahref="https://www.cnblogs.com/ftl1012/p/9302206.html">参考文档1</a></strong><br /></li><li><strong><ahref="https://www.cnblogs.com/apollo1616/p/10205216.html">参考文档2</a></strong><br /></li><li><strong><ahref="https://www.cnblogs.com/wujuntian/p/8183952.html">参考文档3</a></strong><br /></li><li><strong><ahref="https://www.cnblogs.com/inana/p/7545103.html">参考文档4</a></strong></li></ul><h4 id="rpm安装mysql">1.1 RPM安装Mysql:</h4><blockquote><p>在安装之前, 首先要查看的是, 系统中有没有已经安装过的情况, 键入<code>rpm -qa|grep mysql</code> ,如果无任何显示，则表示没有安装过相关组件, 如果有, 则根据显示出来的名字,键入<code>rpm -e --nodeps XXXX</code>(星号为你要删除的文件名字),接着键入<code>rpm -qa|grep mariadb</code>, rpm 删除时如果有依赖关系,可以用<code>yum remove XXXX</code>; 同样的步骤, 把出现的文件删除;两步都完成后, 可以开始安装所需要的包了</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$ tar -xvf mysql-<span class="hljs-number">5.7</span>.<span class="hljs-number">27</span>-<span class="hljs-number">1</span><span class="hljs-selector-class">.el7</span><span class="hljs-selector-class">.x86_64</span><span class="hljs-selector-class">.rpm-bundle</span><span class="hljs-selector-class">.tar</span>   <br>$ yum remove mariadb-libs-<span class="hljs-number">5.5</span>.<span class="hljs-number">35</span>-<span class="hljs-number">3</span><span class="hljs-selector-class">.el7</span>.x86_64<br></code></pre></td></tr></table></figure><p><strong><em>依次安装, 各包之间有依赖关系</em></strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ rpm -ivh mysql-community-common-5.7.27-1.el7.x86_64.rpm <br>$ rpm -ivh mysql-community-libs-5.7.27-1.el7.x86_64.rpm  <br>$ rpm -ivh mysql-community-client-5.7.27-1.el7.x86_64.rpm <br>$ rpm -ivh mysql-community-server-5.7.27-1.el7.x86_64.rpm <br>$ find / -name mysql -<span class="hljs-built_in">print</span>  <br>$ rpm -ql XXXX.rpm<span class="hljs-comment">#查看安装路路径</span><br></code></pre></td></tr></table></figure></p><ul><li>数据库目录: <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/mysql/</span><br></code></pre></td></tr></table></figure></li><li>配置文件: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/share/mysql <span class="hljs-comment">#(mysql.server命令及配置文件)</span><br></code></pre></td></tr></table></figure></li><li>相关命令: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/bin <span class="hljs-comment"># (mysqladmin mysqldump等命令)</span><br></code></pre></td></tr></table></figure></li><li>启动脚本: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/rc.d/init.d/   <span class="hljs-comment"># (启动脚本文件mysql的目录)  </span><br>$ vim /etc/my.cnf  <br><span class="hljs-comment"># For advice on how to change settings please see</span><br><span class="hljs-comment"># http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html</span><br>[mysqld]<br>...<br>skip-grant-tables<span class="hljs-comment"># 添加</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="二进制安装mysql">1.2 二进制安装Mysql:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ tar -xzvf mysql-5.7.27-el7-x86_64.tar.gz<br>$ groupadd mysql<br>$ useradd -r -g mysql -s /sbin/nologin mysql      <span class="hljs-comment"># -r 创建系统账户  </span><br>$ <span class="hljs-built_in">mv</span> ./mysql-5.7.27-el7-x86_64 /usr/local/mysql<br>$ <span class="hljs-built_in">mkdir</span> /usr/local/mysql/data<br>$ <span class="hljs-built_in">chown</span> -Rf mysql:mysql /usr/local/mysql/<br><br>$ <span class="hljs-built_in">cd</span> /usr/local/mysql/bin<br>$ ./mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/myslq/data<br>[Note] A temporary password is generated <span class="hljs-keyword">for</span> root@localhost: C#ePz?uG+9a.  <span class="hljs-comment"># 初始密码</span><br><br>$ <span class="hljs-built_in">mkdir</span> /var/lib/mysql <br>$ <span class="hljs-built_in">ln</span> -s /usr/local/mysql/lib/ /usr/lib/mysql<br>$ <span class="hljs-built_in">ln</span> -s /tmp/mysql.sock /var/lib/mysql/mysql.sock<br>$ <span class="hljs-built_in">ln</span> -s /usr/local/mysql/include/mysql /usr/include/mysql<br><br><span class="hljs-comment"># 配置文件</span><br>$ vim /etc/cnf<span class="hljs-comment"># 配置文件</span><br>  [mysqld]<br>  <span class="hljs-comment">#skip-grant-tables</span><br>  secure_file_priv=<span class="hljs-string">&quot;/usr/local/mysql&quot;</span><br>  port = 3306<br>  basedir = /usr/local/mysql<br>  datadir = /usr/local/mysql/data<br>  socket=/tmp/mysql.sock<br>  pid-file=/usr/local/mysql/data/mysql.pid<br>  log-error=/usr/local/mysql/data/error.log<br>  character_set_server=utf8<br>  user=mysql<br>  max_connections=1500<br>  symbolic-links=0<br>  !includedir /etc/my.cnf.d            <br>$ <span class="hljs-built_in">mkdir</span> /etc/my.cnf.d      <br>$ <span class="hljs-built_in">cp</span> ./support-files/mysql.server /etc/rc.d/init.d/mysqld<br>  46 basedir=/usr/local/mysql  <br>  47 datadir=/usr/local/mysql/data  <br>$ service mysqld start    <br>$ chkconfig mysqld on<br></code></pre></td></tr></table></figure><h4 id="源码编译安装mysql">1.3 源码编译安装Mysql:</h4><p><strong><ahref="https://www.cnblogs.com/galengao/p/5755788.html">源码安装参考</a></strong></p><ul><li>安装boost(若只是安装mysql, 不用安装, 编译引用解包路径即可)<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wget https://nchc.dl.sourceforge.net/project/boost/boost/1.59.0/boost_1_59_0.tar.gz    <br>$ tar xzf boost_1_59_0.tar.gz <br>$ <span class="hljs-built_in">cd</span> boost_1_59_0  <br>$ ./bootstrap.sh  <br>$ ./b2 install<br>$ useradd -r -s /sbin/nologin mysql<br>$ mkdie /usr/local/mysql/data<br>$ <span class="hljs-built_in">chown</span> -Rf mysql:mysql /usr/local/mysql  <br>$ <span class="hljs-built_in">mkdir</span> build &amp;&amp; <span class="hljs-built_in">cd</span> build<br>$ cmake .. \<br>  -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \<br>  -DMYSQL_DATADIR=/usr/local/mysql/data \<br>  -DMYSQL_USER=mysql \<br>  -DSYSCONFDIR=/etc \<br>  -DMYSQL_UNIX_ADDR=/usr/local/mysql/mysql.sock \<br>  -DWITH_DEBUG=0 \<br>  -DEXTRA_CHARSETS=all \<br>  -DDEFAULT_CHARSET=utf8 \ <br>  -DDEFAULT_COLLATION=utf8_general_ci \<br>  -DWITH_BOOST=boost<br>$ make -j 4 &amp;&amp; make install  <br>$ <span class="hljs-built_in">cp</span> /etc/my.cnf /etc/my.cnf.bak <br>$ <span class="hljs-built_in">cd</span> /usr/local/mysql/bin<br>$ ./mysqld --initialize-insecure \<br>  --user=mysql \<br>  --basedir=/usr/local/mysql \<br>  --datadir=/usr/local/myslq/data <br>  [Note] A temporary password is generated <span class="hljs-keyword">for</span> root@localhost: Plip9_BU81ZA<br>$ ./mysql_ssl_rsa_setup \<br>  --user=mysql \<br>  --basedir=/usr/local/mysql \<br>  --datadir=/usr/local/mysql/data<br></code></pre></td></tr></table></figure></li></ul><p><strong>接下来配置如二进制安装方法</strong> <strong>关于Mysql: ERROR1819 (HY000): Your password does not satisfy the current policyrequirements解决方法:</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs SQL">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;validate_password%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+--------+</span><br><span class="hljs-operator">|</span> Variable_name                        <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+--------+</span><br><span class="hljs-operator">|</span> validate_password_check_user_name    <span class="hljs-operator">|</span> OFF    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> validate_password_dictionary_file    <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> validate_password_length             <span class="hljs-operator">|</span> <span class="hljs-number">8</span>      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> validate_password_mixed_case_count   <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> validate_password_number_count       <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> validate_password_policy             <span class="hljs-operator">|</span> MEDIUM <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> validate_password_special_char_count <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+--------+</span><br><span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> validate_password_policy<span class="hljs-operator">=</span>LOW;  # 设置校验等级<br>  Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec) <br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> validate_password_length<span class="hljs-operator">=</span><span class="hljs-number">6</span>;    # 设置密码长度<br>  Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>  Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> privileges <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> root@<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">grant</span> option; <br>  Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h4 id="安装apache">1.4 安装Apache:</h4><ul><li><p>安装依赖：</p></li><li><p>pcre <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -xzvf pcre-8.43.tar.gz<br>./configure --prefix=/usr/local/pcre<br>`make &amp;&amp; make install<br></code></pre></td></tr></table></figure></p></li><li><p>apr <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -xzvf apr-1.7.0.tar.gz<br>./configure --prefix=/usr/local/apr<br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure></p></li><li><p>apr-util <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar -xzvf apr-util-1.6.1.tar.gz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr</span><br>make &amp;&amp; make install<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">useradd www -s /sbin/nologin</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">./configure --prefix=/usr/local/apache24 \</span><br><span class="language-bash">  --with-mysql=/usr/local/mysql \</span><br><span class="language-bash">  --with-pcre=/usr/local/pcre \</span><br><span class="language-bash">  --with-apr=/usr/local/apr \</span><br><span class="language-bash">  --with-apr-util=/usr/local/apr-util \</span><br><span class="language-bash">  --with-openssl=/usr/local/openssl \</span><br><span class="language-bash">  --with-zlib=/usr/local/zlib \</span><br><span class="language-bash">  --with-mpm=prefork \</span><br><span class="language-bash">  --enable-modules=most \</span><br><span class="language-bash">  --enable-rewrite \</span><br><span class="language-bash">  --enable-shared=max \</span><br><span class="language-bash">  --enable-so \</span><br><span class="language-bash">  --enable-mpms-shared=all \</span><br><span class="language-bash">  --enable-ssl \</span><br><span class="language-bash">  --enable-cgi \</span><br><span class="language-bash">  --enable-mpms-shared=all</span> <br></code></pre></td></tr></table></figure></p></li><li><p>自启动脚本配置 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/local/apache/bin<br>vim httpd<span class="hljs-comment"># 编辑自启动脚本</span><br>  <span class="hljs-comment">#!/bin/bash</span><br>  <span class="hljs-comment"># chkconfig:2345 80 90</span><br>  <span class="hljs-comment"># description:Apache httpd</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">start_http</span></span>()<br>  &#123;<br>    /usr/local/apache24/bin/apachectl  start<br>  &#125;<br>  <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">stop_http</span></span>()<br>  &#123;<br>    /usr/local/apache24/bin/apachectl  stop<br>  &#125;<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-keyword">in</span><br>  start)<br>    start_http<br>  ;;  <br>  stop)<br>    stop_http<br>  ;;  <br>  restart)<br>    stop_http<br>    start_http<br>  ;;<br>  *)<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Usage : start | stop | restart&quot;</span><br>  ;;<br>  <span class="hljs-keyword">esac</span><br>    <br>$ <span class="hljs-built_in">chmod</span> a+x httpd<br>$ <span class="hljs-built_in">cp</span> -frp ./httpd /etc/init.d<span class="hljs-comment"># -f强制合并, 不询问-r递归合并-p保持文件属性不变</span><br>$ systemctl daemon-reload<br>$ systemctl start httpd<br>$ chkconfig --add httpd  <span class="hljs-comment"># 设置开机自启</span><br>$ vim ./apache24/conf/httpd.conf<br>  164 User deamon --&gt;User www<br>  165 Group deamon --&gt;Group www<br>  196 <span class="hljs-comment">#ServerName www.example.com:80 --&gt;ServerName localhost:80</span><br>$ firewall-cmd --permanent --add-service=http<br>$ firewall-cmd --permanent --add-service=http<br>$ firewall-cmd --reload <br></code></pre></td></tr></table></figure></p></li><li><p>测试: 192.168.10.130 –&gt;It Works!</p></li><li><p>问题1:</p><ul><li><strong>服务不支持chkconfig的解决?</strong><br /></li><li><strong>解决方法:</strong> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"> httpd 脚本的开头要这样加：  <br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#chkconfig:345 61 61 # 此行的345参数表示, 在哪些运行级别启动</span><br><span class="hljs-comment">#description:Apache httpd # 此行必写,描述服务.</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>level<等级代号> 　指定读系统服务要在哪一个执行等级中开启或关毕。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#等级0表示：表示关机</span><br><span class="hljs-comment">#等级1表示：单用户模式</span><br><span class="hljs-comment">#等级2表示：无网络连接的多用户命令行模式</span><br><span class="hljs-comment">#等级3表示：有网络连接的多用户命令行模式</span><br><span class="hljs-comment">#等级4表示：不可用</span><br><span class="hljs-comment">#等级5表示：带图形界面的多用户模式</span><br><span class="hljs-comment">#等级6表示：重新启动</span><br></code></pre></td></tr></table></figure></p></li><li><p><ahref="https://anyue967.github.io/2019/06/11/LNMP架构部署动态网站环境/">nginx参考</a></p></li></ul><h4 id="安装php7httppecl.php.net">1.5安装PHP7(http://pecl.php.net):</h4><ul><li><p><ahref="https://anyue967.github.io/2019/06/11/LNMP架构部署动态网站环境/">依赖包安装见</a><br /></p></li><li><p><ahref="https://blog.csdn.net/zhou75771217/article/details/83303058">编译参考</a><br /></p></li><li><p><ahref="https://blog.csdn.net/m0_37886429/article/details/79643078">PHP整合apache参考</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wget wget https://nih.at/libzip/libzip-1.2.0.tar.gz <br>$ tar -xzvf libzip-1.2.0.tar.gz<br>$ <span class="hljs-built_in">cd</span> libzip-1.2.0/<br>$ <span class="hljs-built_in">mkdir</span> build &amp;&amp; <span class="hljs-built_in">cd</span> build<br>$ cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local/libzip <br>$ make &amp;&amp; make install <br></code></pre></td></tr></table></figure></p></li><li><p>问题1:</p><ul><li><strong>off_t undefined?</strong><br /></li><li><strong>解决方法:</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/usr/local/libgd/lib<br>$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;/usr/local/lib64 # error: off_t undefined; </span><br><span class="hljs-string">  /usr/local/lib </span><br><span class="hljs-string">  /usr/lib </span><br><span class="hljs-string">  /usr/lib64&#x27;</span>&gt;&gt;/etc/ld.so.conf<br>$ ldconfig -v<br></code></pre></td></tr></table></figure></li></ul></li><li><p>问题2:</p><ul><li><strong>如何让apache支持解析PHP?</strong><br /></li><li><strong>解决方法:</strong><br /></li></ul></li><li><p>编译PHP必须加<strong>–with-apxs2=/usr/local/apache24/bin/apxs</strong>, 目的是在/usr/local/apache24/modules 下生成对应的libphp7.so <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./configure \<br>  --prefix=/usr/local/php73 \<br>  --with-config-file-path=/usr/local/php73/etc \<br>  --with-apxs2=/usr/local/apache24/bin/apxs \<br>  --enable-mysqlnd \<br>  --with-mysqli=mysqlnd \<br>  --with-mysql-sock=/tmp/mysql.sock \<br>  --with-pdo-mysql=mysqlnd \<br>  --enable-inline-optimization \<br>  --enable-opcache --enable-fpm \<br>  --with-fpm-user=www --with-fpm-group=www \<br>  --with-gettext --with-iconv --with-mhash \<br>  --with-openssl=/usr/local/openssl \<br>  --enable-bcmath --enable-soap \<br>  --with-libxml-dir --enable-libxml --enable-pcntl \<br>  --enable-shmop --enable-sysvsem --enable-sockets \<br>  --with-curl --with-zlib-dir=/usr/local/zlib \<br>  --enable-zip --with-gd \<br>  --with-png-dir=/usr/local/libpng \<br>  --with-jpeg-dir=/usr/local/jpeg \<br>  --with-freetype-dir=/usr/local/freetype \<br>  --with-xpm-dir=/usr \<br>  --with-libzip=/usr/local/libzip \<br>  --without-pear --with-tidy=/usr/local/tidy \<br>  --enable-xml --enable-mbregex \<br>  --enable-mbstring --enable-ftp \<br>  --with-xmlrpc --enable-session \<br>  --enable-ctype <br></code></pre></td></tr></table></figure><strong>php.ini-production / php.ini-devlopmentphp.ini–&gt;php.ini</strong> <strong>php-fpm.conf.default–&gt;php-fpm.conf</strong> <strong>sapi/fpm/init.d.php-fpm–&gt;/etc/rc.d/init.d/php-fpm</strong></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">php.ini-development<br>php.ini-production<br>$ <span class="hljs-built_in">mv</span> /etc/php.ini /etc/php.ini.bak<br>$ <span class="hljs-built_in">cp</span> php.ini-production /usr/local/php73/etc/php.ini<br>$ <span class="hljs-built_in">ln</span> -s /usr/local/php73/etc/php.ini /etc/php.ini<br>$ <span class="hljs-built_in">cp</span> /usr/local/php73/etc/php-fpm.conf.default /usr/local/php73/etc/php-fpm.conf<br>$ <span class="hljs-built_in">ln</span> -s /usr/local/php73/etc/php-fpm.conf /etc/php-fpm.conf<br>$ vim /usr/local/php73/etc/php-fpm.conf<br>  17 pid = run/php-fpm.pid<br><br>$ <span class="hljs-built_in">cp</span> sapi/fpm/init.d.php-fpm /etc/rc.d/init.d/php-fpm<br>$ <span class="hljs-built_in">chmod</span> 755 /etc/rc.d/init.d/php-fpm<br>$ chkconfig php-fpm on<br></code></pre></td></tr></table></figure><p><strong>注意: PHP7里的用户设置在如下文件中配置,而不是在php-fpm.conf中</strong> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/local/php73/etc/php-fpm.d<br>$ <span class="hljs-built_in">cp</span> ./www.conf.default www.conf<br>$ vim ./www/conf<br>  user=www<br>  group=www<br></code></pre></td></tr></table></figure></p><p><strong>注意 httpd.conf 配置:</strong> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">162 LoadModule php7_module        modules/libphp7.so<br>173 User www<br>174 Group www<br>206 ServerName localhost:80<br><br>263 &lt;IfModule dir_module&gt;<br>264     DirectoryIndex index.html index.php<br>265 &lt;/IfModule&gt;<br><br>400     AddType application/x-compress .Z<br>401     AddType application/x-gzip .gz .tgz<br>402     AddType application/x-httpd-php .php<span class="hljs-comment"># 增加的</span><br></code></pre></td></tr></table></figure></p><p>问题1: <strong>checking for libzip… not found configure: error:Please reinstall the libzip distribution</strong> <strong>解决方法:<ahref="https://www.hahack.com/codes/cmake/">参考</a></strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -s /usr/local/libzip/lib/libzip/include/zipconf.h /usr/local/include/zipconf.h<br></code></pre></td></tr></table></figure></p><p>问题2: <strong>error: ‘INT_MAX’ undeclared (first use in thisfunction)</strong><br /><strong><em>解决方法:</em></strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#define INT_MAX 4096# 声明宏定义  </span><br><span class="hljs-comment">#include &quot;/usr/include/limits.h&quot;</span><br></code></pre></td></tr></table></figure></p><p>问题3: <strong>configure: WARNING: unrecognized options: –with-mysql,–with-vpx-dir, –with-t1lib, –enable-gd-native-ttf,–with-mcrypt</strong><br /><strong>解决方法:</strong> + 对于PHP7, –with-mysql 不适用:更改为<code>--with-pdo-mysql</code>;<br />+ 对于64位系统, 出现 –with-t1lib 执行: -<code>ln -s /usr/lib64/libltdl.so /usr/lib/libltdl.so</code> -<code>cp -frp /usr/lib64/libXpm.so* /usr/lib</code> + 对于 –with-mcrypt:从PHP7.2开始, Mcrypt no longer provided, <ahref="https://webtatic.com/packages/php72/">参考</a>;<br />+ 对于 –enable-gd-native-ttf: 同–with-mcrypt;<br />+ 对于 –with-vpx-dir: <ahref="https://www.php.net/manual/zh/image.installation.php">参考</a>,要激活 GD 支持, 配置 PHP 时加上 –with-gd[=DIR], DIR 是 GD的基本安装目录, 要使用推荐的绑定的 GD 库版;</p><h3 id="测试">2. 测试:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cd</span> /usr/local/apache24/htdocs/wordpress<br>$ <span class="hljs-built_in">cp</span> ../wp-config-sample.php wp-config.php<br>$ vim wp-config.php<br>  22 /** WordPress数据库的名称 */<br>  23 define( <span class="hljs-string">&#x27;DB_NAME&#x27;</span>, <span class="hljs-string">&#x27;wordpress&#x27;</span> );<br>  24 <br>  25 /** MySQL数据库用户名 */<br>  26 define( <span class="hljs-string">&#x27;DB_USER&#x27;</span>, <span class="hljs-string">&#x27;wordpress&#x27;</span> );<br>  27 <br>  28 /** MySQL数据库密码 */<br>  29 define( <span class="hljs-string">&#x27;DB_PASSWORD&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span> );<br></code></pre></td></tr></table></figure><p><strong>IP:80/wordpress</strong><br /><strong>IP:80/wordpress/wp-login.php?loggedout=true</strong><br /><strong><a href="https://cn.gravatar.com">A Globally RecognizedAvatar</a></strong></p>]]></content>
    
    
    <categories>
      
      <category>Devops, linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Devops</tag>
      
      <tag>网站</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux服务配置02</title>
    <link href="/posts/b0672b6e.html"/>
    <url>/posts/b0672b6e.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-11-Linux服务配置02 <span id="more"></span></p><h2 id="目录">目录 <a id="back"></a></h2><ul><li><a href="#vsftp" target="_self">FTP 服务</a></li><li><a href="#samba" target="_self">Samba 服务</a></li><li><a href="#nfs" target="_self">NFS 服务</a></li><li><a href="#autofs" target="_self">Autofs 挂载服务</a></li><li><a href="#bind" target="_self">Bind 域名解析服务</a></li><li><a href="#dhcp" target="_self">DHCP 服务</a></li><li><a href="#email" target="_self">邮件系统</a></li></ul><h3 id="使用vsftpd服务传输文件">1. 使用vsftpd服务传输文件<a id="vsftp"></a></h3><ul><li>工作模式(服务端默认端口: 21命令端口, 20数据传输端口)<ul><li><p>主动模式(PORT):客户端用本地随机端口<code>(N&gt;1024)</code>连接至服务端<code>21命令端口</code>,客户端开始监听端口<code>N+1</code>,并发送命令<code>PORT N+1</code>给服务端,服务端以<code>数据端口20</code>连接到客户端指定的的数据端口<code>N+1</code></p></li><li><p>被动模式(PASV):客户端用本地随机端口<code>(N&gt;1024)</code>连接至服务端<code>21命令端口</code>,客户端开始监听端口<code>N+1</code>, 并发送命令<code>PASV</code>给服务端,服务端会开启任意端口<code>(P&gt;1024)</code>,并发送<code>PORT P</code>给客户端,客户端发起从本地端口<code>N+1</code>到服务端的端口P的连接用来传输数据<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/vsftpd/vsftpd.conf<br>  pasv_enable=YES<br>  pasv_min_port=30000<br>  pasv_max_port=35000<br></code></pre></td></tr></table></figure></p></li></ul></li><li>传输模式<ul><li>二进制(Binary):不对数据进行处理，传输可执行文件、压缩文件、图片等</li><li>ASCII: 自适应目标系统的结束符</li></ul></li><li>验证方式<ul><li>匿名用户(ftp/anonymous)</li><li>本地用户</li><li>系统用户</li><li>虚拟用户</li></ul></li></ul><h3 id="服务端">2. 服务端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install vsftpd  <br>[root@xy ~]# iptables -F<br>[root@xy ~]# service iptables save   <br>[root@xy ~]# <span class="hljs-built_in">mv</span> /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf_bak  <span class="hljs-comment"># 备份</span><br>[root@xy ~]# grep -v <span class="hljs-string">&quot;#&quot;</span> /etc/vsftpd/vsftpd.conf_bak &gt; /etc/vsftpd/vsftpd.conf  <br>[root@xy ~]# <span class="hljs-built_in">cat</span> /etc/vsftpd/vsftpd.conf<br></code></pre></td></tr></table></figure><h4 id="常用参数">2.1 常用参数:</h4><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>listen=[YES/NO]</code></td><td>是否以独立运行方式监听</td></tr><tr><td>listen_address=IP</td><td>设置要监听的IP</td></tr><tr><td>listen_port=21</td><td>设置FTP服务的监听端口</td></tr><tr><td><code>download _enable=[YES/NO]</code></td><td>是否允许下载</td></tr><tr><td><code>userlist_enable=[YES/NO]</code></td><td>设置用户列表为允许/禁止操作</td></tr><tr><td><code>userlist_deny=[YES/NO]</code></td><td>—</td></tr><tr><td>max_client=0</td><td>最大客户连接数 0不限制</td></tr><tr><td>max_per_ip=0</td><td>同一IP最大连接数</td></tr><tr><td><code>anonymous_enable=[YES/NO]</code></td><td>是否允许匿名用户访问</td></tr><tr><td><code>anon_upload_enable=[YES/NO]</code></td><td>是否允许匿名用户上传文件</td></tr><tr><td>anon_umask=022</td><td>匿名用户上传文件的umask值</td></tr><tr><td>anon_root=/var/ftp</td><td>匿名用户FTP根目录 ✔</td></tr><tr><td><code>anon_mkdir_write_enable=[YES/NO]</code></td><td>是否允许匿名用户创建目录</td></tr><tr><td><code>anon_other_write_enable=[YES/NO]</code></td><td>是否允许匿名用户其他写入权限 重命名 删除等</td></tr><tr><td>anon_max_rate=0</td><td>匿名用户最大传输速率</td></tr><tr><td><code>local_enable=[YES/NO]</code></td><td>是否允许本地用户登陆FTP</td></tr><tr><td>local_umask=022</td><td>本地用户上传文件的umask值</td></tr><tr><td>local_root=/var/ftp</td><td>本地用户FTP根目录 ✔</td></tr><tr><td><code>chroot_local_user=[YES/NO]</code></td><td>是否将用户权限禁锢在FTP目录,以确保安全</td></tr><tr><td>local_max_rate=0</td><td>本地用户最大传输速率</td></tr></tbody></table><h4 id="匿名用户模式开发权限参数">2.2 匿名用户模式开发权限参数:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">anonymous_enable=YES   <br>local_enable = YES<br>write_enable = YES<br>local_umask = 022<br>anon_umask=022 <br>anon_upload_enable=YES <br>anon_mkdir_write_enable=YES            <br>anon_other_write_enable=YES   <br>anno_root=/var/ftp     <span class="hljs-comment"># 匿名用户默认的FTP根目录 /var/ftp/pub </span><br>anno_other_write_enable = YES<br>dirmessage_enable = YES<br>xferlog_enable = YES<br>connect_from_port_20 = YES<br>xferlog_std_format = YES<br>listen_ipv6 = YES<br>pam_service_name = vsftpd<br>userlist_enable = YES<br>tcp_wrappers = YES<br>anno_max_rate=0<br></code></pre></td></tr></table></figure><h4 id="客户端">2.3 客户端:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install ftp　　　<span class="hljs-comment"># ftp是Linux以命令行的方式管理FTP传输服务的客户端工具  </span><br>[root@xy ~]# ftp 192.168.37.10   <br>  Connected to 192.168.37.10 (192.168.37.10).  <br>  220 (vsFTPd 3.0.2)  <br>  Name (192.168.37.10:root): anonymous  <br>  331 Please specify the password.  <br>  Password:  <br>  230 Login successful.  <br>  Remote system <span class="hljs-built_in">type</span> is UNIX.  <br>  Using binary mode to transfer files.  <br>  ftp&gt; <span class="hljs-built_in">cd</span> pub  <br>  250 Directory successfully changed.  <br>  ftp&gt; <span class="hljs-built_in">mkdir</span> files  <br>  550 Permission denied   <span class="hljs-comment"># 提示没有权限, 查看默认访问目录/var/ftp权限  </span><br>  ftp&gt; <span class="hljs-built_in">exit</span>  <br>  221 Goodbye.<br><br>[root@xy ~]# <span class="hljs-built_in">ls</span> -ld /var/ftp/pub　    <span class="hljs-comment"># ls -Zdl  </span><br>  drwxr-xr-x. 2 root root 6 Mar  7  2014 /var/ftp/pub    <br>[root@xy ~]# <span class="hljs-built_in">chown</span> -Rf ftp /var/ftp/pub　<span class="hljs-comment"># 更改目录所属主身份为ftp</span><br>[root@xy ~]# <span class="hljs-built_in">ls</span> -ld /var/ftp/pub  <br>  drwxr-xr-x. 2 ftp root 6 Mar  7  2014 /var/ftp/pub<br>[root@xy ~]# ftp 192.168.37.10<br>  ... <br>  550 Create directory operation failed.   <span class="hljs-comment"># 提示创建目录失败, 原因所在SElinux</span><br>[root@xy ~]# getsebool -a | grep ftp  <span class="hljs-comment"># getsebool -a</span><br>  ftp_home_dir --&gt; off  <br>  ftpd_anon_write --&gt; off  <br>  ftpd_connect_all_unreserved --&gt; off  <br>  ftpd_connect_db --&gt; off  <br>  ftpd_full_access --&gt; off       <span class="hljs-comment"># ftp 全部权限未开启 off 改为 on</span><br>[root@xy ~]# setsebool -P ftpd_full_access=on　 <span class="hljs-comment"># -P permanent       </span><br>[root@xy ~]# ftp 192.168.37.10  <br>  Connected to 192.168.37.10 (192.168.37.10).  <br>  220 (vsFTPd 3.0.2)  <br>  Name (192.168.37.10:root): anonymous   <span class="hljs-comment"># 匿名模式默认名称: anonymous  </span><br>  331 Please specify the password.  <br>  Password:  <br>  230 Login successful.  <br>  Remote system <span class="hljs-built_in">type</span> is UNIX. <br>  Using binary mode to transfer files.  <br>  ftp&gt; <span class="hljs-built_in">cd</span> pub  <br>  250 Directory successfully changed.  <br>  ftp&gt; <span class="hljs-built_in">mkdir</span> files  <br>  257 <span class="hljs-string">&quot;/pub/files&quot;</span> created  <br>  ftp&gt; rename files database  <br>  350 Ready <span class="hljs-keyword">for</span> RNTO.  <br>  250 Rename successful.  <br>  ftp&gt; <span class="hljs-built_in">rmdir</span> database  <br>  250 Remove directory operation successful.  <br>  ftp&gt; <span class="hljs-built_in">exit</span>  <br>  221 Goodbye. <br></code></pre></td></tr></table></figure><h4 id="本地用户模式参数cat-etcvsftpdvsftpd.conf">2.4本地用户模式参数:cat /etc/vsftpd/vsftpd.conf</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">anonymous_enable=NO <span class="hljs-comment"># </span><br>local_enable=YES <br>write_enable=YES <br>local_umask = 022<br>dirmessage_enable = YES<br>xferlog_enable = YES<br>connect_from_port_20 = YES<br>xferlog_std_format = YES<br>listen = NO<br>listen_ipv6 = YES<br>local_root=/var/ftp     <span class="hljs-comment"># 设置本地用户的FTP根目录</span><br>chroot_local_user=YES   <span class="hljs-comment"># 是否将用户禁锢在主目录</span><br>local_max_rate=0<br>pam_service_name = vsftpd<br>local_umask=022  <br>userlist_enable=YES  <br>userlist_deny=YES  <br>tcp_wrappers = YES<br>ftp_banner=Welcome to use FTP Service<br></code></pre></td></tr></table></figure><h4 id="客户端-1">2.4.1 客户端</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# ftp 192.168.37.10 <br>  Connected to 192.168.37.10 (192.168.37.10).  <br>  220 (vsFTPd 3.0.2)  <br>  Name (192.168.37.10:root): root  <br>  530 Permission denied.  <br>  Login failed.  <br>  ftp&gt; <span class="hljs-built_in">exit</span>  <br>  221 Goodbye. <br><br>[root@xy ~]# <span class="hljs-built_in">cat</span> /etc/vsftpd/user_list  <br>[root@xy ~]# <span class="hljs-built_in">cat</span> /etc/vsftpd/ftpusers 　<span class="hljs-comment"># 名单中含有root,默认禁止root用户  </span><br>[root@xy ~]# ftp 192.168.37.10    <br>  Connected to 192.168.37.10 (192.168.37.10).  <br>  220 (vsFTPd 3.0.2)    <br>  Name (192.168.37.10:root): xy       <span class="hljs-comment"># 用不在 ftplist / user_list 的用户登录  </span><br>  331 Please specify the password.  <br>  Password:此处输入该用户密码  <br>  230 Login successfull.  <br>  Reomte system <span class="hljs-built_in">type</span> is UNIX.  <br>  Using binary mode to transfer files.  <br>  ftp&gt; <span class="hljs-built_in">mkdir</span> files  <br>  550 Create directory operation failed.      <span class="hljs-comment"># 依然无法访问</span><br>[root@xy ~]# getsebool -a |grep ftp     <br>  ftpd_full_access --&gt; off<br>[root@xy ~]# setsebool -P ftpd_full_access=on  <span class="hljs-comment"># 可以正常创建文件</span><br></code></pre></td></tr></table></figure><h4 id="虚拟用户模式">2.6 虚拟用户模式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install pam* libdb-utils libdb* --skip-broken -y  <br>[root@xy ~]# <span class="hljs-built_in">cd</span> /etc/vsftpd/<br>[root@xy vsftpd]# vim vuser.list   <span class="hljs-comment"># 建立虚拟用户的用户数据库文件 </span><br>  zhangsan    <span class="hljs-comment"># 账户名</span><br>  123456      <span class="hljs-comment"># 密码</span><br>  lisi  <br>  123456   <br>[root@xy vsftpd]# db_load -T -t <span class="hljs-built_in">hash</span> -f vuser.list vuser.db    <br>[root@xy vsftpd]# file vuser.db  <br>  vuser.db: Berkeley DB (Hash, version 9, native byte-order)  <br>[root@xy vsftpd]# <span class="hljs-built_in">chmod</span> 600 vuser.db<br>[root@xy vsftpd]# <span class="hljs-built_in">rm</span> -f vuser.list <br>[root@xy ~]# useradd -d /var/ftproot -s /sbin/nologin virtual   <span class="hljs-comment"># 增加虚拟用户，提供家目录  </span><br>[root@xy vsftpd]# <span class="hljs-built_in">ls</span> -ld /var/ftproot/<br>  drwx------. 3 virtual virtual 74 Jul 12 08:55 /var/ftproot/  <br>[root@xy vsftpd]# <span class="hljs-built_in">chmod</span> -Rf 755 /var/ftproot/ <br>[root@xy vsftpd]# <span class="hljs-built_in">ls</span> -ld /var/ftproot/  <br>  drwxr-xr-x. 3 virtual virtual 74 Jul 12 08:55 /var/ftproot/ <br> <br><span class="hljs-comment"># 建立用于支持虚拟用户的PAM文件, vsftpd.vu PAM(可插拔认证模块)是一种验证机制,通过动态链接库和统一的API把系统提供的服务和认证方式分开,采用鉴别模块层、用接口层、应设计层三层设计方式   </span><br><br>[root@xy ~]# <span class="hljs-built_in">cp</span> -a /etc/pam.d/vsftpd /etc/pam.d/vdftpd.pam  <br>[root@xy ~]# vim /etc/pam.d/vsftpd.pam   <span class="hljs-comment"># 新建虚拟用户认证 PAM 文件 vsftp.pam       </span><br>  auth      required      pam_userdb.so db=/etc/vsftpd/vuser    <br>  account   required      pam_userdb.so db=/etc/vsftpd/vuser<br></code></pre></td></tr></table></figure><h5 id="主配置文件-vsftpd.conf">2.5.1主配置文件 vsftpd.conf:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/vsftpd/vsftpd.conf   <br>  <span class="hljs-comment"># global config Vsftpd </span><br>  anonymous_enable=YES <br>  local_enable=YES  <br>  write_enable = YES<br>  local_umask = 022<br>  dirmessage_enable = YES<br>  xferlog_enable = YES<br>  connect_from_port_20 = YES<br>  listen = NO<br>  listen_ipv6 = YES<br>  userlist_enable = YES<br>  tcp_wrappers = YES<br>  allow_writeable_chroot=YES<br><br>  <span class="hljs-comment"># config virtual user FTP</span><br>  pam_service_name=vsftpd.pam <span class="hljs-comment"># 虚拟用户启用pam认证</span><br>  guest_enable=YES            <span class="hljs-comment"># 启用虚拟用户</span><br>  guest_username=virtual      <span class="hljs-comment"># 映射虚拟用户至系统用户virtual  </span><br>  user_config_dir=/etc/vsftpd/vusers_dir <span class="hljs-comment"># 设置虚拟用户配置文件所在目录</span><br>  virtual_use_local_privs = YES  <span class="hljs-comment"># 虚拟用户使用与本地用户相同权限</span><br></code></pre></td></tr></table></figure><h4 id="配置不同用户有不同权限">2.5.2配置不同用户有不同权限:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">mkdir</span> /etc/vsftpd/vusers_dir/  <br>[root@xy ~]# <span class="hljs-built_in">cd</span> /etc/vsftpd/vusers_dir <br>[root@xy vusers_dir]# <span class="hljs-built_in">touch</span> lisi<br>[root@xy vusers_dir]# vim zhangsan <br>  local_root = /var/ftproot/zhangsan<br>  write_enable = YES<br>  anon_world_readable_only = YES<br>  anon_upload_enable=YES  <br>  anon_mkdir_write_enable=YES  <br>  anon_other_write_enable=YES  <br>[root@xy ~]# <span class="hljs-built_in">mkdir</span> -p /var/ftproot/&#123;zhangsan,lisi&#125; <br>[root@xy~]# <span class="hljs-built_in">chown</span> -R virtual:virtual /var/ftpuser <br>[root@xy ~]# vim /etc/vsftpd/vsftpd.conf <br>  user_config_dir=/etc/vsftpd/vusers_dir<br>[root@xy ~]# getsebool -a | grep ftp    <br>  ftpd_full_access --&gt; off     <br>[root@xy ~]# setsebool -P ftpd_full_access=on  <span class="hljs-comment"># 可以正常创建文件      </span><br>[root@xy vusers_dir]# systemctl restart vsftpd.service   <br>[root@xy vusers_dir]# systemctl <span class="hljs-built_in">enable</span> vsftpd<br></code></pre></td></tr></table></figure><h3 id="简单文件传输协议tftptrivial-file-transfer-protocol">3.简单文件传输协议(TFTP:Trivial File Transfer Protocol)：</h3><h4id="tftp-基于udp69协议在客户端与服务器之间进行简单文件传输的协议">TFTP基于UDP(69)协议在（客户端与服务器）之间进行简单文件传输的协议</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>?</td><td>帮助 ✔</td></tr><tr><td>put</td><td>上传文件 ✔</td></tr><tr><td>get</td><td>下载文件 ✔</td></tr><tr><td>verbose</td><td>显示详细处理信息</td></tr><tr><td>status</td><td>显示当前状态信息</td></tr><tr><td>binary</td><td>使用二进制进行传输</td></tr><tr><td>ascii</td><td>使用ASCII码传输</td></tr><tr><td>timeout</td><td>设置重传超时时间</td></tr><tr><td>quit</td><td>退出</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install tftp-server tftp   <br>[root@xy ~]# vim /etc/xinetd.d/tftp 　    <span class="hljs-comment"># 修改 disable = no </span><br>[root@xy ~]# systemctl restart xinetd<br>[root@xy ~]# netstat -a | grep tftp       <span class="hljs-comment"># 查询端口启用状态  </span><br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> xinetd  <br>[root@xy ~]# firewall-cmd --permanent --add-port=69/udp  <br>  success<br>[root@xy ~]# firewall-cmd --reload   <br>  success<br><br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;I love An~~&quot;</span> &gt; /var/lib/tftpboot/readme.txt <br>[root@xy ~]# tftp 192.168.37.10 <br>  tftp&gt; get readme.txt    <br>  tftp&gt; quit<br>[root@xy ~]# <span class="hljs-built_in">ls</span>    <br>  anaconda-ks.cfg  Downloads             Pictures    ShellExample  <br>  Desktop          initial-setup-ks.cfg  Public      Templates  <br>  Documents        Music                 readme.txt  Videos  <br>[root@xy ~]# <span class="hljs-built_in">cat</span> readme.txt<br></code></pre></td></tr></table></figure><h3 id="使用samba或nfs实现文件共享">4. 使用Samba或NFS实现文件”共享”<a id="samba"></a></h3><blockquote><p>基于<em>SMB</em>(Server MessagesBlock)协议,开发出SMBServer服务程序,<em>实现Linux与Windows</em>之间的文件共享变得简单,TCP 139、445</p></blockquote><img src="/posts/b0672b6e/Samba.png" class="" title="[Samba logo]"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install samba   <br>[root@xy ~]# <span class="hljs-built_in">mv</span> /etc/samba/smb.conf /etc/samba/smb.conf.bak  <br>[root@xy ~]# <span class="hljs-built_in">cat</span> /etc/samba/smb.conf.bak |grep -v <span class="hljs-string">&quot;#&quot;</span> |grep -v <span class="hljs-string">&quot;;&quot;</span> |grep -v <span class="hljs-string">&quot;^$&quot;</span> &gt; /etc/samba/smb.conf 　 <span class="hljs-comment"># -v 反选(排除)， ^$ 空白行</span><br><br>[root@xy ~]# <span class="hljs-built_in">cat</span> /etc/samba/smb.conf <br>  1 [database]        <span class="hljs-comment"># 自定义共享名称database </span><br>  2 comment = Do not arbitrarily modify the database   <br>  4 path = /home/database                               <br>  5 public = no <br>  6 browseable=no     <span class="hljs-comment"># 定义是否可以在Win下看到共享文件夹                     </span><br>  7 writable = <span class="hljs-built_in">yes</span>    <span class="hljs-comment"># 设置是否可写</span><br>  8 guest ok = <span class="hljs-built_in">yes</span>    <span class="hljs-comment"># 定义匿名用户是否可以登录 </span><br></code></pre></td></tr></table></figure><img src="/posts/b0672b6e/Samba%E5%8F%82%E6%95%B0.jpg" class="" title="[Samba参数]"><h4 id="pdbedit-命令管理smb服务程序的账户信息数据库配置samba服务器">4.3pdbedit 命令管理SMB服务程序的账户信息数据库，配置Samba服务器:</h4><blockquote><p>要建立 Samba用户必须先建立名为 admin的 Samba用户</p></blockquote><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>建立Samba账户</td></tr><tr><td>-x</td><td>删除Samba账户</td></tr><tr><td>-L</td><td>列出Samba账户</td></tr><tr><td>-Lv</td><td>列出账户详尽信息</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">id</span> xy  <br>  uid=1000(xy) gid=1000(xy) <span class="hljs-built_in">groups</span>=1000(xy)      <br>[root@xy ~]# pdbedit -a xy  ✔ <br>  new password:  <br>  retype new password:  <br>  Unix username:        xy  <br>  ...<br>  Full Name:            xy  <br>  Home Directory:       \\xy\xy  <br>  HomeDir Drive:        <br>  Logon Script:         <br>  Profile Path:         \\xy\xy\profile  <br>  Domain:               XY  <br>  ...<br>  Password must change: never<br>  ...<br>[root@xy ~]# <span class="hljs-built_in">mkdir</span> /home/database<br>[root@xy ~]# <span class="hljs-built_in">chown</span> -Rf xy:xy /home/database/<br>[root@xy ~]# <span class="hljs-built_in">ls</span> -ldZ /home/database/<br>  drwxr-xr-x. 2 xy xy 6 Jul 12 11:10 /home/database/ <br>[root@xy ~]# semanage fcontext -a -t samba_share_t /home/database     <br>[root@xy ~]# restorecon -Rv /home/database/<br>  restorecon reset /home/database context unconfined_u:object_r:home_root_t:s0-&gt;unconfined_u:object_r:samba_share_t:s0  <br>[root@xy ~]# getsebool -a | grep samba <br>  samba_create_home_dirs --&gt; off  <br>  samba_domain_controller --&gt; off  <br>  samba_enable_home_dirs --&gt; off <br>[root@xy ~]# setsebool -P samba_enable_home_dirs on  <span class="hljs-comment"># 在smb.conf，中设置path = /home/database  </span><br>[root@xy ~]# systemctl restart smb  <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> smb  <br>  <span class="hljs-built_in">ln</span> -s <span class="hljs-string">&#x27;/usr/lib/systemd/system/smb.service&#x27;</span> <span class="hljs-string">&#x27;/etc/systemd/system/multi-user.target.wants/smb.service&#x27;</span><br>[root@xy ~]# iptables -F<br>[root@xy ~]# service iptables save <br>  iptables: Saving firewall rules to /etc/sysconfig/iptables:[  OK  ]<br></code></pre></td></tr></table></figure><h4 id="linux-访问文件共享服务samba客户端">4.4 Linux访问文件共享服务(Samba客户端)</h4><ul><li>客户端安装 cifs-utils,配置认证文件<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install samba-client cifs-utils  <br>[root@xy ~]# vim auth.smb  <br>  username=xy  <br>  password=redhat  <br>  domain=MYGROUP<br>[root@xy ~]# <span class="hljs-built_in">chmod</span> 600 auth.smb  <br><span class="hljs-comment"># 在Linux客户端创建用于挂载Samba服务共享资源目录,写入/etc/fstab</span><br>[root@xy ~]# <span class="hljs-built_in">mkdir</span> /database<br>[root@xy ~]# vim /etc/fstab   <br>  //Samba服务器IP/共享目录 /客户端目录 cifs credentials=/root/auth.smb 0 0*   <br>[root@xy ~]# smbclient -U 用户名 -L //服务器IP    <span class="hljs-comment">#查看服务器共享  </span><br>[root@xy ~]# smbclient -U 用户名 //服务器IP/共享名    <span class="hljs-comment">#登录服务器共享</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="window-登录方式">4.4 Window 登录方式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">\\服务器IP\共享名       net use * /del<br></code></pre></td></tr></table></figure><h4 id="samba-web界面管理">4.5 Samba Web界面管理</h4><h3 id="nfs基于tcpip协议用于linux系统之间上文件资源共享-cs">5.NFS基于TCP/IP协议，用于Linux系统之间上文件资源共享 C/S<a id="nfs"></a></h3><h4 id="服务端-192.168.37.10">5.1 服务端 192.168.37.10</h4><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>ro</td><td>只读</td></tr><tr><td>rw</td><td>只写</td></tr><tr><td>root_squash</td><td>NFS客户端以root管理员访问,映射为NFS服务器的匿名用户</td></tr><tr><td>no_root_squash</td><td>NFS客户端以root管理员访问,映射为NFS服务器的root管理员</td></tr><tr><td>all_squash</td><td>无论NFS客户端以什么访问,均映射为NFS服务器的匿名用户</td></tr><tr><td>sync</td><td>同时将数据写入内存与硬盘中,保证不丢失数据</td></tr><tr><td>async</td><td>先将数据保存至内存,然后再写入硬盘,效率高,可能丢失数据</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install -y nfs-utils  <br>[root@xy ~]# iptables -F<br>[root@xy ~]# service iptables save <br>[root@xy ~]# <span class="hljs-built_in">mkdir</span> /nfsfile<br>[root@xy ~]# <span class="hljs-built_in">chmod</span> -Rf 777 /nfsfile  <br>  iptables: Saving firewall rules to /etc/sysconfig/iptables:[  OK  ]   <br>[root@xy ~]# vim /etc/exports   <span class="hljs-comment"># fs 配置文件  </span><br>  /nfsfile 192.168.37.10/24.*(rw,<span class="hljs-built_in">sync</span>,root_squash)<br><br>[root@xy ~]# systemctl restart rpcbind<br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> rpcbind<br>[root@xy ~]# systemctl start nfs-server  <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> nfs-server <br>  <span class="hljs-built_in">ln</span> -s <span class="hljs-string">&#x27;/usr/lib/systemd/system/nfs-server.service&#x27;</span> <span class="hljs-string">&#x27;/etc/systemd/system/ nfs.target.wants/nfs-server.service&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="客户端配置">5.1 客户端配置</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-e</td><td>显示NFS服务器的共享列表</td></tr><tr><td>-a</td><td>显示本机挂载文件资源的情况</td></tr><tr><td>-v</td><td>显示版本</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy~]# showmount -e 192.168.37.10 <br>  Export list <span class="hljs-keyword">for</span> 192.168.37.10:<br>  /nfsfile 192.168.37.10  <br>[root@xy ~]# <span class="hljs-built_in">mkdir</span> /nfsfile<span class="hljs-comment"># 客户端创建挂载地址 </span><br>[root@xy ~]# mount -t nfs 192.168.37.10:/nfsfile /nfsfile <br>[root@xy ~]# <span class="hljs-built_in">cat</span> /nfsfile/readme   <br>  192.168.10.10:/nfsfile /nfsfile nfs defaults 0 0<br></code></pre></td></tr></table></figure><h3 id="auto自动挂载服务">6. auto自动挂载服务 <a id="autofs"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install autofs  <br>[root@xy ~]# vim /etc/auto.master　　<span class="hljs-comment"># autofs 的主配置文件  </span><br>  /media /etc/iso.misc　            <span class="hljs-comment"># 挂载目录 子配置文件; 挂在目录是设备挂载位置的上一级目录 </span><br>[root@xy ~]# vim /etc/iso.misc      <span class="hljs-comment"># 子配置文件   </span><br>  iso      -fstype=iso9660,ro,nosuid,nodev :/dev/cdrom   <br>  挂载目录  挂载文件类型及权限                :设备名称<br></code></pre></td></tr></table></figure><h3 id="使用bind提供域名解析服务berkeley-internet-name-domain">7.使用BIND提供域名解析服务(Berkeley Internet Name Domain)<a id="bind"></a></h3><ul><li><p>DNS(Domain Name System)：管理和解析(域名 与IP)的对应关系，<strong>域名–&gt;IP(正向解析)</strong>，<strong>IP–&gt;域名(反向解析)</strong></p></li><li><p>DNS服务器:主服-masster、从服-slave、缓存服三种,DNS域名解析服务采用分布式数据结构,执行查询请求:</p></li><li><p>递归查询(必须向用户返回结果) /迭代查询(一台接一台,直到返回结果)</p><ul><li>配置Bind(Berkely Internet Name Domain)服务:<br /></li><li><strong>主配置文件</strong>:<code>/etc/named.conf</code>–定义bind服务程序的运行<br /></li><li><strong>区域配置文件</strong>:<code>/etc/named.rfc1912.zones</code>–保存域名与IP所在的具体位置<br /></li><li><strong>数据配置文件目录</strong>:<code>/var/named/xxx.zone</code>–保存域名与IP真实对应关系数据</li><li><strong>根节点服务器</strong>:<code>/var/named/named.ca</code></li></ul></li></ul><img src="/posts/b0672b6e/bind%E6%AD%A3%E5%90%91%E8%A7%A3%E6%9E%90%E5%9B%BE%E7%A4%BA.jpg" class="" title="[Bind正向解析参数]"><img src="/posts/b0672b6e/bind%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90%E5%9B%BE%E7%A4%BA.jpg" class="" title="[Bind反向解析]"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install bind-chroot <br>[root@xy ~]# vim /etc/named.conf        <span class="hljs-comment"># 主配置文件 配置 /etc/named.conf</span><br>   ...<br>   7 // See /usr/share/doc/bind*/sample/ <span class="hljs-keyword">for</span> example named configuration files.<br>   10 options &#123;<br>   11 listen-on port 53 &#123; any; &#125;;     <span class="hljs-comment"># 重要</span><br>   12 listen-on-v6 port 53 &#123; ::1; &#125;;<br>   13 directory <span class="hljs-string">&quot;/var/named&quot;</span>;<br>   14 dump-file <span class="hljs-string">&quot;/var/named/data/cache_dump.db&quot;</span>;<br>   15 statistics-file <span class="hljs-string">&quot;/var/named/data/named_stats.txt&quot;</span>;<br>   16 memstatistics-file <span class="hljs-string">&quot;/var/named/data/named_mem_stats.txt&quot;</span>;<br>   17 allow-query &#123; any; &#125;;       <span class="hljs-comment"># 重要</span><br>   29 recursion <span class="hljs-built_in">yes</span>;<br>   31 dnssec-enable <span class="hljs-built_in">yes</span>;<br>   32 dnssec-validation <span class="hljs-built_in">yes</span>;<br>   33 dnssec-lookaside auto;<br>   35 /* Path to ISC DLV key */<br>   36 bindkeys-file <span class="hljs-string">&quot;/etc/named.iscdlv.key&quot;</span>;<br>   38 managed-keys-directory <span class="hljs-string">&quot;/var/named/dynamic&quot;</span>;<br>   40 pid-file <span class="hljs-string">&quot;/run/named/named.pid&quot;</span>;<br>   41 session-keyfile <span class="hljs-string">&quot;/run/named/session.key&quot;</span>;<br>   42 &#125;;<br>   44 logging &#123;<br>   45 channel default_debug &#123;<br>   46 file <span class="hljs-string">&quot;data/named.run&quot;</span>;<br>   47 severity dynamic;<br>   48 &#125;;<br>   49 &#125;;<br>   51 zone <span class="hljs-string">&quot;.&quot;</span> IN &#123;<br>   52 <span class="hljs-built_in">type</span> hint;<br>   53 file <span class="hljs-string">&quot;named.ca&quot;</span>;<br>   54 &#125;;<br>   56 include <span class="hljs-string">&quot;/etc/named.rfc1912.zones&quot;</span>; <span class="hljs-comment"># 区域配置文件 </span><br>   57 include <span class="hljs-string">&quot;/etc/named.root.key&quot;</span>;      <span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h4 id="正向解析-eg">7.1 正向解析 eg:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/named.rfc1912.zones    <span class="hljs-comment"># 正向解析 区域配置文件配置</span><br>  zone <span class="hljs-string">&quot;xy.com&quot;</span> IN &#123;    <br>      <span class="hljs-built_in">type</span> master;  <br>      file <span class="hljs-string">&quot;xy.com.zone&quot;</span>;  <br>      allow-update &#123; none; &#125;;  <br>  &#125;;                                         <span class="hljs-comment"># named-checkconf named-checkzone</span><br>[root@xy named]# <span class="hljs-built_in">ls</span> -al named.localhost      <span class="hljs-comment"># 正向解析 数据配置文件配置 /var/named.localhost  </span><br>  -rw-r-----. 1 root named 152 Jun 21  2007 named.localhost<br>[root@xy named]# <span class="hljs-built_in">cp</span> -a named.localhost xy.com.zone<br>[root@xy named]# vim xy.com.zone<br>  <span class="hljs-variable">$TTL</span> 1D                                   <span class="hljs-comment">#生存周期为1天</span><br>  @IN SOAxy.com.root.xy.com.(<br>    <span class="hljs-comment"># @: 代表相应的域名，就是区域配置文件 --&gt;xy.com.zone</span><br>    <span class="hljs-comment"># IN: Internet标准</span><br>    <span class="hljs-comment"># SOA: Start Of Authority，授权主机 管理者信箱</span><br>                          0;serial          <span class="hljs-comment"># 更新序列号</span><br>                          1D;refresh        <span class="hljs-comment"># 更新时间</span><br>                          1H;retry          <span class="hljs-comment"># 重试延时</span><br>                          1W;expire          <span class="hljs-comment"># 失效时间</span><br>                          3H;)minimum        <span class="hljs-comment"># 无效解析记录的缓存时间</span><br>        NS          ns.xy.com.            <span class="hljs-comment"># 域名服务器记录</span><br>  ns  IN A        192.168.37.10          <span class="hljs-comment"># 地址记录(ns.xy.com.)</span><br>        IN MX 10    mail.xy.com.          <span class="hljs-comment"># 邮箱交换记录</span><br>  mailIN A        192.168.37.10          <span class="hljs-comment"># 地址记录(mail.xy.com.)</span><br>  www  IN A        192.168.37.10          <span class="hljs-comment"># 地址记录(www.xy.com.)</span><br>  ftp  IN CNAME    www                   <span class="hljs-comment"># 地址记录(www.xy.com.)</span><br>  bbs  IN A        192.168.37.20          <span class="hljs-comment"># 地址记录(bbs.xy.com.)</span><br><br>测试：<br>[root@xy ~]# systemd restart named <br>[root@xy ~]# systemctl restart network  <span class="hljs-comment"># 虚拟机环境下一定要先把本机DNS配置为本机IP </span><br>[root@xy ~]# nslookup     <span class="hljs-comment"># 测试</span><br>  &gt; www.xy.com  <br>  Server:   192.168.37.10  <br>  Address:192.168.37.10#53  <br><br>  &gt; Name:www.xy.com  <br>  Address:  192.168.37.10  <br><br>  &gt; bbs.xy.com  <br>  Server:   192.168.37.10  <br>  Address:192.168.37.10#53  <br><br>  &gt; Name:bbs.xy.com  <br>  Address:  192.168.37.20<br></code></pre></td></tr></table></figure><h4 id="反向解析-eg">7.2 反向解析 eg:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/named.rfc1912.zones    <span class="hljs-comment"># 反向解析 区域配置文件配置</span><br>  zone <span class="hljs-string">&quot;xy.com&quot;</span> IN &#123;    <br>      <span class="hljs-built_in">type</span> master;  <br>      file <span class="hljs-string">&quot;xy.com.zone&quot;</span>;  <br>      allow-update &#123; none; &#125;;  <br>  &#125;;<br>  zone <span class="hljs-string">&quot;37.168.192.in-addr.arpa&quot;</span> IN &#123;    <br>      <span class="hljs-built_in">type</span> master;  <br>      file <span class="hljs-string">&quot;192.168.10.arpa&quot;</span>;  <br>  &#125;;<br>[root@xy named]# <span class="hljs-built_in">ls</span> -al named.loopback      <span class="hljs-comment"># 反向解析 数据配置文件配置 </span><br>  -rw-r-----. 1 root named 152 Jun 21  2007 named.loopback<br>[root@xy named]# <span class="hljs-built_in">cp</span> -a named.loopback 192.168.37.arpa<br>[root@xy named]# vim 192.168.37.arpa<br>  <span class="hljs-variable">$TTL</span> 1D                                  <span class="hljs-comment">#生存周期为1天</span><br>  @IN SOAxy.com.root.xy.com.(<br>    <span class="hljs-comment"># @: 代表相应的域名，就是区域配置文件 --&gt;192.168.37.arpa</span><br>    <span class="hljs-comment"># IN: Internet标准</span><br>    <span class="hljs-comment"># SOA: Start Of Authority，授权主机 管理者信箱</span><br>                          0;serial          <span class="hljs-comment"># 更新序列号</span><br>                          1D;refresh        <span class="hljs-comment"># 更新时间</span><br>                          1H;retry          <span class="hljs-comment"># 重试延时</span><br>                          1W;expire          <span class="hljs-comment"># 失效时间</span><br>                          3H;)minimum        <span class="hljs-comment"># 无效解析记录的缓存时间</span><br>        NS          ns.xy.com.            <span class="hljs-comment"># 域名服务器记录</span><br>  ns  A            192.168.37.10          <span class="hljs-comment"># 地址记录(ns.xy.com.)</span><br>  10  PTR          ns.xy.com              <span class="hljs-comment"># PTR 指针记录，仅用于反向解析   </span><br>  10  PTR          mail.xy.com         <br>  10  PTR          www.xy.com                 <br>  20  PTR          bbs.xy.com<br><span class="hljs-comment"># 测试</span><br>[root@xy ~]# systemd restart named <br>[root@xy ~]# systemctl restart network<br>[root@xy ~]# nslookup     <br>  &gt; 192.168.37.10 <br>  Server:   127.0.0.1  <br>  Address:127.0.0.1#53  <br>  10.37.168.192.in-addr.arpa name = ns.xy.com.<br>  10.37.168.192.in-addr.arpa name = www.xy.com.<br>  10.37.168.192.in-addr.arpa name = mail.xy.com.<br>  &gt; 192.168.37.10<br>  Server:   127.0.0.1  <br>  Address:127.0.0.1#53  <br>  20.37.168.192.in-addr.arpa name = bbs.xy.com.   <br></code></pre></td></tr></table></figure><h3 id="部署主从服务器">8. 部署主从服务器</h3><h4 id="无加密的传输">8.1 无加密的传输</h4><h5 id="主服务器的配置ip192.168.37.10">8.1.1主服务器的配置IP：192.168.37.10</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/named.rfc1912.zones    <br>   zone <span class="hljs-string">&quot;xy.com&quot;</span> IN &#123;<br>      <span class="hljs-built_in">type</span> master;<br>      file <span class="hljs-string">&quot;xy.com.zone&quot;</span>;<br>      allow-update &#123; 192.168.37.20; &#125;;<br>   &#125;;<br>   zone <span class="hljs-string">&quot;37.168.192.in-addr.arpa&quot;</span> IN &#123;<br>      <span class="hljs-built_in">type</span> master;<br>      file <span class="hljs-string">&quot;192.168.37.arpa&quot;</span>;<br>      allow-update &#123; 192.168.37.20; &#125;;<br>   &#125;;     <br>[root@xy ~]# systemd restart named<br></code></pre></td></tr></table></figure><h5 id="从服务器的配置ip192.168.37.20">8.1.2从服务器的配置IP：192.168.37.20</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/named.rfc1912.zones<br>   zone <span class="hljs-string">&quot;xy.com&quot;</span> IN &#123;<br>      <span class="hljs-built_in">type</span> slave;<br>      masters &#123; <span class="hljs-string">&quot;192.168.37.10&quot;</span> &#125;;<br>      file <span class="hljs-string">&quot;slaves/xy.com.zone&quot;</span>;<br>   &#125;;<br>   zone <span class="hljs-string">&quot;37.168.192.in-addr.arpa&quot;</span> IN &#123;<br>      <span class="hljs-built_in">type</span> slave;<br>      masters &#123; <span class="hljs-string">&quot;192.168.37.10&quot;</span> &#125;;<br>      file <span class="hljs-string">&quot;slaves/192.168.37.arpa&quot;</span>;<br>   &#125;;<br><br><span class="hljs-comment"># 测试</span><br>[root@xy ~]# systemd restart named <span class="hljs-comment"># 从服务器的DNS服务程序一般就已经自动从主服务器同步了数据     </span><br>[root@xy ~]# <span class="hljs-built_in">cd</span> /var/named/slaves  <br>[root@xy ~]# <span class="hljs-built_in">ls</span><br>  192.168.37.arpa xy.com.zone<br>[root@xy ~]# nslookup    <br>  &gt; www.xy.com  <br>  Server: 192.168.37.20<br>  Address: 192.168.37.20#53  <br>  Name: www.xy.com<br>  Address: 192.168.37.10  <br><br>  &gt; 192.168.37.10  <br>  Server: 192.168.37.20  <br>  Address: 192.168.37.20#53  <br>  10.37.168.192.in-addr.arpa name = www.xy.com.<br>  10.37.168.192.in-addr.arpa name = ns.xy.com.  <br>  10.37.168.192.in-addr.arpa name = mail.xy.com.<br></code></pre></td></tr></table></figure><h4 id="有加密的安全传输">8.2 有加密的安全传输</h4><h5 id="主服务器下生成密钥">8.2.1 主服务器下生成密钥</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# dnssec-keygen -a HMAC-MD5 -b 128 -n HOST master-slave   <span class="hljs-comment"># -a 指定算法    </span><br>  Kmaster-slave.+157+39112  <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -al Kmaster-slave.+157+39112.<br>  -rw-------. 1 root root  56 Jul 13 13:10 Kmaster-slave.+157+39112.key<br>  -rw-------. 1 root root 165 Jul 13 13:10 Kmaster-slave.+157+39112.private <br>[root@xy ~]# <span class="hljs-built_in">cat</span> Kmaster-slave.+157+39112.private  <br>   Private-key-format: v1.3  <br>   Algorithm: 157 (HMAC_MD5)  <br>   Key: pOuRN4eeVTzrZs/aaVpbkQ==      <span class="hljs-comment"># key  </span><br>   ... <br>   Activate: 20180713051051   <br>[root@xy ~]# <span class="hljs-built_in">cd</span> /var/named/chroot/etc/    <span class="hljs-comment"># 主服务器创建密钥验证文件  </span><br>[root@xy etc]# vim transfer.key<br>   key <span class="hljs-string">&quot;master-slave&quot;</span> &#123;  <br>     algorithm hmac-md5;  <br>     secret <span class="hljs-string">&quot;pOuRN4eeVTzrZs/aaVpbkQ==&quot;</span>;  <br>   &#125;;<br>[root@xy etc]# <span class="hljs-built_in">chown</span> root:named transfer.key <br>[root@xy etc]# <span class="hljs-built_in">chmod</span> 640 transfer.key<br>[root@xy etc]# <span class="hljs-built_in">ln</span> transfer.key /etc/transfer.key  <br>[root@xy etc]# vim /etc/named.conf       <span class="hljs-comment"># 开启加载Bind服务的密钥验证功能  </span><br>   include <span class="hljs-string">&quot;/etc/transfer.key&quot;</span>   <span class="hljs-comment"># 9 行  </span><br>   allow-transfer &#123; key master-slave; &#125;;  <br>[root@xy ~]# systemd restart named     <br>[root@xy ~]# <span class="hljs-built_in">rm</span> -rf /var/named/slaves     <span class="hljs-comment"># 清空从服务器数据配置文件  </span><br>[root@xy ~]# systemd restart named<br></code></pre></td></tr></table></figure><h5 id="配置从服务器">8.2.2. 配置从服务器</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">cd</span> /var/named/chroot/etc/ <br>[root@xy etc]# vim transfer.key   <br>   key <span class="hljs-string">&quot;master-slave&quot;</span> &#123;  <br>     algorithm hmac-md5;  <br>     secret <span class="hljs-string">&quot;pOuRN4eeVTzrZs/aaVpbkQ==&quot;</span>;  <br>   &#125;;   <br>[root@xy etc]# <span class="hljs-built_in">chown</span> root:named transfer.key <br>[root@xy etc]# <span class="hljs-built_in">chmod</span> 640 transfer.key<br>[root@xy etc]# <span class="hljs-built_in">ln</span> transfer.key /etc/transfer.key <br>[root@xy etc]# vim /etc/named.conf <span class="hljs-comment"># 开启加载从服务器的密钥验证功能，填写主服务器IP和密钥名称</span><br>   include <span class="hljs-string">&quot;/etc/transfer.key&quot;</span>   <span class="hljs-comment"># 9 行  </span><br>   server 192.168.37.10          <span class="hljs-comment"># 43行  </span><br>   &#123;  <br>     key &#123; master-slave; &#125;;      <span class="hljs-comment"># 45行</span><br>   &#125;<br>[root@xy ~]# systemd restart named <br>[root@xy ~]# <span class="hljs-built_in">ls</span> /var/named/slaves<br>[root@xy ~]# systemd restart named      <br>  192.168.37.arpa xy.com.zone<br></code></pre></td></tr></table></figure><h3 id="使用dhcp动态管理主机地址67">9. 使用DHCP动态管理主机地址(67)<a id="dhcp"></a></h3><ul><li>DHCP(Dynamic Host ConfigurationProtocol):基于<strong>UDP协议</strong>仅仅在局域网内部使用提高IP利用率,提高配置效率,降低管理维护成本<br /></li><li>作用域:完整的IP段,DHCP协议根据作用域分配IP<br /></li><li>超级作用域: 管理处于一个物理网络中多个逻辑子网段<br /></li><li>排除范围: 把作用域的某些IP排除<br /></li><li>地址池: 剩余的IP<br /></li><li>租约: DHCP 客户端能够使用IP的时间<br /></li><li>预约: 保证网络中特定设备总是获取到相同IP</li></ul><h4 id="dhcpddhcpd.conf服务程序配置最常见参数">9.1dhcpd(dhcpd.conf)服务程序配置最常见参数:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install dhcp<br>[root@xy ~]# /etc/dhcp/dhcpd.conf      <br>[root@xy ~]# <span class="hljs-built_in">cp</span> -a /usr/share/doc/dhcp-4.*.*/dhcpd.conf.sample /etc/dhcp/dhcpd.conf    <br>  ddns-update-style none;  <br>  ignore client-updates;  <br>  subnet 192.168.10.1 netmask 255.255.255.0 &#123;  <span class="hljs-comment"># 声明要分配的网段和子网掩码</span><br>  range 192.168.10.50 192.168.10.150;        <span class="hljs-comment"># 声明可用 IP 地址池  </span><br>      option subnet-mask 255.255.255.0;  <br>      option domain-name-servers 192.168.10.1; <span class="hljs-comment"># 设置 DNS 服务器地址</span><br>      option domain-name <span class="hljs-string">&quot;xy.com&quot;</span>;             <span class="hljs-comment"># 设置 DNS 域</span><br>      option routers 192.168.10.1;             <span class="hljs-comment"># 默认网关地址 </span><br>      option broadcast-address 192.168.10.255; <span class="hljs-comment"># 广播地址(可不写)  </span><br>      default-lease-time 21600;                <span class="hljs-comment"># 默认租约  </span><br>      max-lease-time 43200;                    <span class="hljs-comment"># 最大租约</span><br>  &#125;<br>[root@xy ~]# systemctl start dhcpd<br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> dhcpd<br></code></pre></td></tr></table></figure><h4 id="分配固定ipip与mac地址绑定">9.3 分配固定IP：IP与MAC地址绑定</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">host xy &#123;  <br>hardware ethernet 00:0c:29:11:26:05;  <br>fixed-address 192.168.37.55;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="使用postfix-与-dovecot部署邮件系统">10. 使用Postfix 与Dovecot部署邮件系统 <a id="email"></a></h3><img src="/posts/b0672b6e/Email.jpg" class="" title="[Email]"><ul><li>电子邮件协议:<ul><li>SMTP简单邮件传输协议（Simple Mail TransferProtocol，）：用于<strong>发送和中转发出的电子邮件</strong>，占用服务器的<strong>25/TCP端口</strong>;</li><li>POP3邮局协议版本3（Post Office Protocol3）：用于将<strong>电子邮件存储到本地主机</strong>，占用服务器的<strong>110/TCP</strong>端口;</li><li>IMAP Internet消息访问协议版本4（Internet Message Access Protocol4）：用于在<strong>本地主机上访问邮件</strong>，占用服务器的<strong>143/TCP</strong>端口;</li><li>MUA-&gt;SMTP-&gt;MTA-&gt;SMTP-&gt;MTA-&gt;POP3/IMAP4-&gt;MUA</li></ul></li></ul><h4 id="配置dns服务程序bind-chroot">10.1 配置DNS服务程序bind-chroot</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -F  <br>[root@xy ~]# service iptables save  <br>  iptables: Saving firewall rules to /etc/sysconfig/iptables:[  OK  ]  <br>[root@xy ~]# systemctl <span class="hljs-built_in">disable</span> iptables  <br>[root@xy ~]# systemctl <span class="hljs-built_in">disable</span> firewalld.service   <br>[root@xy ~]# vim /etc/hostname                <span class="hljs-comment"># 服务器主机名与发信域名保持一致</span><br>  mail.xy.com<br>[root@mail named]# vim /etc/named.conf        <span class="hljs-comment"># 主配置文件</span><br>  listen-on port 53 &#123; any; &#125;;          <br>  allow-query     &#123; any; &#125;;<br>[root@mail named]# vim /etc/named.rfc1912.zones      <span class="hljs-comment"># 区域配置文件</span><br>  zone <span class="hljs-string">&quot;xy.com&quot;</span> IN &#123;  <br>      <span class="hljs-built_in">type</span> master;  <br>      file <span class="hljs-string">&quot;xy.com.zone&quot;</span>;  <br>      allow-update &#123; none; &#125;;  <br>  &#125;;<br>[root@mail named]# vim xy.com.zone    <span class="hljs-comment"># 域名数据配置文件</span><br>  <span class="hljs-variable">$TTL</span> 1D<br>  @       IN SOA  xy.com. root.xy.com. (  <br>                                      0       ; serial  <br>                                      1D      ; refresh  <br>                                      1H      ; retry  <br>                                      1W      ; expire  <br>                                      3H )    ; minimum  <br>          NS              ns.xy.com.  <br>  ns      IN A            192.168.37.10  <br>  @       IN MX 10        mail.xy.com.  <br>  mail    IN A            192.168.37.10<br></code></pre></td></tr></table></figure><h4 id="配置基于smtp协议的postfix服务程序">10.2配置基于SMTP协议的Postfix服务程序</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install postfix   <br>[root@mail ~]# vim /etc/postfix/main.cf<br>  myhostname = mail.xy.com      <span class="hljs-comment"># 76  邮局系统主机名</span><br>  mydomain = xy.com              <span class="hljs-comment"># 83  邮局系统域名</span><br>  myorigin = <span class="hljs-variable">$mydomain</span>           <span class="hljs-comment"># 99 从本机发出邮件的域名名称</span><br>  inet_interfaces = all            <span class="hljs-comment"># 116 监听网卡接口</span><br>  mydestination = <span class="hljs-variable">$myhostname</span> , <span class="hljs-variable">$mydomain</span>    <span class="hljs-comment"># 164  可接收邮件的主机名或域名列表</span><br>  (relay_domains = <span class="hljs-variable">$mydestination</span>)    <span class="hljs-comment"># 设置可转发哪些网域的邮件</span><br>[root@mail named]# useradd boss     <span class="hljs-comment"># 创建邮件系统登陆用户,Postfix能调用本地系统账户 </span><br>[root@mail named]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;xy&quot;</span> | passwd --stdin boss<br>  Changing password <span class="hljs-keyword">for</span> user boss.<br>  passwd: all authentication tokens updated successfully.<br>[root@mail ~]# systemctl restart postfix<br>[root@mail ~]# systemctl <span class="hljs-built_in">enable</span> postfix<br></code></pre></td></tr></table></figure><h4 id="配置基于pop3与imap4协议的dovecot服务程序">10.3配置基于POP3与IMAP4协议的Dovecot服务程序</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install dovecot     <br>[root@mail ~]# vim /etc/dovecot/dovecot.conf  <br>  protocols = imap pop3 lmtp              <span class="hljs-comment"># 24  </span><br>  disable_plaintext_auth = no             <span class="hljs-comment"># 25  </span><br>  login_trusted_networks = 192.168.37.0/24     <span class="hljs-comment"># 48  </span><br>[root@mail ~]# vim /etc/dovecot/conf.d/10-mail.conf  <br>  mail_location = mbox:~/mail:INBOX=/var/mail/%u  <br>[root@mail ~]# su - boss  <br>[boss@mail ~]$ <span class="hljs-built_in">mkdir</span> -p mail/.imap/INBOX<br>[boss@mail ~]$ <span class="hljs-built_in">exit</span><br>[root@mail ~]# systemctl restart dovecot <br>[root@mail ~]# systemctl <span class="hljs-built_in">enable</span> dovecot  <br>  <span class="hljs-built_in">ln</span> -s <span class="hljs-string">&#x27;/usr/lib/systemd/system/dovecot.service&#x27;</span> <span class="hljs-string">&#x27;/etc/systemd/system/multi-user.target.wants/dovecot.service&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="测试">10.4测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">客户端: Windows Outlook2017  <br>IP: 192.168.37.2/24  <br>DNS: 192.168.37.10  <br>username: boss<br>password: 123465  <br></code></pre></td></tr></table></figure><p><a href="#back" target="_self">返回目录</a></p>]]></content>
    
    
    <categories>
      
      <category>Devops, linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Devops</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux服务配置03</title>
    <link href="/posts/c7601bf8.html"/>
    <url>/posts/c7601bf8.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-11-Linux服务配置03 <span id="more"></span></p><h2 id="目录">目录 <a id="back"></a></h2><ul><li><a href="#squid" target="_self">Squid 服务</a></li><li><a href="#iscis" target="_self">iSCIS 服务</a></li><li><a href="#mariadb" target="_self">MariaDB 服务</a></li><li><a href="#pxe" target="_self">无人值守安装服务</a></li><li><a href="#cobbler" target="_self">Cobbler</a></li><li><a  href="#neihe" target="_self">内核</a></li></ul><h3 id="使用squid部署代理缓存服务">1. 使用Squid部署代理缓存服务<a id="squid"></a></h3><h4id="squid-替代用户向网站服务器请求页面数据并进行缓存当用户再次再请求相同数据则可以将存储服务器本地数据交付给用户减少了用户等待时间支持httpftpssl等多种协议">1.1Squid替代用户向网站服务器请求页面数据并进行缓存,当用户再次再请求相同数据,则可以将存储服务器本地数据交付给用户,减少了用户等待时间,支持HTTP、FTP、SSL等多种协议</h4><h4 id="squid分为正向代理-与-反向代理">1.2Squid分为<code>正向代理</code> 与 <code>反向代理</code>:</h4><ul><li>正向代理:<code>用户(局域网)-&gt; Squid-&gt; 网站资源</code>,以及基于ACL功能对用户访问网站进行限制,具体分为标准代理模式与 透明代理模式。<ul><li><code>标准模式</code>:把网站数据缓存到本地服务器上,提高数据资源再次访问时的效率,但用户必须填写代理服务器IP与端口;<br /></li><li><code>透明模式</code>:不需要填写代理IP和端口号，是由<code>DHCP服务器</code>将网络配置信息分配给客户端主机;</li></ul></li></ul><img src="/posts/c7601bf8/Squid%E9%80%8F%E6%98%8E%E6%A8%A1%E5%BC%8F.jpg" class="" title="[Squid透明模式]"><img src="/posts/c7601bf8/Squid%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86.jpg" class="" title="[Squid正向代理图示]"><ul><li>反向代理:让多节点主机反向缓存网站数据服务器机房(多节点主机-&gt;Squid服务器-&gt;Internet-&gt;公网用户)<img src="/posts/c7601bf8/Squid%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86.jpg" class="" title="[Squid反向代理图示]"></li></ul><h4 id="测试设备">1.4 测试设备:</h4><ul><li>Squid服务器(<strong>内网卡:仅主机模式192.168.37.10，外网卡:桥接模式DHCP</strong>)<br /></li><li>Windows客户端主机(<strong>网卡:仅主机模式192.168.37.20</strong>)</li></ul><h4 id="文件配置">1.5 文件配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/squid/squid.conf  <br>  http_port 312     <span class="hljs-comment"># 监听端口 ✔</span><br>  cache_mem 64M   <span class="hljs-comment"># 内存缓冲区  </span><br>  cache_dir ufs /var/spool/squid 2000 16 256   <span class="hljs-comment"># 硬盘缓冲区  </span><br>  cache_effective_user squid    <span class="hljs-comment"># 设置缓存的有效用户</span><br>  cache_effective_group squid        <span class="hljs-comment"># 设置缓存有效用户组  </span><br>  dns_nameservers [IP]           <span class="hljs-comment"># 一般不设置,用服务器默认的DNS  </span><br>  cache_access_log /var/log/squid/access.log   <span class="hljs-comment"># 访问日志文件的保存路径  </span><br>  cache_log /var/log/squid/cache.log     <span class="hljs-comment"># 缓存日志文件的保存路径  </span><br>  visible_hostname xy.com           <span class="hljs-comment"># 设置Squid服务器名称  </span><br>[root@xy ~]# systemctl restart squid  <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> squid  <br>  <span class="hljs-built_in">ln</span> -s <span class="hljs-string">&#x27;/usr/lib/systemd/system/squid.service&#x27;</span> <span class="hljs-string">&#x27;/etc/systemd/system/multi-user.target.wants/squid.service&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="标准正向代理ip-192.168.37.103128">1.6 标准正向代理(IP:192.168.37.10:3128)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# semanage port -l | grep squid_port_t           <span class="hljs-comment"># /etc/squid/squid.conf    </span><br>  squid_port_t        tcp      3128, 3401, 4827  <br>  squid_port_t        udp      3401, 4827  <br>[root@xy ~]# semanage port -a -t squid_port_t -p tcp 10000  <span class="hljs-comment"># http_port 10000  </span><br>  squid_port_t       tcp      10000, 3128, 3401, 4827  <br>  squid_port_t       udp      3401, 4827  <br>[root@xy ~]# vim /etc/squid/squid.conf    <span class="hljs-comment"># Squid 提供的ACL功能</span><br>  acl client src = 192.168.37.20          <span class="hljs-comment"># 仅允许192.168.37.20使用Squid提供的代理服务  </span><br>  http_access allow client  <br>  http_access deny all  <br>[root@xy ~]# vim /etc/squid/squid.conf    <span class="hljs-comment"># 禁止所有客户端访问网址包含liunx关键字的网站  </span><br>  acl deny_keyword url_regex -i linux<br>  http_access deny deny_keyword<br>[root@xy ~]# vim /etc/squid/squid.conf    <span class="hljs-comment"># 禁止所有客户端访问某个特定网站  </span><br>  acl deny_url url_regex https://www.baidu.com<br>  http_access deny deny_url<br>[root@xy ~]# vim /etc/squid/squid.conf    <span class="hljs-comment"># 禁止员工在企业网内部下载带有某些后缀的文件  </span><br>  acl badfile urlpath_regex -i \.rar$ \.avi$<br>  http_access deny badfile<br></code></pre></td></tr></table></figure><h4 id="透明模式">1.7 透明模式</h4><blockquote><p>没有配置DHCP服务的话,设置客户端地址192.168.10.20</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -F<br></code></pre></td></tr></table></figure><blockquote><p>实现DNS地址解析服务53端口的数据转发功能(SNAT), -o匹配外网网卡流出的流量</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -t nat -A POSTROUTING -p udp --dport 53 -o eno33554968 -j MASQUERAD<br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;net.ipv4.ip_forwrad=1&quot;</span> &gt;&gt; /etc/sysctl.conf <span class="hljs-comment"># 开启路由转发功能     </span><br>[root@xy ~]# sysctl -p<br>[root@xy ~]# net.ipv4.ip_forward = 1  <br>[root@xy ~]# vim /etc/squid/squid.conf  <br>  http_port 3128 transparent                  <span class="hljs-comment"># 59, 开启透明模式  </span><br>  cache_dir ufs /var/spool/squid 100 16 256  <span class="hljs-comment"># 62</span><br>[root@xy ~]# squid -k parse                   <span class="hljs-comment"># 检测主配置文件是否有错    </span><br>[root@xy ~]# squid -z                         <span class="hljs-comment"># 对服务程序透明化进行初始化   </span><br></code></pre></td></tr></table></figure><blockquote><p>SNAT 设置对网站80端口请求转发至Squid服务器本地3128端口</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -t nat -A PREROUTING -p tcp -m tcp --dport 80 -j REDIRECT --to-ports 3128  <br>[root@xy ~]# iptables -t nat -A POSTROUTING -s 192.168.37.0/24 -o eno33554968 -j SNAT --to 桥接网卡IP      <span class="hljs-comment"># -o 匹配外网网卡流出的流量交给 外网卡</span><br></code></pre></td></tr></table></figure><h4 id="反向代理模式">1.8 反向代理模式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/squid/squid.conf  <span class="hljs-comment"># 反向代理配置  </span><br>  http_port 桥接网卡 IP:80 vhost         <span class="hljs-comment"># 59 </span><br>  cahe_peer 网站服务器 IP parent 80 0 originserver     <span class="hljs-comment"># 60 </span><br></code></pre></td></tr></table></figure><h3 id="使用iscsiinternet-small-computer-system-interface">2.使用iSCSI(Internet Small Computer System Interface)<a id="iscis"></a></h3><ul><li>IDE(成熟稳定, 价格便宜并行传输接口)<br /></li><li>SATA(传输速度更快, 数据校验更完整串行传输接口)<br /></li><li>SCSI(计算机和硬盘, 光驱等设备间系统级接口通用标准; 系统资源占用率低,转速快, 传输速度快)<br /></li><li>基于TCP/IP协议和SCSI接口协议的iSCSI是将SCSI接口与以太网技术结合的新型存储技术,可以来在网络中传输SCSI接口命令和数据;<br /></li><li>需要网卡传输, iSCSI-HBA网卡,该网卡连接SCSI接口或者FC(光纤通道)总线和内存,用于主机之间交换存储数据;</li></ul><h3 id="配置iscsi服务端">2.1 配置iSCSI服务端</h3><h4 id="创建raid-5磁盘阵列">2.1.2 创建RAID 5磁盘阵列:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mdadm -Cv /dev/md0 -n 3 -l 5 -x 1 /dev/sdb /dev/sdc /dev/sdd /dev/sde    <br>[root@xy ~]# mdadm -D /dev/md0 <span class="hljs-comment"># 查看设备详细信息</span><br></code></pre></td></tr></table></figure><h4 id="安装iscsi服务端192.168.37.1">2.1.3安装iSCSI服务端(192.168.37.1)：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum -y install targetd targetcli      <br>[root@xy ~]# systemctl restart targetd<br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> targetd    <br>  <span class="hljs-built_in">ln</span> -s <span class="hljs-string">&#x27;/usr/lib/systemd/system/targetd.service&#x27;</span> <span class="hljs-string">&#x27;/etc/systemd/system/multi-user.target.wants/targetd.service&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# targetcli       <span class="hljs-comment"># 交互式配置界面    </span><br>Warning: Could not load preferences file /root/.targetcli/prefs.bin.  <br>targetcli shell version 2.1.fb34  <br>Copyright 2011-2013 by Datera, Inc and others.    <br>For <span class="hljs-built_in">help</span> on commands, <span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;help&#x27;</span>.    <br><br>+++++++++++++++++++++++++++加入md0阵列到共享设备资源池++++++++++++++++++++++++++++<br>/&gt; <span class="hljs-built_in">ls</span>    <br>o- / ..................................................................... [...]    <br>o- backstores .......................................................... [...]    <br>| o- block .............................................. [Storage Objects: 0]    <br>| o- fileio ............................................. [Storage Objects: 0]    <br>| o- pscsi .............................................. [Storage Objects: 0]    <br>| o- ramdisk ............................................ [Storage Objects: 0]    <br>o- iscsi ........................................................ [Targets: 0]    <br>o- loopback ..................................................... [Targets: 0]    <br>/&gt; <span class="hljs-built_in">cd</span> /backstores/block     <span class="hljs-comment"># 共享设备位置  </span><br>/backstores/block&gt; create disk0 /dev/md0  <br>Create block storage object disk0 using /dev/md0.    <br>/backstores/block&gt; <span class="hljs-built_in">cd</span>   <br>/&gt; <span class="hljs-built_in">ls</span>  <br>o- / ..................................................................... [...]  <br>  o- backstores .......................................................... [...]  <br>    o-disk0 ........................ [/dev/md0 (40.0GiB write-thru deactivated)]  <span class="hljs-comment"># </span><br>  | o- block .............................................. [Storage Objects: 0]  <br>  | o- fileio ............................................. [Storage Objects: 0]  <br>  | o- pscsi .............................................. [Storage Objects: 0]  <br>  | o- ramdisk ............................................ [Storage Objects: 0]  <br>  o- iscsi ........................................................ [Targets: 0]  <br>  o- loopback ..................................................... [Targets: 0]  <br><br>+++++++++++++++++++++++创建iSCSI target名称及配置共享资源+++++++++++++++++++++++++<br>/&gt; <span class="hljs-built_in">cd</span> iscsi <span class="hljs-comment"># 创建iSCSI target名称及配置共享资源 </span><br>/iscsi&gt; create  <span class="hljs-comment"># </span><br>Created target iqn.2003-01.org.linux-iscsi.xy.x8664:sn.ca5dd98d2e7d.  <br>Created TPG 1.  <br>/iscsi&gt; <span class="hljs-built_in">cd</span> iqn.2003-01.org.linux-iscsi.xy.x8664:sn.ca5dd98d2e7d/  <br>/iscsi/iqn.20....ca5dd98d2e7d&gt; <span class="hljs-built_in">ls</span>    <br>o- iqn.2003-01.org.linux-iscsi.xy.x8664:sn.ca5dd98d2e7d .............. [TPGs: 1]  <br>  o- tpg1 ............................................... [no-gen-acls, no-auth]  <br>    o- acls .......................................................... [ACLs: 0]  <br>    o- luns .......................................................... [LUNs: 0]  <br>    o- portals .................................................... [Portals: 0]  <br>/iscsi/iqn.20....ca5dd98d2e7d&gt; <span class="hljs-built_in">cd</span> tpg1/luns <span class="hljs-comment"># </span><br>/iscsi/iqn.20...e7d/tpg1/luns&gt; create /backstores/block/disk0   <span class="hljs-comment">#  </span><br>Create LUN 0.  <br><br>++++++++++++++++++++++++++++++设置访问控制列表++++++++++++++++++++++++++++++++++  <br>/iscsi/iqn.20...e7d/tpg1/luns&gt; <span class="hljs-built_in">cd</span>..   <br>/iscsi/iqn.20...e7d/tpg1/luns&gt; <span class="hljs-built_in">cd</span> acls  <span class="hljs-comment"># 设置访问控制列表        </span><br>/iscsi/iqn.20...d98d2e7d/tpg1&gt; create iqn.2003-01.org.linux-iscsi.xy.x8664:sn.ca5dd98d2e7d:client**    <br>Create Node ACL <span class="hljs-keyword">for</span> iqn.2003-01.org.linux-iscsi.xy.x8664:sn.ca5dd98d2e7d:client  <br>Create LUN 0. <br><br>++++++++++++++++++++++++++++设置服务的监听IP及端口++++++++++++++++++++++++++++++++<br>/iscsi/iqn.20...e7d/tpg1/luns&gt; <span class="hljs-built_in">cd</span> ..    <br>/iscsi/iqn.20...d98d2e7d/tpg1&gt; <span class="hljs-built_in">cd</span> portals   <br>/iscsi/iqn.20.../tpg1/portals&gt; create 192.168.37.10    <br>Using default IP port 3260  <br>Created network portal 192.168.37.10:3260. <br><br>+++++++++++++++++++++++++++++检测配置信息++++++++++++++++++++++++++++++++++++++++ <br>/iscsi/iqn.20.../tpg1/portals&gt; <span class="hljs-built_in">ls</span>      <span class="hljs-comment"># 检测配置信息   </span><br>o- / ..................................................................... [...]  <br>  o- backstores .......................................................... [...]  <br>  | o- block .............................................. [Storage Objects: 0]  <br>  | | o-disk0 ...................... [/dev/md0 (40.0GiB write-thru deactivated)] <span class="hljs-comment">#  </span><br>  | o- fileio ............................................. [Storage Objects: 0]  <br>  | o- pscsi .............................................. [Storage Objects: 0]  <br>  | o- ramdisk ............................................ [Storage Objects: 0]  <br>  o- iscsi ........................................................ [Targets: 1]   <br>  | o- iqn.2003-01.org.linux-iscsi.xy.x8664:sn.ca5dd98d2e7d .......... [TPGs: 1] <span class="hljs-comment">#    </span><br>  |   o- tpg1 ........................................... [no-gen-acls, no-auth]  <br>  |     o- acls ...................................................... [ACLs: 0]  <br>  |     | o- iqn.2003-01.org.linux-iscsi.xy.x8664:sn.ca5dd98d2e7d:client......  <span class="hljs-comment">#  </span><br>  [Mapped LUNs: 1]  <br>  |     | o- mapped_lun0 ............................... [lun0 block/disk0 (rw)] <span class="hljs-comment"># </span><br>    o- luns .................................. [LUNs: 1]  <br>        | o -lun0 ............................ [block/disk0 (dev/md0)]  <br>  |     o- portals ........................... [Portals: 1]  <br>  |       o- 192.168.37.10:3260 .............. [OK]  <span class="hljs-comment">#   </span><br>  o- loopback ................................ [Targets: 0]  <br>/&gt; <span class="hljs-built_in">exit</span>  <br>Global pref auto_save_on_exit=<span class="hljs-literal">true</span>  <br>Last 10 configs saved <span class="hljs-keyword">in</span> /etc/target/backup.  <br>Configuration saved to /etc/target/saveconfig.json  <br>++++++++++++++++++++++++++++++++++++++结束++++++++++++++++++++++++++++++++++++++<br><br>[root@xy ~]# firewall-cmd --permanent --add-port=3260/tcp <br>  success<br>[root@xy ~]# firewall-cmd --reload    <br>  success<br></code></pre></td></tr></table></figure><h4 id="配置linux-iscsi客户端">2.1.4 配置Linux iSCSI客户端</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install iscsi-initiator-utils<br>[root@xy ~]# vim /etc/iscsi/initiatorname.iscsi <br>  Initiatorname=iqn.2003-01.org.linux-iscsi.xy.x8664:sn.ca5dd98d2e7d:clien <br>[root@xy ~]# iscsi -m discovery -t st -p 192.168.37.10    <span class="hljs-comment"># 发现  </span><br>  192.168.37.10:3260,1 iqn.2003-01.org.linux-iscsi.xy.x8664:sn.ca5dd98d2e7d  <br>[root@xy ~]# iscsiadm -m mode -T iqn.2003-01.org.linux-iscsi.xy.x8664:sn.ca5dd98d2e7d -p 192.168.37.10 --login                <span class="hljs-comment"># 登陆   </span><br>[root@xy ~]# file /dev/sdb  <br>  /dev/sdb: block specile<br>[root@xy ~]# mkfs.xfs /dev/sdb           <span class="hljs-comment"># 格式化  </span><br>[root@xy ~]# <span class="hljs-built_in">mkdir</span> /iscsi  <br>[root@xy ~]# mount /dev/sdb /iscsi       <span class="hljs-comment"># 挂载  </span><br>[root@xy ~]# blkid | grep /dev/sdb<br>  /dev/sdb: UUID=<span class="hljs-string">&quot;b6b6d578-3ba5-450b-b967-d1a81a71d600&quot;</span> TYPE=<span class="hljs-string">&quot;xfs&quot;</span> <br>[root@xy ~]# /etc/fstab<br>  UUID=<span class="hljs-string">&quot;b6b6d578-3ba5-450b-b967-d1a81a71d600   /iscsi   xfs   defaults,_netdev   0 0 </span><br><span class="hljs-string">[root@xy ~]# iscsiadm -u   # 卸载网络设备</span><br></code></pre></td></tr></table></figure><h4 id="配置windows-iscsi客户端">2.1.5 配置Windows iSCSI客户端</h4><ul><li>系统安全-&gt;管理工具-&gt;iSCSI发起程序-&gt;目标填写iSCSI服务端IP-&gt;快速连接-&gt;配置-&gt;更改-&gt;填写服务端ACL所定义的名称</li></ul><h3 id="使用mariadb数据库管理系统">3. 使用MariaDB数据库管理系统<a id="mariadb"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum -y install mariadb mariadb-server   <br>[root@xy ~]# systemctl restart mariadb<br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> mariadb    <br>  <span class="hljs-built_in">ln</span> -s <span class="hljs-string">&#x27;/usr/lib/systemd/system/mariadb.service&#x27;</span> <span class="hljs-string">&#x27;/etc/systemd/system/multi-user.target.wants/mariadb.service&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="数据库初始化">3.1 数据库初始化</h4><table><thead><tr><th>命令</th><th>作用</th><th>eg.</th></tr></thead><tbody><tr><td>set</td><td>设置密码</td><td>set password=password(‘123456’);</td></tr><tr><td>show</td><td>展示数据库, 表, 权限</td><td>show databases;</td></tr><tr><td>—</td><td>—</td><td>show tables;</td></tr><tr><td>—</td><td>—</td><td>show grants for anyue@localhost;</td></tr><tr><td>use</td><td>指定使用数据库</td><td>use anyue;</td></tr><tr><td>grant</td><td>授予权限</td><td>grant 权限 on 库名.表名 to 用户名@主机名;</td></tr><tr><td>revoke</td><td>移除权限</td><td>revoke 权限 on 库名.表名 from 用户名@主机名;</td></tr><tr><td>create</td><td>创建数据库, 用户, 表单</td><td>create database anyue;</td></tr><tr><td>—</td><td>—</td><td>create user anyue@localhost identified by ‘123456’;</td></tr><tr><td>—</td><td>—</td><td>create table mybook (name char(15),price int,pages int);</td></tr><tr><td>insert</td><td>增(增加表单数据)</td><td>insert into mybook(name,price,pages) values(‘ES’,‘60’,‘10’);</td></tr><tr><td>update</td><td>改(改动表单数据)</td><td>update 表单 set attr=新值 where attr=初值;</td></tr><tr><td>—</td><td>—</td><td>update mybook set price=55;</td></tr><tr><td>delete</td><td>删(删除表单数据)</td><td>delete form 表单名 where atrr=值;</td></tr><tr><td>select</td><td>查(表单数据)</td><td>select user,host,password from user where=‘anyue’;</td></tr><tr><td>—</td><td>—</td><td>select * from mybook where price&gt;75;</td></tr><tr><td>—</td><td>—</td><td>select name,price from mybook;</td></tr><tr><td>describe</td><td>描述表单(desc)</td><td>desc mybook;</td></tr><tr><td>drop</td><td>删数据库,表,用户</td><td>drop anyue;</td></tr><tr><td>alter</td><td>修改表描述</td><td>alter table 表单名</td></tr><tr><td>—</td><td>—</td><td>alter table mybook add(字段名1 字段类型1,…);</td></tr><tr><td>—</td><td>—</td><td>a lter table mybook modify 字段名1 字段类型1;</td></tr><tr><td>—</td><td>—</td><td>alter table mybook drop 字段名;</td></tr><tr><td>—</td><td>—</td><td>alter table mybook 原表名 rename to 新表名;</td></tr><tr><td>mysqldump</td><td>备份数据库</td><td>mysqldump -uroot -p anyue &gt;/root/anyue.dump</td></tr><tr><td>—</td><td>还原数据库</td><td><code>mysql -uroot -p anyue &lt;/root/anyue.dump</code></td></tr><tr><td>like</td><td>模糊查询</td><td>% 或者 _</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mysql: emp,dept,salgrate<br>[root@xy ~]# mysql_secure_installation  <span class="hljs-comment"># mariaDB初始化    </span><br>[root@xy ~]# firewall-cmd --permanent --add-service=mysql <br>  success  <br>[root@xy ~]# firewall-cmd --reload<br>  success<br></code></pre></td></tr></table></figure><h4 id="基本操作">3.2 基本操作</h4><p><ahref="https://www.cnblogs.com/gaojian/p/3317456.html">mysql参考</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p         # 进入数据库  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;    # <span class="hljs-keyword">show</span> databses 显示数据库<br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.03</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> password <span class="hljs-operator">=</span> password(<span class="hljs-string">&#x27;123456&#x27;</span>);  # 修改密码  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> database testdb <span class="hljs-keyword">character set</span> utf8;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> anyue<span class="hljs-variable">@localhost</span> indentified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;  <br>  Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)  <br>  # 创建用户  <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> 用户名@主机名 identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;PASSWORD&#x27;</span><br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> use mysql;<br>MariaDB [mysql]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host,password <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;anyue&#x27;</span>;  # 选择用户  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------+-----------+-------------------------------------------+</span><br>  <span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>  <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span> password                                  <span class="hljs-operator">|</span><br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------+-----------+-------------------------------------------+</span><br>  <span class="hljs-operator">|</span> anyue <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> <span class="hljs-operator">*</span><span class="hljs-number">6</span>BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 <span class="hljs-operator">|</span><br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------+-----------+-------------------------------------------+</span><br>  <span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec) <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> quit;  <br>Bye  <br></code></pre></td></tr></table></figure><h3 id="授予权限操作">3.3 授予权限操作</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uanyue <span class="hljs-operator">-</span>p       # mysql <span class="hljs-operator">-</span>uusername <span class="hljs-operator">-</span>p  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> quit;  <br>  Bye  <br><br><span class="hljs-operator">+</span> <span class="hljs-keyword">GRANT</span> 权限 <span class="hljs-keyword">ON</span> 数据库.表单名称 <span class="hljs-keyword">TO</span> 账户名@主机名  # 授予权限 <span class="hljs-keyword">GRANT</span> <br><span class="hljs-operator">+</span> <span class="hljs-keyword">GRANT</span> 权限 <span class="hljs-keyword">ON</span> 数据库.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> 账户名@主机名  <br><span class="hljs-operator">+</span> <span class="hljs-keyword">GRANT</span> 权限 <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> 账户名@主机名  <br><span class="hljs-operator">+</span> <span class="hljs-keyword">GRANT</span> 权限<span class="hljs-number">1</span>,权限<span class="hljs-number">2</span> <span class="hljs-keyword">ON</span> 数据库.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> 账户名@主机名  <br><span class="hljs-operator">+</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> 账户名@主机名  <br><br>[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span>,<span class="hljs-keyword">update</span>,<span class="hljs-keyword">delete</span>,<span class="hljs-keyword">insert</span> <span class="hljs-keyword">on</span> mysql.user <span class="hljs-keyword">to</span> anyue<span class="hljs-variable">@localhost</span>;  # 赋予anyue权限    <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> anyue<span class="hljs-variable">@localhost</span>;   # 查看anyue权限  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------------------------------------------------------------+  </span><br>  <span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> anyue<span class="hljs-variable">@localhost</span>                                                                                   <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------------------------------------------------------------+  </span><br>  <span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;anyue&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> PASSWORD <span class="hljs-string">&#x27;*6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9&#x27;</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>, <span class="hljs-keyword">INSERT</span>, <span class="hljs-keyword">UPDATE</span>, <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">ON</span> mysql.user <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;anyue&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span>                                <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------------------------------------------------------------+  </span><br>  <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> quit  <br>  Bye  <br></code></pre></td></tr></table></figure><h3 id="移除权限操作">3.4 移除权限操作</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uanyue <span class="hljs-operator">-</span>p <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;<br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span>   <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> use mysql;  <br>MariaDB [mysql]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> tables;<br>  <span class="hljs-operator">+</span><span class="hljs-comment">-----------------+  </span><br>  <span class="hljs-operator">|</span> Tables_in_mysql <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-----------------+  </span><br>  <span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>            <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-----------------+  </span><br>  <span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> quit;  <br>  Bye <br><span class="hljs-comment">---</span><br><br>[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> use mysql;<br>MariaDB [mysql]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">select</span>,<span class="hljs-keyword">update</span>,<span class="hljs-keyword">delete</span>,<span class="hljs-keyword">insert</span> <span class="hljs-keyword">on</span> mysql.user <span class="hljs-keyword">from</span> anyue<span class="hljs-variable">@localhost</span>;  # 移除对anyue的授权 <span class="hljs-keyword">REVOKE</span><br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">select</span>,<span class="hljs-keyword">update</span>,<span class="hljs-keyword">insert</span>,<span class="hljs-keyword">delete</span> <span class="hljs-keyword">on</span> mysql.user <span class="hljs-keyword">from</span> xy<span class="hljs-variable">@localhost</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">revoke</span> <span class="hljs-keyword">all</span> privileges <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> anyue<span class="hljs-variable">@localhost</span>;<br>  Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [mysql]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> anyue<span class="hljs-variable">@localhost</span>;<br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------------------------------------------------------------+  </span><br>  <span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> anyue<span class="hljs-variable">@localhost</span>                                                                                   <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------------------------------------------------------------+  </span><br>  <span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;anyue&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> PASSWORD <span class="hljs-string">&#x27;*6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9&#x27;</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------------------------------------------------------------+  </span><br>  <span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> quit;   <br>  Bye<br></code></pre></td></tr></table></figure><h3 id="数据库-表单操作">3.5 数据库 表单操作</h3><ul><li>CREATE DATABASE 数据库名称<br /></li><li>DESCRIBE 表单名称(DESC)<br /></li><li>UPDATE 表单名称 SET attribute=新值 WHERE attribute=旧值<br /></li><li>USE 数据库名称<br /></li><li>SHOW databases # 显示当前已有的数据库</li><li>SHOW tables # 显示当前数据库中的表单</li><li>SELECT * FROM 表单名称<br /></li><li>DELETE FROM 表单名 WHERE attribute=值</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> database mybook;  # 创建数据库xy  <br>  Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> mybook             <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.02</span> sec)  <br><br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> use mybook;  <br>  Database changed  <br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create table</span> mybook (name <span class="hljs-type">char</span>(<span class="hljs-number">15</span>),price <span class="hljs-type">int</span>,pages <span class="hljs-type">int</span>); # 创建表单  <br>  Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)  <br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">desc</span> mybook; # <span class="hljs-keyword">desc</span> mybook;  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------+----------+------+-----+---------+-------+  </span><br>  <span class="hljs-operator">|</span> Field <span class="hljs-operator">|</span> Type     <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------+----------+------+-----+---------+-------+  </span><br>  <span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> <span class="hljs-type">char</span>(<span class="hljs-number">15</span>) <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> price <span class="hljs-operator">|</span> <span class="hljs-type">int</span>(<span class="hljs-number">11</span>)  <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> pages <span class="hljs-operator">|</span> <span class="hljs-type">int</span>(<span class="hljs-number">11</span>)  <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------+----------+------+-----+---------+-------+  </span><br>  <span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.02</span> sec)  <br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert into</span> mybook(name,price,pages) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;MC&#x27;</span>,<span class="hljs-string">&#x27;60&#x27;</span>,<span class="hljs-string">&#x27;518&#x27;</span>);  # 往表单mybook插入数据<br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> mybook;     # 选择表单内容 <br>  <span class="hljs-operator">+</span><span class="hljs-comment">------------+-------+-------+  </span><br>  <span class="hljs-operator">|</span> name       <span class="hljs-operator">|</span> price <span class="hljs-operator">|</span> pages <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">------------+-------+-------+  </span><br>  <span class="hljs-operator">|</span> MC         <span class="hljs-operator">|</span>    <span class="hljs-number">60</span> <span class="hljs-operator">|</span>   <span class="hljs-number">518</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">------------+-------+-------+  </span><br>  <span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)  <br><br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> mybook <span class="hljs-keyword">set</span> price<span class="hljs-operator">=</span><span class="hljs-number">55</span>;  # 更新表单内容  <br>  Query OK, <span class="hljs-number">1</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)  <br>  <span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span>  <br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> name,price <span class="hljs-keyword">from</span> mybook; <br>  <span class="hljs-operator">+</span><span class="hljs-comment">------------+-------+  </span><br>  <span class="hljs-operator">|</span> name       <span class="hljs-operator">|</span> price <span class="hljs-operator">|</span>   <br>  <span class="hljs-operator">+</span><span class="hljs-comment">------------+-------+  </span><br>  <span class="hljs-operator">|</span> MC         <span class="hljs-operator">|</span>    <span class="hljs-number">50</span> <span class="hljs-operator">|</span>    <br>  <span class="hljs-operator">+</span><span class="hljs-comment">------------+-------+  </span><br>  <span class="hljs-number">1</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> mybook;  <br>  Query OK, <span class="hljs-number">1</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [xy]<span class="hljs-operator">&gt;</span> selete <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> mybook;  <br>  <span class="hljs-keyword">Empty</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> quit;  <br>  Bye<br></code></pre></td></tr></table></figure><h3 id="数据库where命令">3.6 数据库where命令</h3><p>=、&lt;&gt;或!=、&gt;、&lt;、&gt;= 大于或等于、&lt;= 小于或等于<br />BETWEEN 在某个范围内、 LINK 搜索一个例子、IN 在列中搜索多个值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> mybook; <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+-------+-------+  </span><br>  <span class="hljs-operator">|</span> name        <span class="hljs-operator">|</span> price <span class="hljs-operator">|</span> pages <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+-------+-------+  </span><br>  <span class="hljs-operator">|</span> ShenQu      <span class="hljs-operator">|</span>    <span class="hljs-number">58</span> <span class="hljs-operator">|</span>   <span class="hljs-number">800</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> MC          <span class="hljs-operator">|</span>    <span class="hljs-number">60</span> <span class="hljs-operator">|</span>   <span class="hljs-number">518</span> <span class="hljs-operator">|</span>   <br>  <span class="hljs-operator">|</span> Baoliandeng <span class="hljs-operator">|</span>    <span class="hljs-number">70</span> <span class="hljs-operator">|</span>    <span class="hljs-number">65</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> xy          <span class="hljs-operator">|</span>    <span class="hljs-number">45</span> <span class="hljs-operator">|</span>    <span class="hljs-number">83</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> xy1         <span class="hljs-operator">|</span>    <span class="hljs-number">45</span> <span class="hljs-operator">|</span>    <span class="hljs-number">83</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+-------+-------+  </span><br>  <span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)  <br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> mybook <span class="hljs-keyword">where</span> price<span class="hljs-operator">&gt;</span><span class="hljs-number">45</span>; <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+-------+-------+  </span><br>  <span class="hljs-operator">|</span> name        <span class="hljs-operator">|</span> price <span class="hljs-operator">|</span> pages <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+-------+-------+  </span><br>  <span class="hljs-operator">|</span> ShenQu      <span class="hljs-operator">|</span>    <span class="hljs-number">58</span> <span class="hljs-operator">|</span>   <span class="hljs-number">800</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> MC     <span class="hljs-operator">|</span>    <span class="hljs-number">60</span> <span class="hljs-operator">|</span>   <span class="hljs-number">518</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> Baoliandeng <span class="hljs-operator">|</span>    <span class="hljs-number">70</span> <span class="hljs-operator">|</span>    <span class="hljs-number">65</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+-------+-------+  </span><br>  <span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)  <br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> mybook <span class="hljs-keyword">where</span> price<span class="hljs-operator">!=</span><span class="hljs-number">60</span>; <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+-------+-------+  </span><br>  <span class="hljs-operator">|</span> name        <span class="hljs-operator">|</span> price <span class="hljs-operator">|</span> pages <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+-------+-------+  </span><br>  <span class="hljs-operator">|</span> ShenQu      <span class="hljs-operator">|</span>    <span class="hljs-number">58</span> <span class="hljs-operator">|</span>   <span class="hljs-number">800</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> Baoliandeng <span class="hljs-operator">|</span>    <span class="hljs-number">70</span> <span class="hljs-operator">|</span>    <span class="hljs-number">65</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> xy          <span class="hljs-operator">|</span>    <span class="hljs-number">45</span> <span class="hljs-operator">|</span>    <span class="hljs-number">83</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> xy1         <span class="hljs-operator">|</span>    <span class="hljs-number">45</span> <span class="hljs-operator">|</span>    <span class="hljs-number">83</span> <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+-------+-------+  </span><br>  <span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> quit;  <br>  Bye<br></code></pre></td></tr></table></figure><h3 id="数据库的备份mysqldump">3.7 数据库的备份mysqldump</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysqldump <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p xy <span class="hljs-operator">&gt;</span> <span class="hljs-operator">/</span>root<span class="hljs-operator">/</span>xy.dump  <br>  Enter password:   <br>[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">drop</span> database xy;  <br>  Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.03</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases; <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> database xy;  <br>  Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> quit;<br>  Bye  <br></code></pre></td></tr></table></figure><h3 id="数据库还原">3.8 数据库还原</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p xy <span class="hljs-operator">&lt;</span> <span class="hljs-operator">/</span>root<span class="hljs-operator">/</span>xy.dump   # xy 是 数据库，不是密码<br>  Enter password:   <br>[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> use xy;<br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> tables;<br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------+  </span><br>  <span class="hljs-operator">|</span> Tables_in_xy <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------+  </span><br>  <span class="hljs-operator">|</span> mybook       <span class="hljs-operator">|</span>    <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------+  </span><br>  <span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)  <br>MariaDB [xy]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">desc</span> mybook;  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------+----------+------+-----+---------+-------+  </span><br>  <span class="hljs-operator">|</span> Field <span class="hljs-operator">|</span> Type     <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------+----------+------+-----+---------+-------+  </span><br>  <span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> <span class="hljs-type">char</span>(<span class="hljs-number">15</span>) <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span> <br>  <span class="hljs-operator">|</span> price <span class="hljs-operator">|</span> <span class="hljs-type">int</span>(<span class="hljs-number">11</span>)  <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> pages <span class="hljs-operator">|</span> <span class="hljs-type">int</span>(<span class="hljs-number">11</span>)  <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">-------+----------+------+-----+---------+-------+  </span><br>  <span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> quit;  <br>  Bye<br></code></pre></td></tr></table></figure><h3 id="练习">练习:</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@Xingyue</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> databases;  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> Database           <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-operator">|</span> information_schema <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> mysql              <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> performance_schema <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+  </span><br>  <span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> privileges <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> anyue<span class="hljs-variable">@localhost</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> privileges <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> root<span class="hljs-variable">@localhost</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> privileges <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> root<span class="hljs-variable">@127</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>  <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> use mysql; <br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host,password <span class="hljs-keyword">from</span> mysql.user;<br>  <span class="hljs-operator">+</span><span class="hljs-comment">---------+-----------+-------------------------------------------+  </span><br>  <span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>    <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span> password                                  <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">+</span><span class="hljs-comment">---------+-----------+-------------------------------------------+  </span><br>  <span class="hljs-operator">|</span> root    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> <span class="hljs-operator">*</span><span class="hljs-number">6</span>BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> root    <span class="hljs-operator">|</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-operator">|</span> <span class="hljs-operator">*</span><span class="hljs-number">6</span>BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> root    <span class="hljs-operator">|</span> ::<span class="hljs-number">1</span>       <span class="hljs-operator">|</span> <span class="hljs-operator">*</span><span class="hljs-number">6</span>BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 <span class="hljs-operator">|</span>  <br>  <span class="hljs-operator">|</span> anyue   <span class="hljs-operator">|</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-operator">|</span> <span class="hljs-operator">*</span><span class="hljs-number">6</span>BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 <span class="hljs-operator">|</span>   <br>  <span class="hljs-operator">+</span><span class="hljs-comment">---------+-----------+-------------------------------------------+  </span><br>  <span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h3 id="binlog日志">binlog日志</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# vim <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>my.cnf <br>  log<span class="hljs-operator">-</span>bin<span class="hljs-operator">=</span>mysql<span class="hljs-operator">-</span>bin          # 开启二进制日志, 只记录增删改  <br>[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysqlbinlog <span class="hljs-comment">--start-datetime &#x27;Y-M-D H:M:S&#x27; --stop-datetime &#x27;Y-M-D H:M:S&#x27; |mysql -uroot -p  </span><br>[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# mysqlbinlog <span class="hljs-comment">--start-position --stop-position |mysql -uroot -p</span><br></code></pre></td></tr></table></figure><h3 id="mysql主从备份备份负载均衡">MySQL主从备份(备份,负载均衡):</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@xy</span> <span class="hljs-operator">~</span>]# vim <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>my.cnf  <br>  主: <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.10</span><br>  [mysqld]<br>  log<span class="hljs-operator">-</span>bin<span class="hljs-operator">=</span>mysql.bin  <br>  server<span class="hljs-operator">-</span>id<span class="hljs-operator">=</span><span class="hljs-number">10</span>    <br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> replication slave <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> slave@<span class="hljs-string">&#x27;192.168.10.20&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> master status;  # replication 拷贝<br>  <span class="hljs-operator">+</span><span class="hljs-comment">------------------+----------+--------------+-------------------+</span><br>  <span class="hljs-operator">|</span> Fiel             <span class="hljs-operator">|</span> Position <span class="hljs-operator">|</span> Binlog_Do_DB <span class="hljs-operator">|</span> Binglog_Ignore_DB <span class="hljs-operator">|</span><br>  <span class="hljs-operator">+</span><span class="hljs-comment">------------------+----------+--------------+-------------------+</span><br>  <span class="hljs-operator">|</span> mysql<span class="hljs-operator">-</span>bin<span class="hljs-number">.000003</span> <span class="hljs-operator">|</span>      <span class="hljs-number">257</span> <span class="hljs-operator">|</span>              <span class="hljs-operator">|</span>                   <span class="hljs-operator">|</span><br>  <span class="hljs-operator">+</span><span class="hljs-comment">------------------+----------+--------------+-------------------+</span><br><span class="hljs-comment">---</span><br><br>备: <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.20</span><br>  [mysqld]<br>  log<span class="hljs-operator">-</span>bin<span class="hljs-operator">=</span>mysql.bin  <br>  server<span class="hljs-operator">-</span>id<span class="hljs-operator">=</span><span class="hljs-number">20</span>  <br>mysql<span class="hljs-operator">&gt;</span> change master <span class="hljs-keyword">to</span><br><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> master_user<span class="hljs-operator">=</span><span class="hljs-string">&#x27;slave&#x27;</span>,<br><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> master_password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;123456&#x27;</span>,<br><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> master_host<span class="hljs-operator">=</span><span class="hljs-string">&#x27;192.168.10.10&#x27;</span>,<br><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> master_log_file<span class="hljs-operator">=</span><span class="hljs-string">&#x27;mysql-bin.000003&#x27;</span>,<br><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> master_log_pos<span class="hljs-operator">=</span><span class="hljs-number">257</span>;<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">start</span> slave;<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> slave status;<br></code></pre></td></tr></table></figure><h3 id="mysql主主备份均摊写压力">MySQL主主备份(均摊写压力):</h3><blockquote><p>在主从备份的基础上如下操作</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/my.cnf  <br>  主: 192.168.10.10<br>  [mysqld]<br>  log-bin=mysql.bin  <br>  server-id=10 <br>  replace-do-db=<span class="hljs-built_in">test</span><br>  binlog-ignore-db=mysql<br>  binlog-ignore-db=information_schema<br>  auto-increment-increment=2<br>  auto=increment-offset=1<br> <br>mysql&gt; change master to<br>-&gt; master_user=<span class="hljs-string">&#x27;slave&#x27;</span>,<br>-&gt; master_password=<span class="hljs-string">&#x27;123456&#x27;</span>,<br>-&gt; master_host=<span class="hljs-string">&#x27;192.168.10.20&#x27;</span>,<br>-&gt; master_log_file=<span class="hljs-string">&#x27;mysql-bin.000004&#x27;</span>,<br>-&gt; master_log_pos=259;<br>mysql&gt; start slave;<br>mysql&gt; show slave status\G;<br><br>  备: 192.168.10.20<br>  [mysqld]<br>  log-bin=mysql.bin  <br>  server-id=20 <br>  replace-do-db=<span class="hljs-built_in">test</span><br>  binlog-ignore-db=mysql<br>  binlog-ignore-db=information_schema<br>  auto-increment-increment=2<br>  auto=increment-offset=1<br>mysql&gt; grant replication slave on *.* to slave@<span class="hljs-string">&#x27;192.168.10.10&#x27;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>;<br>mysql&gt; show master status;<br></code></pre></td></tr></table></figure><h3 id="使用pxekickstat无人值守安装服务">4.1使用PXE+Kickstat无人值守安装服务 <a id="pxe"></a></h3><ul><li><strong>PXE(Preboot eXecuteEnvironment)</strong>—预启动执行环境,可以让计算机通过网络来启动操作系统,主要用于在无人值守安装系统中引导客户端安装Linux操作系统<br /></li><li><strong>Kickstat无人值守安装方式</strong>,预先把手工填写参数保存为<strong>ks.cfg</strong>文件,安装过程自动匹配Kickstat生成的文件<br /></li><li><strong>DHCP + vsftp + tftp + Kickstart</strong><br /><img src="/posts/c7601bf8/PXE.png" class="" title="[PXE+Kickstart]"></li></ul><h4 id="dhcp服务程序配置-192.168.37.10-无人值守系统服务器ip">4.2DHCP服务程序配置 (192.168.37.10 无人值守系统服务器IP)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install dhcp<br>[root@xy ~]# vim /etc/dhcp/dhcpd.conf  <span class="hljs-comment"># /usr/share/doc/dhcp*/dhcpd.conf.example</span><br>  <span class="hljs-comment">#  </span><br>  <span class="hljs-comment"># DHCP Server Configuration file.  </span><br>  <span class="hljs-comment">#   see /usr/share/doc/dhcp*/dhcpd.conf.example  </span><br>  <span class="hljs-comment">#   see dhcpd.conf(5) man page  </span><br>  <span class="hljs-comment">#  </span><br>  allow booting;  <br>  allow bootp;  <br>  ddns-update-style interim;  <br>  ignore client-updates;  <br>  subnet 192.168.37.0 netmask 255.255.255.0 &#123;  <span class="hljs-comment"># 填写网段 </span><br>      option subnet-mask  255.255.255.0  <br>      option domain-name-server   192.168.37.10;  <br>      range dynamic-bootp 192.168.37.100  192.168.37.200;  <br>      default-lease-time  21600;  <br>      max-server  43200;  <br>      next-server 192.168.37.10;    <span class="hljs-comment"># tftp server 的 IP</span><br>      filename<span class="hljs-string">&quot;pxelinux.0&quot;</span>;         <span class="hljs-comment"># 客户机获取IP 主动获取引导驱动文件 </span><br>  &#125;<br>[root@xy ~]# systemctl restart dhcpd  <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> dhcpd  <br>  <span class="hljs-built_in">ln</span> -s <span class="hljs-string">&#x27;/usr/lib/systemd/system/dhcpd.service&#x27;</span> <span class="hljs-string">&#x27;/etc/systemd/system/multi-user.target.wants/dhcpd.service&#x27;</span><br></code></pre></td></tr></table></figure><h4id="tftp服务程序配置为客户机提供引导及驱动文件默认占用端口-69udp">4.3TFTP服务程序配置，为客户机提供引导及驱动文件,默认占用端口 69/UDP</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install tftp-server<br>[root@xy ~]# vim /etc/xinetd.d/tftp <br>  <span class="hljs-built_in">disable</span> = no  <br>[root@xy ~]# firewall-cmd  --permanent --add-port=69/udp      <br>  success  <br>[root@xy ~]# firewall-cmd --reload<br>  success <br></code></pre></td></tr></table></figure><h4 id="syslinux服务程序配置-提供引导加载服务程序">4.4SYSLinux服务程序配置, 提供引导加载服务程序</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install syslinux   <span class="hljs-comment"># /usr/share/syslinux 引导文件 </span><br>[root@xy ~]# <span class="hljs-built_in">cd</span> /var/lib/tftpboot/<br>[root@xy tftpboot]# <span class="hljs-built_in">cp</span> /usr/share/syslinux/pxelinux.0 .<br>[root@xy tftpboot]# <span class="hljs-built_in">cp</span> /media/cdrom/images/pxeboot/&#123;vmlinuz,initrd.img&#125; .<br>[root@xy tftpboot]# <span class="hljs-built_in">cp</span> /media/cdrom/isolinux/&#123;vesamenu.c32,boot.msg&#125; .<br>[root@xy tftpboot]# <span class="hljs-built_in">mkdir</span> pxelinux.cfg  <br>[root@xy tftpboot]# <span class="hljs-built_in">cp</span> /media/cdrom/isolinux/isolinux.cfg pxelinux.cfg/default  <br>[root@xy tftpboot]# <span class="hljs-built_in">ls</span>  <br>  boot.msg  initrd.img  pxelinux.0  pxelinux.cfg  vesamenu.c32  vmlinuz<br><br>[root@xy tftpboot]# vim /pxelinux.cfg/default<br>  default linux    <span class="hljs-comment"># 1行   vesamenu.c32</span><br>  label linux     <span class="hljs-comment"># 61行</span><br>      menu label ^Install Red Hat Enterprise Linux 7.0  <br>      kernel vmlinuz  <br>      append initrd=initrd.img inst.stage2=hd:LABEL=RHEL-7.0\x20Server.x86_64 quiet   <br>  <span class="hljs-comment"># 64行改为</span><br>      append initrd=initrd.img inst.stage2=ftp://192.168.37.10 ks=ftp://192.168.37.10/pub/ks.cfg quiet  <br></code></pre></td></tr></table></figure><h4 id="vsftp服务程序配置光盘镜像通过ftp协议传输">4.5vsftp服务程序配置，光盘镜像通过FTP协议传输</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install vsftpd  <br>[root@xy ~]# systemctl restart vsftpd  <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> vsftpd<br>  <span class="hljs-built_in">ln</span> -s <span class="hljs-string">&#x27;/usr/lib/systemd/system/vsftpd.service&#x27;</span> <span class="hljs-string">&#x27;/etc/systemd/system/multi-user.target.wants/vsftpd.service&#x27;</span> <br>[root@xy ~]# <span class="hljs-built_in">cp</span> -r /media/cdrom/* /var/ftp<br>[root@xy ~]# firewall-cmd --permanent --add-service=ftp  <br>  success  <br>[root@xy ~]# firewall-cmd --reload<br>  success  <br>[root@xy ~]# setsebool -P ftpd_connect_all_unreserved=on<br></code></pre></td></tr></table></figure><h4 id="创建应答文件kickstart">4.6 创建应答文件Kickstart</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">cp</span> ~/anaconda-ks.cfg /var/ftp/pub/ks.cfg  <br>[root@xy ~]# <span class="hljs-built_in">chmod</span> +r /var/ftp/pub/ks.cfg  <br>[root@xy ~]# vim /var/ftp/pub/ks.cfg<br>  url --url=ftp://192.168.37.10     <span class="hljs-comment"># 1行  </span><br>  timezone Aisa/Shanghai --isUtc    <span class="hljs-comment"># 21行  </span><br>  cleanpart --all --initlable       <span class="hljs-comment"># 29行  </span><br><br>[root@xy ~]# yum istall system-config-kickstart <span class="hljs-comment"># 图形化Kickstart应答文件生成工具</span><br></code></pre></td></tr></table></figure><ul><li><strong>DHCP</strong>: 给未安装操作系统的机子分配静态IP,并加载引导驱动文件 pxelinux.0;<br /></li><li><strong>tftp</strong>(基于 UDP 文件传输协议):为客户机提供引导及驱动文件;<br /></li><li><strong>SYSLinux</strong>: 复制引导文件 pxelinux.0 到TFTP默认目录中, 创建 /pxelinux.cfg/defalut 文件;<br /></li><li><strong>vsftp</strong>: 将光盘镜像挂载到 media/cdrom, 复制到 vsftp工作目录;</li><li>创建 Kickstart 应答文件: /var/ftp/pub/ks.cfg</li></ul><h3 id="cobbler-无人值守安装服务">4.1 Cobbler 无人值守安装服务<a id="cobbler"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@localhost ~]# systemctl <span class="hljs-built_in">disable</span> firewalld.service  <br>[root@localhost ~]# setenforce 0 <br></code></pre></td></tr></table></figure><h4 id="安装配置cobbler">4.2 安装配置Cobbler</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum -y instal epel-release   <br>[root@xy ~]# yum install cobbler cobbler-web pykickstart debmirror  <br>[root@xy ~]# systemctl restart httpd  <span class="hljs-comment"># 共享镜像 </span><br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> httpd  <br>[root@xy ~]# systemctl restart cobblerd  <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> cobblerd <br>[root@xy ~]# netstat -antp | grep 25151  <br>[root@xy ~]# vim /etc/cobbler/settings <br>  server: 10.10.10.11  <span class="hljs-comment"># 指定TFTP服务器地址  </span><br>  next_server: 10.10.10.11    <span class="hljs-comment"># 指定Cobbler服务器地址   </span><br>  manage_dhcp: 1    <span class="hljs-comment"># 把对dhcp管理服务开启  </span><br>[root@xy ~]# cobbler get-loaders <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> rsyncd  <br>[root@xy ~]# systemctl restart rsyncd  <br>[root@xy ~]# vim /etc/debmirror.conf  <span class="hljs-comment"># 安装操作系统类型  </span><br>  @dists=<span class="hljs-string">&quot;sid&quot;</span>;  <span class="hljs-comment"># 注释</span><br>  <span class="hljs-comment">#@arches=&quot;i386&quot;;  # 注释  </span><br>[root@xy ~]# openssl passwd -l -salt $(openssl rand -hex 4)  <span class="hljs-comment"># 生成加密字符串  </span><br>[root@xy ~]# vim /etc/cobbler/settings  <br>  default_passsword_cryptes:<span class="hljs-string">&quot;加密字符串&quot;</span>   <br>[root@xy ~]# yum install cman fence-agents  <br></code></pre></td></tr></table></figure><h4 id="配置tftp服务">4.3配置tftp服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@localhost ~]# yum install xinetd  <br>[root@xy ~]# vim /etc/xinetd.d/tftp  <span class="hljs-comment"># tftp基于xinetd服务  </span><br>  disabled=no <span class="hljs-comment"># 开启tftp服务  </span><br>[root@xy ~]# systemctl start xinetd  <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> xinetd    <br>[root@xy ~]# systemctl restart tftp<br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> tftp<br>[root@xy ~]# systemctl restart cobblerd         <br>[root@xy ~]# cobbler <span class="hljs-built_in">sync</span><span class="hljs-comment"># 同步配置文件   </span><br>[root@xy ~]# cobbler check     <br></code></pre></td></tr></table></figure><h4 id="配置dhcp服务">4.4配置DHCP服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install dhcp    <br>[root@xy ~]# vim /etc/dhcp/dhcpd.conf  <br>  option domain-name <span class="hljs-string">&quot;chinasoft.com&quot;</span>;      <span class="hljs-comment"># 域</span><br>  option domain-name-servers 114.114.114.114,8.8.8.8;<br>  default-lease-time  43200; <br>  max-server  86400;  <br>  log-facility <span class="hljs-built_in">local</span> 7;<br>    subnet 10.10.10.0 netmask 255.255.255.0 &#123;     <span class="hljs-comment"># 填写网段 </span><br>  range dynamic-bootp 10.10.10.100 10.10.10.200;  <span class="hljs-comment"># 地址池</span><br>  option routers10.10.10.11           <span class="hljs-comment"># 网关</span><br>        option subnet-mask  255.255.255.0         <span class="hljs-comment"># 掩码</span><br>  option domain-name-servers 10.10.10.2;          <span class="hljs-comment">#修改DNS</span><br>    &#125;<br>  next-server 10.10.10.11;                        <span class="hljs-comment"># tftp server 的 IP</span><br>    filename<span class="hljs-string">&quot;pxelinux.0&quot;</span>;       <span class="hljs-comment"># 客户机获取IP 主动获取引导驱动文件</span><br>[root@xy ~]# systemctl restart dhcpd  <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> dhcpd  <br>[root@xy ~]# systemctl restart cobblerd    <br>[root@localhost ~]# cobbler <span class="hljs-built_in">sync</span>  <span class="hljs-comment"># 同步生成DHCP配置文件</span><br></code></pre></td></tr></table></figure><h4 id="导入镜像">4.5导入镜像</h4><img src="/posts/c7601bf8/kickstart.png" class="" title="[kickstart]"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">mkdir</span> /mnt/cdrom/ &amp;&amp; mount -t iso9660 /dev/cdrom /mnt/cdrom   <br>[root@localhost ~]# cobbler import --path=/mnt/cdrom --name=<span class="hljs-string">&quot;CentOS7.6&quot;</span>  <br>[root@localhost ~]# cobbler import --path=/mnt/cdrom --name=<span class="hljs-string">&quot;CentOS6.8&quot;</span>    <br>  10.10.10.11/cobbler  <br>  /var/www/cobbler/ks_mirror/CentOS-7-x86_64    <span class="hljs-comment"># 导入的镜像文件存放的位置  </span><br>  /var/lib/cobbler/kickstarts                   <span class="hljs-comment"># 应答文件存放位置  </span><br><br>[root@xy ~]# cobbler distro list                <span class="hljs-comment"># cobbler profile list  </span><br>  centos7.6-x86_64  <br>  centos6.8-x86_64  <br>[root@xy ~]# cobbler profile remove --name=centos7.6-x86_64  <span class="hljs-comment"># 删除自带应答文件 </span><br>[root@xy ~]# <span class="hljs-built_in">mv</span> centos7-x86_64.cfg centos6-x86_64.cfg /var/lib/cobbler/kickstarts   <br>  <span class="hljs-comment">#Use NFS installation Media  </span><br>  url --url=<span class="hljs-string">&quot;image link&quot;</span>  <br>  <span class="hljs-comment">#Root password  </span><br>  rootpw --iscrypted <span class="hljs-variable">$default_password_crypted</span>    <br>[root@xy ~]# cobbler profile add --name=centos6.5-x86_67-basic --distro=centos6.5-x86_64 --kickstart=/var/lib/cobbler/kickstart/centos6.5-x86_64.cfg  <span class="hljs-comment"># 匹配  </span><br>[root@xy ~]# cobbler profile list<br>  centos6.8-basic  <br>  centos7.6-basic   <br>[root@xy ~]# cobbler <span class="hljs-built_in">sync</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops, linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Devops</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux服务配置01</title>
    <link href="/posts/296e7ad4.html"/>
    <url>/posts/296e7ad4.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-11-Linux服务配置01 <span id="more"></span></p><h2 id="目录">目录 <a id="back"></a></h2><ul><li><a href="#fdisk" target="_self">分区/格式化/挂载/卸载</a></li><li><a href="#uquota" target="_self">磁盘容量配额技术 uquota</a></li><li><a href="#raid" target="_self">RAID 磁盘阵列</a></li><li><a href="#lvm" target="_self">LVM 逻辑卷管理</a></li><li><a href="#iptables" target="_self">iptables 参数 规则链动作</a></li><li><a href="#firewalld" target="_self">firewall-cmd 防火墙</a></li><li><a href="#ssh" target="_self">SSH 服务</a></li><li><a href="#scp" target="_self">scp 远程传输</a></li><li><a href="#apache" target="_self">apache 服务</a></li></ul><h3 id="一切从-开始">1. 一切从 / 开始</h3><img src="/posts/296e7ad4/jiegou.jpg" class="" title="[文件系统与目录结构]"><table><thead><tr><th>类别</th><th>说明</th></tr></thead><tbody><tr><td>/boot</td><td>开机所需文件——内核、开机菜单以及所需配置文件</td></tr><tr><td>/dev</td><td>以文件形式存放任何设备及接口</td></tr><tr><td>/etc</td><td>配置文件</td></tr><tr><td>/home</td><td>用户家目录</td></tr><tr><td>/bin</td><td>存放单用户模式下还可以操作的命令</td></tr><tr><td>/lib</td><td>开机时用到的函数库</td></tr><tr><td>/sbin</td><td>开机过程中用到的命令</td></tr><tr><td>/media</td><td>挂载设备文件的目录</td></tr><tr><td>/opt</td><td>第三方软件</td></tr><tr><td>/root</td><td>系统管理员家目录</td></tr><tr><td>/srv</td><td>网络服务的数据文件目录</td></tr><tr><td>/tmp</td><td>任何人均可使用的“共享”临时目录</td></tr><tr><td>/proc</td><td>虚拟文件系统</td></tr><tr><td>/usr/local</td><td>用户自行安装的软件</td></tr><tr><td>/usr/sbin</td><td>开机不会使用的软件及脚本</td></tr><tr><td>/usr/share</td><td>帮助与说明文件</td></tr><tr><td>/var</td><td>经常变化文件,日志</td></tr><tr><td>/lost+found</td><td>当文件系统发生错误，存放丢失的文件片段</td></tr></tbody></table><h3 id="路径">2. 路径</h3><p>绝对路径：从根目录(/)开始写起的文件或目录<br />相对路径：相对于当前路径的写法 <code>./  ../  ~</code></p><h3 id="物理设备的命名规则">3. 物理设备的命名规则</h3><table><thead><tr><th>类别</th><th>说明</th></tr></thead><tbody><tr><td>IDE</td><td>/dev/hd[a-d]</td></tr><tr><td>SCSI/SATA/U盘</td><td>/dev/sd[a-p]</td></tr><tr><td>软驱</td><td>/dev/fd[0-1]</td></tr><tr><td>打印机</td><td>/dev/lp[0-15]</td></tr><tr><td>光驱</td><td>/dev/cdrom</td></tr><tr><td>鼠标</td><td>/dev/mouse</td></tr><tr><td>磁带机</td><td>/dev/st0 /dev/ht0</td></tr></tbody></table><ul><li><strong>主分区/扩展分区编号从1开始，到4结束　逻辑分区从编号5开始</strong><br />硬盘设备是由大量扇区组成的，<strong>每个扇区的容量为512字节</strong>，第一个扇区最重要，保存了<strong>主引导记录与分区表信息MBR</strong>，主引导记录用446B，分区表用64B，结束符用2B；分区表记录一个<strong>分区信息需要16B</strong>，最多只有4个分区信息可以写到第一个扇区中，这四个分区就是4个主分区；</li><li>为了解决分区个数不够,可以将第一个扇区分区表中16B(原本写入主分区信息)的空间(称为扩展分区)拿出来指向另外一个分区表。<strong>扩展分区不是一个真正的分区</strong>,是一个占用16字节分区表空间的指针。所以,<strong>用户一般会选择3个主分区加1个扩展分区,在扩展分区中建立数个逻辑分区</strong>；</li></ul><h3 id="文件系统与数据资料">4. 文件系统与数据资料</h3><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>EXT3</td><td>日志文件系统</td></tr><tr><td>Ext4</td><td>Ext3改进版,RHEL6系统默认文件管理系统,支持存储容量高达1EB</td></tr><tr><td>XFS</td><td>高性能的日志文件系统,RHEL7默认文件管理系统,最大支持存储容量18EB</td></tr></tbody></table><h3 id="挂载硬件设备">5. 挂载硬件设备</h3><p><strong>注：</strong> mount -a会自动检查/etc/fstab文件有无疏漏的挂载设备，若有则自动进行挂载</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-t</td><td>指定文件的系统类型:iso9600</td></tr><tr><td>-o</td><td>描述设备或档案的挂载方式</td></tr><tr><td>—</td><td>loop:把文件当成硬盘分区挂载</td></tr><tr><td>—</td><td>ro:只读方式</td></tr><tr><td>—</td><td>rw:读写方式</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mount /dev/sdb2 /backup <span class="hljs-comment"># 挂载目录需要挂载前创建好，mount[设备文件 挂在目录]  </span><br>[root@xy ~]# vim /etc/fstab     <span class="hljs-comment"># 开机自动挂载sdb2    </span><br>  1  <span class="hljs-comment">#  </span><br>  2  <span class="hljs-comment"># /etc/fstab  </span><br>  3  <span class="hljs-comment"># Created by anaconda on Fri Jul  6 08:44:38 2018  </span><br>  4  <span class="hljs-comment">#  </span><br>  5  <span class="hljs-comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;  </span><br>  6  <span class="hljs-comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info  </span><br>  7  <span class="hljs-comment">#  </span><br>  8  /dev/mapper/rhel-root                      /         xfs       defaults        1 1  <br>  9  UUID=28d7b2f5-a322-4990-ab6c-5936d156fce7 /boot      xfs       defaults        1 2  <br>  10 /dev/mapper                              /rhel-swap  swap swap defaults        0 0  <br>  11 /dev/cdrom                              /media/cdrom iso9660   defaults        0 0  <br>  12 /dev/sdb2  /backupext4      defaults        0 0  <br></code></pre></td></tr></table></figure><h3 id="撤销挂载设备">6. 撤销挂载设备 <a id="fdisk"></a></h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@xy</span> ~]<span class="hljs-meta"># umount /dev/sdb2　# umount [设备文件/挂在目录]</span><br></code></pre></td></tr></table></figure><h3 id="分区-格式化-挂载">7. 分区-格式化-挂载:</h3><h4 id="fdisk">fdisk</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-m</td><td>查看全部可用参数</td></tr><tr><td>-n</td><td>添加新的分区，p主分区，e扩展分区</td></tr><tr><td>-d</td><td>删除某个分区信息</td></tr><tr><td>-q</td><td>不保存退出</td></tr><tr><td>-l</td><td>✔列出所以可用的分区类型</td></tr><tr><td>-t</td><td>✔改变某个分区的信息</td></tr><tr><td>-p</td><td>✔查看分区信息</td></tr><tr><td>-w</td><td>保存并退出</td></tr></tbody></table><h4 id="分区">7.1 分区：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# fdisk /dev/sdb  <span class="hljs-comment"># sd --&gt;SATA</span><br>  Welcome to fdisk (util-linux 2.23.2).  <br><br>  Changes will remain <span class="hljs-keyword">in</span> memory only, <span class="hljs-keyword">until</span> you decide to write them.  <br>  Be careful before using the write <span class="hljs-built_in">command</span>.  <br><br>  Device does not contain a recognized partition table  <br>  Building a new DOS disklabel with disk identifier 0x301a431a.  <br>   <br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): p <span class="hljs-comment">#查看分区信息  </span><br>  Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors  <br>  Units = sectors of 1 * 512 = 512 bytes  <br>  Sector size (logical/physical): 512 bytes / 512 bytes  <br>  I/O size (minimum/optimal): 512 bytes / 512 bytes  <br>  Disk label <span class="hljs-built_in">type</span>: dos  <br>  Disk identifier: 0x301a431a  <br>  <br>  Device Boot      Start         End      Blocks   Id  System  <br> <br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): n <span class="hljs-comment">#添加新的分区  </span><br>  Partition <span class="hljs-built_in">type</span>:  <br>      p   primary (0 primary, 0 extended, 4 free)  <br>      e   extended  <br>  <br>Select (default p): p   <br>Partition number (1-4, default 1): 1  <br>  First sector (2048-41943039, default 2048):   <br>  Using default value 2048  <br>  Last sector, +sectors or +size&#123;K,M,G&#125; (2048-41943039, default 41943039): +2G <span class="hljs-comment"># 创建2GB分区  </span><br>  Partition 1 of <span class="hljs-built_in">type</span> Linux and of size 2 GiB is <span class="hljs-built_in">set</span>  <br>  <br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): p 　<span class="hljs-comment"># 查看分区信息     </span><br>  Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors  <br>  Units = sectors of 1 * 512 = 512 bytes  <br>  Sector size (logical/physical): 512 bytes / 512 bytes  <br>  I/O size (minimum/optimal): 512 bytes / 512 bytes  <br>  Disk label <span class="hljs-built_in">type</span>: dos  <br>  Disk identifier: 0x301a431a  <br><br>  Device Boot      Start         End      Blocks   Id  System  <br>  /dev/sdb1            2048     4196351     2097152   83  Linux  <br>  <br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): w <span class="hljs-comment"># 保存分区信息并退出</span><br>  The partition table has been altered!  <br>  Calling ioctl() to re-read partition table.  <br>  Syncing disks.<br>   <br>[root@xy ~]# file /dev/sdb　<span class="hljs-comment"># file 查看 /dev/sdb1 文件属性  /dev/sdb1: cannot open (No such file or directory)</span><br>[root@xy ~]# partprobe　<span class="hljs-comment">#partprobe 同步分区信息到系统内核 </span><br>[root@xy ~]# file /dev/sdb1  <br>/dev/sdb1: block special  <br></code></pre></td></tr></table></figure><h4 id="格式化创建文件系统类型-mkfs.文件类型名称-devsdb1">7.2格式化(创建文件系统类型)： mkfs.文件类型名称 /dev/sdb1</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mkfs <span class="hljs-comment"># 分区完后用 mkfs 格式化  </span><br>    mkfs mkfs.cramfs  mkfs.ext3mkfs.fatmkfs.msdos  <br>    mkfs.xfsmkfs.btrfsmkfs.ext2mkfs.ext4mkfs.minix   <br>    mkfs.vfat   <br>[root@xy ~]# mkfs -t xfs /dev/sdb1 <br>  meta-data=/dev/sdb1  isize=256  agcount=4, agsize=131072 blks  <br>  =  sectsz=512  attr=2, projid32bit=1  <br>  =  crc=0  <br>  data  =bsize=4096   blocks=524288, imaxpct=25  <br>  =  sunit=0  swidth=0 blks  <br>  naming  =version 2  bsize=4096   ascii-ci=0 ftype=0  <br>  <span class="hljs-built_in">log</span>  =internal <span class="hljs-built_in">log</span>  bsize=4096   blocks=2560, version=2  <br>  =  sectsz=512   sunit=0 blks, lazy-count=1  <br>  realtime =none  extsz=4096   blocks=0, rtextents=0<br></code></pre></td></tr></table></figure><h4 id="挂载分区">7.3 挂载分区：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">mkdir</span> /newFS<br>[root@xy ~]# mount /dev/sdb1 /newFS/  <br>[root@xy ~]# <span class="hljs-built_in">df</span> -h 　 <span class="hljs-comment"># 查看挂载状态及设备 建议 df -Th 命令信息更全 </span><br>    Filesystem           Size  Used Avail Use% Mounted on  <br>    /dev/mapper/rhel-root   28G  3.0G   25G  11% /  <br>    devtmpfs               985M     0  985M   0% /dev  <br>    tmpfs                  994M  148K  994M   1% /dev/shm  <br>    tmpfs                  994M  8.8M  986M   1% /run  <br>    tmpfs                  994M     0  994M   0% /sys/fs/cgroup  <br>    /dev/sr0               3.5G  3.5G     0 100% /media/cdrom  <br>    /dev/sda1              497M  119M  379M  24% /boot  <br>    /dev/sdb1              2.0G   33M  2.0G   2% /newFS  <br>    <br>[root@xy ~]# <span class="hljs-built_in">cp</span> -rf /etc/* /newFS<br>[root@xy ~]# <span class="hljs-built_in">ls</span> /newFS<br>abrt hosts pulse  <br>adjtime host.allow purple  <br>........省略部分信息........  <br><br>[root@xy ~]# <span class="hljs-built_in">du</span> -sh /newFS/ 　 <span class="hljs-comment"># du -sh  查看空间占用情况  </span><br>33M /newFS/<br></code></pre></td></tr></table></figure><h3 id="添加交换分区swap">8. 添加交换分区swap</h3><blockquote><p>交换分区是把内存中暂时不用的数据临时存放到硬盘中,解决物理内存不足问题,交换分区一般为物理内存的1.5~2倍，mkswap 与 swapon</p></blockquote><h4 id="分区-1">8.1 分区：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# fdisk /dev/sdb 　 <span class="hljs-comment"># 分区  </span><br>Welcome to fdisk (util-linux 2.23.2).  <br><br>Changes will remain <span class="hljs-keyword">in</span> memory only, <span class="hljs-keyword">until</span> you decide to write them.  <br>Be careful before using the write <span class="hljs-built_in">command</span>.  <br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): n<br> Partition <span class="hljs-built_in">type</span>:<br>   p   primary (1 primary, 0 extended, 3 free)  <br>   e   extended  <br><br>Select (default p): p <br> Partition number (2-4, default 2): 2  <br>  First sector (4196352-41943039, default 4196352):   <br>  Using default value 4196352  <br>  Last sector, +sectors or +size&#123;K,M,G&#125; (4196352-41943039, default 41943039): +5G  <br>  Partition 2 of <span class="hljs-built_in">type</span> Linux and of size 5 GiB is <span class="hljs-built_in">set</span>  <br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): p  <br> Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors  <br>Units = sectors of 1 * 512 = 512 bytes  <br>Sector size (logical/physical): 512 bytes / 512 bytes  <br>I/O size (minimum/optimal): 512 bytes / 512 bytes  <br>Disk label <span class="hljs-built_in">type</span>: dos  <br>Disk identifier: 0x301a431a  <br><br> Device Boot      Start         End      Blocks   Id  System  <br>/dev/sdb1            2048     4196351     2097152   83  Linux  <br>/dev/sdb2         4196352    14682111     5242880   83  Linux  <br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): w  <br> The partition table has been altered!  <br><br> Calling ioctl() to re-read partition table.  <br><br> WARNING: Re-reading the partition table failed with error 16: Device or resource busy.  <br>The kernel still uses the old table. The new table will be used at  <br>the next reboot or after you run partprobe(8) or kpartx(8)  <br>Syncing disks.  <br></code></pre></td></tr></table></figure><h4 id="格式化">8.2 格式化：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mkswap /dev/sdb2  　<span class="hljs-comment"># 格式化 mkswap  </span><br>/dev/sdb2: No such file or directory  <br>[root@xy ~]# partprobe  <br>[root@xy ~]# partprobe  <br>[root@xy ~]# mkswap /dev/sdb2  <br>Setting up swapspace version 1, size = 5242876 KiB  <br>no label, UUID=ffe8494a-c2f5-4af4-becf-985b130d395c  <br>[root@xy ~]# free -m  <br>             total       used       free     shared    buffers     cached  <br>Mem:          1987       1137        850          9          1        279  <br>-/+ buffers/cache:        856       1131  <br>Swap:            0          0          0  <br></code></pre></td></tr></table></figure><h4 id="挂载分区-1">8.3 挂载分区：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# swapon /dev/sdb2    　<span class="hljs-comment"># 挂载使用  </span><br>[root@xy ~]# free -m  <br>             total       used       free     shared    buffers     cached  <br>Mem:          1987       1141        846          9          1        279  <br>-/+ buffers/cache:        860       1127  <br>Swap:         5119          0       5119  <br><br>[root@xy ~]# vim /etc/fstab 　<span class="hljs-comment"># 设置自动挂载      </span><br>  1  <span class="hljs-comment">#  </span><br>  2  <span class="hljs-comment"># /etc/fstab  </span><br>  3  <span class="hljs-comment"># Created by anaconda on Fri Jul  6 08:44:38 2018  </span><br>  4  <span class="hljs-comment">#  </span><br>  5  <span class="hljs-comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;  </span><br>  6  <span class="hljs-comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info  </span><br>  7  <span class="hljs-comment">#  </span><br>  /dev/mapper/rhel-root                  /         xfs       defaults        1 1    <br>  UUID=28d7b2f5-a322-4990-ab6c-5936d156fce7 /boot  xfs       defaults        1 2    <br>  /dev/mapper                          /rhel-swap  swap swap defaults        0 0  <br>  /dev/cdrom                          /media/cdrom iso9660   defaults        0 0    <br>  /dev/sdb1                          /newFS        xfs       defaults        0 0    <br>  /dev/sdb2                          swap          swap      defaults        0 0 <br></code></pre></td></tr></table></figure><h3 id="删除手动增加的交换分区swap">9. 删除手动增加的交换分区swap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# /sbin/swapoff /dev/sdb2  <br>[root@xy ~]# vim /etc/fstab   <br>/dev/sdb2    swap     swap     defaults       0 0 　<span class="hljs-comment"># 删除  </span><br>[root@xy ~]# swapon -s<br>Filename        Type      Size    Used  Priority  <br>/dev/dm-0       partition 2113532 0     -1  <br></code></pre></td></tr></table></figure><h3 id="磁盘容量配额技术">10. 磁盘容量配额技术 <a id="uquota"></a></h3><p><strong>配置/etc/fstab,使/boot目录支持uquota,磁盘容量配额技术</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">UUID=28d7b2f5-a322-4990-ab6c-5936d156fce7 /boot    xfs    defaults,uquota 1 2<br></code></pre></td></tr></table></figure> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# reboot  <br>[root@xy ~]# mount | grep boot<br>/dev/sda1 on /boot <span class="hljs-built_in">type</span> xfs (rw,relatime,seclablel,attr2,inode64,usrquota)  <br>[root@xy ~]# useradd tom   <br>[root@xy ~]# <span class="hljs-built_in">chmod</span> -Rf o+w /boot 　<span class="hljs-comment"># other write  </span><br>[root@xy ~]# xfs_quota -x -c <span class="hljs-string">&#x27;limit bsoft=3m bhard=6m isoft=3 ihard=6 tom&#x27;</span> /boot<br>[root@xy ~]# xfs_quota -x -c report /boot　<span class="hljs-comment"># xfs_quota -x -c</span><br>  User quota on /boot (/dev/sda1)  Blocks  <br>  User ID Used Soft Hard Warn/Grace  <br>  ----------- ----------------------------------------------  <br>  root 95084   0     0    00 [--------] <br>  tom  0       3072  6144 00 [--------] <br><br>[root@xy ~]# su - tom  <br>[tom@xy ~]$ <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/boot/tom bs=5M count=1  <br>  1+0 records <span class="hljs-keyword">in</span>  <br>  1+0 records out  <br>  5242880 bytes (5.2 MB) copied, 0.123996 s, 42.3 MB/s  <br><br>[tom@xy ~]$ <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/boot/tom bs=8M count=1<br>  <span class="hljs-built_in">dd</span>: error writing <span class="hljs-string">&#x27;/boot/tom&#x27;</span>: Disk quato exceeded 　 <span class="hljs-comment"># 限制  </span><br>  1+0 records <span class="hljs-keyword">in</span>  <br>  1+0 records out  <br>  6291456 bytes (6.3 MB) copied, 0.0201596s, 312MB/s  <br><br>[root@xy ~]# edquota -u tom　 <span class="hljs-comment"># edquota -u 按需修改配额    </span><br>  Disk quotas <span class="hljs-keyword">for</span> user tom (uid 1001):  <br>  Filesystem blocks   soft   hard   inodes   soft   hard  <br>  /dev/sda   6114     3072   8192   1        3      6  <br><br>[root@xy ~]# su - tom<br>[tom@xy ~]$ <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/boot/tom bs=8M count=1  <br>  1+0 records <span class="hljs-keyword">in</span>  <br>  1+0 records out  <br>  8388608 bytes (8.4 MB) copied, 0.0238044s, 313MB/s  <br>[tom@xy ~]$ <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/boot/tom bs=10M count=1  <br>  <span class="hljs-built_in">dd</span>: error writing <span class="hljs-string">&#x27;/boot/tom&#x27;</span>: Disk quato exceeded  <br>  1+0 records <span class="hljs-keyword">in</span>  <br>  1+0 records out  <br>  8388608 bytes (8.4 MB) copied, 0.0238044s, 313MB/s  <br></code></pre></td></tr></table></figure></p><h3 id="创建链接文件ln">11. 创建链接文件ln</h3><p>:link:<ahref="https://www.cnblogs.com/ricklz/p/9378755.html">cnblog参考</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy /]# <span class="hljs-built_in">ln</span> -s ../usr/share/zoneinfo/Asia/Shanghai /etc/localtime <span class="hljs-comment">#相对目录建立, 找相对于链接的根目录</span><br></code></pre></td></tr></table></figure><blockquote><p>硬链接与软链接的区别:<br />&gt; ln src dst &gt; 1、不能跨分区； &gt; 2、删除源文件不影响链接文件；&gt; 3、inode号不变，指向同一个文件； &gt; 4、链接数增加； &gt;##软链接： &gt; ln -s src dst &gt; 1、可以跨分区； &gt;2、删除源文件影响链接文件； &gt; 3、inode号不相同； &gt; 4、链接数不变；&gt; ln -s ../boot/grub2/grub.cfg /etc/grub2.cfg</p></blockquote><h3 id="raid与lvm磁盘阵列技术">12. RAID与LVM磁盘阵列技术<a id="raid"></a></h3><ul><li>RAID(fd)(Redundant Array of Independent Disks,独立冗余磁盘阵列)</li><li><strong>RAID0(Srtiping)</strong>:把多块物理硬件设备(至少2块)通过硬件或软件凡事串联在一起,组成一个大的卷组,提升了硬盘数据的吞吐量,但不具备数据备份和错误修复能力；<ul><li>性能提升：读写；</li><li>冗余(容错)能力：无；</li><li>空间利用率：ns(s–&gt; 一块盘利用率)</li><li>至少2块 <img src="/posts/296e7ad4/RAID0.png" class="" title="[RAID 0--条带]"></li></ul></li><li><strong>RAID1(Mirroring)</strong>:数据写到多块硬盘设备上,当某一块硬盘发生故障后,一般会立即以热交换方式来恢复数据的正常使用,但硬盘的使用率却下降了,只有33%左右✔<ul><li>性能提升：写下降，读提升；</li><li>冗余能力：有；</li><li>空间利用率：1/2</li><li>至少2块 <img src="/posts/296e7ad4/raid1.jpg" class="" title="[RAID 1--镜像]"></li></ul></li><li><strong>RAID5</strong>:将硬盘设备的数据奇偶校验信息保存到除自身外每一块硬盘设备上,当硬盘出现问题,通过奇偶校验信息来尝试重建损坏的数据✔<ul><li>性能提升：读写提升；</li><li>冗余能力：有；</li><li>空间利用率：(n-1)s/n</li><li>至少3块 <img src="/posts/296e7ad4/raid5.jpg" class="" title="[RAID 5--校验]"></li></ul></li><li><strong>RAID 10</strong>：RAID10=RAID 1 + RAID 0<ul><li>性能提升：读写提升；</li><li>冗余能力：有；</li><li>空间利用率：1/2</li><li>至少4块 <img src="/posts/296e7ad4/raid-10.png" class="" title="[RAID 10--综合]"></li></ul></li><li>mdadm 命令</li></ul><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-C</td><td>创建 ✔</td></tr><tr><td>-v</td><td>显示过程 ✔</td></tr><tr><td>-a</td><td>检测设备名称</td></tr><tr><td>-n</td><td>指定设备数量 ✔</td></tr><tr><td>-l</td><td>指定RAID级别</td></tr><tr><td>-D</td><td>查看详细信息 ✔</td></tr><tr><td>-f</td><td>模拟设备损坏</td></tr><tr><td>-Q</td><td>查看摘要信息</td></tr><tr><td>-r</td><td>移除设备</td></tr><tr><td>-S</td><td>停止RAID磁盘阵列</td></tr><tr><td>-x</td><td>备用盘</td></tr></tbody></table><h3 id="部署磁盘阵列raid-5也可以拿分区做实验">12.1 部署磁盘阵列RAID5(也可以拿分区做实验)</h3><h4 id="创建raid-5">1)创建RAID 5：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mdadm -Cv -a <span class="hljs-built_in">yes</span> /dev/md0 -n 3 -l 5 -x 1 /dev/sd&#123;c,d,e,f&#125;<br>  mdadm: layout defaults to left-symmetric  <br>  mdadm: layout defaults to left-symmetric  <br>  mdadm: chunk size defaults to 512K  <br>  mdadm: Defaulting to version 1.2 metadata  <br>  mdadm: array /dev/md0 started.<br></code></pre></td></tr></table></figure><h4 id="查看raid-5">2)查看RAID 5：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mdadm -D /dev/md0  <br>[root@xy ~]# watch -n <span class="hljs-string">&#x27;command&#x27;</span>  <span class="hljs-comment"># 周期性执行指定命令，并以全屏方式显示结果</span><br>  /dev/md0:  <br>  Version : 1.2  <br>  Creation Time : Fri May 8 09:20:35 2018  <br>  Raid Level : raid5  <br>  Array Size : 41909248 (39.97 GiB 42.92 GB)  <br>  Used Dev Size : 20954624 (19.98 GiB 21.46 GB)  <br>  Raid Devices : 3   <br>  Total Devices : 4  <br>  Persistence : Superblock is Persistence  <br>  Update Time : Fri May 8 09:22:22 2018  <br>  State : clean  <br>  Active Devices : 3  <br>  Working Devices : 4  <br>  Failed Devices : 0  <br>  Spare Devices : 1  <br>  Layout : left-symmetric  <br>  Chunk Size : 512K   <br>  Name : xy.com:0 (<span class="hljs-built_in">local</span> to host xy.com)  <br>  UUID : 111c244f:e080b0c1:3316b6f2:986fa663  <br>  Events : 18  <br>  Number Major Minor RaidDevice State  <br>       0   8    16       0      active <span class="hljs-built_in">sync</span> /dev/sdc  <br>       1   8    32       1      active <span class="hljs-built_in">sync</span> /dev/sdd  <br>       4   8    48       2      active <span class="hljs-built_in">sync</span> /dev/sde  <br>       3   8    64       -      spare       /dev/sdf <br></code></pre></td></tr></table></figure><h4 id="格式化raid-5">3)格式化RAID 5：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mkfs.ext4 /dev/md0<br>  mke2fs 1.42.9 (28-Dec-2013)  <br>  Filesystem label=  <br>  OS <span class="hljs-built_in">type</span>: Linux  <br>  Block size=4096 (<span class="hljs-built_in">log</span>=2)  <br>  Fragment size=4096 (<span class="hljs-built_in">log</span>=2)  <br>  Stride=128 blocks, Stripe width=256 blocks  <br>  2621440 inodes, 10477312 blocks  <br>  523865 blocks (5.00%) reserved <span class="hljs-keyword">for</span> the super user  <br>  First data block=0  <br>  Maximum filesystem blocks=2157969408  <br>  320 block <span class="hljs-built_in">groups</span>  <br>  32768 blocks per group, 32768 fragments per group  <br>  8192 inodes per group  <br>  Superblock backups stored on blocks:   <br>    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,   <br>    4096000, 7962624  <br><br>  Allocating group tables: <span class="hljs-keyword">done</span>                              <br>  Writing inode tables: <span class="hljs-keyword">done</span>                              <br>  Creating journal (32768 blocks): <span class="hljs-keyword">done</span>  <br>  Writing superblocks and filesystem accounting information: <span class="hljs-keyword">done</span> <br></code></pre></td></tr></table></figure><h4 id="挂载-raid-5">4)挂载 RAID 5</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/dev/md0 /RAID ext4 defaults 0 0&quot;</span> &gt;&gt; /etc/fstab  <br>[root@xy ~]# <span class="hljs-built_in">mkdir</span> /RAID <br>[root@xy ~]# mount -a<br>[root@xy ~]# mdadm /dev/md0 -f /dev/sdc  <br>  mdadm: <span class="hljs-built_in">set</span> /dev/sdc faulty <span class="hljs-keyword">in</span> /dev/md0  <br>[root@xy ~]# mdadm -D /dev/md0<br>  /dev/md0:  <br>  Version : 1.2  <br>  Creation Time : Fri May 8 09:20:35 2018  <br>  Raid Level : raid5  <br>  Array Size : 41909248 (39.97 GiB 42.92 GB)  <br>  Used Dev Size : 20954624 (19.98 GiB 21.46 GB)  <br>  Raid Devices : 3  <br>  Total Devices : 4  <br>  Persistence : Superblock is Persistence  <br>  Update Time : Fri May 8 09:23:51 2018  <br>  State : active, degraded, resering  <br>  Active Devices : 2  <br>  Working Devices :3  <br>  Failed Devices : 1  <br>  Spare Devices : 1  <br>  Layout : left-symmetric  <br>  Chunk Size : 512K  <br>  Rebuild Status : 0% complete  <br>  Name : xy.com:0 (<span class="hljs-built_in">local</span> to host xy.com)  <br>  UUID : 111c244f:e080b0c1:3316b6f2:986fa663  <br>  Events : 21  <br>  Number Major Minor RaidDevice Status  <br>       3   8    64       0      spare rebuilding /dev/sdf <br>       1   8    32       1      active <span class="hljs-built_in">sync</span>      /dev/sdd <br>       4   8    48       2      active <span class="hljs-built_in">sync</span>      /dev/sde <br>       0   8    16       -      faulty           /dev/sdc  <br></code></pre></td></tr></table></figure><h4 id="部署磁盘阵列raid-10">12.3 部署磁盘阵列RAID 10:</h4><h5 id="创建-raid-10">1) 创建 RAID 10:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mdadm -Cv /dev/md0 -a <span class="hljs-built_in">yes</span> -n 4 -l 10 /dev/sd&#123;c,d,e,f&#125;     <br>  mdadm: layout defaults to n2  <br>  mdadm: layout defaults to n2  <br>  mdadm: chunk size defaults to 512K  <br>  mdadm: size <span class="hljs-built_in">set</span> to 20954624K  <br>  mdadm: Defaulting to version 1.2 metadata  <br>  mdadm: array /dev/md0 started. <br></code></pre></td></tr></table></figure><h5 id="格式化-raid-10">2) 格式化 RAID 10:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mkfs.ext4 /dev/md0　<span class="hljs-comment"># 格式化 ext4  </span><br>  mke2fs 1.42.9 (28-Dec-2013)  <br>  Filesystem label=  <br>  OS <span class="hljs-built_in">type</span>: Linux  <br>  Block size=4096 (<span class="hljs-built_in">log</span>=2)  <br>  Fragment size=4096 (<span class="hljs-built_in">log</span>=2)  <br>  Stride=128 blocks, Stripe width=256 blocks  <br>  2621440 inodes, 10477312 blocks  <br>  523865 blocks (5.00%) reserved <span class="hljs-keyword">for</span> the super user  <br>  First data block=0  <br>  Maximum filesystem blocks=2157969408  <br>  320 block <span class="hljs-built_in">groups</span>  <br>  32768 blocks per group, 32768 fragments per group  <br>  8192 inodes per group  <br>  Superblock backups stored on blocks:   <br>  32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,  <br>  4096000, 7962624  <br><br>  Allocating group tables: <span class="hljs-keyword">done</span>                           <br>  Writing inode tables: <span class="hljs-keyword">done</span>                             <br>  Creating journal (32768 blocks): <span class="hljs-keyword">done</span>  <br>  Writing superblocks and filesystem accounting information: <span class="hljs-keyword">done</span>   <br></code></pre></td></tr></table></figure><h5 id="挂载-raid-10">3) 挂载 RAID 10:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">mkdir</span> /RAID 　<span class="hljs-comment"># 挂载 /dev/md0</span><br>[root@xy ~]# mount /dev/md0 /RAID/<br>[root@xy ~]# <span class="hljs-built_in">df</span> -h  <br>  Filesystem             Size  Used Avail Use% Mounted on  <br>  /dev/mapper/rhel-root   28G  3.0G   25G  11% /  <br>  devtmpfs               985M     0  985M   0% /dev  <br>  tmpfs                  994M  148K  994M   1% /dev/shm  <br>  tmpfs                  994M  8.8M  986M   1% /run  <br>  tmpfs                  994M     0  994M   0% /sys/fs/cgroup  <br>  /dev/sdb1              2.0G   33M  2.0G   2% /newFS  <br>  /dev/sr0               3.5G  3.5G     0 100% /media/cdrom  <br>  /dev/sda1              497M  119M  379M  24% /boot  <br>  /dev/md0                40G   49M   38G   1% /RAID  <br></code></pre></td></tr></table></figure><h5 id="查看-raid-10-信息">4) 查看 RAID 10 信息:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mdadm -D /dev/md0 　<span class="hljs-comment"># 查看 /dev/md0 磁盘阵列详细信息</span><br>  /dev/md0:  <br>        Version : 1.2  <br>  Creation Time : Mon Jul  9 20:07:08 2018  <br>     Raid Level : raid10  <br>     Array Size : 41909248 (39.97 GiB 42.92 GB)  <br>  Used Dev Size : 20954624 (19.98 GiB 21.46 GB)  <br>   Raid Devices : 4  <br>  Total Devices : 4  <br>    Persistence : Superblock is persistent  <br>    <br>    Update Time : Mon Jul  9 20:10:35 2018  <br>          State : active, resyncing   <br>  Active Devices : 4  <br>  Working Devices : 4  <br>  Failed Devices : 0  <br>  Spare Devices : 0  <br><br>         Layout : near=2  <br>     Chunk Size : 512K  <br><br>  Resync Status : 96% complete  <br><br>           Name : xy.com:0  (<span class="hljs-built_in">local</span> to host xy.com)  <br>           UUID : 111c244f:e080b0c1:3316b6f2:986fa663  <br>         Events : 16  <br><br>    Number   Major   Minor   RaidDevice State  <br>       0       8       32        0      active <span class="hljs-built_in">sync</span>   /dev/sdc  <br>       1       8       48        1      active <span class="hljs-built_in">sync</span>   /dev/sdd  <br>       2       8       64        2      active <span class="hljs-built_in">sync</span>   /dev/sde  <br>       3       8       80        3      active <span class="hljs-built_in">sync</span>   /dev/sdf  <br></code></pre></td></tr></table></figure><h4 id="模拟损坏磁盘阵列及修复">12.2 模拟损坏磁盘阵列及修复：</h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs gams">[root@xy ~]# mdadm /dev/md0 -f /dev/sdc　# -f 模拟设备损坏 <br>  mdadm: <span class="hljs-keyword">set</span> /dev/sdc <span class="hljs-comment">faulty in</span> /dev/<span class="hljs-comment">md0</span>   <br>[root@xy ~<span class="hljs-comment">]# mdadm -D</span> /dev/<span class="hljs-comment">md0</span><br>  /dev/md0:  <br>          Version <span class="hljs-comment">: 1.2</span>  <br>    Creation <span class="hljs-comment">Time : Mon Jul  9 20:07:08 2018</span>  <br>       Raid <span class="hljs-comment">Level : raid10</span>  <br>       Array <span class="hljs-comment">Size : 41909248 (39.97 GiB 42.92 GB)</span>  <br>    Used <span class="hljs-comment">Dev Size : 20954624 (19.98 GiB 21.46 GB)</span>  <br>     Raid <span class="hljs-comment">Devices : 4</span>  <br>    Total <span class="hljs-comment">Devices : 4</span>  <br>      Persistence <span class="hljs-comment">: Superblock is persistent</span>  <br><br>      Update <span class="hljs-comment">Time : Mon Jul  9 20:23:34 2018</span>  <br>            State <span class="hljs-comment">: clean, degraded</span>   <br>   Active <span class="hljs-comment">Devices : 3</span>  <br>  Working <span class="hljs-comment">Devices : 3</span>  <br>   Failed <span class="hljs-comment">Devices : 1</span>  <br>    Spare <span class="hljs-comment">Devices : 0</span>  <br><br>           Layout <span class="hljs-comment">: near=2</span>  <br>       Chunk <span class="hljs-comment">Size : 512K</span>  <br><br>             Name <span class="hljs-comment">: xy.com:0  (local to host xy.com)</span>  <br>             UUID <span class="hljs-comment">: 111c244f:e080b0c1:3316b6f2:986fa663</span>  <br>           Events <span class="hljs-comment">: 21</span>  <br><br>      Number   <span class="hljs-comment">Major   Minor   RaidDevice State</span> <br>         0       0        0        0      removed  <br>         1       8       48        1      active <span class="hljs-comment">sync</span>   /dev/<span class="hljs-comment">sdd</span>  <br>         2       8       64        2      active <span class="hljs-comment">sync</span>   /dev/<span class="hljs-comment">sde</span>  <br>         3       8       80        3      active <span class="hljs-comment">sync</span>   /dev/<span class="hljs-comment">sdf</span>  <br><br>         0       8       32        -      faulty   /dev/<span class="hljs-comment">sdc</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# reboot  <br>[root@xy ~]# umount /dev/RAID<br>[root@xy ~]# mdadm /dev/md0 -a /dev/sdc<br>  mdadm: added /dev/sdc  <br>[root@xy ~]# mdadm -D /dev/md0<br><br>  /dev/md0:  <br>          Version : 1.2  <br>    Creation Time : Mon Jul  9 20:07:08 2018  <br>       Raid Level : raid10  <br>       Array Size : 41909248 (39.97 GiB 42.92 GB)  <br>    Used Dev Size : 20954624 (19.98 GiB 21.46 GB)  <br>     Raid Devices : 4  <br>    Total Devices : 4  <br>      Persistence : Superblock is persistent  <br><br>      Update Time : Mon Jul  9 21:04:28 2018 <br>            State : clean, degraded, recovering   <br>   Active Devices : 3  <br>  Working Devices : 4  <br>   Failed Devices : 0  <br>    Spare Devices : 1  <br><br>           Layout : near=2  <br>       Chunk Size : 512K  <br><br>   Rebuild Status : 19% complete  <br>   <br>             Name : xy.com:0  (<span class="hljs-built_in">local</span> to host xy.com)  <br>             UUID : 111c244f:e080b0c1:3316b6f2:986fa663  <br>           Events : 32 <br><br>      Number   Major   Minor   RaidDevice State  <br>         4       8       32        0      spare rebuilding   /dev/sdc  <br>         1       8       48        1      active <span class="hljs-built_in">sync</span>   /dev/sdd  <br>         2       8       64        2      active <span class="hljs-built_in">sync</span>   /dev/sde  <br>         3       8       80        3      active <span class="hljs-built_in">sync</span>   /dev/sdf  <br></code></pre></td></tr></table></figure><h3 id="lvm8e-logical-volume-manager逻辑卷管理器">13. LVM(8e) (LogicalVolume Manager，逻辑卷管理器) <a id="lvm"></a></h3><blockquote><p>在硬盘分区和文件系统之间添加了一个逻辑层,提供了一个抽象的卷组，可以把多块硬盘进行卷合并实现对硬盘分区的<strong>动态调整</strong></p></blockquote><ul><li>物理卷(PV) 就是真正的<strong>物理硬盘或者分区</strong>；<br /></li><li>卷组(VG)将多个物理卷合起来组成卷组，组成同一个卷组的物理卷可以是同一个硬盘的不同分区，也可以是不同硬盘的不同分区，<strong>抽象为一个逻辑硬盘</strong>；<br /></li><li>逻辑卷(LV)卷组是一个逻辑硬盘，硬盘分区后才可以使用，类似的，从卷组出来的分区为逻辑卷，<strong>可以抽象为分区</strong></li></ul><img src="/posts/296e7ad4/%E9%80%BB%E8%BE%91%E5%8D%B7.png" class="" title="[LVM图示]"><h4 id="常用lvm部署命令">13.1 常用LVM部署命令</h4><table><thead><tr><th>项目</th><th>PV</th><th>VG</th><th>LV</th></tr></thead><tbody><tr><td>扫描</td><td>pvscan</td><td>vgscan</td><td>lvscan</td></tr><tr><td>建立</td><td>pvcreate</td><td>vgcreate</td><td>lvcreate</td></tr><tr><td>显示</td><td>pvs/pvdisplay</td><td>vgs/vgdisplay</td><td>lvs/lvdisplay</td></tr><tr><td>移除</td><td>pvremove</td><td>vgremove</td><td>lvremove</td></tr><tr><td>扩展</td><td>vgextend</td><td>vgextend</td><td>lvextend</td></tr><tr><td>缩小</td><td>vgreduce</td><td>vgreduce</td><td>lvreduce</td></tr></tbody></table><h4 id="创建lvm-pv---vg---lv---mkfs.ext4-devstoragevo---monut">13.2创建LVM: PV -&gt; VG -&gt; LV -&gt; mkfs.ext4 /dev/storage/vo -&gt;monut</h4><h5 id="pvcrate-创建物理卷">1) pvcrate 创建物理卷：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# pvcreate /dev/sd&#123;c,d&#125;<br>  Physical volume <span class="hljs-string">&quot;/dev/sdc&quot;</span> successfully created  <br>  Physical volume <span class="hljs-string">&quot;/dev/sdd&quot;</span> successfully created<br></code></pre></td></tr></table></figure><h5 id="vgcrate-创建卷组管理">2) vgcrate 创建卷组管理：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vgcreate storage /dev/sd&#123;c,d&#125;  <span class="hljs-comment"># 添加到storage卷组中 </span><br>  Volume group <span class="hljs-string">&quot;storage&quot;</span> successfully created<br></code></pre></td></tr></table></figure><h5 id="vgdisplay-显示卷组管理">3) vgdisplay 显示卷组管理：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vgdisplay storage<br>  --- Volume group ---  <br>  VG Name               storage  <br>  System ID               <br>  Format                lvm2  <br>  Metadata Areas        2  <br>  Metadata Sequence No  1  <br>  VG Access             <span class="hljs-built_in">read</span>/write  <br>  VG Status             resizable  <br>  MAX LV                0  <br>  Cur LV                0  <br>  Open LV               0  <br>  Max PV                0  <br>  Cur PV                2  <br>  Act PV                2  <br>  VG Size               39.99 GiB  <br>  PE Size               4.00 MiB  <span class="hljs-comment"># -s 8M 指定PE大小  </span><br>  Total PE              10238  <br>  Alloc PE / Size       0 / 0    <br>  Free  PE / Size       10238 / 39.99 GiB  <br>  VG UUID               pjR9cJ-VoyM-TZsz-NdMb-s05a-0VQZ-wHhEBo <br></code></pre></td></tr></table></figure><h5 id="lvcrate-创建逻辑卷">4) lvcrate 创建逻辑卷：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# lvcreate -l 37 -n vo storage　<span class="hljs-comment"># 从卷组里边 创建逻辑卷 lvcreate  </span><br>  Logical volume <span class="hljs-string">&quot;vo&quot;</span> created   <br>  -L 以容量为单位(-L 15G)  <br>  -l 以PE（4MB）为单位<br></code></pre></td></tr></table></figure><h5 id="lvdisplay-显示逻辑卷">5) lvdisplay 显示逻辑卷：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# lvdisplay <br>  --- Logical volume ---  <br>  LV Path                /dev/storage/vo  <br>  LV Name                vo  <br>  VG Name                storage  <br>  LV UUID                bDRxSW-f9X3-KkjE-UPJL-wsrj-2zXm-pCNpcq  <br>  LV Write Access        <span class="hljs-built_in">read</span>/write  <br>  LV Creation host, <span class="hljs-keyword">time</span> xy.com, 2018-07-10 10:03:43 +0800  <br>  LV Status              available  <br>  open                 0  <br>  LV Size                148.00 MiB  <br>  Current LE             37  <br>  Segments               1  <br>  Allocation             inherit  <br>  Read ahead sectors     auto  <br>  currently <span class="hljs-built_in">set</span> to     8192  <br>  Block device           253:2  <br></code></pre></td></tr></table></figure><h5 id="格式化逻辑卷">6) 格式化逻辑卷：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# mkfs.ext4 /dev/storage/vo<br>[root@xy ~]# mke2fs -j /dev/storage/vo<br></code></pre></td></tr></table></figure><h5 id="挂载使用逻辑卷">7) 挂载使用逻辑卷：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">mkdir</span> /LVM <br>[root@xy ~]# mount /dev/storage/vo /LVM/<br>[root@xy ~]# vim /etc/fstab  <br>  /dev/storage/vo              /LVM         ext4          defaults   0 0<br></code></pre></td></tr></table></figure><h5 id="扩容">8) 扩容</h5><p><strong>外加磁盘</strong> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# fdisk t 8e<br>[root@xy ~]# mkfs.ext4 /dev/sdb1  <span class="hljs-comment"># 不用分区也可以</span><br>---<br>[root@xy ~]# pvcreate /dev/sdb1<br>[root@xy ~]# vgextend VolGroup /dev/sdb1<br>[root@xy ~]# lvextend -L +20G /dev/volGroup/VolGroup-lv_root<br>[root@xy ~]# resize2fs /dev/volGroup/VolGroup-lv_root<br></code></pre></td></tr></table></figure></p><p><strong>把其它分区分给空间不足的</strong> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# umount /home   <span class="hljs-comment"># 25G</span><br>[root@xy ~]# e2fsck -f /dev/volGroup/VolGroup-lv_home<br>[root@xy ~]# resize2fs -p /dev/volGroup/VolGroup-lv_home 10G   <span class="hljs-comment"># xfs格式用xfs_growfs</span><br>---<br>[root@xy ~]# mount /home<br>[root@xy ~]# lvreduce -L -15G /dev/volGroup/VolGroup-lv_home<br>[root@xy ~]# lvextend -L +15G 或 lvextend -l +100%FREE /dev/volGroup/VolGroup-lv_root<br>[root@xy ~]# resize2fs -p /dev/volGroup/VolGroup-lv_root<br><br>[root@xy ~]# fuser -m -v /home<br>[root@xy ~]# <span class="hljs-built_in">kill</span> -9 PID<br><span class="hljs-comment"># 建议保留Free PE／SIZE 一点空间，不要全用上；</span><br></code></pre></td></tr></table></figure></p><h3id="逻辑卷快照类似于虚拟机快照-特点快照卷容量必须等同于逻辑卷容量-快照卷是一次性的-执行后会立即自动删除">14.逻辑卷快照:类似于虚拟机快照, 特点:快照卷容量必须等同于逻辑卷容量;快照卷是一次性的, 执行后会立即自动删除</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vgdisplay<br>  --- Volume group ---<br>  VG Name               storage  <br>  System ID             <br>  Format                lvm2 <br>  ...<br>  Total PE              10238<br>  Alloc PE / Size       37 / 148.00 MiB　<span class="hljs-comment"># PE 创建快照大小依据</span><br>  Free  PE / Size       10201 / 39.85 GiB<br>  VG UUID          6YZPns-qgdy-yEFx-hEZ3-bLwe-2eDd-PFEip8<br><br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Welcome to linux&quot;</span> &gt; /LVM/readme.txt <br>[root@xy ~]# lvcreate -L 148M -n SNAP -p r -s /dev/storage/vo 　<span class="hljs-comment"># -s创建快照卷  </span><br>  Logical volume <span class="hljs-string">&quot;SNAP&quot;</span> created<br><br>[root@xy ~]# lvdisplay <br><br>  --- Logical volume ---  <br>  LV Path                /dev/storage/vo  <br>  LV Name                vo  <br>  VG Name                storage  <br>  ...  <br>  LV snapshot status     <span class="hljs-built_in">source</span> of  SNAP [active]  <br>  LV Status              available  <br>  open                 1<br>  LV Size               148.00 MiB  <br>  ...<br>  currently <span class="hljs-built_in">set</span> to     8192  <br>  Block device           253:2  <br><br>  --- Logical volume ---  <br>  LV Path                /dev/storage/SNAP <br>  LV Name                SNAP  <br>  VG Name                storage  <br>  LV UUID                dERsif-hvjx-20JJ-1BLn-dPxb-aYtw-n1zetn  <br>  LV Write Access        <span class="hljs-built_in">read</span>/write  <br>  LV Creation host, <span class="hljs-keyword">time</span> xy.com, 2018-07-10 14:00:46 +0800  <br>  LV snapshot status     active destination <span class="hljs-keyword">for</span> vo  <br>  LV Status              available  <br>  open                 0  <br>  LV Size                148.00 MiB  <br>  ...<br>  Block device           253:3<br><br>[root@xy ~]# <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/LVM/files count=1 bs=100M<br>[root@xy ~]# mount -o /dev/storage/SNAP /mnt/SNAP  <span class="hljs-comment"># ext4  </span><br>[root@xy ~]# mount -o nouuid,ro /dev/storage/SNAP /mnt/SNAP  <span class="hljs-comment"># xfs  </span><br><br>[root@xy ~]# umount /LVM<br>[root@xy ~]# umount /mnt/SANP    <br>[root@xy ~]# lvconvert --merge /dev/storage/SNAP 　<span class="hljs-comment"># 快照还原  </span><br>   Merging of volume SNAP started.  <br>   vo: Merged: 33.5%  <br>   vo: Merged: 100.0%  <br>   Merge of snapshot into logical volume vo has finished.  <br>   Logical volume <span class="hljs-string">&quot;SNAP&quot;</span> successfully removed<br><br>[root@xy ~]# mount /dev/storage/vo /LVM/    <br>[root@xy ~]# <span class="hljs-built_in">ls</span> /LVM/  <br>  lost+found  readme.txt<br></code></pre></td></tr></table></figure><h3 id="删除逻辑卷-lv---vg---pv">15. 删除逻辑卷: LV -&gt; VG -&gt;PV</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">root@xy ~</span>]<span class="hljs-meta"># umount /LVM/</span><br>[<span class="hljs-meta">root@xy ~</span>]<span class="hljs-meta"># lvremove /dev/storage/vo　# lvremove</span><br>  Do you really want to <span class="hljs-keyword">remove</span> active  logical volume vo? [y/n]: y<br>  Logical volume <span class="hljs-string">&quot;vo&quot;</span> successfully<br>  removed<br>[<span class="hljs-meta">root@xy ~</span>]<span class="hljs-meta"># vgremove storage</span><br>  Volume <span class="hljs-keyword">group</span> <span class="hljs-string">&quot;storage&quot;</span> successfully removed<br>[<span class="hljs-meta">root@xy ~</span>]<span class="hljs-meta"># pvremove /dev/sdc /dev/sdd</span><br>  Labels <span class="hljs-keyword">on</span> physical volume <span class="hljs-string">&quot;/dev/sdc&quot;</span> successfully wiped  <br>  Labels <span class="hljs-keyword">on</span> physical volume <span class="hljs-string">&quot;/dev/sdd&quot;</span> successfully wiped<br></code></pre></td></tr></table></figure><h3 id="iptables-与-firewalld-防火墙四表五链">16. iptables 与 firewalld防火墙(四表五链)</h3><h4 id="iptables命令-参数-策略规则链-动作">16.1 iptables命令 参数 +策略规则链 + 动作 ：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">iptables  [-t 表名]  选项 [链名]  [条件]  [-j 控制类型]<br>1）默认filter表；<br>2）默认表内所有链； <br>3）选项、链名、控制类型使用大写字母，其余均为小写；<br></code></pre></td></tr></table></figure><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-P</td><td>设置默认策略 ✔</td></tr><tr><td>-F</td><td>清空规则链 ✔</td></tr><tr><td>-L</td><td>查看规则链 ✔</td></tr><tr><td>-A</td><td>在规则链的 末尾 添加新规则 ✔</td></tr><tr><td>-I num</td><td>在规则链的 头部 添加新规则 ✔</td></tr><tr><td>-D num</td><td>删除某一条规则 ✔ <code>iptables -t 表明 -D 链名 num</code></td></tr><tr><td>-s IP/MASK</td><td>匹配来源地址IP/MASK,加!表示除这个IP外</td></tr><tr><td>-d IP/MASK</td><td>匹配目标地址(多个IP用逗号隔开)</td></tr><tr><td>-i 网卡名称</td><td>匹配从这块网卡流入的数据(PREROUTING、INPUT、FORWARD)</td></tr><tr><td>-o 网卡名称</td><td>匹配从这块网卡流出的数据(FORWARD、OUTPUT、POSTROUTING)</td></tr><tr><td>-p Protocol</td><td>匹配协议,如:TCP/UDP/ICMP</td></tr><tr><td>–dport num</td><td>匹配目标端口号</td></tr><tr><td>–sport num</td><td>匹配来源端口号</td></tr><tr><td>-v</td><td>数据报文 字节数显示(信息更全)<code>iptables --line-number -vnL INPUT</code></td></tr><tr><td>-n</td><td>以数字形式显示IP地址、端口</td></tr><tr><td><code>--line-numbers</code></td><td>查看规则，显示序号 ✔</td></tr><tr><td>-N -E -X</td><td>自定义、重命名、删除自定义链</td></tr><tr><td>-m,–module</td><td>扩展模块</td></tr><tr><td>—</td><td>-m multiport –sport 用于匹配报文源端口,多个端口用逗号隔开</td></tr><tr><td>—</td><td>-m multiport –dport 用于匹配报文目的端口,多个端口用逗号隔开</td></tr><tr><td>—</td><td>-m iprange –src-range IP范围</td></tr><tr><td>—</td><td>-m iprange –dst-range IP范围</td></tr><tr><td>—</td><td>-m mac –macl-source MAC地址</td></tr><tr><td>—</td><td>-m tcp –sport 用于匹配tcp协议报文源端口,用冒号定义连续端口</td></tr><tr><td>—</td><td>-m tcp –dport 用于匹配tcp协议报文目的端口,用冒号定义连续端口</td></tr><tr><td>-m state –state</td><td>连接状态</td></tr><tr><td>—</td><td>NEW,ESTABLISHED,RELATED -j ACCEPT</td></tr></tbody></table><h4id="策略规则链iptables服务把用于处理或过滤流量的策略条目称为规则多条规则可组成一个规则链而规则链则依据数据包处理位置的不同进行分类具体如下">16.2策略规则链[iptables]服务把用于处理或过滤流量的策略条目称为规则,多条规则可组成一个规则链,而规则链则依据数据包处理位置的不同进行分类,具体如下：<a id="iptables"></a></h4><ul><li>报文路径:<ul><li>到本机某进程的报文（<code>PREROUTING --&gt; INPUT</code>）;</li><li>由本机转发的报文（<code>PREROUTING --&gt; FORWARD--&gt; POSTROUTING</code>）;</li><li>由本机的某进程发出报文，即响应报文（<code>OUTPUT --&gt; POSTROUTING</code>）;</li></ul></li></ul><table><thead><tr><th>四表(相同功能规则的集合)</th><th>说明</th></tr></thead><tbody><tr><td><code>raw表</code></td><td>关闭nat启用的连接追踪机制</td></tr><tr><td><code>mangle表</code></td><td>拆解报文，做出修改，重新封装功能</td></tr><tr><td><code>nat表</code></td><td>网络地址转换功能，内核模块</td></tr><tr><td><code>filter表</code></td><td>过滤功能，防火墙，内核模块</td></tr></tbody></table><hr /><table><thead><tr><th>五链(钩子)</th><th>说明</th></tr></thead><tbody><tr><td><code>PREROUTING链</code></td><td>在进行路由选择前处理数据包(raw&gt;mangle&gt;nat)</td></tr><tr><td><code>INPUT链</code></td><td>处理流入数据包</td></tr><tr><td><code>OUTPUT链</code></td><td>处理流出数据包</td></tr><tr><td><code>FORWARD链</code></td><td>处理转发数据包</td></tr><tr><td><code>POSTROUTING链</code></td><td>在进行路由选择后处理数据包</td></tr></tbody></table><p><strong>-L 查看规则链</strong> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -L  <span class="hljs-comment"># -L 查看规则链 Look  </span><br>  Chain INPUT (policy ACCEPT)  <br>  target     prot opt <span class="hljs-built_in">source</span>        destination           <br>  ACCEPT     all  --  anywhere      anywhere             ctstate RELATED,ESTABLISHED  <br>  ACCEPT     all  --  anywhere      anywhere              <br>  INPUT_direct  all  --  anywhere   anywhere                         <br>  ........省略部分输出信息........  <br>[root@xy ~]# iptables-save &gt; /home/User/iptables.bak         <span class="hljs-comment"># 备份</span><br>[root@xy ~]# iptables-restore &lt; /home/User/iptables.bak      <span class="hljs-comment"># 还原</span><br></code></pre></td></tr></table></figure></p><p><strong>-F 清空规则链</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -F 　<br>[root@xy ~]# iptables -L  <br>  Chain INPUT (policy ACCEPT)  <br>  target     prot opt <span class="hljs-built_in">source</span>               destination   <br><br>  Chain FORWARD (policy ACCEPT)  <br>  target     prot opt <span class="hljs-built_in">source</span>               destination   <br><br>  Chain OUTPUT (policy ACCEPT)  <br>  target     prot opt <span class="hljs-built_in">source</span>               destination   <br>  <br>  ........省略部分输出信息........  <br></code></pre></td></tr></table></figure></p><p><strong>iptables -P参数默认策略 INPUT规则链 DROP动作</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -P INPUT DROP<br>[root@xy ~]# iptables -L  <br>   Chain INPUT (policy DROP)    <br>   ........省略部分输出信息........  <br></code></pre></td></tr></table></figure></p><p><strong>iptables -I头部添加新规则 INPUT规则链 -p icmpACCEPT动作</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -I INPUT -p icmp -j ACCEPT<br></code></pre></td></tr></table></figure></p><p><strong>iptables -D删除某一条规则 INPUT规则链 序号</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -D INPUT 1<br></code></pre></td></tr></table></figure></p><p><strong>iptables -P默认策略 INPUT规则链 ACCEPT动作</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -P INPUT ACCEPT<br>[root@xy ~]# iptables -L<br>  Chain INPUT (policy ACCEPT)<br>  ........省略部分输出信息........<br></code></pre></td></tr></table></figure></p><h4 id="仅允许指定网段的主机访问本机的22端口-ssh">16.4仅允许指定网段的主机访问本机的22端口 SSH</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#iptables -I头部添加新规则 INPUT规则链 源IP -p tcp --dport 22 ACCEPT动作  </span><br>[root@xy ~]# iptables -I INPUT -s 192.168.37.0/24 -p tcp --dport 22 -j ACCEPT　　<br><br><span class="hljs-comment">#iptables -A尾部添加新规则 INPUT规则链 -p tcp --dport 22 REJECT动作</span><br>[root@xy ~]# iptables -A INPUT -p tcp --dport 22 -j REJECT<br>[root@xy ~]# iptables -L<br>  Chain INPUT (policy ACCEPT)  <br>  target     prot opt <span class="hljs-built_in">source</span>               destination           <br>  ACCEPT     tcp  --  192.168.37.0/24      anywhere             tcp dpt:ssh  <br>  REJECT     tcp  --  anywhere             anywhere             tcp dpt:ssh   <br>  reject-with icmp-port-unreachable  <br>  ........省略部分输出信息........   <br><br>[root@clientA ~]# ssh 192.168.37.10　<span class="hljs-comment"># 网段192.168.37.0/24 是可以的  </span><br>[root@clientA ~]# ssh 192.168.37.10　<span class="hljs-comment"># 网段192.168.20.0/24 XXXXXXXX</span><br>  Connecting to 192.168.37.10:22...<br>  Could not connect to <span class="hljs-string">&#x27;192.168.37.10&#x27;</span>(port 22): Connection failed  <br></code></pre></td></tr></table></figure><h4 id="input-规则链加入拒绝所有人访问本机12345端口的策略规则">16.5INPUT 规则链加入拒绝所有人访问本机12345端口的策略规则</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -I INPUT -p tcp --dport 12345 -j REJECT   <br>[root@xy ~]# iptables -I INPUT -p udp --dport 12345 -j REJECT  <br>[root@xy ~]# iptables -L<br>  Chain INPUT (policy ACCEPT)  <br>  target     prot opt <span class="hljs-built_in">source</span>               destination           <br>  REJECT     udp  --  anywhere             anywhere             udp dpt:italk   <br>  reject-with icmp-port-unreachable  <br>  REJECT     tcp  --  anywhere             anywhere             tcp dpt:italk   <br>  reject-with icmp-port-unreachable  <br>  ACCEPT     tcp  --  192.168.37.0/24      anywhere             tcp dpt:ssh  <br>  REJECT     tcp  --  anywhere             anywhere             tcp dpt:ssh   <br>  reject-with icmp-port-unreachable  <br>  ........省略部分输出信息........  <br></code></pre></td></tr></table></figure><h4 id="input-规则链加入拒绝所有人访问本机10001024端口的策略规则">16.6INPUT 规则链加入拒绝所有人访问本机1000:1024端口的策略规则</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -A INPUT -p tcp --dport 1000:1024 -j REJECT<br>[root@xy ~]# iptables -A INPUT -p udp --dport 1000:1024 -j REJECT<br>[root@xy ~]# iptables -L<br>  Chain INPUT (policy ACCEPT)  <br>  target     prot opt <span class="hljs-built_in">source</span>               destination           <br>  REJECT     udp  --  anywhere             anywhere             udp dpt:italk   <br>  reject-with icmp-port-unreachable  <br>  REJECT     tcp  --  anywhere             anywhere             tcp dpt:italk   <br>  reject-with icmp-port-unreachable  <br>  ACCEPT     tcp  --  192.168.37.0/24      anywhere             tcp dpt:ssh  <br>  REJECT     tcp  --  anywhere             anywhere             tcp dpt:ssh   <br>  ........省略部分输出信息........  <br></code></pre></td></tr></table></figure><h4 id="input-规则链加入拒绝192.168.37.5访问本机80端口的策略规则">16.7INPUT 规则链加入拒绝192.168.37.5访问本机80端口的策略规则</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -I INPUT -p tcp -s 192.168.37.5 --dport 80 -j REJECT<br>[root@xy ~]# iptables -L<br>  Chain INPUT (policy ACCEPT)  <br>  target     prot opt <span class="hljs-built_in">source</span>               destination           <br>  REJECT     tcp  --  192.168.37.5         anywhere             tcp dpt:http   <br>  reject-with icmp-port-unreachable<br>  ........省略部分输出信息........  <br>[root@xy ~]# service iptables save　 <span class="hljs-comment"># 永久生效</span><br>  iptables: Saving firewall rules to /etc/sysconfig/iptables:[  OK  ]<br></code></pre></td></tr></table></figure><h4 id="禁止源自192.168.10.024-网段的流量访问本机sshd服务">16.8禁止源自192.168.10.0/24 网段的流量访问本机sshd服务：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -I INPUT -s 192.168.10.0/24 -p tcp --dport 22 -j REJECT  <br>[root@xt ~]# service iptables save<br></code></pre></td></tr></table></figure><h4 id="snat-dnat">16.9 SNAT &amp;&amp; DNAT</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# modprobe ip_tables  <br>[root@xy ~]# modprobe<br>[root@xy ~]# vim /etc/sysctl.conf  <span class="hljs-comment"># /proc/sys/net/ipv4/ip_forward  </span><br>[root@xy ~]# net.ipv4.ip_forward  = 1 <br>[root@xy ~]# sysctl -p /etc/sysctl.conf  <br>[root@xy ~]# iptables -F<br><br><span class="hljs-comment">#网关服务器: eth0(192.168.1.1) eth1(218.29.30.31) </span><br><span class="hljs-comment">#局域网客户机(服务器): 192.168.1.6</span><br><span class="hljs-comment">#公网服务器(客户机): 58.63.236.45</span><br></code></pre></td></tr></table></figure><h4 id="snat-转换规则内网访问外网路由后交给snat">16.10 SNAT转换规则：内网访问外网(路由后交给SNAT)</h4><img src="/posts/296e7ad4/SNAT.png" class="" title="[SNAT转换]"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -t nat -A  POSTROUTING -s 192.168.1.0/24 -o eth1 -j SNAT --to-source 218.29.30.31     <br>[root@xy ~]# iptables -t nat -A  POSTROUTING -s 192.168.1.0/24 -o eth1 -j MASQUERADE  <br>[root@xy ~]# service iptables save<br>[root@xy ~]# vim /etc/sysconfig/iptables  <br>[root@xy~]# tcpdump -i eth0 -nn -X icmp<br></code></pre></td></tr></table></figure><h4 id="dnat-转换规则外网访问内网路由前交给dnat">16.11 DNAT转换规则：外网访问内网(路由前交给DNAT)</h4><img src="/posts/296e7ad4/DNAT.png" class="" title="[DNAT转换]"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -t nat -A  PREROUTING -d 218.29.30.31 -i eth1 -p tcp --dport 8080 -j DNAT --to-destination 192.168.1.6:80      <br>[root@xy ~]# service iptables save<br>[root@xy ~]# iptables-save &gt; 1.iptables<br>[root@xy ~]# iptables-restore &lt; 1.iptables<br></code></pre></td></tr></table></figure><h4 id="解决windows访问samba服务拒绝的方法">16.12解决Windows访问Samba服务拒绝的方法:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# iptables -L --line-number -n    <span class="hljs-comment"># 以带有序号形式查看规则</span><br><br>[root@xy ~]# iptables -t filter -I INPUT 7 -p udp -m multiport --dport 139,445 -j ACCEPT<br>[root@xy ~]# iptables -t filter -I INPUT 7 -p tcp -m multiport --dport 139,445 -m state --state NEW  -j ACCEPT<br></code></pre></td></tr></table></figure><h3id="firewallddynamic-firewall-manager-of-linux-systemlinux动态防火墙管理器">17firewalld(Dynamic Firewall Manager of Linuxsystem):Linux动态防火墙管理器 <a id="firewalld"></a></h3><p>管理方式:CLI(命令行界面) 与 GUI(图形用户界面)</p><h4 id="firewalld中常用的区域名及策略规则">17.1firewalld中常用的区域名及策略规则:</h4><table><thead><tr><th>区域</th><th>默认规则策略</th></tr></thead><tbody><tr><td>trusted</td><td>允许所有数据包</td></tr><tr><td>home</td><td>拒绝流入的流量,除非与流出的流量相关;而如果流量与ssh、mdns、ipp-client、amba-client与dhcpv6-client服务相关,则允许流量</td></tr><tr><td>internal</td><td>等同于home区域</td></tr><tr><td>public</td><td>拒绝流入的流量,除非与流出的流量相关;而如果流量与ssh、dhcpv6-client服务相关,则允许流量</td></tr><tr><td>external</td><td>拒绝流入的流量,除非与流出的流量相关;而如果流量与ssh服务相关,则允许流量</td></tr><tr><td>dmz</td><td>拒绝流入的流量,除非与流出的流量相关;而如果流量与ssh服务相关,则允许流量</td></tr><tr><td>block</td><td>拒绝流入的流量,除非与流出的流量相关</td></tr><tr><td>drop</td><td>拒绝流入的流量,除非与流出的流量相</td></tr></tbody></table><h4 id="firewall-cmd-命令">17.2 firewall-cmd 命令:</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>--get-default-zone</code></td><td>查询默认区域名称</td></tr><tr><td><code>--set-default-zone=&lt;区域名称&gt;</code></td><td>设置默认区域,使其永久生效</td></tr><tr><td><code>--get-zones</code></td><td>显示可用区域</td></tr><tr><td><code>--get-services</code></td><td>显示预先定义服务</td></tr><tr><td><code>--get-active-zones</code></td><td>显示当前正使用的区域与网卡名称</td></tr><tr><td><code>--add-source=</code></td><td>将源自此IP/子网流量导向某个指定区域</td></tr><tr><td><code>--remove-source=</code></td><td>不再将源自此IP/子网流量导向某个指定区域</td></tr><tr><td><code>--add-interface=&lt;网卡名称&gt;</code></td><td>将源自此网卡所有流量导向某个指定区域</td></tr><tr><td><code>--change-interface=&lt;网卡名称&gt;</code></td><td>将某个网卡与区域进行关联</td></tr><tr><td><code>--list-all</code></td><td>显示当前区域网卡配置参数/资源/端口/服务</td></tr><tr><td><code>--list-all-zones</code></td><td>显示所有区域网卡配置参数/资源/端口/服务</td></tr><tr><td><code>--add-service=&lt;服务名&gt;</code></td><td>设置默认区域允许该服务的流量</td></tr><tr><td><code>--add-port=&lt;端口号/协议&gt;</code></td><td>设置默认区域允许该端口的流量</td></tr><tr><td><code>--remove-service=&lt;服务名&gt;</code></td><td>设置默认区域不再允许该服务的流量</td></tr><tr><td><code>--remove-port=&lt;端口号/协议&gt;</code></td><td>设置默认区域不再允许该端口的流量</td></tr><tr><td><code>--reload</code></td><td>让永久生效的配置规则立即生效,覆盖当前配置规则</td></tr><tr><td><code>--panic-on</code></td><td>开启应急状况模式</td></tr><tr><td><code>--panic-off</code></td><td>关闭应急状况模式</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# firewall-cmd --get-default-zone  <br>  public  <br>[root@xy ~]# firewall-cmd --get-zone-of-interface=eno16777736  <br>  public  <br>[root@xy ~]# firewall-cmd --permanent --zone=external --change-interface=eno16777736    <br>  success　<span class="hljs-comment"># 重启后生效</span><br>[root@xy ~]# firewall-cmd --get-zone-of-interface=eno16777736<br>  external<br>[root@xy ~]# firewall-cmd --set-default-zone=public  <span class="hljs-comment"># firewall当前服务设置为public  </span><br>  success <br>[root@xy ~]# firewall-cmd --panic-on <span class="hljs-comment"># 启动/关闭防火墙应急状况模式,阻断一切网络连接  </span><br>  success  <br>[root@xy ~]# firewall-cmd --panic-off<br>  success  <br></code></pre></td></tr></table></figure><p><strong>查询public区域是否允许请求SSH和HTTPS协议流量</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# firewall-cmd --zone=public --query-service=ssh<br>  <span class="hljs-built_in">yes</span>  <br>[root@xy ~]# firewall-cmd --zone=public --query-service=https<br>  no   <br></code></pre></td></tr></table></figure><p><strong>firewalld服务中请求HTTPS协议流量设置永久允许,立即生效</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# firewall-cmd --zone=public --add-service=https<br>  success  <br>[root@xy ~]# firewall-cmd --permanent --zone=public --add-service=https<br>  success  <br>[root@xy ~]# firewall-cmd --reload  <span class="hljs-comment"># 更改设置立即生效 </span><br>  success  <br></code></pre></td></tr></table></figure></p><p><strong>firewalld服务中请求HTTP协议流量设置永久拒绝,立即生效</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# firewall-cmd --permanent --zone=public --remove-service=http <span class="hljs-comment"># permanent</span><br>  success  <br>[root@xy ~]# firewall-cmd --reload<br>  success  <br></code></pre></td></tr></table></figure></p><p><strong>firewalld　服务中访问80808081端口流量策略设置允许,仅当前生效</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# firewall-cmd --zone=public --add-port=8080-8081/tcp<br>  success  <br>[root@xy ~]# firewall-cmd --zone=public --list-ports 8080-8081/tcp  <br></code></pre></td></tr></table></figure></p><p><strong>流量转发 访问本机888端口的流量转发到22端口</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# firewall-cmd --permanent --zone=public     --add-forward-port=port=888:proto=tcp:toport=22:toaddr=192.168.37.10<br>[root@xy ~]# firewall-cmd --reload  <br>  success  <br></code></pre></td></tr></table></figure></p><p><strong>服务的ACL</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/hosts.deny<br>[root@xy ~]# vim /etc/host.allow<br></code></pre></td></tr></table></figure></p><h3 id="使用ssh服务管理远程主机">18. 使用SSH服务管理远程主机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# nmtui  <span class="hljs-comment"># GUI配置网络参数</span><br>[root@xy ~]# <span class="hljs-built_in">cd</span> /etc/sysconfig/network-scripts/<br>[root@xy network-scripts]# vim ifcfg-eno16777736  <br>[root@xy network-scripts]# systemctl restart network <br>[root@xy network-scripts]# ping -c 4 192.168.37.10 <br>  PING 192.168.37.10 (192.168.37.10) 56(84) bytes of data.  <br>  64 bytes from 192.168.37.10: icmp_seq=1 ttl=64 <span class="hljs-keyword">time</span>=31.3 ms  <br>  --- 192.168.37.10 ping statistics ---  <br>  4 packets transmitted, 4 received, 0% packet loss, <span class="hljs-keyword">time</span> 3005ms  <br>  rtt min/avg/max/mdev = 0.183/8.006/31.325/13.463 ms  <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy network-scripts]# nmcli connection show　 <span class="hljs-comment"># 管理Network Manager服务</span><br>  NAME         UUID                                  TYPE            DEVICE        <br>  eno16777736  e1fa8452-091b-429e-adce-ecea92a845c7  802-3-ethernet  eno16777736   <br>[root@xy network-scripts]# nmcli con show eno16777736    <br>  connection.id:                          eno16777736  <br>  connection.uuid:                        e1fa8452-091b-429e-adce-ecea92a845c7  <br>  connection.interface-name:  <br>  ........省略部分输出信息........  <br>[root@xy ~]# nmcli connection add con-name company ifname eno16777736<br>  autoconnect   <br>  no <span class="hljs-built_in">type</span> ethernet ip4 192.168.37.10/24 gw4 192.168.37.1  <br>  Connection <span class="hljs-string">&#x27;company&#x27;</span> (a8b3a029-5c7b-4ec7-b519-69f6862e616f) successfully added.<br>[root@xy ~]# nmcli connection add con-name house <span class="hljs-built_in">type</span> ethernet ifname eno16777736   <br>  Connection <span class="hljs-string">&#x27;house&#x27;</span> (00a825ae-b1c2-4130-a1f6-c693de73783c) successfully added.<br>[root@xy ~]# nmcli connection show<br>  NAME         UUID                                  TYPE            DEVICE        <br>  house        00a825ae-b1c2-4130-a1f6-c693de73783c  802-3-ethernet  --             <br>  company      a8b3a029-5c7b-4ec7-b519-69f6862e616f  802-3-ethernet  --             <br>  eno16777736  e1fa8452-091b-429e-adce-ecea92a845c7  802-3-ethernet  eno16777736  <br>[root@xy ~]# nmcli connection up house<br>  Connection successfully actived (D-Bus activ path: /org/freedesktop/NetworkManager/ActiveConnection/2)<br></code></pre></td></tr></table></figure><h3 id="绑定两块网卡">19. 绑定两块网卡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/sysconfig/network-scripts/ifcfg-eno16777736<br>  TYPE=Ethernet  <br>  BOOTPROTO=none  <br>  ONBOOT=<span class="hljs-built_in">yes</span>  <br>  USERCTL=no  <br>  DEVICE=eno16777736   <br>  MASTER=bond0  <br>  SLAVE=<span class="hljs-built_in">yes</span>  <br>[root@xy ~]# vim /etc/sysconfig/network-scripts/ifcfg-eno33554984      <br>  TYPE=Ethernet<br>  BOOTPROTO=none<br>  ONBOOT=<span class="hljs-built_in">yes</span><br>  USERCTL=no<br>  DEVICE=eno16777736<br>  MASTER=bond0<br>  SLAVE=<span class="hljs-built_in">yes</span>  <br>[root@xy ~]# vim /etc/sysconfig/network-scripts/ifcfg-bond0  <br>  TYPE=Ethernet  <br>  BOOTPROTO=none  <br>  ONBOOT=<span class="hljs-built_in">yes</span>  <br>  USERCTL=no   <br>  DEVICE=bond0  <br>  IPADDR=192.168.37.10  <br>  PREFIX=24  <br>  DNS=192.168.37.1  <br>  NM_CONTROLLED=no<br></code></pre></td></tr></table></figure><p><strong>常见网卡绑定驱动有三种模式</strong><br />+mode0:平衡负载模式,平时两块网卡同时工作,且自动备援,但需要在与服务器本地网卡相连的交换机设备上进行端口聚合来支持绑定技术<br />+ mode1:自动备援模式,平时仅一块网卡工作,故障后自动替换为另外网卡<br />+mode6:平衡负载模式,平时两块网卡同时工作,自动备援,无须交换机设备提供辅助支持</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/modprobe.d/bond.conf　<span class="hljs-comment"># 创建绑定网卡文件    </span><br>  <span class="hljs-built_in">alias</span> bond0 bonding<br>  options bond0 miiimon=100 mode=6  <br>[root@xy ~]# systemctl restart network  <br>[root@xy ~]# ifconfig 　 <span class="hljs-comment"># 正常情况下仅仅bond0网卡设备显示IP等信息  </span><br>  bond0: flags=5187&lt;UP,BR0ADCAST,RUNNING,MASTER,MULTICAST&gt; mtu 1500  <br>  inet 192.168.37.10 network 255.255.255.0 broadcast 192.168.37.255  <br>  inet6 fe80:20c:29ff:fe9c:637d prefixlen 64 scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;  <br>  ........省略部分信息........  <br>  eno16777736: flags=5187&lt;UP,BR0ADCAST,RUNNING,MASTER,MULTICAST&gt; mtu 1500  <br>  ........省略部分信息........  <br>  eno33554984: flags=5187&lt;UP,BR0ADCAST,RUNNING,MASTER,MULTICAST&gt; mtu 1500  <br>  ........省略部分信息........  <br>[root@xy ~]# ping 192.168.37.10 <span class="hljs-comment"># 断开其中一块网卡,另一块会继续为用户提供服务</span><br></code></pre></td></tr></table></figure><h3 id="配置sshd服务">20. 配置sshd服务: <a id="ssh"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/ssh/sshd_config<br>[root@xy ~]# systemctl restart sshd　<span class="hljs-comment"># service sshd start </span><br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> sshd　 <span class="hljs-comment"># chkconfig sshd enable  </span><br></code></pre></td></tr></table></figure><table><thead><tr><th>项目</th><th>说明</th></tr></thead><tbody><tr><td>Port 22</td><td>sshd服务默认端口</td></tr><tr><td>ListenAddress 0.0.0.0</td><td>设定sshd服务监听的IP地址</td></tr><tr><td>Protocol 2</td><td>SSH协议的版本号</td></tr><tr><td>HostKey /etc/ssh/ssh_host_key</td><td>SSH协议的版本1,DES私钥存放位置</td></tr><tr><td>HostKey /etc/ssh/ssh_host_rsa_key</td><td>SSH协议的版本2,RSA私钥存放位置</td></tr><tr><td>HostKey /etc/ssh/ssh_host_dsa_key</td><td>SSH协议的版本2,DSA私钥存放位置</td></tr><tr><td>PermitRootLogin no</td><td>设定是否允许管理员直接登陆</td></tr><tr><td>StrictModes yes</td><td>当远程用户的私钥改变时直接拒接登陆</td></tr><tr><td>MaxAuthTries 6</td><td>最大密码尝试次数</td></tr><tr><td>MaxSessions 10</td><td>最大终端数</td></tr><tr><td>PasswordAuthentication yes</td><td>是否允许密码验证</td></tr><tr><td>PermitEmptyPasswords no</td><td>是否允许空密码登录</td></tr></tbody></table><p><strong>安全密钥验证</strong><br /><em>客户端主机生成“密钥对”(非对称加密)</em><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# ssh-keygen -t rsa -b 2048  <span class="hljs-comment"># 用此命令的 留下 私钥</span><br>  Generating public/private rsa key pair. <br>  Enter file <span class="hljs-keyword">in</span> <span class="hljs-built_in">which</span> to save the key (/root/.ssh/id_rsa):　回车或设置密钥存储路径<br>  Enter passphrase (empty <span class="hljs-keyword">for</span> no passphrase): 　直接按回车或设置密钥密码  <br>  Enter same passphrase again: 再次按回车或设置密钥密码<br>  Your identification has been saved <span class="hljs-keyword">in</span> /root/.ssh/id_rsa.  <br>  Your public key has been saved <span class="hljs-keyword">in</span> /root/.ssh/id_rsa.pub.  <br>  The key fingerprint is:  <br>  81:e1:46:ce:a2:1a:a2:45:e2:5e:46:05:9f:ce:c1:12 root@xy.com  <br>  The key<span class="hljs-string">&#x27;s randomart image is:  </span><br><span class="hljs-string">  ....</span><br></code></pre></td></tr></table></figure></p><ul><li><p>客户端主机生成的<code>公钥</code>传送至远程主机上<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# ssh-copy-id 192.168.37.10  <span class="hljs-comment"># ssh-copy-ip 只能拷贝公钥</span><br>  Number of key(s) added: 1  <br>  Now try logging into the machine, with:   <span class="hljs-string">&quot;ssh &#x27;192.168.37.10&#x27;&quot;</span>  <br>  and check to make sure that only the key(s) you wanted were added.  <br></code></pre></td></tr></table></figure></p></li><li><p>对服务器进行设置只允许密钥验证<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/ssh/sshd_config  <br>PasswordAuthentication no<br></code></pre></td></tr></table></figure></p></li></ul><h3 id="远程传输命令scpsecure-copy-基于ssh协议-liunx主机之间">21.远程传输命令scp(secure copy) 基于SSH协议 Liunx主机之间:<a id="scp"></a></h3><ul><li>scp [参数] 本地文件 远程用户@远程IP地址:远程目录 上传到远程主机</li><li>scp [参数] 远程用户@远程IP地址:远程文件 本地目录 下载到本地主机<ul><li>-v 显示详细的链接进度</li><li>-P 指定远程主机的sshd端口号</li><li>-r 用于传送文件</li><li>-6 使用ipv6协议</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello World&quot;</span> &gt; readme.txt  <br>[root@xy ~]# scp /root/readme.txt 192.168.37.10:/home　　　　<span class="hljs-comment"># 上传</span><br>[root@xy ~]# scp 192.168.37.10:/home/readme.txt /root　　　　<span class="hljs-comment"># 下载</span><br></code></pre></td></tr></table></figure><p><strong>不间断会话服务screen</strong></p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-ls</td><td><strong>显示当前已经有的会话</strong></td></tr><tr><td>-r ID</td><td><strong>恢复指定会话</strong></td></tr><tr><td>Ctrl+a,d</td><td><strong>剥离当前会话</strong></td></tr><tr><td>-S</td><td><strong>创建会话窗口</strong></td></tr><tr><td>-x</td><td><strong>加入指定会话</strong></td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# screen -S backup 　 <span class="hljs-comment"># 屏幕快速闪动进入会话  </span><br>[root@xy ~]# screen -<span class="hljs-built_in">ls</span><br>  There is a screen on:  <br>        3127.backup     (Attached)  <br>1 Socket <span class="hljs-keyword">in</span> /var/run/screen/S-root.<br></code></pre></td></tr></table></figure><h3 id="apache-服务部署静态网站">22. Apache 服务部署静态网站<a id="apache"></a></h3><ul><li>Web 服务程序:IIS、Nginx、Apache<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# yum install httpd<br>[root@xy ~]# systemctl start httpd  <br>[root@xy ~]# systemctl <span class="hljs-built_in">enable</span> httpd<br>[root@xy ~]# vim /etc/httpd/conf/httpd.conf <span class="hljs-comment"># 配置文件</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="httpd服务程序配置文件及存放位置">22.1httpd服务程序配置文件及存放位置</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>服务目录</td><td>/etc/httpd</td></tr><tr><td>主配置文件</td><td>/etc/httpd/conf/httpd.conf</td></tr><tr><td>网站数据目录DocumentRoot</td><td>/var/www/html</td></tr><tr><td>访问日志</td><td>/var/log/httpd/access_log</td></tr><tr><td>错误日志</td><td>/var/log/httpd/error_log</td></tr></tbody></table><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>ServerRoot</td><td>服务目录 ✔</td></tr><tr><td>ServerAdmin</td><td>管理员邮箱</td></tr><tr><td>User</td><td>运行服务的用户</td></tr><tr><td>Group</td><td>运行服务的用户组</td></tr><tr><td>ServerName</td><td>网站服务器的域名</td></tr><tr><td>DocumentRoot</td><td>网站数据目录 ✔</td></tr><tr><td>Directory</td><td>网站数据目录的权限</td></tr><tr><td>DirectoryIndex</td><td>默认索引页面 ✔</td></tr><tr><td>ErrorLog</td><td>错误日志文件</td></tr><tr><td>CustomLog</td><td>访问日志文件</td></tr><tr><td>Timeout</td><td>网页超时时间,默认300s</td></tr></tbody></table><blockquote><p>SELinux(Security-EnhancesLinux),强制反问控制(MAC)安全子系统,三种服务配置模式<code>enforccing  peimissing  disabled</code>,当改变DocumentRoot路径后,违反了SELinux监管规则,所以在新的路径下Index.html无法访问；</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim  /etc/selinux/config　  <span class="hljs-comment"># SELinux 配置文件路径</span><br>  1  <span class="hljs-comment">#This file controls the state of SELinux on the system.  </span><br>  2  <span class="hljs-comment"># SELINUX= can take one of these three values:  </span><br>  3  <span class="hljs-comment">#     enforcing - SELinux security policy is enforced.   &#x27;enforce&#x27;  </span><br>  4  <span class="hljs-comment">#     permissive - SELinux prints warnings instead of enforcing.  &#x27;permissive&#x27;  </span><br>  5  <span class="hljs-comment">#     disabled - No SELinux policy is loaded.  &#x27;disabled SELINUX=enforcing  </span><br>  6  <span class="hljs-comment"># SELINUXTYPE= can take one of these two values:  </span><br>  7  <span class="hljs-comment">#     targeted - Targeted processes are protected,  </span><br>  8  <span class="hljs-comment">#     minimum - Modification of targeted policy. Only selected processes are protected.   </span><br>  9  <span class="hljs-comment">#     mls - Multi Level Security protection.</span><br></code></pre></td></tr></table></figure><h4 id="selinux-安全上下文由用户段角色段类型段共同组成">22.2 SELinux安全上下文由用户段、角色段、类型段共同组成</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# setenforce 0   <span class="hljs-comment"># setenforce  </span><br>[root@xy ~]# getenforce 　  <span class="hljs-comment"># getenforce  </span><br>  Permissive  <br>[root@xy ~]# setenforce 1    <br>[root@xy ~]# getenforce <br>  Enforcing  <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -Zd /var/www/html/ 　<span class="hljs-comment"># ls -Zd  用户段 角色段 类型段  </span><br>  drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /var/www/html/  <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -Zd /home/wwwroot/<br>  drwxr-xr-x. root root unconfined_u:object_r:home_root_t:s0 /home/wwwroot/<br></code></pre></td></tr></table></figure><h4 id="semanage-参数-选项-文件">22.3 semanage [参数] [选项] [文件]</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-l</td><td>用于查询</td></tr><tr><td>-a</td><td>用于添加</td></tr><tr><td>-m</td><td>用于修改</td></tr><tr><td>-d</td><td>用于删除</td></tr><tr><td>semanage fcontext -a -t</td><td>用于添加新的SELinux安全上下文✔</td></tr><tr><td>restorcon -Rv</td><td>更新安全上下文</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# semanage fcontext -a -t httpd_sys_content_t /home/wwwroot   <br>[root@xy ~]# semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/*  <br>[root@xy ~]# restorecon -Rv /home/wwwroot/    <br>  restorecon reset /home/wwwroot context unconfined_u:object_r:home_root_t:s0-&gt;  <br>  unconfined_u:object_r:httpd_sys_content_t:s0  <br>  restorecon reset /home/wwwroot/index.html context   <br>  unconfined_u:object_r:home_root_t:s0-&gt;unconfined_u:object_r:httpd_sys_content_t:s0<br></code></pre></td></tr></table></figure><h4 id="个人用户主页功能">22.4 个人用户主页功能</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/httpd/conf.d/userdir.conf<br>  <span class="hljs-comment">#UserDir disabled  </span><br>  UserDir public_html　　24行 去掉#   网站在用户家目录中保存的名称 <br>[root@xy ~]# su - xy  <br>[xy@xy ~]$ <span class="hljs-built_in">mkdir</span> public_html  <br>[xy@xy ~]$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;This is xy&#x27;s website&quot;</span> &gt; public_html/index.html <br>[xy@xy ~]$ <span class="hljs-built_in">chmod</span> -Rf 755 /home/xy<br><br>[root@xy ~]# getsebool -a | grep http　<span class="hljs-comment"># getsebool -a 获取安全策略  </span><br>  httpd_enable_homedirs --&gt; off  <br>[root@xy ~]# setsebool -P httpd_enable_homedirs=on　 <span class="hljs-comment"># setsebool -P  </span><br>[root@xy ~]# htpasswd -c /etc/httpd/passwd xy <br>  New password:  <br>  Re-<span class="hljs-built_in">type</span> new password:  <br>  Adding password <span class="hljs-keyword">for</span> user xy  <br>[root@xy ~]# vim /etc/httpd/conf.d/userdir.conf  <span class="hljs-comment"># 31-35 </span><br>  &lt;Directory <span class="hljs-string">&quot;/home/*/public_html&quot;</span>&gt;  <br>     AllowOverride all  <br>     authuserfile <span class="hljs-string">&quot;/etc/httpd/passwd&quot;</span>  <br>     authname <span class="hljs-string">&quot;My privately website&quot;</span>  <br>     authtype basic  <br>     require user xy  <br>  &lt;/Directory&gt;<br></code></pre></td></tr></table></figure><h4 id="虚拟主机vpsvirtual-private-server功能">22.5 虚拟主机(VPS:VirtualPrivate Server)功能</h4><p><strong>利用该功能可以把一台物理服务器分割为多个”虚拟服务器”,VPS共享物理服务器硬件</strong><strong>资源,Apache的VPS是基于用户请求不同IP、主机域名、端口号,实现提供多个网站同时为外部提供访问服务技术</strong><br />##### 1. 基于多个IP地址(192.168.37.10 ; 192.168.37.20 ;192.168.37.30)<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">mkdir</span> -p /home/wwwroot/10  <br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;IP:192.168.37.10&quot;</span> &gt; /home/wwwroot/10/index.html  <br>[root@xy ~]# vim /etc/httpd/conf/httpd.conf       <br>  &lt;VirtualHost 192.168.37.10&gt;  <br>  &lt;DocumentRoot <span class="hljs-string">&quot;/home/wwwroot/10&quot;</span>&gt;  <br>    ServerName tech.xy.com  <br>  &lt;Directory <span class="hljs-string">&quot;/home/wwwroot/10&quot;</span>&gt;  <br>    AllowOverride None  <br>    Require all granted  <br>  &lt;/Directory&gt;  <br>  &lt;/VirtualHost&gt; <br></code></pre></td></tr></table></figure></p><h5id="基于主机域名192.168.37.10-www.xy.com-bbs.xy.com-tech.xy.com-ˇˇ">2.基于主机域名(192.168.37.10 www.xy.com bbs.xy.com tech.xy.com)(●ˇ∀ˇ●)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/hosts     <br>  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4  <br>  ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6  <br>  192.168.37.10 www.xy.com bbs.xy.com tech.xy.com  <br>[root@xy ~]# <span class="hljs-built_in">mkdir</span> -p /home/wwwroot/www<br>  &lt;VirtualHost 192.168.37.10&gt;  <br>  DocumentRoot <span class="hljs-string">&quot;/home/wwwroot/www&quot;</span>  <br>  ServerName tech.xy.com  <br>  &lt;Directory <span class="hljs-string">&quot;/home/wwwroot/www&quot;</span>&gt;  <br>AllowOverride None  <br>Require all granted  <br>  &lt;/Directory&gt;  <br>  &lt;/VirtualHost&gt; <br><br>[root@xy ~]# systemctl restart httpd<br>[root@xy ~]# semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/ <br>[root@xy ~]# semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/bbs <br>[root@xy ~]# semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/bbs/*<br>[root@xy ~]# restorecon -Rv /home/wwwroot<br></code></pre></td></tr></table></figure><h5 id="基于端口号80-443-8080比较合理-测试6111-6222">3. 基于端口号80 4438080比较合理 (测试:6111 6222)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">mkdir</span> -p /home/wwwroot/6111<br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;port:6111&quot;</span> &gt; /home/wwwroot/6111/index.html<br>[root@xy ~]# vim /etc/httpd/conf/httpd.conf <br>  Listen 6111  <br>    &lt;VirtualHost 192.168.37.10:6111&gt;  <br>    DocumentRoot <span class="hljs-string">&quot;/home/wwwroot/6111&quot;</span>  <br>    ServerName www.xy.com  <br>    &lt;Directory <span class="hljs-string">&quot;/home/wwwroot/6111&quot;</span>&gt;  <br>        AllowOverride None  <br>        Require all granted  <br>    &lt;/Directory&gt;  <br>    &lt;/VirtualHost&gt;    <br>[root@xy ~]# semanage fcontext -a -t httpd_sys_content_t /home/wwwroot <br>[root@xy ~]# semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6111 <br>[root@xy ~]# semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6111/*  <br>[root@xy ~]# restorecon -Rv /home/wwwroot <br>[root@xy ~]# semanage port -l | grep http   <span class="hljs-comment"># semanage port -l 查询端口</span><br>    http_cache_port_t            tcp      8080, 8118, 8123, 10001-10010  <br>    http_cache_port_t            udp      3130  <br>    http_port_t                  tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000  <br>    pegasus_http_port_t          tcp      5988  <br>    pegasus_https_port_t         tcp      5989  <br><br>[root@xy ~]# semanage port -a -t http_port_t -p tcp 6111  <span class="hljs-comment"># semanage port -a -t  </span><br>[root@xy ~]# semanage port -l | grep http<br>    http_cache_port_t    tcp   8080, 8118, 8123, 10001-10010  <br>    http_cache_port_t    udp   3130  <br>    http_port_t          tcp   6111, 80, 81, 443, 488, 8008, 8009, 8443, 9000  <br>    pegasus_http_port_t  tcp   5988  <br>    pegasus_https_port_t tcp   5989  <br>[root@xy ~]# systemctl restart httpd<br></code></pre></td></tr></table></figure><h4 id="构建基于http的网络yum源">22.6 构建基于HTTP的网络YUM源</h4><ol type="1"><li>挂在光盘镜像并拷贝光盘下Packages目录所有软件包到/var/www/html/centos;<br /></li><li>创建本地源，构建缓存，<code>yum install createrepo; createrepo centos/</code>;</li><li>安装httpd并<code>useradd apache -g apache</code>，重启服务并关闭防火墙;</li><li>配置网络yum源/etc/yum.repo.d/http.repo: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[base]<br>name = <span class="hljs-string">&quot;CentOS7 HTTP YUM&quot;</span><br>baseurl = http://192.168.37.10/centos/<br>gpgcheck = 0<br>enabled = 1<br>[update]<br>name = <span class="hljs-string">&quot;CentOS7 HTTP YUM&quot;</span><br>baseurl = http://192.168.37.10/centos/<br>gpgcheck = 0<br>enabled = 1<br></code></pre></td></tr></table></figure></li><li>更新软件包，<code>createrepo --update centos/</code><br /></li><li>同步外网YUM源reposync: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget -O /etc/yum.repo.d/ http://mirrors.163.com/.help/CentOS7-Base-163.repo <br>yum install yum-utils createrepo -y<br>yum repolist<br>reposync -r base -p /var/www/html/centos<br>createrepo /var/www/html/centos<br></code></pre></td></tr></table></figure></li></ol><h4 id="返回目录"><a href="#back" target="_self">返回目录</a></h4>]]></content>
    
    
    <categories>
      
      <category>Devops, linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Devops</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux基础命令</title>
    <link href="/posts/4ac0a166.html"/>
    <url>/posts/4ac0a166.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-11-Linux基础命令 <span id="more"></span></p><p>199 238 106 ## 目录 <a id="back"></a> *<a href="#mbr" target="_self">首扇区知识</a> *<a href="#rpm" target="_self">RPM</a> *<a href="#yum" target="_self">Yum</a> *<a href="#chkconfig" target="_self">启动模式</a> *<a href="#service" target="_self">管理服务</a> *<a href="#date" target="_self">日期命令</a> *<a href="#pidof" target="_self">查看进程IDpidof</a> *<a href="#kill" target="_self">杀死进程IDkill</a> *<a href="#killall" target="_self">杀死进程服务killall</a> *<a href="#tar" target="_self">打包压缩与搜索命令</a> *<a href="#director" target="_self">重定向操作</a> *<a href="#yumku" target="_self">配置yum库</a> *<a href="#shell" target="_self">Shell脚本</a> *<a href="#crontab" target="_self">crontab</a></p><h2 id="分区方案">分区方案：</h2><h3 id="背景知识">背景知识：</h3><h4 id="硬盘建立分区">硬盘建立分区</h4><ul><li>主分区-&gt; 扩展分区-&gt; 逻辑分区-&gt; 激活主分区-&gt;格式化所有分区；</li><li>虚拟机的三种网络模式：<strong>桥接网络</strong>，<strong>NAT网络地址转换(VMnet8)</strong>，<strong>仅主机模式(VMnet1)</strong>；其中，主机模式仅仅与物理主机通信，不能访问外网，而其它两种可以通过物理主机进行外网的访问。</li></ul><h4 id="主引导记录-mbr-master-boot-record">主引导记录 MBR (Master BootRecord): <a id="mbr"></a></h4><ul><li>硬盘由大量扇区构成，以首扇区最重要，<strong>硬盘0号(首)扇区共512B</strong>，<strong>结束符占2B</strong>，<strong>主引导记录占446B</strong>，所以<strong>分区表就只有64B</strong>，分区表记录一个分区信息需要16B，所以做多记录4个分区信息；</li><li>为了解决分区不够的问题，可将其中的分区信息指向另外一个分区，称为<strong>扩展分区(扩展分区0扇区)</strong>，在扩展分区里划分逻辑分区，<strong>一块硬盘只能有一个扩展分区，1/2/3/4号只能给主分区，5/6开始为逻辑分区</strong>;</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/sda of=MBR bs=1 count=64 skip=446 &amp;&amp; hexdump -C /dev/sda -n 512 <span class="hljs-comment"># 备份分区表:以字节为单位 </span><br><span class="hljs-comment"># 测试: </span><br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/sda bs=1 count=64 seek=446 &amp;&amp; <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=MBR of=/dev/sda bs=1 count=64 seek=446 &amp;&amp; <span class="hljs-built_in">sync</span>  <br></code></pre></td></tr></table></figure><img src="/posts/4ac0a166/%E9%A6%96%E6%89%87%E5%8C%BA%E5%9B%BE%E7%A4%BA.png" class="" title="[首扇区图示]"><img src="/posts/4ac0a166/%E9%80%BB%E8%BE%91%E5%88%86%E5%8C%BA.png" class="" title="[分区图示]"><h4 id="linux-下的分区方案">Linux 下的分区方案</h4><table><thead><tr><th>分区</th><th>说明</th></tr></thead><tbody><tr><td>/</td><td>用于存放系统，划为主分区 ✔</td></tr><tr><td>/boot</td><td>引导分区，划为主分区，大概200M即可； ✔</td></tr><tr><td>/swap</td><td>充当虚拟内存，划为逻辑分区，大致为电脑内存； ✔</td></tr><tr><td>/home</td><td>划为逻辑分区，用于存放用户文件； ✔</td></tr><tr><td>/tmp</td><td>存放临时文件，可有可无，划为逻辑分区；</td></tr></tbody></table><img src="/posts/4ac0a166/%E5%88%86%E5%8C%BA%E6%96%B9%E6%A1%88.png" class="" title="[分区方案]"><h4id="rpm红帽软件包管理器-相当于windows-的控制面板的软件管理">RPM:(红帽软件包管理器)相当于windows 的控制面板的软件管理 <a id="rpm"></a></h4><table><thead><tr><th>RPM -选项</th><th>说明</th></tr></thead><tbody><tr><td>rpm -ivh filename.rpm</td><td>-v:verbose -h:进度 安装软件✔, -i,–info</td></tr><tr><td>rpm -Uvh filename.rpm</td><td>升级</td></tr><tr><td>rpm -e filename.rpm</td><td>--nodeps 不检查依赖性 卸载软件✔, -e,–erase</td></tr><tr><td>rpm -qa | grep filename</td><td>查询所安装的包的名称✔</td></tr><tr><td>rpm -qc filename</td><td>查询所安装的包的配置文件✔</td></tr><tr><td>rpm -qd filename</td><td>查询所安装的包的帮助文件✔</td></tr><tr><td>rpm -qi filename.rpm</td><td>查询包描述信息 -p(查未安装,包全名)</td></tr><tr><td>rpm -ql filename.rpm</td><td>列出包文件信息 -p(查未安装)</td></tr><tr><td>rpm -qf filename</td><td>查询文件属于哪个包</td></tr><tr><td>rpm -V filename</td><td>验证</td></tr></tbody></table><h4 id="程序包来源">程序包来源</h4><ul><li>Fedora-EPEL: Extra PAckages for Enterprise Linux</li><li>Rpmforge: RHEL推荐</li><li>http://pkgs.org http://rpmfind.net http://rpm.pbone.nethttps://sourceforge.net<br /></li><li><code>rpm2cpio tree</code></li><li><code>rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</code> #导入密钥</li><li><code>rpm2cpio Package.rpm |cpio -idv .文件绝对路径</code> #RPM包文件提取<br /></li><li><code>patch -pnumber &lt;文件</code></li></ul><h4 id="yum软件仓库解决包的依赖性">Yum软件仓库(解决包的依赖性):<a id="yum"></a></h4><table><thead><tr><th>yum 选项</th><th>说明</th></tr></thead><tbody><tr><td>yum repolist all</td><td>列出软件仓库 ✔</td></tr><tr><td>yum list all/installed</td><td>列出仓库所有软件/已安装的 ✔</td></tr><tr><td>yum info 包名称</td><td>查看包信息 ✔</td></tr><tr><td>yum history</td><td>info undo redo查看历史</td></tr><tr><td>yum search Package</td><td>查寻包</td></tr><tr><td>yum install 包名称</td><td>安装包 ✔</td></tr><tr><td>yum reinstall 包名称</td><td>卸载包 ✔</td></tr><tr><td>yum update 包名称</td><td>升级包 ✔</td></tr><tr><td>yum remove 包名称</td><td>移除包 ✔</td></tr><tr><td>yum clean all</td><td>清除所有仓库缓存 ✔</td></tr><tr><td>yum check-update</td><td>检查可更新的包 ✔</td></tr><tr><td>yum grouplist</td><td>查看系统中已经安装的包组</td></tr><tr><td>yum groupinstall</td><td>包组 安装指的包组</td></tr><tr><td>yum groupremove</td><td>包组 移除指定的包组</td></tr><tr><td>yum groupinfo</td><td>包组 查询指定的包组信息</td></tr><tr><td>yum deplist httpd</td><td>列出依赖包</td></tr><tr><td>yum provides rz</td><td>查找命令rz的提供者</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">BIOS-&gt; Boot Loader-&gt; 内核-&gt; 内核初始化-&gt; 启动初始化进程(systemd) ✔<br><span class="hljs-built_in">command</span> [options] [arguments]  <span class="hljs-comment"># 命令 选项 参数</span><br></code></pre></td></tr></table></figure><h4 id="启用多用户">启用多用户 <a id="chkconfig"></a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">ln</span> -sf /lib/systemd/system/multi-user.target /etc/systemd/system/default.target <span class="hljs-comment"># 无图形模式 </span><br>[root@xy ~]# <span class="hljs-built_in">ln</span> -sf /lib/systemd/system/graphical.target /etc/systemd/system/default.target <span class="hljs-comment"># 图形模式</span><br></code></pre></td></tr></table></figure><h3 id="管理服务">3. 管理服务 <a id="service"></a></h3><h4 id="rpm-包安装">3.1 RPM 包安装</h4><ul><li>独立服务:<ul><li><p>服务启动: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/rc.d/init.d/httpd start<br>service httpd start<br></code></pre></td></tr></table></figure></p></li><li><p>服务自启动: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">chkconfig --levle 2345 httpd on |off<br>vim /etc/rc.d/rc.local     <span class="hljs-comment"># 添加: /etc/rc.d/init.d/httpd start</span><br>ntsysv<br></code></pre></td></tr></table></figure></p></li></ul></li><li>基于xinetd 的非独立服务:<ul><li><p>服务启动: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/xinetd/telnet    <span class="hljs-comment"># disable = no, 重启xinetd</span><br></code></pre></td></tr></table></figure></p></li><li><p>服务自启动: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">chkconfig httpd on|off<br>ntsysv<br></code></pre></td></tr></table></figure></p></li></ul></li></ul><h4 id="源码安装">3.2 源码安装</h4><blockquote><p>service命令其实只是在<code>/etc/init.d/</code>目录中寻找是否有服务<strong>启动脚本</strong>,通过源码安装的服务, 需要要把<strong>启动脚本</strong>软连接到此目录;<code>ln -s /usr/local/apache2/bin/apachectl /etc/init.d/httpd</code></p></blockquote><blockquote><p>chkconfig 需要修改<code>/etc/init.d/httpd</code>,<code>chkconfig --add apachectl</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment"># chkconfig: 35 86 76 </span><br><span class="hljs-comment"># 指定httpd在3和5级别能被chkconfig命令管理, 启动顺序Start 86, 关闭顺序Kill 76</span><br><span class="hljs-comment"># (顺序自定, 和系统不冲突)</span><br><span class="hljs-comment"># description: source package apache</span><br></code></pre></td></tr></table></figure><table><thead><tr><th>System V init</th><th>systemctl</th></tr></thead><tbody><tr><td>service foo start</td><td>systemctl start foo.service</td></tr><tr><td>service foo restar</td><td>systemctl restart foo.service</td></tr><tr><td>service foo stop</td><td>systemctl stop foo.service</td></tr><tr><td>service foo reload</td><td>systemctl reload foo.service</td></tr><tr><td>service foo status</td><td>systemctl status foo.service</td></tr><tr><td>—</td><td>journalctl -xe</td></tr></tbody></table><h3 id="设置服务开机启动不启动">4. 设置服务开机启动、不启动</h3><table><thead><tr><th>System V init</th><th>systemctl</th></tr></thead><tbody><tr><td>chkconfig foo on</td><td>systemctl enable foo.service</td></tr><tr><td>chkconfig foo off</td><td>systemctl disable foo.service</td></tr><tr><td>chkconfig foo list</td><td>systemctl list-unit-files –type=service</td></tr><tr><td>–level默认级别2345</td><td>—</td></tr></tbody></table><h3 id="重置密码操作">5. 重置密码操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /etc/redhat-release  　　<span class="hljs-comment"># 查看redhat-realease version</span><br>  linux16 追加 rd.break ctrl+x运行  <br>mount -o remount, rw /sysroot  <br><span class="hljs-built_in">chroot</span> /sysroot <br>passwd<br><span class="hljs-built_in">touch</span> /.autorelable <br><span class="hljs-built_in">exit</span> <br>reboot<br></code></pre></td></tr></table></figure><h3 id="解决piix4_smbus-0000000073host-smbus-controller-not-enabled">6.解决piix4_smbus 0000:00:007:3:Host SMBus controller not enabled!</h3><ul><li>modprobe<ul><li>modprobe MOD_NAME: 装载模块<br /></li><li>modprobe -r MOD_NAME: 卸载模块<br /></li><li>modinfo MOD_NAME: 查看模块具体信息</li></ul></li><li>insmod /PATH/TO/MODULE_FILE: 装载模块</li><li>rmmod MOD_NAME</li><li>depmod /PATH/TO/MODULE_FILE</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy Desktop]# lsmod |grep i2c　　 <span class="hljs-comment"># lsmod 查看模块  </span><br>  i2c_piix4              22106  0   <br>  i2c_core               40325  2 drm,i2c_piix4  <br>[root@xy Desktop]# vim /etc/modprobe.d/blacklist.conf    <br>  blacklist i2c-piix4 　　　　 <span class="hljs-comment"># 加黑名单  </span><br>reboot<br></code></pre></td></tr></table></figure><h3 id="常用系统工作命令">7. 常用系统工作命令</h3><h4 id="man">7.1 man</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# whatis motd    <br>[root@xy ~]# man 5 motd　　<span class="hljs-comment"># 帮助 n N ?   </span><br>[root@xy ~]# man -w issue  <br></code></pre></td></tr></table></figure><h4 id="echo-字符串-变量">7.2 echo 　　# 字符串 / $变量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">echo</span> xy<br>  xy  <br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-variable">$SHELL</span> <br>  /bin/bash<br></code></pre></td></tr></table></figure><h4 id="date">7.3 date <a id="date"></a></h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>%t</td><td>跳格</td></tr><tr><td>%H</td><td>小时(00~23)</td></tr><tr><td>%S</td><td>秒(00~59)</td></tr><tr><td>%I</td><td>小时(00~12)</td></tr><tr><td>%M</td><td>分钟(00~59)</td></tr><tr><td>%F</td><td>Year-Month-Day</td></tr><tr><td>hwclock -w / -s</td><td>以软件/硬件时间为基准, 覆盖硬件/软件时间</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">date</span><br>  Thu Jul  5 22:44:59 EDT 2018  <br>[root@xy ~]# <span class="hljs-built_in">date</span> <span class="hljs-string">&quot;+%Y-%M-%m-%d %H:%M:%S&quot;</span>  <br>  2018-45-07-05 22:45:56  <br>[root@xy ~]# <span class="hljs-built_in">date</span> -s <span class="hljs-string">&quot;20180706 10:49:00&quot;</span>   --<span class="hljs-built_in">set</span>=STRING  <br>  Fri Jul  6 10:49:00 EDT 2018  <br>[root@xy ~]# <span class="hljs-built_in">touch</span> `<span class="hljs-built_in">date</span> +%F`.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><h5 id="centos-6.x-7.x">CentOS 6.x / 7.x</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# ntpd -p  <span class="hljs-comment"># 时间同步  </span><br>[root@xy ~]# /etc/sysconfig/clock  <span class="hljs-comment"># 修改时区  </span><br>[root@xy ~]# /etc/sysconfig/il8n  <span class="hljs-comment"># 修改语言 </span><br>---<br>[root@xy ~]# chronyc <span class="hljs-built_in">source</span>  <span class="hljs-comment"># 时间同步  </span><br>[root@xy ~]# timedatectl set-timezone Asia/Shanghai  <span class="hljs-comment"># 修改时区  </span><br>[root@xy ~]# localectl set-locale LANG=zh_UTF-8  <span class="hljs-comment"># 修改语言</span><br></code></pre></td></tr></table></figure><h4 id="wget">7.4 wget</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-b</td><td>后台下载</td></tr><tr><td>-P</td><td>下载至指定目录</td></tr><tr><td>-O</td><td>指定目录并重命名</td></tr><tr><td>-c</td><td>断点续传</td></tr><tr><td>-p</td><td>下载页面搜有资源</td></tr><tr><td>-r</td><td>递归下载</td></tr><tr><td>-np</td><td>不追溯至父级</td></tr><tr><td>-k</td><td>make links in downloaded HTML point to local files</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# wget -r -p http://www.linuxprobe.com  <br>[root@xy ~]# wget -r -p -np -k http://www.linuxprobe.com<br></code></pre></td></tr></table></figure><h4 id="curl">curl</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-i, –include</td><td>响应头部信息,连同body</td></tr><tr><td>-I, –head</td><td>仅仅显示响应头部信息</td></tr><tr><td>-X, –request</td><td>指定请求方式</td></tr><tr><td>-v</td><td>显示响应结果</td></tr><tr><td>-u</td><td>携带用户名/密码</td></tr></tbody></table><h4 id="pspstree--p">7.5 ps(pstree -p)</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>显示所有终端下执行的进程sysV</td></tr><tr><td>-u</td><td>显示指定用户相关的进程信息sysV</td></tr><tr><td>-x</td><td>显示没有控制终端进程sysV</td></tr><tr><td>-e</td><td>显示所有进程</td></tr><tr><td>-f</td><td>额外显示UID PPID(父进程ID) C与STIME栏位</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# ps -aux  <br>USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND  <br>root          1  0.8  0.3  53784  7716 ?        Ss   10:37   0:09 /usr/lib/  systetemd    <br>root          2  0.0  0.0      0     0 ?        S    10:37   0:00 [kthreadd]  <span class="hljs-comment"># 内核线程    </span><br>root          3  0.0  0.0      0     0 ?        S    10:37   0:00 [ksoftirqd/0]       <br>root       3041  0.0  0.0 125440  1436 pts/0    R+   10:55   0:00 ps -aux   <br>.......省略部分信息........ <br><br>5种常见进程状态:R(运行) S(中断) D(不可中断) Z(僵死) T(停止)<br><br>[root@xy ~]# mpstat -P ALL; sar -P ALL <span class="hljs-comment"># 查看多核CPU</span><br>[root@xy ~]# top     <span class="hljs-comment"># 动态显示进程活动  </span><br>  top - 11:00:06 up 23 min,  2 <span class="hljs-built_in">users</span>,  load average: 0.96, 0.59, 0.53   <span class="hljs-comment"># 1min 5min 15min    </span><br>  Tasks: 486 total,   1 running, 485 sleeping,   0 stopped,   0 zombie<br>  %Cpu(s): 21.9 us, 11.8 sy,  0.0 ni, 66.3 <span class="hljs-built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>  KiB Mem:   2035648 total,  1280152 used,   755496 free,     1084 buffers<br>  KiB Swap:  2113532 total,        0 used,  2113532 free.   342864 cached Mem<br>.......省略部分信息........  <br></code></pre></td></tr></table></figure><h4 id="pidof">7.7 pidof 　　　 <a id="pidof"></a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# pidof sshd　　　<span class="hljs-comment"># 查询PID值 ，pidof 服务名称 </span><br>1552<br></code></pre></td></tr></table></figure><h4 id="kill--l">7.8 kill -l <a id="kill"></a></h4><ul><li>进程间通信(IPC)：<code>共享内存；信号；Semaphore</code>；</li><li>信号：<ul><li><code>1  SIGHUB</code> (进程不用重启，可以重读配置文件并生效)<br /></li><li><code>2  SIGINT</code> (Ctrl+c 中断)<br /></li><li><code>9  SIGKILL</code> (杀死进程)<br /></li><li><code>15 SIGTERM</code> (终止进程，默认)</li></ul></li></ul><h4 id="killall">7.9 killall <a id="killall"></a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# pidof httpd  <span class="hljs-comment"># pid open file  </span><br>13581 13580 13579 13578 13577 13576 <br>[root@xy ~]# killall httpd    　<span class="hljs-comment"># killall 服务名称  </span><br>[root@xy ~]# pidof httpd<br>[root@xy ~]# <span class="hljs-built_in">kill</span> PID　　        <span class="hljs-comment"># kill PID号 </span><br></code></pre></td></tr></table></figure><h3 id="系统状态检测命令">8. 系统状态检测命令</h3><h4 id="ifconfigip">8.1 ifconfig(ip)</h4><blockquote><p>RedHat/CentOS: /etc/sysconfig/network-scripts<br />Debian/Ubuntu: /etc/network/interfaces</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;1&quot;</span>&gt; <span class="hljs-built_in">cat</span> /proc/sys/net/ipv4/ip_forward  <span class="hljs-comment">#临时开启路由转发  </span><br>/etc/sysctl.conf  <span class="hljs-comment">#net.ipv4.ip_forward = 0  #永久修改  sysctl -p</span><br>[root@xy ~]# ifconfig  <br>eno16777736: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        ether 00:0c:29:11:26:05  txqueuelen 1000  (Ethernet)  <br>        RX packets 496  bytes 46407 (45.3 KiB)  <br>        RX errors 0  dropped 0  overruns 0  frame 0  <br>        TX packets 0  bytes 0 (0.0 B)  <br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0  <br><br>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536  <br>        inet 127.0.0.1  netmask 255.0.0.0  <br>        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;  <br>        loop  txqueuelen 0  (Local Loopback)  <br>        RX packets 770  bytes 62348 (60.8 KiB)  <br>        RX errors 0  dropped 0  overruns 0  frame 0  <br>        TX packets 770  bytes 62348 (60.8 KiB)   <br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0    <br>[root@xy ~]# ifconfig eno16777736 IP       <span class="hljs-comment"># 临时测试更改IP  </span><br>[root@xy ~]# yum install quagga -y    <br>[root@xy ~]# ifconfig eth0:1 192.168.10.131 netmask 255.255.255.0 up  <span class="hljs-comment"># eth0:1 虚拟网络接口</span><br></code></pre></td></tr></table></figure><h4 id="uname">8.2 uname</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">uname</span> -a 　　　<span class="hljs-comment"># 查看系统内核与版本信息    </span><br>  Linux xy.com 3.10.0-123.el7.x86_64 <span class="hljs-comment">#1 SMP Mon May 5 11:16:57 EDT 2014 x86_64 x86_64 x86_64 GNU/Linux  </span><br>[root@xy ~]# <span class="hljs-built_in">cat</span> /etc/redhat-release   　　　 <span class="hljs-comment"># 系统版本详细信息文件路径  </span><br>  Red Hat Enterprise Linux Server release 7.0 (Maipo)<br></code></pre></td></tr></table></figure><h4 id="uptime">8.3 uptime</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">uptime</span>　　　<span class="hljs-comment"># 5min 10min15min系统负载状况 </span><br>  11:08:55 up 31 min,  2 <span class="hljs-built_in">users</span>,  load average: 0.48, 0.42, 0.46    <br></code></pre></td></tr></table></figure><h4 id="free">8.4. free</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# free -h       　　　<span class="hljs-comment"># 内存使用情况    </span><br>             total       used       free     shared    buffers     cached  <br>Mem:          1.9G       1.2G       732M       9.8M       1.1M       335M  <br>-/+ buffers/cache:       919M       1.0G  <br>Swap:         2.0G         0B       2.0G  <br></code></pre></td></tr></table></figure><h4 id="who">8.5 who</h4><blockquote><p>-r 显示当前运行级别<br />console pty(物理终端) tty(虚拟终端) ttyS(串行终端) pts(伪终端)<br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">who</span>      　　　　　<span class="hljs-comment"># 当前登录主机用户信息</span><br>xy       :0           2018-07-05 22:38 (:0)  <br>xy       pts/0        2018-07-06 11:06 (:0)  <br></code></pre></td></tr></table></figure></p></blockquote><h4 id="last-显示用户登录历史及系统重启历史">8.6 last:显示用户登录历史及系统重启历史</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# last     　　　　 <span class="hljs-comment"># /var/log/wtmp    </span><br>xy       pts/0        :0               Fri Jul  6 11:06   still logged <span class="hljs-keyword">in</span>     <br>xy       pts/0        :0               Thu Jul  5 22:41 - 11:06  (12:24)      <br>xy       :0           :0               Thu Jul  5 22:38   still logged <span class="hljs-keyword">in</span>        <br>reboot   system boot  3.10.0-123.el7.x Fri Jul  6 06:37 - 11:11  (04:33)  <br>.......省略部分信息........   <br><br>lastb -n      <span class="hljs-comment"># /var/log/btmp   # 显示错误的登录尝试信息  </span><br>lastlog -u username           <span class="hljs-comment"># 显示每一个用户最近登录信息    </span><br></code></pre></td></tr></table></figure><h4 id="history">8.7 history</h4><table><thead><tr><th>调用</th><th>说明</th></tr></thead><tbody><tr><td>!!</td><td>重复执行上一条</td></tr><tr><td>!n</td><td>重复执行第n条</td></tr><tr><td>!$</td><td>重复上一条命令的最后一个参数</td></tr><tr><td>!string</td><td>重复执行最后一条以该字串开头的</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">history</span>      　　　      <span class="hljs-comment"># 命令使用历史     </span><br>[root@xy ~]# <span class="hljs-built_in">history</span> -c      　　 <span class="hljs-comment"># clean    </span><br>[root@xy ~]# <span class="hljs-built_in">cat</span> ~/.bash_history  <br>  lsmod|grep i2c  <br>  vim /etc/modprobe.d/blacklist.conf      <br>  reboot  <br>  lsmod|grep i2c  <br>.......省略部分信息........  <br></code></pre></td></tr></table></figure><h4 id="sosreport">8.8 sosreport</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# sosreport    <br>    sosreport (version 3.0)    <br>    This <span class="hljs-built_in">command</span> will collect diagnostic and configuration information from  <br>    this Red Hat Enterprise Linux system and installed applications.  <br>    Your sosreport has been generated and saved <span class="hljs-keyword">in</span>:  <br>      /var/tmp/sosreport-xy.com-20180706113138.tar.xz<br></code></pre></td></tr></table></figure><h3 id="工作目录切换命令">9. 工作目录切换命令</h3><h4 id="pwd">9.1 pwd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">pwd</span>          　　<span class="hljs-comment"># 当前所处工作目录  </span><br>/root<br></code></pre></td></tr></table></figure><h4 id="cd">9.2 cd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">cd</span> /etc  <br>[root@xy etc]# <span class="hljs-built_in">cd</span> -       　　<span class="hljs-comment"># cd - 返回到上一次所处目录  </span><br>/root  <br>[root@xy ~]# <span class="hljs-built_in">cd</span> /etc  <br>[root@xy etc]# <span class="hljs-built_in">cd</span> ~       　　<span class="hljs-comment"># 进入当前用户的home目录  </span><br>[root@xy ~]# <span class="hljs-built_in">cd</span> ..      　　  <span class="hljs-comment"># cd .. 进入上级目录 </span><br>[root@xy /]# <span class="hljs-built_in">cd</span> /etc  <br></code></pre></td></tr></table></figure><h4 id="ls">9.3 ls</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>全部文件(包括隐藏文件)</td></tr><tr><td>-l</td><td>查看文件属性、大小等详细信息</td></tr><tr><td>-d</td><td>查看目录属性信息</td></tr><tr><td>-h,–human</td><td>–</td></tr><tr><td>-Z</td><td>查看安全上下文</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">ls</span> -al   <br>total 64  <br>dr-xr-x---. 14 root root 4096 Jul  6 11:06 .   <br>-rw-------.  1 root root  378 Jul  6 11:06 .bash_history  <br><br>[root@xy ~]# <span class="hljs-built_in">ls</span> -ld /etc   <br>drwxr-xr-x. 132 root root 8192 Jul  6 06:37 /etc<br></code></pre></td></tr></table></figure><h3 id="文本编辑命令">10. 文本编辑命令</h3><h4 id="cat">10.1 cat</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-n</td><td>显示行号</td></tr><tr><td>-E</td><td>显示所有符号</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">cat</span> -n initial-setup-ks.cfg     　　<span class="hljs-comment"># 短篇文本查看 Number  </span><br>  1  <span class="hljs-comment">#version=RHEL7  </span><br>  2  <span class="hljs-comment"># X Window System configuration information  </span><br>  3  xconfig  --startxonboot  <br></code></pre></td></tr></table></figure><h4 id="more">10.2 more</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# more initial-setup-ks.cfg<span class="hljs-comment">#长篇文本查看 翻滚 空格键  </span><br>  1  <span class="hljs-comment">#version=RHEL7  </span><br>  2  <span class="hljs-comment"># X Window System configuration information  </span><br>  3  xconfig  --startxonboot   <br></code></pre></td></tr></table></figure><h4 id="head">10.3 head</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-n</td><td>显示文本前n行</td></tr><tr><td>-c</td><td>指定获取前n字符数</td></tr><tr><td>-2</td><td>指定查看前2行</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">head</span> -n 5 initial-setup-ks.cfg       <br>  1  <span class="hljs-comment">#version=RHEL7  </span><br>  2  <span class="hljs-comment"># X Window System configuration information</span><br></code></pre></td></tr></table></figure><h4 id="tail默认后10行">10.4 tail(默认后10行)</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-c</td><td>指定获取后n字符数</td></tr><tr><td>-n</td><td>指定获取后n行</td></tr><tr><td>-f</td><td>查看文件尾部等待显示后续新追加内容</td></tr><tr><td>-F</td><td>同-f, 删除跟踪后会提醒</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">tail</span> -n 5 initial-setup-ks.cfg  <span class="hljs-comment"># tail -n 查看后10行  </span><br>  @guest-agents  <br>  @guest-desktop-agents     <br><br>[root@xy ~]# <span class="hljs-built_in">tail</span> -f /var/log/messages　<span class="hljs-comment"># tail -f 动态显示log信息 </span><br>  Jul  6 11:51:43 xy dbus[1068]: [system] Activating via systemd: service   name=<span class="hljs-string">&#x27;net.reactivated.Fprint&#x27;</span> unit=<span class="hljs-string">&#x27;fprintd.service&#x27;</span>  <br>  Jul  6 11:51:43 xy systemd: Starting Fingerprint Authentication Daemon...<br></code></pre></td></tr></table></figure><h4 id="diff">10.3 diff</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy diff]# <span class="hljs-built_in">cat</span> diff_A.txt  <br>  Welcom to RedHat 7  <br>  RedHat certified  <br>  Free Linux Lessons  <br>  Professional guidance  <br>  Linux Course  <br>[root@xy diff]# <span class="hljs-built_in">cat</span> diff_B.txt  <br>  Welcom tooo RedHat7  <br><br>  RedHat certified  <br>  Free Linux LessonS  <br>  //////////...../////////  <br>  Professional guidance  <br>  Linux Course  <br>[root@xy diff]# diff --brief diff_A.txt diff_B.txt         　　<span class="hljs-comment"># 比较文本差异  </span><br>  Files diff_A.txt and diff_B.txt differ  <br>[root@xy diff]# diff -c -Naur diff_A.txt diff_B.txt &gt;patch.txt  <br>  *** diff_A.txt2018-07-06 12:06:35.889958037 -0400  <br>  --- diff_B.txt2018-07-06 12:10:58.818955667 -0400  <br>  ***************  <br>  *** 1,5 ***  <br>  ! Welcom to RedHat 7  <br>    RedHat certified  <br>  ! Free Linux Lessons  <br>    Professional guidance  <br>    Linux Course  <br>  --- 1,8 ----  <br>  ! Welcom tooo RedHat7  <br>  !   <br>  !   <br>    RedHat certified  <br>  ! Free Linux LessonS  <br>  ! //////////...../////////  <br>    Professional guidance  <br>    Linux Course<br></code></pre></td></tr></table></figure><h4 id="wc-统计指定文本的行数-字数-字节数-word-count">10.4 wc<strong>统计指定文本的行数, 字数, 字节数 word count</strong></h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-l</td><td>只显示行数line</td></tr><tr><td>-w</td><td>只显示单词数word</td></tr><tr><td>-c</td><td>只显示字节数</td></tr><tr><td>-m</td><td>只统计数字字(节)符总数</td></tr><tr><td>-L</td><td>最长的行包含字符数</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">wc</span> -l /etc/passwd <br>  38 /etc/passwd  <br>[root@xy ~]# <span class="hljs-built_in">wc</span> -w /etc/passwd  <br>  66 /etc/passwd  <br>[root@xy ~]# <span class="hljs-built_in">wc</span> -c /etc/passwd<br>  1902 /etc/passwd<br></code></pre></td></tr></table></figure><h4 id="stat">10.5 stat</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">stat</span> anaconda-ks.cfg 　　<span class="hljs-comment"># 查看文件具体存储信息与时间  </span><br>    File: ‘anaconda-ks.cfg’  <br>    Size: 1071      Blocks: 8          IO Block: 4096   regular file  <br>  Device: fd00h/64768dInode: 68521005    Links: 1  <br>  Access: (0600/-rw-------)  Uid: (    0/    root)   Gid: (    0/    root)  <br>  Context: system_u:object_r:admin_home_t:s0  <br>  Access: 2018-07-06 14:25:45.099882788 -0400  <span class="hljs-comment"># atime</span><br>  Modify: 2018-07-06 05:36:00.000000000 -0400  <span class="hljs-comment"># mtime</span><br>  Change: 2018-07-06 12:21:08.983950168 -0400  <span class="hljs-comment"># ctime</span><br>  Birth: -<br></code></pre></td></tr></table></figure><h4 id="cut-提取列-字符串不识别空格">10.6 cut 提取列字符串,不识别空格</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-d</td><td>分隔符,默认为Tab</td></tr><tr><td>-f,--filed</td><td>指定列数(1,3 1-3)</td></tr><tr><td>-c</td><td>按字符提取</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">head</span> -n 2 /etc/passwd<br>  root:x:0:0:root:/root:/bin/bash <br>  bin:x:1:1:bin:/bin:/sbin/nologin  <br>[root@xy ~]# <span class="hljs-built_in">cut</span> -d: -f1 /etc/passwd  <span class="hljs-comment"># 按列提取文本字符</span><br>  root   <br>  ...    <br>  sshd  <br>  xy<br></code></pre></td></tr></table></figure><h4 id="tr-替换文本字符串">10.7 tr　<strong>替换文本字符串</strong></h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-s</td><td>将重复出现字符串压缩为一个字符串替换</td></tr><tr><td>-d</td><td>删除出现在字符集中的所有字符</td></tr><tr><td>-c</td><td>反选</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">cat</span> anaconda-ks.cfg | <span class="hljs-built_in">tr</span> [a-z] [A-Z]  <br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;xt.,l 1 jr#!$mn2 c*/fe3 uz4&#x27;</span> |<span class="hljs-built_in">tr</span> -dc [0-9]  <span class="hljs-comment"># -d 删除 -c 取反  </span><br>[root@xy ~]# ifconfig eno16777736 |<span class="hljs-built_in">head</span> -n2 |<span class="hljs-built_in">tail</span> -n1 |<span class="hljs-built_in">tr</span> -dc <span class="hljs-string">&#x27;[0-9]. &#x27;</span> |<span class="hljs-built_in">tr</span> -s <span class="hljs-string">&#x27; &#x27;</span>|<span class="hljs-built_in">cut</span> -d<span class="hljs-string">&quot; &quot;</span> -f2 <br>  192.168.137.10<br></code></pre></td></tr></table></figure><h4 id="sort取列排序">sort(取列排序)</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-n</td><td>按数字排序</td></tr><tr><td>-r</td><td>倒序排序</td></tr><tr><td>-t</td><td>分隔符</td></tr><tr><td>-k,--key=POSL</td><td>指定某列进行排序(默认字符)</td></tr><tr><td>-u,--unique</td><td>重复内容只排一次</td></tr><tr><td>-f</td><td>忽略大小写</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">df</span> |grep sd | <span class="hljs-built_in">tr</span> -s <span class="hljs-string">&quot; &quot;</span> <span class="hljs-string">&quot;%&quot;</span> |<span class="hljs-built_in">cut</span> -d% -f5 |<span class="hljs-built_in">sort</span> -nr |<span class="hljs-built_in">head</span> -n1<br></code></pre></td></tr></table></figure><h4 id="uniq相邻相同的字符">uniq(相邻相同的字符)</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-c,–count</td><td>统计每行重复出现次数</td></tr><tr><td>-d,–repeated</td><td>统计重复过的行(交)</td></tr><tr><td>-u,–unique</td><td>显示不曾重复的行(并)</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">cut</span> -d<span class="hljs-string">&quot; &quot;</span> -f1 /var/log/httpd/access_log |<span class="hljs-built_in">sort</span> |<span class="hljs-built_in">uniq</span> -c |<span class="hljs-built_in">sort</span> -nr <span class="hljs-comment"># 统计客户端访问IP次数  </span><br>[root@xy ~]# <span class="hljs-built_in">cat</span> f1 f2 | <span class="hljs-built_in">sort</span> |<span class="hljs-built_in">uniq</span> -d <span class="hljs-comment"># 交集  </span><br>[root@xy ~]# grep -f f1 f2             <span class="hljs-comment"># 交集  </span><br><br>[root@xy ~]# <span class="hljs-built_in">cat</span> f1 f2| <span class="hljs-built_in">sort</span> |<span class="hljs-built_in">uniq</span> -u  <span class="hljs-comment"># 不同</span><br>[root@xy ~]# <span class="hljs-built_in">cat</span> f1 f2 |<span class="hljs-built_in">sort</span> -u        <span class="hljs-comment"># 并集</span><br></code></pre></td></tr></table></figure><h3 id="文件目录管理命令">11. 文件目录管理命令</h3><h4 id="touch">11.1 touch</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>仅仅修改读取时间atime</td></tr><tr><td>-m</td><td>仅仅修改修改时间mtime</td></tr><tr><td>-d</td><td>都修改</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">ls</span> -l anaconda-ks.cfg  <br>  -rw-------. 1 root root 1024 Jul  6 05:36 anaconda-ks.cfg  <br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Visit the LinuxProbe.com to learn linux skills&quot;</span> &gt;&gt;anaconda-ks  <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -l anaconda-ks.cfg <br>  -rw-------. 1 root root 1071 Jul  6 12:18 anaconda-ks.cfg  <br>[root@xy ~]# <span class="hljs-built_in">touch</span> -d <span class="hljs-string">&quot;2018-07-06 05:36&quot;</span> anaconda-ks.cfg   <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -l anaconda-ks.cfg   <br>  -rw-------. 1 root root 1071 Jul  6 05:36 anaconda-ks.cfg<br></code></pre></td></tr></table></figure><h4 id="mkdir">11.2 mkdir</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">cd</span> /tmp <br>[root@xy tmp]# <span class="hljs-built_in">mkdir</span> diff  <br>[root@xy tmp]# <span class="hljs-built_in">cd</span> diff    <br>[root@xy diff]# <span class="hljs-built_in">mkdir</span> -p a/b/c/d/e 　　　 <span class="hljs-comment"># 递归创建目录  </span><br>[root@xy ~] <span class="hljs-built_in">mkdir</span> <span class="hljs-built_in">mkdir</span> -p base/&#123;<span class="hljs-built_in">cd</span>,fd&#125;  <span class="hljs-comment"># 创建多个同级目录   </span><br>[root@xy diff]# <span class="hljs-built_in">cd</span> a  <br>[root@xy a]# <br>[root@xy ~]# <span class="hljs-built_in">touch</span> install.log  <br>[root@xy ~]# <span class="hljs-built_in">ls</span>  <br>  anaconda-ks.cfg  Documents  initial-setup-ks.cfg  Music     Public     Videos  <br>  Desktop          Downloads  install.log           Pictures  Templates  <br>[root@anyue <span class="hljs-built_in">test</span>]# <span class="hljs-built_in">mkdir</span> -pv /testdir/dir1/&#123;x,y&#125;/&#123;a,b&#125;<br>  /testdir/<br>  └── dir1<br>      ├── x<br>      │   ├── a<br>      │   └── b<br>      └── y<br>          ├── a<br>          └── b<br>[root@anyue <span class="hljs-built_in">test</span>]# <span class="hljs-built_in">mkdir</span> -pv ./testdir/dir2/&#123;x/&#123;a,b&#125;,y&#125;<br>  ./testdir/dir2/<br>  ├── x<br>  │   ├── a<br>  │   └── b<br>  └── y<br>[root@anyue <span class="hljs-built_in">test</span>]# <span class="hljs-built_in">mkdir</span> -pv ./testdir/dir&#123;3,4,5/dir&#123;6,7&#125;&#125;<br>  <span class="hljs-built_in">mkdir</span>: created directory ‘./testdir/dir3’  <br>  <span class="hljs-built_in">mkdir</span>: created directory ‘./testdir/dir4’  <br>  <span class="hljs-built_in">mkdir</span>: created directory ‘./testdir/dir5’  <br>  <span class="hljs-built_in">mkdir</span>: created directory ‘./testdir/dir5/dir6’  <br>  <span class="hljs-built_in">mkdir</span>: created directory ‘./testdir/dir5/dir7’  <br>[root@anyue <span class="hljs-built_in">test</span>]# tree ./testdir/ <br>    <br>    ./testdir/<br>    ├── dir3<br>    ├── dir4<br>    └── dir5<br>        ├── dir6<br>        └── dir7<br></code></pre></td></tr></table></figure><h4 id="cp--a--r--v">11.3 cp (-a -r -v)</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>复制目录时使用,保留链接/文件属性/并复制目录下的所有内容,等于dpR参数组合</td></tr><tr><td>-r</td><td>复制该目录下所有的子目录和文件</td></tr><tr><td>-v</td><td>显示过程</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">cp</span> -a install.log x.log  <br>[root@xy ~]# <span class="hljs-built_in">ls</span><br>  anaconda-ks.cfg  Documents  initial-setup-ks.cfg  Music     Public     Videos  <br>  Desktop          Downloads  install.log           Pictures  Templates  x.log<br></code></pre></td></tr></table></figure><h4 id="mv">11.4 mv</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">mv</span> install.log linux.log <br>[root@xy ~]# <span class="hljs-built_in">ls</span>  <br>  anaconda-ks.cfg  Documents  initial-setup-ks.cfg  Music     Public     Videos  <br>  Desktop          Downloads  linux.log            Pictures  Templates  <br></code></pre></td></tr></table></figure><h4 id="rm">11.5 rm</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">rm</span> linux.log<br>  <span class="hljs-built_in">rm</span>: remove regular empty file ‘diff’? y  <br>[root@xy ~]# <span class="hljs-built_in">rm</span> -f linux.log              <span class="hljs-comment"># -f,强制删除文件或目录</span><br>  anaconda-ks.cfg  Documents  initial-setup-ks.cfg  Music     Public     Videos  <br>  Desktop          Downloads  Pictures              Templates  <br>[root@xy ~]# <span class="hljs-built_in">mkdir</span> diff  <br>[root@xy ~]# <span class="hljs-built_in">cd</span> diff  <br>[root@xy diff]# <span class="hljs-built_in">cd</span> -<br>  /root  <br>[root@xy ~]# <span class="hljs-built_in">rm</span> -rf diff  <span class="hljs-comment"># -r,递归处理，将指定目录下的所有文件与子目录一并处理</span><br>[root@xy ~]# <span class="hljs-built_in">ls</span>  <br>  anaconda-ks.cfg  Documents  initial-setup-ks.cfg  Pictures  Templates  <br>  Desktop          Downloads  Music                 Public    Video<br></code></pre></td></tr></table></figure><h4 id="dd-按照指定大小和个数的数据块复制文件或转换文件">11.6 dd按照指定大小和个数的数据块复制文件或转换文件</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>if</td><td>输入文件名称</td></tr><tr><td>of</td><td>输出文件名称</td></tr><tr><td>bs</td><td>设置块大小</td></tr><tr><td>count</td><td>设置复制块的个数</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=10_file bs=10M count=1<br>[root@xy ~]# <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/cdrom of=RHEL-server-7.0-x86_64.iso  <br>[root@xy ~]# file anaconda-ks.cfg  <br>  anaconda-ks.cfg: ASCII text<br></code></pre></td></tr></table></figure><h4 id="file">11.7 file</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# file /dev/sda  <br>  /dev/sda: block special <br></code></pre></td></tr></table></figure><h3 id="打包压缩与搜索命令">12. 打包压缩与搜索命令 <a id="tar"></a></h3><h4 id="tar">12.1 tar</h4><p><ahref="https://www.cnblogs.com/lhm166/articles/6604852.html">tar相关命令参考1</a></p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-c</td><td>创建压缩文档</td></tr><tr><td>-x</td><td>解开压缩文档</td></tr><tr><td>-t</td><td>查看压缩包内容</td></tr><tr><td>-z</td><td>用Gzip压缩/解压, *.tar.gz</td></tr><tr><td>-j</td><td>用bzip2压缩/解压, *.tar.bz2</td></tr><tr><td>-J</td><td>用xz压缩或解压</td></tr><tr><td>-v</td><td>显示压缩/解压过程</td></tr><tr><td>-f</td><td>目标文件名</td></tr><tr><td>-p</td><td>保留原文件的权限属性</td></tr><tr><td>-P</td><td>使用绝对路径来压缩</td></tr><tr><td>-C</td><td>指定目录</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy tmp]# tar -czvf diff.tar.gz /diff     <br>  diff/  <br>  diff/diff_A.txt  <br>  diff/diff_B.txt  <br>  diff/diff_B.txt~  <br>  diff/diff.tar.gz  <br>[root@xy diff]# tar -xzvf diff.tar.gz -C /diff    <span class="hljs-comment"># 指定解压目录 -C   </span><br>[root@xy diff]# tar -g /data/backup/snapshot -czvf /data/backup/2017.tar.gz *  <span class="hljs-comment"># -g 增量备份  </span><br>[root@xy diff]# tar -g /data/backup/snapshot -czvf /data/backup/2017-1.tar.gz *<br></code></pre></td></tr></table></figure><h4 id="grep-提取行-字符串搜索常用">12.2 grep # 提取行字符串搜索常用</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-n</td><td>显示行号</td></tr><tr><td>-i</td><td>忽略大小写</td></tr><tr><td>-v</td><td>反向选择，仅列出没有关键词的行</td></tr><tr><td>-c</td><td>仅显示找到的行数</td></tr><tr><td>-E</td><td>支持扩展正则</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# grep -n /sbin/nologin /etc/passwd<br>  1:bin:x:1:1:bin:/bin:/sbin/nologin  <br>  2:daemon:x:2:2:daemon:/sbin:/sbin/nologin  <br>  3:adm:x:3:4:adm:/var/adm:/sbin/nologin<br></code></pre></td></tr></table></figure><h4 id="find-文件搜索-实用">12.3 find # 文件搜索 实用</h4><img src="/posts/4ac0a166/find.jpg" class="" title="[find时间轴]"><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-name</td><td>匹配名称</td></tr><tr><td>-perm</td><td>匹配权限</td></tr><tr><td>-user</td><td>匹配所有者</td></tr><tr><td>-group</td><td>匹配所有组</td></tr><tr><td>-mtime -n +n</td><td>匹配修改内容的时间</td></tr><tr><td>-atime -n +n</td><td>匹配访问文件的时间</td></tr><tr><td>-nouser -nogroup</td><td>匹配没有所有者/所有组</td></tr><tr><td>-inum n</td><td>匹配节点编号</td></tr><tr><td>-maxdepth / -mindepth level</td><td>定义搜索深度</td></tr><tr><td>-exec 后续命令 {} dst ;</td><td>后可跟进 执行的命令</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# find /etc/ -name <span class="hljs-string">&quot;host*&quot;</span> -<span class="hljs-built_in">print</span><br>  /etc/avahi/hosts  <br>  /etc/host.conf  <br>  /etc/hosts  <br>  /etc/hosts.allow  <br>  /etc/hosts.deny  <br>  /etc/selinux/targeted/modules/active/modules/hostname.pp  <br>  /etc/hostname  <br>[root@xy ~]# find / -perm -4000 -<span class="hljs-built_in">print</span>    <span class="hljs-comment"># -perm 匹配权限     </span><br>  /usr/bin/fusermount  <br>  /usr/bin/su  <br>  /usr/bin/chage  <br>  /usr/bin/gpasswd  <br>  /usr/bin/newgrp  <br>[root@xy ~]# find /tmp \(-not -user root -a -not -name <span class="hljs-string">&#x27;f*&#x27;</span>\) -<span class="hljs-built_in">ls</span> <span class="hljs-comment"># 属主非root且不以f开头的文件  </span><br>[root@xy ~]# find /etc \(-path <span class="hljs-string">&quot;/etc/sane.d&quot;</span> -o -path <span class="hljs-string">&quot;/etc/fonts&quot;</span>\) -a -prune -o -name <span class="hljs-string">&quot;*.conf&quot;</span>   <span class="hljs-comment"># 查找etc下除了/etc/sane.d /etc/fonts 目录的所有.conf后缀的文件  </span><br><br>[root@xy ~]# find / -user xy -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">cp</span> -a &#123;&#125; /root/findresults/ \;    <br>[root@xy ~]# find linux-4.18.13/ -name <span class="hljs-string">&quot;*.c&quot;</span> -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">cat</span> &#123;&#125; \; |grep -v <span class="hljs-string">&quot;^$&quot;</span> |<span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure><h3 id="重定向操作符">13. 重定向操作符 <a id="director"></a></h3><blockquote><p><code>标准输入重定向</code>（STDIN, 文件描述符为 0）<br /><code>标准输出重定向</code>（STDOUT, 文件描述符为 1）<br /><code>错误输出重定向</code>（STDERR, 文件描述符为 2）</p></blockquote><ul><li>输入重定向 O-I<ul><li>命令 &lt; 文件<br /></li><li>命令 &lt;&lt; 分界符 <strong>遇见分界符为止</strong><br /></li><li>命令 &lt; 文件1 &gt; 文件2<strong>将文件1作为命令的标准输入并将标准输出到文件2</strong></li></ul></li><li>输出重定向 I-O<ul><li>命令 &gt; 文件 <strong>清空原有文件</strong><br /></li><li>命令 2&gt; 文件<br /></li><li>命令 &gt;&gt; 文件 <strong>追加到原有文件内容的后面</strong><br /></li><li>命令 2&gt;&gt; 文件</li><li>命令 &gt;&gt; 文件 2&gt;&amp;1<strong>将标准输出与错误输出共同写到文件</strong><br /></li><li>命令 &amp;&gt;&gt; 文件</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# man bash &gt; readme.txt  <br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Welcome to Linuxprobe.Com&quot;</span> &gt; readme.txt  <br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Quality linux learning materials&quot;</span> &gt;&gt; readme.txt   <br>[root@xy ~]# <span class="hljs-built_in">cat</span> readme.txt<br>  Welcome to anyue967.Com  <br>  Quality linux learning materials <br> <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -l xxxxxxx &gt; readme.txt <br>  <span class="hljs-built_in">ls</span>: cannot access xxxxxxx: No such file or directory  <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -l  xxxxxxx 2&gt; readme.txt <span class="hljs-comment">#2的用法      </span><br>[root@xy ~]# <span class="hljs-built_in">cat</span> readme.txt<br>  <span class="hljs-built_in">ls</span>: cannot access xxxxxxx: No such file or directory  <br>[root@xy ~]# <span class="hljs-built_in">wc</span> -l &lt; readme.txt  <br>  1      <br>[root@xy ~]# <span class="hljs-built_in">cat</span> readme.txt | <span class="hljs-built_in">wc</span> -l    <br>  1<br><br><span class="hljs-built_in">cat</span> &gt;&gt;README.txt &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">...</span><br><span class="hljs-string">EOF</span> <br><br><span class="hljs-built_in">ls</span> /data /noexist 2&gt;/root/out.log 1&gt;&amp;2<br><span class="hljs-built_in">ls</span> /data/ /noexist &gt;/root/out.log 2&gt;&amp;1<br><span class="hljs-built_in">ls</span> /data/ /noexist &amp;&gt;/root/out.log<br><span class="hljs-comment">#小测试</span><br>    A.cmd &amp;&gt;/dev/null<br>    B.cmd &gt;/dev/null 2&gt;&amp;1<br>    C.cmd 2&gt;&amp;1 &gt;/dev/null  ✔ <span class="hljs-comment">#屏幕显示错误信息,标准输出至/dev/null</span><br>    D.cmd 2&gt;/dev/null 1&gt;&amp;2<br></code></pre></td></tr></table></figure><h3 id="管道符">14. 管道符 |</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# grep <span class="hljs-string">&quot;/sbin/nologin&quot;</span> /etc/passwd |<span class="hljs-built_in">wc</span> -l  <br>  33  <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -l /etc/ |more<br>  total 1396  <br>  drwxr-xr-x.  3 root root       97 Jul  6 05:01 abrt  <br>  -rw-r--r--.  1 root root       16 Jul  6 05:33 adjtime  <br>  -rw-r--r--.  1 root root     1518 Jun  7  2013 aliases  <br>  .......省略部分输出内容.......  <br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;19937100xy&quot;</span> |passwd --stdin root    <br>  Changing password <span class="hljs-keyword">for</span> user root.  <br>  passwd: all authentication tokens updated successfully.  <br>[root@xy ~]# <span class="hljs-built_in">who</span> |<span class="hljs-built_in">tee</span> -a /test/who.log  <span class="hljs-comment"># tee 命令</span><br></code></pre></td></tr></table></figure><h3 id="命令行的通配符">15. 命令行的通配符 * [] ?</h3><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>*</td><td>任意长度的任意字符</td></tr><tr><td>?</td><td>任意单个字符</td></tr><tr><td>[0-9]</td><td>匹配0~9之间的单个数字的字符</td></tr><tr><td>[abc]</td><td>匹配a、b、c三个字符中个任意一个</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">touch</span> &#123;a..z&#125;.txt <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -l /dev/sda*  <br>  brw-rw----. 1 root disk 8, 0 Jul  6  2018 /dev/sda  <br>  brw-rw----. 1 root disk 8, 1 Jul  6  2018 /dev/sda1  <br>  brw-rw----. 1 root disk 8, 2 Jul  6  2018 /dev/sda2  <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -l /dev/sda?  <br>  brw-rw----. 1 root disk 8, 1 Jul  6  2018 /dev/sda1  <br>  brw-rw----. 1 root disk 8, 2 Jul  6  2018 /dev/sda2  <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -l /dev/sda[0-9]  <br>  brw-rw----. 1 root disk 8, 1 Jul  6  2018 /dev/sda1  <br>  brw-rw----. 1 root disk 8, 2 Jul  6  2018 /dev/sda2<br></code></pre></td></tr></table></figure><h3 id="常用的转义字符">16. 常用的转义字符</h3><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>\</td><td>使反斜杠后的一个变量变为单纯的字符串</td></tr><tr><td>’’</td><td>转义其中所有的变量为单纯的字符串</td></tr><tr><td>“”</td><td>保留其中的变量属性,不进行转义处理</td></tr><tr><td>``</td><td>命令执行后并返回结果</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# PRICE=5<br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Price is <span class="hljs-variable">$PRICE</span>&quot;</span>        　　<span class="hljs-comment"># $ 取变量的值</span><br>  Price is 5  <br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Price is $<span class="hljs-variable">$PRICE</span>&quot;</span>  <br>  Price is 7982PRICE  <br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Price is \$<span class="hljs-variable">$PRICE</span>&quot;</span> <br>  Price is <span class="hljs-variable">$5</span>  <br>[root@xy ~]# <span class="hljs-built_in">echo</span> `<span class="hljs-built_in">uname</span> -a` 　　              <span class="hljs-comment"># 执行命令返回结果</span><br>  Linux xy.com 3.10.0-123.el7.x86_64 <span class="hljs-comment">#1 SMP Mon May 5 11:16:57 EDT 2014 x86_64 x86_64 x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure><h3 id="重要的环境变量">17. 重要的环境变量</h3><table><thead><tr><th>系统变量</th><th>说明</th></tr></thead><tbody><tr><td>HOME</td><td>—</td></tr><tr><td>SHELL</td><td>—</td></tr><tr><td>HISTSIZE</td><td>—</td></tr><tr><td>HISTFILESIZE</td><td>—</td></tr><tr><td>MAILL</td><td>—</td></tr><tr><td>LANG</td><td>—</td></tr><tr><td>RANDOM</td><td>—</td></tr><tr><td>PS1</td><td>—</td></tr><tr><td>PATH</td><td>—</td></tr><tr><td>EDITOR</td><td>—</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">touch</span> xy.txt<br>[root@xy ~]# <span class="hljs-built_in">ls</span>  <br>  anaconda-ks.cfg  Documents  initial-setup-ks.cfg  Pictures  readme.txt  Videos  <br>  Desktop          Downloads  Music                 Public    Templates   xy.txt  <br>[root@xy ~]# <span class="hljs-built_in">rm</span> xy.txt  <br>  <span class="hljs-built_in">rm</span>: remove regular empty file ‘xy.txt’?  y  <br>[root@xy ~]# <span class="hljs-built_in">alias</span> <span class="hljs-built_in">rm</span>          　　<span class="hljs-comment">#alias 的用法  </span><br>  <span class="hljs-built_in">alias</span> <span class="hljs-built_in">rm</span>=<span class="hljs-string">&#x27;rm -i&#x27;</span>                 <span class="hljs-comment">#inter  </span><br>[root@xy ~]# <span class="hljs-built_in">unalias</span> <span class="hljs-built_in">rm</span>          　<span class="hljs-comment">#unalias 的用法  </span><br>[root@xy ~]# <span class="hljs-built_in">rm</span> xy.txt<br>[root@xy ~]# <span class="hljs-built_in">alias</span> <span class="hljs-built_in">rm</span>=<span class="hljs-string">&#x27;mv -t /data&#x27;</span>   <span class="hljs-comment">#-t -target-directory</span><br><br><span class="hljs-comment"># export # 变量名, 提升变量为全局变量   </span><br>[root@xy <span class="hljs-built_in">test</span>]# <span class="hljs-built_in">type</span> -a <span class="hljs-literal">true</span>   <span class="hljs-comment">#type 命令名称 内部还是外部   </span><br>  <span class="hljs-literal">true</span> is a shell <span class="hljs-built_in">builtin</span>  <br>  <span class="hljs-literal">true</span> is /bin/true  <br>  <span class="hljs-literal">true</span> is /usr/bin/true  <br>[root@xy <span class="hljs-built_in">test</span>]# <span class="hljs-built_in">type</span> <span class="hljs-literal">true</span>  <br>  <span class="hljs-literal">true</span> is a shell <span class="hljs-built_in">builtin</span>  <br>[root@xy <span class="hljs-built_in">test</span>]# <span class="hljs-built_in">env</span>   <span class="hljs-comment">#env  查看所有的环境变量  </span><br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span>  <br>/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin:/bin:/sbin   <br>[root@xy ~]# PATH=<span class="hljs-variable">$PATH</span>:/root/bin      <span class="hljs-comment">#增加PATH   </span><br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin:/bin:/sbin:　<span class="hljs-comment"># /root/bin</span><br></code></pre></td></tr></table></figure><h3 id="配置主机名">19. 配置主机名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# vim /etc/hostname  <br>  xy.com  <br>[root@xy ~]# hostname<br>  xy.com<br></code></pre></td></tr></table></figure><h3 id="配置网卡信息">20. 配置网卡信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">cd</span> /etc/sysconfig/network-scripts/  <br>[root@xy network-scripts]# <span class="hljs-built_in">ls</span> <br>  ifcfg-eno16777736  　ifdown-ppp      　ifup-eth     ifup-sit    <br>  ifcfg-lo             ifdown-routes    ifup-ippp    ifup-Team  <br>  ifdown               ifdown-sit       ifup-ipv6    ifup-TeamPort  <br>  ifdown-bnep          ifdown-Team      ifup-isdn    ifup-tunnel   <br>[root@xy network-scripts]# vim  ifcfg-eno16777736  　<span class="hljs-comment"># RHEL5，6 ifcfg-eth  </span><br>  TYPE=Ethernet  <br>  BOOTPROTO=static  <br>  NAME=eno16777736  <br>  ONBOOT=<span class="hljs-built_in">yes</span>  <br>  HWADDR=00:0C:29:11:26:05  <br>  IPADDR0=192.168.37.10  <br>  PREFIX0=24  <br>  GATEWAY0=192.168.37.1  <br>  DNS1=192.168.37.1  <br>[root@xy network-scripts]# systemctl restart network <br>[root@xy network-scripts]# ping 192.168.37.10 <br>[root@xy ~]# dmesg |grep -i eno<span class="hljs-comment"># 查看网卡模块  </span><br>[root@xy ~]# modprobe -r e1000<span class="hljs-comment"># 卸载网卡模块  </span><br>[root@xy ~]# modprobe e1000<span class="hljs-comment"># 装载网卡模块</span><br></code></pre></td></tr></table></figure><h3 id="配置yum软件仓库">21. 配置Yum软件仓库 <a id="yumku"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ]# vim /etc/yum.repos.d/rhel7.repo <span class="hljs-comment"># 创建本地yum源 </span><br>  [rhel-media]  <br>  name=xy  <br>  baseurl=file:///media/cdromfile:ftp://file:http://file:///  <br>  enabled=1   　<span class="hljs-comment"># 启用         </span><br>  gpgcheck=1  <br>  gpgkey=file:///media/cdrom/RPM-GPG-KEY-redhat-release  <br><br>[root@xy yum.repos.d]# <span class="hljs-built_in">mkdir</span> -p /media/cdrom  <br>[root@xy yum.repos.d]# mount /dev/cdrom /media/cdrom   　<span class="hljs-comment"># mount 设备 挂载目录 </span><br>  mount: /dev/sr0 is write-protected,mounting read-only  <br><br>[root@xy yum.repos.d]# vim /etc/fstab   <br>  /dev/cdrom /media/cdrom iso9660 default 0 0   <span class="hljs-comment"># fstab 文件写法</span><br>[root@xy yum.repos.d]# yum install httpd  　<span class="hljs-comment"># 测试  </span><br>  Dependencies Resolved  <br>  ........省略部分信息........  <br>  Install  1 Package (+4 Dependent packages)  <br>  ........省略部分信息........  <br>  Is this ok [y/d/N]: y          <br>  ........省略部分信息........ <br>  Complete!<br></code></pre></td></tr></table></figure><h3 id="编写简单的shell脚本">22. 编写简单的shell脚本<a id="shell"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 执行成功返回值：0，否则返回值为非 0 数字</span><br>[root@xy <span class="hljs-built_in">test</span>]# vim example.sh    <span class="hljs-comment"># bash -n file.sh 检测语法错误</span><br>  <span class="hljs-comment">#!/bin/bash  </span><br>  <span class="hljs-comment">#For Example BY xy.com  </span><br>  <span class="hljs-built_in">pwd</span>  <br>  <span class="hljs-built_in">ls</span> -al  <br>[root@xy <span class="hljs-built_in">test</span>]# bash example.sh  <br>  /root/test  <br>  total 8  <br>  drwxr-xr-x.  2 root root   23 Jul  7 18:29 .  <br>  dr-xr-x---. 15 root root 4096 Jul  7 18:29 ..  <br>  -rw-r--r--.  1 root root   46 Jul  7 18:29 example.sh  <br>[root@xy ShellExample]# ./example01.sh<br>  -bash: ./example01.sh: Permission denied  <br>[root@xy ShellExample]# <span class="hljs-built_in">chmod</span> u+x example01.sh<br></code></pre></td></tr></table></figure><h3 id="接收用户的参数">23. 接收用户的参数</h3><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>$0</td><td>对应当前Shell脚本名称</td></tr><tr><td>$#</td><td>对应总共有几个参数</td></tr><tr><td>$*</td><td>对应所有位置参数值</td></tr><tr><td>$?</td><td>对应显示上一次命令的执行返回值</td></tr><tr><td>$1 /$2 /$3</td><td>对应第N个位置的参数值</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy <span class="hljs-built_in">test</span>]# vim example02.sh <br>  <span class="hljs-comment">#!/bin/bash  </span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;当前脚本名称为<span class="hljs-variable">$0</span>&quot;</span><span class="hljs-comment"># $0 当前Shell脚本名称 </span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;总共有<span class="hljs-variable">$#</span>个参数,分别是$*.&quot;</span><span class="hljs-comment"># $# 参数个数</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第一个参数为<span class="hljs-variable">$1</span>,第五个参数为<span class="hljs-variable">$5</span>.&quot;</span><span class="hljs-comment"># $ 所以位置的参数值  </span><br>[root@xy <span class="hljs-built_in">test</span>]# sh example02.sh one two three four five six  <br>  当前脚本名称为example02.sh  <br>  总共有6个参数,分别是one two three four five six.<br>  第一个参数为one,第五个参数为five.<br></code></pre></td></tr></table></figure><h3 id="判断用户的参数">24. 判断用户的参数</h3><h4 id="文件">24.1 文件</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-d</td><td>测试文件是否为目录类型</td></tr><tr><td>-e</td><td>测试文件是否存在</td></tr><tr><td>-f</td><td>判断文件是否为一般文件</td></tr><tr><td>-r</td><td>测试当前用户是否有读权限</td></tr><tr><td>-w</td><td>当前用户是否有写权限</td></tr><tr><td>-x</td><td>当前用户是否有执行权限</td></tr><tr><td>$?</td><td>显示上一次命令的执行返回值</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# [ -d /etc/fstab ]<span class="hljs-comment"># 测试文件是否为目录类型</span><br>[root@xy ~]# <span class="hljs-built_in">echo</span> $?<br>  1        <br>[root@xy ~]# [ -f /etc/fstab ]<span class="hljs-comment"># 判断是否为一般文件    </span><br>[root@xy ~]# <span class="hljs-built_in">echo</span> $?   <br>  0        <br>[root@xy ~]# [ -e /dev/cdrom ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Exist&quot;</span><span class="hljs-comment"># 当前面执行成功则执行后面，整个表达式返回值 为 0 </span><br>  Exist    <br>[root@xy ~]# su - xy    <br>[xy@xy ~]$ [ <span class="hljs-variable">$USER</span> = root ] || <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;user&quot;</span><span class="hljs-comment"># 当前执行失败则执行后面  </span><br>user  <br>[xy@xy ~]$ <span class="hljs-built_in">exit</span> <br>  <span class="hljs-built_in">logout</span>  <br>[root@xy ~]# [ ! <span class="hljs-variable">$USER</span> = root ] || <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;administrator&quot;</span><br>  administrator<br></code></pre></td></tr></table></figure><h4 id="数字">24.2 数字</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-eq</td><td>是否相等</td></tr><tr><td>-ne</td><td>是否不等于</td></tr><tr><td>-gt</td><td>是否大于</td></tr><tr><td>-lt</td><td>是否小于</td></tr><tr><td>-le</td><td>是否等于/小于</td></tr><tr><td>-ge</td><td>是否等于/大于</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# [ 10 -gt 10 ]    <br>[root@xy ~]# <span class="hljs-built_in">echo</span> $? <br>  1     <br>[root@xy ~]# [ 10 -eq 10 ]    <br>[root@xy ~]# <span class="hljs-built_in">echo</span> $? <br>  0    <br>[root@xy ~]# free -m  <br>             total       used       free     shared    buffers     cached  <br>Mem:          1987       1197        789          9          0        280  <br>-/+ buffers/cache:        916       1071  <br>Swap:         2063          0       2063  <br>[root@xy ~]# free -m | grep Mem:  <br>Mem:          1987       1198        789          9          0        280  <br>[root@xy ~]# free -m |grep Mem: |awk <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span>  <br>789  <br>[root@xy ~]# FreeMem=`free -m |grep Mem: |awk <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span>`<br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-variable">$FreeMem</span>  <br>789  <br>[root@xy ~]# [ <span class="hljs-variable">$FreeMem</span> -lt 1024 ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Insufficient Memory&quot;</span>  <br>Insufficient Memory<br></code></pre></td></tr></table></figure><h4 id="字符串">24.3 字符串</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>=</td><td><strong>比较字符串内容是否相同</strong></td></tr><tr><td>!=</td><td><strong>比较字符串内容是否不同</strong></td></tr><tr><td>-z</td><td><strong>判断字符串内容是否为空</strong></td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# [ -z <span class="hljs-variable">$String</span> ] <br>[root@xy ~]# <span class="hljs-built_in">echo</span> $?<br>  0    <br>[root@xy ~]# <span class="hljs-built_in">echo</span> <span class="hljs-variable">$LANG</span> <br>  en_US.UTF-8  <br>[root@xy ~]# [ <span class="hljs-variable">$LANG</span> != <span class="hljs-string">&quot;en.US&quot;</span> ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Not en.US&quot;</span> <br>  Not en.US<br></code></pre></td></tr></table></figure><h3 id="流程控制语句">25. 流程控制语句</h3><h4 id="if条件测试语句">25.1 if条件测试语句</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy <span class="hljs-built_in">test</span>]# vim mkcdrom.sh  <br>  <span class="hljs-comment">#!/bin/bash  </span><br>  DIR=<span class="hljs-string">&quot;/media/cdrom&quot;</span>  <br>  <span class="hljs-keyword">if</span> [ ! -e <span class="hljs-variable">$DIR</span> ]; <span class="hljs-keyword">then</span>  <br>   <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$DIR</span>  <br>  <span class="hljs-keyword">fi</span>  <br>[root@xy <span class="hljs-built_in">test</span>]# bash mkcdrom.sh   <br>[root@xy <span class="hljs-built_in">test</span>]# <span class="hljs-built_in">ls</span> -d /media/cdrom/ <br>  /media/cdrom/  <br>[root@xy <span class="hljs-built_in">test</span>]# vim chkhost.sh <br>[root@xy <span class="hljs-built_in">test</span>]# bash mkcdrom.sh<br>---<br><br>[root@xy <span class="hljs-built_in">test</span>]# vim chkhost.sh<br>  <span class="hljs-comment">#!/bin/bash  </span><br>  ping -c 3 -i 0.2 -W 3 <span class="hljs-variable">$1</span> &amp;&gt; /dev/null   <span class="hljs-comment"># /dev/null 没有回收功能的垃圾箱  </span><br>  <span class="hljs-keyword">if</span> [ $? -eq 0 ]<br>  <span class="hljs-keyword">then</span>  <br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Host <span class="hljs-variable">$1</span> is On-line.&quot;</span>  <br>  <span class="hljs-keyword">else</span>  <br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Host <span class="hljs-variable">$1</span> is Off-line.&quot;</span>  <br>  <span class="hljs-keyword">fi</span>  <br>[root@xy <span class="hljs-built_in">test</span>]# bash chkhost.sh 192.168.37.10  <br>  Host 192.168.37.10 is On-line.  <br>[root@xy <span class="hljs-built_in">test</span>]# bash chkhost.sh 192.168.37.20  <br>  Host 192.168.37.20 is Off-line. <br>---<br><br>[root@xy <span class="hljs-built_in">test</span>]# vim chkscore.sh<br>  <span class="hljs-comment">#!/bin/bash  </span><br>  <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Enter your score (0-100):&quot;</span> GRADE  <br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$GRADE</span> -ge 85 ] &amp;&amp; [ <span class="hljs-variable">$GRADE</span> -le 100 ]; <span class="hljs-keyword">then</span>  <br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$GRADE</span> is Excellent&quot;</span>  <br>  <span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$GRADE</span> -ge 70 ] &amp;&amp; [ <span class="hljs-variable">$GRADE</span> -le 84 ]; <span class="hljs-keyword">then</span>  <br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$GRADE</span> is Pass&quot;</span>  <br>  <span class="hljs-keyword">else</span>  <br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$GRADE</span> is Fail&quot;</span>  <br>  <span class="hljs-keyword">fi</span>  <br>[root@xy <span class="hljs-built_in">test</span>]# bash chkscore.sh  <br>  Enter your score (0-100): 88  <br>  88 is Excellent<br></code></pre></td></tr></table></figure><h4 id="for条件循环语句for-变量名-in-取值列表-do-命令序列-done">26.2for条件循环语句(for 变量名 in 取值列表 do 命令序列 done)</h4><p><strong>说明:/dev/null是一个被称作Linux黑洞的文件,把输出信息重定向到这个文件等同于删除数据(类似于没有回收功能的垃圾箱),可以让用户的屏幕窗口保持清洁.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy <span class="hljs-built_in">test</span>]# vim users.txt  <br>  andy  <br>  barry  <br>  carll  <br>  duck  <br>[root@xy <span class="hljs-built_in">test</span>]# vim usersadd.sh <br>  <span class="hljs-comment">#!/bin/bash  </span><br>  <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Enter The Users Password:&quot;</span> PASSWD<span class="hljs-comment">#read 读取用户输入信息  </span><br>  <span class="hljs-keyword">for</span> UNAME <span class="hljs-keyword">in</span> `<span class="hljs-built_in">cat</span> users.txt`<span class="hljs-comment">#$(cat users.txt)</span><br>  <span class="hljs-keyword">do</span>  <br>    <span class="hljs-built_in">id</span> <span class="hljs-variable">$UNAME</span> &amp;&gt; /dev/null                      <span class="hljs-comment">#id 用户名</span><br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>  <br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Already exists&quot;</span>  <br>    <span class="hljs-keyword">else</span>  <br>        useradd <span class="hljs-variable">$UNAME</span> &amp;&gt; /dev/null   <br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PASSWD</span>&quot;</span> | passwd --stdin <span class="hljs-variable">$UNAME</span> &amp;&gt; /dev/null  <br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>  <br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$UNAME</span> , Create success&quot;</span>  <br>    <span class="hljs-keyword">else</span>  <br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$UNAME</span> , Create failure&quot;</span>  <br>    <span class="hljs-keyword">fi</span>  <br>    <span class="hljs-keyword">fi</span>  <br>  <span class="hljs-keyword">done</span>  <br>[root@xy <span class="hljs-built_in">test</span>]# bash usersadd.sh  <br>  Enter The Users Password: 19937100xy  <br>  andy ,Create success  <br>  barry ,Create success  <br>  carl ,Create success  <br>  duck ,Create success  <br>[root@xy <span class="hljs-built_in">test</span>]# <span class="hljs-built_in">tail</span> -6 /etc/passwd <br>  andy:x:1001:1001::/home/andy:/bin/bash  <br>  barry:x:1002:1002::/home/barry:/bin/bash  <br>  carl:x:1003:1003::/home/carl:/bin/bash  <br>  duck:x:1004:1004::/home/duck:/bin/bash<br>---<br><br>[root@xy <span class="hljs-built_in">test</span>]# vim ipadds.txt  <br>  192.168.37.10  <br>  192.168.37.11  <br>  192.168.37.12  <br>[root@xy <span class="hljs-built_in">test</span>]# vim CheckHosts.sh <br>  <span class="hljs-comment">#!/bin/bashHLIST=$(cat ~/ipadds.txt)  </span><br>  <span class="hljs-keyword">for</span> IP <span class="hljs-keyword">in</span> `<span class="hljs-built_in">cat</span> ipadds.txt`<span class="hljs-comment"># for IP in $HLIST </span><br>  <span class="hljs-keyword">do</span><br>      ping -c 3 -i 0.2 -W 3 <span class="hljs-variable">$IP</span> &amp;&gt; /dev/null  <br>      <span class="hljs-keyword">if</span> [ $? -eq 0 ] ; <span class="hljs-keyword">then</span><br>          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Host <span class="hljs-variable">$IP</span> is On-line.&quot;</span>   <br>      <span class="hljs-keyword">else</span>   <br>          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Host <span class="hljs-variable">$IP</span> is Off-line.&quot;</span>  <br>      <span class="hljs-keyword">fi</span>  <br>  <span class="hljs-keyword">done</span>  <br>[root@xy <span class="hljs-built_in">test</span>]# bash CheckHosts.sh   <br>  Host 192.168.37.10 is On-line.  <br>  Host 192.168.37.11 is Off-line.  <br>  Host 192.168.37.12 is Off-line.<br></code></pre></td></tr></table></figure><h4 id="while条件循环语句while-条件测试操作-do-命令序列-done">26.3while条件循环语句(while 条件测试操作 do 命令序列 done)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy <span class="hljs-built_in">test</span>]# vim Guess.sh  <br>  <span class="hljs-comment">#!/bin/bash  </span><br>  PRICE=$(<span class="hljs-built_in">expr</span> <span class="hljs-variable">$RANDOM</span> % 1000)  <br>  TIMES=0  <br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;商品的实际价格在0-999之间,猜猜看是多少?&quot;</span>  <br>  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>  <br>  <span class="hljs-keyword">do</span>  <br>      <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入您猜测的价格:&quot;</span> INT  <br>      <span class="hljs-built_in">let</span> TIMES++  <br>      <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$INT</span> -eq <span class="hljs-variable">$PRICE</span> ] ; <span class="hljs-keyword">then</span>  <br>          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;恭喜您答对了,实际价格是 <span class="hljs-variable">$PRICE</span>&quot;</span>  <br>          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;您总共猜测了 <span class="hljs-variable">$TIMES</span> 次&quot;</span>  <br>          <span class="hljs-built_in">exit</span> 0  <br>      <span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$INT</span> -gt <span class="hljs-variable">$PRICE</span> ] ; <span class="hljs-keyword">then</span>  <br>          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;太高了!&quot;</span>  <br>      <span class="hljs-keyword">else</span>  <br>          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;太低了!&quot;</span>  <br>      <span class="hljs-keyword">fi</span>  <br>  <span class="hljs-keyword">done</span>  <br></code></pre></td></tr></table></figure><h4 id="case条件测试语句">26.4 case条件测试语句</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ShellExample]# vim checkkeys.sh <br>  <span class="hljs-comment">#!/bin/bash  </span><br>  <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入一个字符，并按Enter键确认：&quot;</span> KEY  <br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$KEY</span>&quot;</span> <span class="hljs-keyword">in</span>  <br>  [a-z] | [A-Z])  <br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;您输入的是<span class="hljs-variable">$KEY</span>字母。&quot;</span>  <br>      ;;  <br>  [0-9])  <br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;您输入的是<span class="hljs-variable">$KEY</span>数字。&quot;</span>  <br>      ;;  <br>  *)  <br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;您输入的是空格、功能健或其他控制字符。&quot;</span> <br>      ;; <br>  <span class="hljs-keyword">esac</span>  <br>[root@xy ShellExample]# bash checkkeys.sh  <br>  请输入一个字符，并按Enter键确认：4  <br>  您输入的是4数字。<br></code></pre></td></tr></table></figure><h4 id="计划任务服务程序-一次性长期性计划任务">27. 计划任务服务程序(一次性、长期性计划任务) <a id="corntab"></a></h4><img src="/posts/4ac0a166/crontab.png" class="" title="[crontab]"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">1 <span class="hljs-comment"># Example of job definition:  </span><br>2 <span class="hljs-comment"># .---------------- minute (0 - 59)  </span><br>3 <span class="hljs-comment"># |  .------------- hour (0 - 23)  </span><br>4 <span class="hljs-comment"># |  |  .---------- day of month (1 - 31)  </span><br>5 <span class="hljs-comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...  </span><br>6 <span class="hljs-comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR   sun,mon,tue,wed,thu,fri,sat  </span><br>7 <span class="hljs-comment"># |  |  |  |  |</span><br>8 <span class="hljs-comment"># *  *  *  *  * user-name command to be executed </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# at 23:30  <br>  at &gt; systemctl restart httpd<span class="hljs-comment">#echo &quot;systemctl restart httpd&quot; |at 23:30 </span><br>  at &gt; 此处按下Ctrl+d 组合键来结束编写任务计划  <br>  job 3 at Mon Apr 27 23:30:00 2017 <br>[root@xy ~]# at -l                 <span class="hljs-comment">#查看一次性计划任务   </span><br>  3 Mon Apr 27 23:30:00 2017 a root<br>[root@xy ~]# at -d 3               <span class="hljs-comment"># 同 atrm</span><br>---<br><br>[root@xy ~]# crontab -e   <br>[root@xy ~]# crontab -l     　<span class="hljs-comment"># crontab - l 查看  crontab -r 删除</span><br>  00 3 * * * <span class="hljs-built_in">cp</span> /var/log/alternatives.log /home/shiyanlou/tmp/$(<span class="hljs-built_in">date</span> +%F)   <br>  25  3  *  * 1,3,5 /usr/bin/tar -czvf backup.tar.gz /home/wwwroot  <br>  分  时 日 月 周    任务     <span class="hljs-comment"># 没有设置的用*占位，表示每  </span><br><br><span class="hljs-comment"># 注:分字段必须有, 每分钟用* 或者 */1表示; 日、周不能同时有,否则会冲突 </span><br><br>[root@xy ~]# whereis <span class="hljs-built_in">rm</span>       　<span class="hljs-comment"># whereis 命令 查询命令所在路径</span><br>  <span class="hljs-built_in">rm</span>: /usr/bin/rm /usr/share/man/man1/rm.1.gz /usr/share/man/man1p/rm.1p.gz  <br>[root@xy ~]# crontab -e  <br>  crontab: installing new crontab  <br>[root@xy ~]# crontab -l  <br>  25 3 * * 1,3,5 /usr/bin/tar -czvf backup-tar.gz /home/wwwroot  <br>  0 1 * * 1-5 /usr/bin/rm -rf /tmp/*<br></code></pre></td></tr></table></figure><h3 id="用户身份">28. 用户身份</h3><h4 id="相关文件">相关文件:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/passwd <br>用户名  :密码标识位   :UID  :GID  :组名   :家目录  :shell     <br><br>/etc/shadow            <br>用户名 :MD5paswd :密码修改时间(19700101) :两次修改密码时间间隔 :密码有效期 :密码到期前的警告天数  :密码过期后的宽限天数  :密码失效时间 <br><br>/etc/group  /etc/gshadow /etc/skel<br>  root:x:0:<br>  组名:密码:GID:附加组  <br></code></pre></td></tr></table></figure><h4 id="useradd">28.1 useradd:</h4><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-u</td><td><strong>指定该用户默认UID</strong></td></tr><tr><td>-g</td><td><strong>指定一个初始用户基本组,须存在</strong></td></tr><tr><td>-G</td><td>指定附加组, 须存在</td></tr><tr><td>-d</td><td><strong>指定用户家目录(默认/home/username)</strong></td></tr><tr><td>-s</td><td><strong>指定该用户默认Shell解释器</strong></td></tr><tr><td>-m</td><td>创建家目录, 用于系统用户</td></tr><tr><td>-M</td><td>不创建家目录, 用于非系统用户</td></tr><tr><td>-r</td><td>设置系统账号 #不会自动生成家目录</td></tr><tr><td>-c,comment</td><td>描述信息</td></tr><tr><td>-e,expire_date</td><td>账户到期时间(YYYY-MM-DD)</td></tr></tbody></table><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>-u -g -G -n</td></tr><tr><td>finger</td><td>username</td></tr><tr><td>chsh</td><td>修改shell</td></tr><tr><td>chfn</td><td>修改注释信息</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# getent shadow xy   <span class="hljs-comment"># getent passwd xy  </span><br>[root@xy ~]# useradd -d /home/xy -u 8888 -s /sbin/nologin xy    <br>[root@xy ~]# <span class="hljs-built_in">id</span> xy         <br>uid=8888(xy) gid=8888(xy) <span class="hljs-built_in">groups</span>=8888(xy)<br></code></pre></td></tr></table></figure><h4 id="passwd">28.2 passwd</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>--stdin 允许标准输入改密码</td><td><code>echo "NewPassWord" | passwd --stdin Username</code></td></tr><tr><td>-l</td><td>锁定用户</td></tr><tr><td>-u</td><td>解锁用户</td></tr><tr><td>-e</td><td>使用户密码立即过期,下次登录强制修改密码</td></tr><tr><td>-d</td><td>使该用户可以用空密码登陆系统</td></tr><tr><td>-n</td><td>设置修改密码的最短天数</td></tr><tr><td>-x</td><td>设置修改密码的最长天数</td></tr><tr><td>-k</td><td>为密码已经过期的用户更新有效期</td></tr><tr><td>-w</td><td>设置密码过期前告警的天数</td></tr><tr><td>-i</td><td>设置密码过期后多少天禁用该用户</td></tr><tr><td>-S</td><td>显示用户密码相关描述</td></tr></tbody></table><table><thead><tr><th>chage</th><th>修改用户密码策略</th></tr></thead><tbody><tr><td>-d</td><td>最近一次修改时间</td></tr><tr><td>-E</td><td>过期时间</td></tr><tr><td>-I</td><td>非活动时间</td></tr><tr><td>-m</td><td>最短使用期限</td></tr><tr><td>-M</td><td>最长使用期限</td></tr><tr><td>-w</td><td>警告时间</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# passwd xy <br>  Changing password <span class="hljs-keyword">for</span> user xy.  <br>  New password:   <br>  Retype new password:  <br>  asswd: all authentication tokens updated successfully.   <br>[root@xy ~]# passwd -l xy <br>  Locking password <span class="hljs-keyword">for</span> user xy.  <br>  passwd: Success  <br>[root@xy ~]# passwd -u xy<br>  Unlocking password <span class="hljs-keyword">for</span> user xy.  <br>  passwd: Success  <br>[root@xy ~]# passwd -S xy   <span class="hljs-comment"># -S --ststus</span><br>  xy PS 2018-07-06 0 99999 7 -1 (Password <span class="hljs-built_in">set</span>, SHA512 crypt.)  <br>[root@xy ~]# passwd -n 7 -x 60 -w 10 -i 30 xy  <span class="hljs-comment"># 7天内不能更改密码，60天后必须改密，过期前10天通知，过期后30天禁用该用户  </span><br>[root@xy ~]# groupadd ronny               <span class="hljs-comment"># groupadd -g ID    groupdel    </span><br>[root@xy ~]# gpasswd -a / -d user group   <span class="hljs-comment"># 把用户从组中加入/删除</span><br></code></pre></td></tr></table></figure><h4 id="userdel">28.3 userdel</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-f</td><td>强制删除用户</td></tr><tr><td>-r</td><td>同时删除用户及家目录</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">id</span> xy  <br>  uid=8888(xy) gid=1000(xy) <span class="hljs-built_in">groups</span>=1000(xy),0(root)  <br>[root@xy ~]# userdel -r xy  <br>[root@xy ~]# <span class="hljs-built_in">id</span> xy<br>  <span class="hljs-built_in">id</span>: xy: no user  <br></code></pre></td></tr></table></figure><h4 id="usermod">28.4 usermod</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-u</td><td><strong>修改用户UID</strong></td></tr><tr><td>-g</td><td><strong>修改用户初始组</strong></td></tr><tr><td>-aG</td><td><strong>修改用户附加组,追加不覆盖</strong></td></tr><tr><td>-l</td><td>修改用户名</td></tr><tr><td>-s</td><td><strong>变更默认终端</strong></td></tr><tr><td>-c,--comment</td><td><strong>填写用户备注信息</strong></td></tr><tr><td>-d -m</td><td><strong>重新指定用户的家目录并自动迁移数据</strong></td></tr><tr><td>-e,–expire_date</td><td><strong>账户到期时间(YYYY-MM-DD)</strong></td></tr><tr><td>-L,–Lock</td><td><strong>锁定用户禁止登陆系统</strong></td></tr><tr><td>-U,–Unlock</td><td><strong>解锁用户,允许登陆系统</strong></td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# usermod -aG root xy  <span class="hljs-comment"># 用户xy追加附加组root  </span><br>[root@xy ~]# <span class="hljs-built_in">id</span> xy  <br>  uid=1000(xy) gid=1000(xy) <span class="hljs-built_in">groups</span>=1000(xy),0(root)<br>[root@xy ~]# usermod -u 8888 xy  <br>[root@xy ~]# <span class="hljs-built_in">id</span> xy<br>  uid=8888(xy) gid=1000(xy) <span class="hljs-built_in">groups</span>=1000(xy),0(root)<br>[root@xy ~]# gpasswd -a xy root<br>[root@xy ~]# gpasswd -d xy root<br></code></pre></td></tr></table></figure><h4 id="chmod">28.5 chmod</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">who</span>: u g o a<br>opt: + - =<br>per: r=4 w=2 x=1<span class="hljs-comment">#r,可浏览文件列表; w,可创建删除文件; x,访问目录的内容;</span><br><br><span class="hljs-comment">#umask </span><br><span class="hljs-built_in">umask</span>: 0002 (掩码)<br>目录: 777=<span class="hljs-built_in">umask</span>+default<br>文件: 666=<span class="hljs-built_in">umask</span>+default<br>当文件权限通过666-<span class="hljs-built_in">umask</span>计算后,某位有奇数,则将其权限+1;<br><span class="hljs-comment">#特殊权限</span><br>SUID: 作用于二进制程序,执行此文件,临时具有所有者的权限, /bin/passwd<br><span class="hljs-built_in">chmod</span> u+s<span class="hljs-comment">#s=4</span><br>SGID: 作用于二进制程序,执行此文件,临时具有所属组的权限, /bin/passwd<br>  作用于目录上,创建的新文件,文件的所属组继承目录的所属组<br>Sticky: 作用与目录,只能删除此目录中自己文件, /tmp<span class="hljs-comment">#s=2</span><br><span class="hljs-built_in">chmod</span> o+t<span class="hljs-comment">#t=1</span><br></code></pre></td></tr></table></figure><h3 id="netstat-atlnp">29. netstat(-atlnp)</h3><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-t, --tcp</td><td>指明显示TCP端口</td></tr><tr><td>-u, --udp</td><td>指明显示UDP端口</td></tr><tr><td>-a, --all</td><td>–</td></tr><tr><td>-r, --route</td><td>显示核心路由信息</td></tr><tr><td>-l, --listen</td><td>仅显示监听套接字</td></tr><tr><td>-p, --PID</td><td>显示进程标识符</td></tr><tr><td>-n, --numeric</td><td>不解析服务的名称</td></tr></tbody></table><h3 id="ss-antlp">30. ss(-antlp)</h3><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-t, --tcp</td><td>显示 TCP 协议的 sockets</td></tr><tr><td>-u, --udp</td><td>显示 UDP 协议的 sockets</td></tr><tr><td>-n, --numeric</td><td>不解析服务的名称，如 “22” 端口不会显示成 “ssh”</td></tr><tr><td>-l, --listening</td><td>只显示处于监听状态的端口</td></tr><tr><td>-p, --processes</td><td>显示监听端口的进程(Ubuntu 上需要 sudo)</td></tr><tr><td>-a, --all</td><td>对 TCP 协议来说，既包含监听的端口，也包含建立的连接</td></tr><tr><td>-r, --resolve</td><td>把 IP 解释为域名，把端口号解释为协议名称</td></tr></tbody></table><h3 id="lsof-list-open-files">31. lsof: list open files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsof -i:8022 <br>lsof -i tcp     <br></code></pre></td></tr></table></figure><h3 id="文件归属与权限">32. 文件归属与权限</h3><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-</td><td>普通文件</td></tr><tr><td>d</td><td>目录文件</td></tr><tr><td>l</td><td>链接文件</td></tr><tr><td>b</td><td>块设备文件,按块为单位,随机访问的设备(硬盘)</td></tr><tr><td>c</td><td>字符设备文件,按字符为单位,线性设备(键盘)</td></tr><tr><td>p</td><td>管道文件</td></tr><tr><td>r</td><td>(可读)-4</td></tr><tr><td>w</td><td>(可写:编辑、新增、修改、删除文件实际内容) -2</td></tr><tr><td>x</td><td>(执行)-1</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# <span class="hljs-built_in">ls</span> -l initial-setup-ks.cfg<br>  drwxr-xr-x. 2 anyue anyue  6 Jul 27 14:59 Videos<br>  | 文件类型 | 7 | 5 | 5 | 属主 | 属组 | 大小 | 修改时间 | 文件名 |<br></code></pre></td></tr></table></figure><p><strong>SUID是一种对<code>二进制程序</code>进行设置的特殊权限,可以让二进制程序的执行者临时拥有属主的权限(仅对拥有执行权限的二进制程序有效),相应进程的属主是程序文件自身的属主, 而不是调用者</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# ll /bin/cat  <br>  -rwxr-xr-x  1 root root 23260 Jan 30 2014 /bin/cat  <br>[root@xy ~]# <span class="hljs-built_in">chmod</span> u+s /bin/cat  <span class="hljs-comment"># chmod u-s FILE</span><br>  -rwxsr-xr-x  1 root root 23260 Jan 30 2014 /bin/cat  <br><br>[anyue@xy ~]# <span class="hljs-built_in">cat</span> /etc/shadow  <span class="hljs-comment"># 可以查看shadow  </span><br></code></pre></td></tr></table></figure><p><strong>SGID:让执行者临时拥有属组的权限(对拥有执行权限的二进制程序进行设置)在<code>某个目录</code>中创建的文件自动集成该目录的用户组(只可以对目录进行设置)</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]# useradd hadoop; useradd hbase;    <br>[root@xy ~]# <span class="hljs-built_in">mkdir</span> /tmp/project <br>[root@xy ~]# groupadd deve; <span class="hljs-built_in">chown</span> -R :deve /tmp/project/  <br>[root@xy ~]# usermod -aG  deve hadoop; usermod -aG  deve habase  <br>[hadoop@xy project]# <span class="hljs-built_in">ls</span> -ld       <br>  drwxr-xr-x 2 root deve 4096 Jan 8 18:55 .  <span class="hljs-comment"># hadoop 无写权限</span><br>[root@xy tmp]# <span class="hljs-built_in">chmod</span> g+w /tmp/project  <span class="hljs-comment"># 添加写权限  </span><br>[hadoop@xy project]# <span class="hljs-built_in">ls</span> -l  <br>  -rw-rw-r-- 1 hadoop hadoop 0 Jan 8 18:58 a.hadoop    <br>  -rw-rw-r-- 1 habase habse 0 Jan 8 18:58 a.habase    <br>[root@xy ~]# <span class="hljs-built_in">chmod</span> g+s /tmp/project  <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -ld /tmp/project        <br>  drwxrwsr-x 2 root deve 4096 Jan 8 18:59 /tmp/project   <br>[hadoop@xy project]# <span class="hljs-built_in">touch</span> b.hadoop  <br>  -rw-rw-r-- 1 hadoop deve 0 Jan 8 19:00 b.hadoop   <br><br><span class="hljs-built_in">chmod</span> 权限 文件或目录名称  u g o + - = rwx       <br><span class="hljs-built_in">chown</span> 所有者:所属组 文件或目录名称   --reference=/path/file modFile,...<br></code></pre></td></tr></table></figure></p><p><strong>SBIT(StickyBit):特殊权限位可确保用户只能删除自己的文件,而不能删除其它用户的文件.即当<code>对某个目录设置</code>了SBIT粘滞位权限后,那么该目录中的文件就只能被其所有者执行删除操作了</strong><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy ~]$ <span class="hljs-built_in">chmod</span> o+t /tmp/project  <br>[root@xy ~]# <span class="hljs-built_in">ls</span> -ld /tmp/project <br>  drwxrwsr-t 2 root deve 4096 Jan 8  19:05 /tmp/project  <br>[root@xy ~]$ <span class="hljs-built_in">chmod</span> 3755 /tmp/project  <span class="hljs-comment"># SUID SGUID Sticky(000-111)</span><br></code></pre></td></tr></table></figure></p><h3 id="文件的隐藏属性">33. 文件的隐藏属性</h3><h4 id="chattr参数--参数">33.1 chattr(+参数 -参数)</h4><ul><li>i: 不能删除、改名、更改<br /></li><li>a: 只能追加内容</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xy <span class="hljs-built_in">test</span>]# chattr +a linuxprobe   <span class="hljs-comment"># Append Only </span><br>[root@xy <span class="hljs-built_in">test</span>]# <span class="hljs-built_in">rm</span> linuxprobe   <br>  <span class="hljs-built_in">rm</span>: remove regular file ‘linuxprobe’? y  <br>  <span class="hljs-built_in">rm</span>: cannot remove ‘linuxprobe’: Operation not permitted  <br>[root@xy <span class="hljs-built_in">test</span>]# chattr -a linuxprobe   <br>[root@xy <span class="hljs-built_in">test</span>]# <span class="hljs-built_in">rm</span> linuxprobe<br>  <span class="hljs-built_in">rm</span>: remove regular file ‘linuxprobe’? y  <br>[root@xy <span class="hljs-built_in">test</span>]# lsattr linuxprobe   <span class="hljs-comment"># 隐藏权限  </span><br>[root@xy <span class="hljs-built_in">test</span>]# -----a--------- linuxprobe  <br></code></pre></td></tr></table></figure><h4 id="文件访问控制表acl">33.2 文件访问控制表(ACL)</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-m</td><td>设定权限</td></tr><tr><td>-x</td><td>取消权限</td></tr><tr><td>-b, –remove all</td><td>移除所有</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xy@xy ~]$ <span class="hljs-built_in">cd</span> /root  <br>  -bash: <span class="hljs-built_in">cd</span>: /root: Permission denied  <br>[xy@xy root]$ <span class="hljs-built_in">exit</span>  <br>[root@xy ~]# setfacl -Rm u:xy:rwx /root  <br>[root@xy ~]# su -xy  <br>  Last login: Sat Mar 21 21:45:04 CST 2018 on pts/1  <br>[xy@xy ~]$ <span class="hljs-built_in">cd</span> /root  <br>[xy@xy root]$ <span class="hljs-built_in">ls</span>  <br>  anaconda-ks.cfg Downloads Pictures Public  <br>[xy@xy ~]# <span class="hljs-built_in">cat</span> anaconda-ks.cfg  <br>[xy@xy ~]# <span class="hljs-built_in">exit</span>  <br>[root@xy ~]# <span class="hljs-built_in">ls</span> ld /root  <br>  dr-xrwx---+ 14 root root 4096 May 4 2018 /root  <br>[root@xy ~]# setfacl -x u:xy /root <br>[root@xy ~]# getfacl /root        <span class="hljs-comment"># getfacl 显示ACL信息  </span><br>  getfacl: Removing leading <span class="hljs-string">&#x27;/&#x27;</span> from absolute path names   <br>  1 <span class="hljs-comment"># file: root  </span><br>  2 <span class="hljs-comment"># owner: root  </span><br>  3 <span class="hljs-comment"># group: root  </span><br>  user::r-x  <br>  user:xy:rwx  <br>  group::r-x  <br>  mask::rwx  <br>  other::---<br><br>[root@xy ~]# whereis ps  <span class="hljs-comment"># 搜索命令所在位置及帮助文档</span><br>  ps: /usr/bin/ps /usr/share/man/man1/ps.1.gz /usr/share/man/man1p/ps.1p.gz<br></code></pre></td></tr></table></figure><h3 id="补充小知识">补充小知识：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">locate     <span class="hljs-comment"># 文件名搜索   </span><br>快捷的在`locatedb`中搜索文件名, 因为是在本地数据库中搜索`/var/lib/mlocate`, 所以速度很快, 但数据库更新为1天, 所以使用`updatedb`更新数据库;   <br><span class="hljs-built_in">whoami</span>     <span class="hljs-comment"># 当前登陆用户  </span><br>whatis <span class="hljs-built_in">ls</span>  <span class="hljs-comment"># 查看命令作用</span><br><span class="hljs-built_in">which</span> <span class="hljs-built_in">ls</span>   <span class="hljs-comment"># 查看命令所在位置及别名 whereis 更详细</span><br></code></pre></td></tr></table></figure><p>:link:<ahref="https://www.cnblogs.com/wlzjdm/p/8687745.html">Rhel-7-yum源配置-1</a><br />:link:<ahref="https://blog.csdn.net/qq_36119192/article/details/82222175">Rhel-7-yum源配置-2</a><br />:link:<ahref="https://blog.csdn.net/u013605322/article/details/79726564">Rhel-7-yum源配置-3</a><br />:link:<ahref="https://blog.csdn.net/tantexian/article/details/38895449">RHEL-7-yum优先级设置-1</a><br />:link:<ahref="https://blog.csdn.net/conling_/article/details/70399694">RHEL-7-yum优先级设置-2</a></p><p>:link:<a href="https://www.cnblogs.com/sench/p/8933638.html">umask命令参考</a><br />&gt; <strong>文件的默认权限</strong>为 <code>666</code>,创建目录的默认权限 <code>777</code>,而umask值则表明了需要从默认权限中去掉哪些权限来成为最终的默认权限值,文件默认不能具有执行权限，如果算的结果中右执行权限，则将其权限加1;<br />&gt; &gt; 权限 = 默认权限 - umask</p><img src="/posts/4ac0a166/umask.jpg" class="" title="[umask]"><h4 id="文件系统命令补充">文件系统命令补充：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">dumpe2fs -h /dev/sd*<span class="hljs-comment">#查看分区概览信息</span><br>fdisk -l<span class="hljs-comment">#显示磁盘信息</span><br>fdisk -t<span class="hljs-comment">#更改分区系统的ID</span><br>fsck -y /dev/sdb1<span class="hljs-comment">#文件系统修复命令</span><br><br>partx -a /dev/DEVICE   partx -d --nr number /dev/device<span class="hljs-comment">#CentOS6</span><br>partprobe /dev/DEVICE<span class="hljs-comment">#CentOS5,7</span><br></code></pre></td></tr></table></figure><h4 id="相关解压压缩命令">相关解压压缩命令</h4><h4 id="link参考2">:link:<ahref="https://www.cnblogs.com/machangwei-8/p/9572227.html">参考2</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">1、gzip gunzip:<br>gzip /PATH/SOMEFILE<span class="hljs-comment">#压缩后会删除源文件(不支持目录压缩) </span><br>    -d 解压缩<br>    -# 1-9(压缩率)<br>    gunzip  /PATH/SOMEFILE.gz <span class="hljs-comment">#解压后会删除源文件  </span><br>    zcat /PATH/SOMEFILE.gz    <span class="hljs-comment">#不解压查看文本文件内容</span><br><br>2、bzip2 bunzip2<br>bzip2 /PATH/SOMEFILE<br>-d 解压缩<br>        -k 保留源文件<br>        -# 1-9(压缩率)<br>    bunzip2 /PATH/SOMEFILE.bz2<br>    bzcat /PATH/SOMEFILE.bz2     <span class="hljs-comment">#不解压查看文本文件内容</span><br><br>3、xz unxz <br>xz /PATH/SOMEFILE<br>-d 解压缩<br>        -k 保留源文件<br>        -# 1-9(压缩率)<br>    unxz /PATH/SOMEFILE.xz<br>    xzcat /PATH/SOMEFILE.xz<br>4、zip unzip:  <br>zip FILENAME.zip FILE1 FILE2 ...    <br>unzip tmp.zip    <span class="hljs-comment">#指定解压目录</span><br></code></pre></td></tr></table></figure><h4 id="bash快捷键">bash快捷键</h4><table><thead><tr><th>快捷键</th><th>作用</th></tr></thead><tbody><tr><td>Tab</td><td>命令补全</td></tr><tr><td>Ctrl+E</td><td>移动到行尾</td></tr><tr><td>Ctrl+C</td><td>移动到行首</td></tr><tr><td>Ctrl+L</td><td>清屏</td></tr><tr><td>Ctrl+U</td><td>删除/剪切</td></tr><tr><td>Ctrl+Y</td><td>粘贴</td></tr></tbody></table><h5 id="查询文件的第几行-第几行命令">查询文件的第几行-第几行命令</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> file.txt |<span class="hljs-built_in">tail</span> -n +10 |<span class="hljs-built_in">head</span> -n20   <span class="hljs-comment"># 从10行开始, 显示20行, 10~29</span><br>sed -n <span class="hljs-string">&#x27;5,10p&#x27;</span> file.txt<br></code></pre></td></tr></table></figure><h5 id="命令提示符颜色更改">命令提示符颜色更改</h5><p>:link:<ahref="https://www.cnblogs.com/menlsh/archive/2012/08/27/2659101.html">PS1参考博文</a></p><p>:link:<ahref="https://www.cnblogs.com/wt645631686/p/6868694.html">Shell脚本的颜色样式及属性控制</a><br /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PS1</span><br>vim /etc/profile.d/color.sh<br>PS1=<span class="hljs-string">&quot;\[\033[1;5;41;33m\][\u@\h\W\t\!]\\$\[\033[0m\]&quot;</span><br>\u 当前用户  \H 主机名  \h 主机名简称  \w 当前工作目录<br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\e[字体格式;背景色;前景色m字符串\e[0m&quot;</span>  <span class="hljs-comment"># \e[0m 关闭所有属性</span><br></code></pre></td></tr></table></figure></p><img src="/posts/4ac0a166/colorBash.jpg" class="" title="[PS1]"><h5 id="总结1位数表示字体显示格式">总结：1位数表示字体显示格式</h5><table><thead><tr><th>背景色(4)</th><th>字体色/前景色(3)</th><th>结束其他功能</th></tr></thead><tbody><tr><td>40 黑色</td><td>30m 黑色</td><td>\033[0m 关闭所有属性</td></tr><tr><td>41 红色</td><td>31m 红色</td><td>\033[1m 设置高亮度</td></tr><tr><td>42 绿色</td><td>32m 绿色</td><td>\033[4m 下划线</td></tr><tr><td>43 黄色</td><td>33m 黄色</td><td>\033[5m 闪烁</td></tr><tr><td>44 蓝色</td><td>34m 蓝色</td><td>\033[7m 反显，显示为白底黑字，或黑底白字</td></tr><tr><td>45 紫色</td><td>35m 紫色</td><td>\033[8m 消隐，字符色与背景色相同</td></tr><tr><td>46 浅蓝色</td><td>36m 浅蓝色</td><td>\033[K 清除从光标到行尾的内容</td></tr><tr><td>47 灰色</td><td>37m 灰色</td><td>—</td></tr></tbody></table><h5 id="visudo-man-5-sudoers">visudo (man 5 sudoers)</h5><ul><li>用户名/%组名 被管理主机地址=(可使用的身份) 授权命令(绝对路径)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root    ALL=(ALL)    ALL<br>hadoop  ALL=(root)   NOPASSWD: /usr/sbin/useradd, PASSWD: /usr/sbin/usermod<br></code></pre></td></tr></table></figure><ul><li><p>alias: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">User_Alias USERADMIN = hadoop, %hadoop, %useradmin<br>Cmnd_Alias USERADMINCMND = /usr/sbin/useradd, /usr/sbin/usermod, /usr/bin/passwd [a-zA-Z]*, ! /usr/bin/passwd root<br>USERADMIN  ALL=(root) NOPASSWD: USERADMINCMND<br></code></pre></td></tr></table></figure></p></li><li><p>ldd(列出文件依赖库文件)</p><h3 id="返回目录"><a href="#back">返回目录</a></h3></li></ul>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux命令</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于开源协议</title>
    <link href="/posts/b83b20cb.html"/>
    <url>/posts/b83b20cb.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-11-关于开源协议 <span id="more"></span></p><h3 id="关于开源协议">关于开源协议：</h3><ul><li>:point_right: <strong>GNU GPL(GNU General PublicLicense，GNU通用公共许可证)</strong>，协议规则：</li></ul><img src="/posts/b83b20cb/Gnu-GPL.png" class="" title="Gnu-GPL"><p><strong><ahref="http://www.gnu.org/home.en.html">GNU官方网址</a></strong></p><ul><li><p><strong>复制自由：</strong>允许把软件复制到任何人的电脑中，并且不限制复制的数量。</p></li><li><p><strong>传播自由：</strong>允许软件以各种形式进行传播。</p></li><li><p><strong>收费传播：</strong>允许在各种媒介上出售该软件，但必须提前让买家知道这个软件是可以免费获得的；因此，一般来讲，开源软件都是通过为用户提供有偿服务的形式来盈利的。</p></li><li><p><strong>修改自由：</strong>允许开发人员增加或删除软件的功能，但软件修改后必须依然基于GPL许可协议授权。</p></li><li><p>:point_right:<strong>BSD(Berkeley softwareDistribution，伯克利软件分销)</strong>，协议规则：<br /><img src="/posts/b83b20cb/bsd.png" class="" title="bsd"><br /></p></li><li><p>如果再发布的软件中包含源代码，则源代码必须继续遵循BSD许可协议。</p></li><li><p>如果再发布的软件中只有二进制程序，则需要在相关文档或版权文件中声明原始代码遵循了BSD协议。</p></li><li><p>若软件是基于他人的源代码编写而成的，则需要保留原始代码的协议、商标、专利声明及其他原作者声明的内容信息。</p></li><li><p>A<strong>pache Liscense Version(Apache许可证版本)</strong>，协议规则：<br /><img src="/posts/b83b20cb/apache.jpg" class="" title="Apache"></p><ul><li>该软件及其衍生品必须继续使用Apache许可协议。</li><li>如果修改了程序源代码，需要在文档中进行声明。</li><li>若软件是基于他人的源代码编写而成的，则需要保留原始代码的协议、商标、专利声明及其他原作者声明的内容信息。</li><li>如果再发布的软件中有声明文件，则需在此文件中标注Apache许可协议及其他许可协议。</li></ul></li><li><p><strong>MPL(Mozliia Public Liscense，Mozliia公共许可协议)</strong>，相较于GPL许可协议，MPL更加注重对开发者的源代码需求和收益之间的平衡。</p></li><li><p><strong>MIT(Massachusetts Institute of Technology许可协议)</strong>，目前限制最少的开源许可协议之一，只要程序的开发者在修改后的源代码中保留原作者的许可信息即可，因此普遍被商业软件所使用。</p></li></ul><h3 id="关于linux发行版本类型">关于Linux发行版本类型：</h3><ul><li><p><strong>RedHat EnterpriseLinux，RHEL</strong>(红帽企业版Linux)：红帽公司是全球最大的开源技术厂商，RHEL是全世界内使用最广泛的Linux系统。<br /><img src="/posts/b83b20cb/redhat.png" class="" title="RedHat"></p></li><li><p><strong>Community Enterprise OperatingSystem，CentOS</strong>(社区企业操作系统)：通过把RHEL系统重新编译并发布给用户免费使用的Linux系统。<br /><img src="/posts/b83b20cb/centos-150x150.jpg" class="" title="CentOS"></p></li><li><p><strong>Fedora</strong>：由红帽公司发布的桌面版系统套件，用户可免费体验到最新的技术或工具，这些技术或工具在成熟后会被加入到RHEL系统中，因此Fedora也称为RHEL系统的“试验田”。<br /><img src="/posts/b83b20cb/fedora-e1422160855872.png" class="" title="Fedora"></p></li><li><p><strong>openSUSE</strong>：源自德国的一款著名的Linux系统。<br /><img src="/posts/b83b20cb/OpenSUSE-300x193.png" class="" title="openSUSE"></p></li><li><p><strong>Gentoo</strong>：具有极高的自定制性，操作复杂，因此适合有经验的人员使用。<br /><img src="/posts/b83b20cb/Gentoo-287x300.png" class="" title="Gentoo"></p></li><li><p><strong>Debian</strong>：稳定性、安全性强，提供了免费的基础支持，可以<strong>良好地支持各种硬件架构</strong>，以及提供近十万种不同的开源软件，在国外拥有很高的认可度和使用率。<br /><img src="/posts/b83b20cb/debian.png" class="" title="Debian"></p></li><li><p><strong>Ubuntu</strong>：<em>一款派生自Debian的操作系统</em>，<em>对新款硬件具有极强的兼容能力</em>。Ubuntu与Fedora都是极其出色的Linux桌面系统，而且Ubuntu也可用于服务器领域。<br /><img src="/posts/b83b20cb/ubuntu.png" class="" title="Ubuntu"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>开源</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>开源协议</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vim</title>
    <link href="/posts/104c461b.html"/>
    <url>/posts/104c461b.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-10-VIM <span id="more"></span></p><h3 id="vim">Vim</h3><h4 id="移动光标">移动光标：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">h 左  ✔      <br>j 下  ✔  <br>k 上  ✔   <span class="hljs-comment">#9k 向上移动9行   </span><br>l 右  ✔<br></code></pre></td></tr></table></figure><h4 id="命令">命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">w 跳至下一个单词词首           <span class="hljs-comment"># 3w  ✔</span><br>b 跳至当前或前一个单词词首      <span class="hljs-comment"># backword  ✔</span><br>e 跳至当前或后一个单词词首      <span class="hljs-comment"># end of word  ✔</span><br>ge: 移动到前一个word的最后一个字符上  <br>W 空白为分界的WORDs为单位进行移动  <br>gg 移动到文件头  ✔<br>G 移动到文件尾  ✔<br><br>0 移动到当前行的第一个字符上   ✔  <br>^ 移动到当前行的第一个非空白字符上<br>$ 移动到当前行行尾             <span class="hljs-comment"># 2$  ✔</span><br>:start_pos,end_pos 指定到第n行  ✔  <br><br>fx 单字符搜索命令                <span class="hljs-comment"># 3fh ✔  </span><br></code></pre></td></tr></table></figure><h4 id="删除">删除</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">x<span class="hljs-comment">#3x 删除3个字符 ✔</span><br><span class="hljs-built_in">dd</span>  ✔  <br>  :n1,n2d  <br>  dw<br>y yy 复制  <br>p 粘贴到光标后(小写)   <br>P 粘贴到光标前(大写) <br></code></pre></td></tr></table></figure><h4 id="撤销和重做">撤销和重做：</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">u 撤销最后一次删除  ✔   <br>U 一次撤消对一行的全部操  <br>Ctrl+r 反转撤销<br><span class="hljs-bullet">. </span>重复前一次编辑操作<br></code></pre></td></tr></table></figure><h4 id="命令模式">命令模式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#当前页跳转</span><br>H<span class="hljs-comment">#页首</span><br>M<span class="hljs-comment">#页中</span><br>L<span class="hljs-comment">#页底</span><br>ZZ<span class="hljs-comment">#保存退出</span><br>ZQ<span class="hljs-comment">#不保存退出   </span><br></code></pre></td></tr></table></figure><h4 id="扩展命令模式">扩展命令模式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">:q:q!<br>:wq:x<br>r filename<span class="hljs-comment">#读文件到当前文件</span><br>w filename<span class="hljs-comment">#当前文件写入另一个文件</span><br>!<span class="hljs-built_in">command</span><span class="hljs-comment">#执行命令</span><br>r!<span class="hljs-built_in">command</span><span class="hljs-comment">#读入命令的输出</span><br></code></pre></td></tr></table></figure><h4 id="查找替换">查找/替换：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">:/string<span class="hljs-comment">#搜索一个字符串(向尾部)   </span><br>:?string<span class="hljs-comment">#(向头部) </span><br>  n<span class="hljs-comment">#与命令同方向</span><br>  N<span class="hljs-comment">#与命令反方向</span><br>:1,10s/old/new/g   <br>  :%s@^[^#]@#&amp;@     <span class="hljs-comment">#注释</span><br>  :%s/old/new/g     <span class="hljs-comment">#% 全文, g 全局</span><br>  <span class="hljs-comment">#查找替换中的分隔符/可替换为其他字符</span><br>  :s/xyz/&amp;er/g<br>r<span class="hljs-comment">#替换光标所在处的字符</span><br></code></pre></td></tr></table></figure><h4 id="多窗口操作">多窗口操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">多文件分割:<br>  vim -o|-O FILE1 FILE2...<br>  -o<span class="hljs-comment">#水平分割</span><br>  -O<span class="hljs-comment">#垂直分割</span><br>  :next :prev :last :first<br>  Ctrl+w, Arrow<span class="hljs-comment">#在窗口间切换</span><br>单文件窗口切换:<br>  Ctrl+w,s <span class="hljs-built_in">split</span><span class="hljs-comment">#水平分割</span><br>  Ctrl+w,v vertical<span class="hljs-comment">#垂直分割</span><br>  Ctrl+w,q<span class="hljs-comment">#取消相邻窗口</span><br>  Ctrl+w,o<span class="hljs-comment">#取消全部窗口</span><br>  :wqall<span class="hljs-comment">#退出</span><br></code></pre></td></tr></table></figure><h4 id="vim配置文件.vimrc">VIM配置文件.vimrc</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">全局: /etc/vimrc<br>局部: ~/.vimrc<br><span class="hljs-built_in">set</span> nu<span class="hljs-comment">#显示行号</span><br><span class="hljs-built_in">set</span> ic<span class="hljs-comment">#忽略字符的大小写</span><br><span class="hljs-built_in">set</span> ai<span class="hljs-comment">#自动缩进,autoindent</span><br><span class="hljs-built_in">set</span> si<span class="hljs-comment">#智能缩进,smartindent</span><br><span class="hljs-built_in">set</span> hlsearch<span class="hljs-comment">#高亮搜索显示</span><br><span class="hljs-built_in">set</span> syntax on <span class="hljs-comment">#语法高亮</span><br><span class="hljs-built_in">set</span> list <span class="hljs-comment">#显示Tab和换行符</span><br><span class="hljs-built_in">set</span> fileformat=dos<span class="hljs-comment">#启用win文件格式</span><br><span class="hljs-built_in">set</span> fileformat=unix<br><span class="hljs-built_in">set</span> ff=dos|unix<br><span class="hljs-built_in">set</span> textwidth=65<span class="hljs-comment">#设置文本宽度</span><br><span class="hljs-built_in">set</span> wrapmargin=15<br><span class="hljs-built_in">set</span> cursorline<span class="hljs-comment">#设置光标所在行的标识线</span><br><span class="hljs-built_in">set</span> <span class="hljs-built_in">paste</span> <span class="hljs-comment">#复制保留格式</span><br><br>:<span class="hljs-built_in">help</span> <span class="hljs-built_in">command</span><br>vimtutor<br></code></pre></td></tr></table></figure><img src="/posts/104c461b/VIM01.jpg" class="" title="[VIM01]"><img src="/posts/104c461b/vim%E5%91%BD%E4%BB%A4%E5%B0%8F%E6%8A%84.jpg" class="" title="[VIM02]"><img src="/posts/104c461b/VIM03.png" class="" title="[VIM03]">]]></content>
    
    
    <categories>
      
      <category>vim</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>vim</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Adobe</title>
    <link href="/posts/3e6df65f.html"/>
    <url>/posts/3e6df65f.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-09-Adobe <span id="more"></span></p><h3 id="关于-adobe-photoshop-快捷键">1.关于 Adobe Photoshop 快捷键</h3><h4 id="应用程序菜单">应用程序菜单：</h4><ul><li><p>编辑： <figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs excel">自由变换：Ctrl+<span class="hljs-built_in">T</span><br>常规：Ctrl+K<br></code></pre></td></tr></table></figure></p></li><li><p>图像： <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css">色阶：Ctrl+L<br>曲线：Ctrl+M<br>反相：Ctrl+<span class="hljs-selector-tag">I</span><br>色相/饱和度：Ctrl+U<br>色彩平衡：Ctrl+<span class="hljs-selector-tag">B</span><br></code></pre></td></tr></table></figure></p></li><li><p>图层： <figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">新建图层：<span class="hljs-keyword">Shift+Ctrl+N</span><br><span class="hljs-keyword"></span>通过拷贝的图层：Ctrl+<span class="hljs-keyword">J</span><br><span class="hljs-keyword"></span>图层编组：Ctrl+G<br>取消图层编组：<span class="hljs-keyword">Shift+Ctrl+G</span><br><span class="hljs-keyword"></span>合并图层：Ctrl+E<br></code></pre></td></tr></table></figure></p></li><li><p>选择：<br /><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">取消选择：<span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">D</span><br>反选：<span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">I</span>  <br>单独查看图层：<span class="hljs-variable">Alt</span><span class="hljs-operator">+</span><span class="hljs-variable">Eye</span><br></code></pre></td></tr></table></figure></p></li><li><p>工具： <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css">移动工具：V<br>矩形工具：M<br>魔棒工具：W<br>吸管工具：<span class="hljs-selector-tag">I</span><br>抓手工具：H<br>默认前景色/背景色：D<br>切换前景色/背景色：<span class="hljs-attribute">X</span><br>切换屏幕模式：F<br></code></pre></td></tr></table></figure></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>CRH</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Adobe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SQL基础命令</title>
    <link href="/posts/5b397e67.html"/>
    <url>/posts/5b397e67.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-09-SQL基础命令 <span id="more"></span></p><h3 id="basic-sql-commands">Basic SQL Commands:</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">SHOW</span><span class="hljs-keyword">SELECT</span>  <span class="hljs-keyword">INSERT</span>  <span class="hljs-keyword">CREATE</span>  <span class="hljs-keyword">UPDATE</span>  <span class="hljs-keyword">DELETE</span>  <span class="hljs-keyword">GRANT</span><span class="hljs-keyword">REVOKE</span><span class="hljs-keyword">CREATE</span>  <br></code></pre></td></tr></table></figure><h4 id="create">CREATE</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">CREATE</span> DATABASE [IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>] db_name [<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-keyword">CHARACTER SET</span> [<span class="hljs-operator">=</span>] charset_name;<br></code></pre></td></tr></table></figure><h4 id="show">SHOW</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">SHOW</span> databases;<br><span class="hljs-comment">/* The SQL SHOW statement displays information contained in the database and its tables.*/</span><br><span class="hljs-keyword">SHOW</span> DATABASES;<br><br><span class="hljs-keyword">SHOW</span> TABLES;<br><span class="hljs-comment">/* The SHOW TABLES command is used to display all of the tables in the currently selected MySQL database.*/</span><br><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE TABLE</span> tbl_name;#查看创建表的语句<br></code></pre></td></tr></table></figure><h4 id="select">SELECT</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">/* The SELECT statement is used to select data from a database.*/</span><br><span class="hljs-keyword">SELECT</span> column_list <span class="hljs-keyword">FROM</span> tbl_name;<br>  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span>;<br>  eg1. <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers;<br>  <span class="hljs-operator">|</span> ID <span class="hljs-operator">|</span> FirstName <span class="hljs-operator">|</span> LastName <span class="hljs-operator">|</span>     City    <span class="hljs-operator">|</span> ZipCode <span class="hljs-operator">|</span> Age <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span><span class="hljs-comment">----|-----------|----------|-------------|---------|-----|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> John      <span class="hljs-operator">|</span> Smith    <span class="hljs-operator">|</span> NewYork     <span class="hljs-operator">|</span>   <span class="hljs-number">10199</span> <span class="hljs-operator">|</span>  <span class="hljs-number">21</span> <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> David     <span class="hljs-operator">|</span> Williams <span class="hljs-operator">|</span> Los Angeles <span class="hljs-operator">|</span>   <span class="hljs-number">90052</span> <span class="hljs-operator">|</span>  <span class="hljs-number">22</span> <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> Chole     <span class="hljs-operator">|</span> Anderson <span class="hljs-operator">|</span> Chicago     <span class="hljs-operator">|</span>   <span class="hljs-number">60607</span> <span class="hljs-operator">|</span>  <span class="hljs-number">24</span> <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> Emily     <span class="hljs-operator">|</span> Adams    <span class="hljs-operator">|</span> Houston     <span class="hljs-operator">|</span>   <span class="hljs-number">77201</span> <span class="hljs-operator">|</span>  <span class="hljs-number">23</span> <span class="hljs-operator">|</span><br><br>  eg2. <span class="hljs-keyword">SELECT</span> FirstName,LastName,City <span class="hljs-keyword">FROM</span> customers;<br>  <span class="hljs-operator">|</span> ID <span class="hljs-operator">|</span> FirstName <span class="hljs-operator">|</span> LastName <span class="hljs-operator">|</span>     City    <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span><span class="hljs-comment">----|-----------|----------|-------------|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> John      <span class="hljs-operator">|</span> Smith    <span class="hljs-operator">|</span> NewYork     <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> David     <span class="hljs-operator">|</span> Williams <span class="hljs-operator">|</span> Los Angeles <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> Chole     <span class="hljs-operator">|</span> Anderson <span class="hljs-operator">|</span> Chicago     <span class="hljs-operator">|</span> <br>  <span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> Emily     <span class="hljs-operator">|</span> Adams    <span class="hljs-operator">|</span> Houston     <span class="hljs-operator">|</span><br><br><span class="hljs-comment">/* The SQL DISTINCT keyword is used in conjunction with SELECT to eliminate all duplicate records and return only unique ones.(不选择重复的数据).*/</span><br>  eg1. <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> column_name1, column_name2 <span class="hljs-keyword">FROM</span> tbl_name;  <br>  <span class="hljs-operator">|</span> ID <span class="hljs-operator">|</span> FirstName <span class="hljs-operator">|</span> LastName <span class="hljs-operator">|</span>     City    <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span><span class="hljs-comment">----|-----------|----------|-------------|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> John      <span class="hljs-operator">|</span> Smith    <span class="hljs-operator">|</span> NewYork     <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> David     <span class="hljs-operator">|</span> Williams <span class="hljs-operator">|</span> Los Angeles <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> Chole     <span class="hljs-operator">|</span> Anderson <span class="hljs-operator">|</span> Chicago     <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> Emily     <span class="hljs-operator">|</span> Adams    <span class="hljs-operator">|</span> Houston     <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">5</span> <span class="hljs-operator">|</span> Yue       <span class="hljs-operator">|</span> Xing     <span class="hljs-operator">|</span> NewYork     <span class="hljs-operator">|</span><br><br><span class="hljs-comment">/* Sometimes we need to retrieve just a subset of records(限制选择数据条数).*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">column</span> list <span class="hljs-keyword">FROM</span> table_name LIMIT [number <span class="hljs-keyword">of</span> records];  <br>  eg. <span class="hljs-keyword">SELECT</span> ID, FirstName, LastName, City <span class="hljs-keyword">FROM</span> customers LIMIT <span class="hljs-number">3</span>; <br><br><span class="hljs-comment">/* 从第2个位置开始拾取3条记录：(计数由0开始).*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> ID, FirstName, LastName, City <span class="hljs-keyword">FROM</span> customers LIMIT <span class="hljs-number">1</span>,<span class="hljs-number">3</span>;<br><br><span class="hljs-comment">/* In SQL, you can provide the table name prior to the column name, by separating them with a dot.The following statements are equivalent:*/</span>  <br>  eg. <span class="hljs-keyword">SELECT</span> City <span class="hljs-keyword">FROM</span> customers;<br>  eg. <span class="hljs-keyword">SELECT</span> customers.City <span class="hljs-keyword">FROM</span> customers;<br><br><span class="hljs-comment">/* ORDER BY is used with SELECT to sort the returned data.*/</span> <br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> FirstName,Age;<br>  <br><span class="hljs-keyword">SELECT</span> databases();<br><span class="hljs-keyword">SELECT</span> version();<br><span class="hljs-keyword">SELECT</span> now();<br></code></pre></td></tr></table></figure><h4 id="where">WHERE</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">/* The WHERE clause is used to extract only those records that fulfill a specified criterion.*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> column_list <span class="hljs-keyword">FROM</span> table_name <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>;<br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> ID <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;<br><br>  <span class="hljs-comment">/* SQL Operators:</span><br><span class="hljs-comment">     | Operator | Describtion               |</span><br><span class="hljs-comment">     |----------|---------------------------|</span><br><span class="hljs-comment">     | =        | equal                     |</span><br><span class="hljs-comment">     | !=       | Not equal                 |</span><br><span class="hljs-comment">     | &gt;        | Greater than              |</span><br><span class="hljs-comment">     | &lt;        | Less than                 |</span><br><span class="hljs-comment">     | &gt;=       | Greater than or equal     |</span><br><span class="hljs-comment">     | &lt;=       | Less than or equal        |</span><br><span class="hljs-comment">     | BETWEEN  | between an inclusiverange |</span><br><span class="hljs-comment">     | AND      | ----                      |</span><br><span class="hljs-comment">     | OR       | ----                      |</span><br><span class="hljs-comment">     | IN       | ----                      |</span><br><span class="hljs-comment">     | NOT      | ---                       |</span><br><span class="hljs-comment">   */</span><br><br>  eg. <span class="hljs-keyword">SELECT</span> column_name(s) <span class="hljs-keyword">FROM</span> table_name <span class="hljs-keyword">WHERE</span> column_name <span class="hljs-keyword">BETWEEN</span> value1 <span class="hljs-keyword">AND</span> value2;<br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> ID <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">3</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">7</span>;<br>  eg. <span class="hljs-keyword">SELECT</span> ID, FirstName <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> City <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;New York&#x27;</span>;<br>  eg. <span class="hljs-keyword">SELECT</span> ID, Age <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> Age <span class="hljs-operator">&gt;=</span> <span class="hljs-number">30</span> <span class="hljs-keyword">AND</span> Age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">40</span>;<br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> City <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;New York&#x27;</span> <span class="hljs-keyword">AND</span> (Age<span class="hljs-operator">=</span><span class="hljs-number">30</span> <span class="hljs-keyword">OR</span> Age<span class="hljs-operator">=</span><span class="hljs-number">35</span>);<br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> City <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;New York&#x27;</span>, <span class="hljs-string">&#x27;Los Angeles&#x27;</span>);<br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> City <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;New York&#x27;</span>, <span class="hljs-string">&#x27;Los Angeles&#x27;</span>);<br></code></pre></td></tr></table></figure><h4 id="concat">CONCAT()</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">/* The CONCAT function is used to concatenate two or more text values and returns the concatenating string.*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> CONCAT(FirstName, <span class="hljs-string">&#x27;, &#x27;</span> , City) <span class="hljs-keyword">FROM</span> customers; <br>  <span class="hljs-operator">|</span> CONCAT(FirstName,<span class="hljs-string">&#x27;,&#x27;</span>,City) <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span><span class="hljs-comment">----------------------------|</span><br>  <span class="hljs-operator">|</span> John,NewYork               <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span> David,Los Angeles          <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span> Chole,Chicado              <span class="hljs-operator">|</span><br></code></pre></td></tr></table></figure><h4 id="as">AS</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">/* A concatenation results in a new column. The default column name will be the CONCAT function.You can assign a custom name to the resulting.*/</span><br>  <span class="hljs-keyword">column</span> <span class="hljs-keyword">using</span> the <span class="hljs-keyword">AS</span> keyword:<br>  eg. <span class="hljs-keyword">SELECT</span> CONCAT(FirstName,<span class="hljs-string">&#x27;, &#x27;</span>, City) <span class="hljs-keyword">AS</span> new_column <span class="hljs-keyword">FROM</span> customers;<br>  eg. <span class="hljs-keyword">SELECT</span> ID, FirstName, LastName, Salary<span class="hljs-operator">+</span><span class="hljs-number">500</span> <span class="hljs-keyword">AS</span> Salary <span class="hljs-keyword">FROM</span> employees;<br></code></pre></td></tr></table></figure><h4 id="function">Function: <a id="function" target="_self"></a></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">/* The UPPER function converts all letters in the specified string to uppercase.*/</span> <br><br><span class="hljs-comment">/* The LOWER function converts the string to lowercase.*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> FirstName, <span class="hljs-built_in">UPPER</span>(LastName) <span class="hljs-keyword">AS</span> LastName <span class="hljs-keyword">FROM</span> employees;<br><br><span class="hljs-comment">/* The SQRT function returns the square root of given value in the argument.*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> Salary, <span class="hljs-built_in">SQRT</span>(Salary) <span class="hljs-keyword">FROM</span> employees;<br><br><span class="hljs-comment">/* Similarly, the AVG function returns the average value of a numeric column:*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(Salary) <span class="hljs-keyword">FROM</span> employees;<br><br><span class="hljs-comment">/* The SUM function is used to calculate the sum for a column 的 values.*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(Salary) <span class="hljs-keyword">FROM</span> employees;<br><br><span class="hljs-comment">/* DESC:递减排列(子查询) / ASC:升序排列*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(Salary) <span class="hljs-keyword">FROM</span> employees;<br>  eg. <span class="hljs-keyword">SELECT</span> FirstName，Salary <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">WHERE</span> Salary<span class="hljs-operator">&gt;</span><span class="hljs-number">3100</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> Salary <span class="hljs-keyword">DESC</span>; <br>  eg. <span class="hljs-keyword">SELECT</span> FirstName，Salary <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">WHERE</span> Salary<span class="hljs-operator">&gt;</span>(<span class="hljs-keyword">SELECT</span> AVG（Salary) <span class="hljs-keyword">FROM</span> employees）<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> Salary <span class="hljs-keyword">DESC</span>; <br><br><span class="hljs-comment">/* The LIKE keyword is useful when specifying a search condition within your WHERE clause.*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">WHERE</span> LastName <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%s&#x27;</span>; <span class="hljs-comment">/* 以s结尾的*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">WHERE</span> FirstName <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;A%&#x27;</span>; <span class="hljs-comment">/* 以A开头的*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">WHERE</span> LastName <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;_A&#x27;</span>;  <br><span class="hljs-comment">/* 2个字符*/</span><br><br><span class="hljs-comment">/* The MIN function is used to return the minimum value of an expression in a SELECT statement.*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(Salary) <span class="hljs-keyword">AS</span> Salary <span class="hljs-keyword">FROM</span> employees;<br></code></pre></td></tr></table></figure><h4 id="join">JOIN:</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">/* To join the two tables, specify them as a comma-separated list in the FROM clause:*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> customers.ID, customers.Name, orders.Name, orders.Amount <span class="hljs-keyword">FROM</span> customers, orders <span class="hljs-keyword">WHERE</span> customers.ID<span class="hljs-operator">=</span>orders.Customer_ID <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customers.ID;   <br><br>            customers <span class="hljs-keyword">table</span><br>  <span class="hljs-operator">|</span> ID  <span class="hljs-operator">|</span> Name  <span class="hljs-operator">|</span>     City     <span class="hljs-operator">|</span> Age <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span> <span class="hljs-comment">--- | ----- | ------------ | --- |</span><br>  <span class="hljs-operator">|</span> <span class="hljs-number">1</span>   <span class="hljs-operator">|</span> John  <span class="hljs-operator">|</span> <span class="hljs-keyword">New</span> York     <span class="hljs-operator">|</span> <span class="hljs-number">35</span>  <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span> <span class="hljs-number">2</span>   <span class="hljs-operator">|</span> David <span class="hljs-operator">|</span> Los Angeles  <span class="hljs-operator">|</span> <span class="hljs-number">23</span>  <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span> <span class="hljs-number">3</span>   <span class="hljs-operator">|</span> Chole <span class="hljs-operator">|</span> Chicago      <span class="hljs-operator">|</span> <span class="hljs-number">27</span>  <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span> <span class="hljs-number">4</span>   <span class="hljs-operator">|</span> Emily <span class="hljs-operator">|</span> Houston      <span class="hljs-operator">|</span> <span class="hljs-number">34</span>  <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span> <span class="hljs-number">5</span>   <span class="hljs-operator">|</span> James <span class="hljs-operator">|</span> Philadelphia <span class="hljs-operator">|</span> <span class="hljs-number">31</span>  <span class="hljs-operator">|</span><br><br>    orders <span class="hljs-keyword">table</span><br>  <span class="hljs-operator">|</span> ID <span class="hljs-operator">|</span>  Name   <span class="hljs-operator">|</span> Customer_ID <span class="hljs-operator">|</span> Amount <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span><span class="hljs-comment">----|---------|-------------|----------|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> Book    <span class="hljs-operator">|</span>           <span class="hljs-number">3</span> <span class="hljs-operator">|</span>     <span class="hljs-number">5000</span> <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> Box     <span class="hljs-operator">|</span>           <span class="hljs-number">5</span> <span class="hljs-operator">|</span>     <span class="hljs-number">3000</span> <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> Toy     <span class="hljs-operator">|</span>           <span class="hljs-number">2</span> <span class="hljs-operator">|</span>     <span class="hljs-number">4500</span> <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> Flowers <span class="hljs-operator">|</span>           <span class="hljs-number">4</span> <span class="hljs-operator">|</span>     <span class="hljs-number">1800</span> <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">5</span> <span class="hljs-operator">|</span> Cake    <span class="hljs-operator">|</span>           <span class="hljs-number">1</span> <span class="hljs-operator">|</span>     <span class="hljs-number">6700</span> <span class="hljs-operator">|</span><br><br>    Joining Tables<br>  <span class="hljs-operator">|</span> ID <span class="hljs-operator">|</span>  Name <span class="hljs-operator">|</span>   Name  <span class="hljs-operator">|</span> Amount <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span><span class="hljs-comment">----|-------|---------|--------|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> John  <span class="hljs-operator">|</span> Cake    <span class="hljs-operator">|</span>   <span class="hljs-number">6700</span> <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> David <span class="hljs-operator">|</span> Toy     <span class="hljs-operator">|</span>   <span class="hljs-number">4500</span> <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> Chole <span class="hljs-operator">|</span> Book    <span class="hljs-operator">|</span>   <span class="hljs-number">5000</span> <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> Emoly <span class="hljs-operator">|</span> Flowers <span class="hljs-operator">|</span>   <span class="hljs-number">1800</span> <span class="hljs-operator">|</span><br>  <span class="hljs-operator">|</span>  <span class="hljs-number">5</span> <span class="hljs-operator">|</span> James <span class="hljs-operator">|</span> Box     <span class="hljs-operator">|</span>   <span class="hljs-number">3000</span> <span class="hljs-operator">|</span><br><br><span class="hljs-comment">/* AS*/</span><br>  eg. <span class="hljs-keyword">SELECT</span> customers.ID, customers.Name, orders.Name, orders.Amount <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">AS</span> ct, orders <span class="hljs-keyword">AS</span> ord <span class="hljs-keyword">WHERE</span> ct.ID<span class="hljs-operator">=</span>ord.Customer_ID <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ct.ID;<br><br>  # <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> 相当于 <span class="hljs-keyword">JOIN</span><br>    eg. <span class="hljs-keyword">SELECT</span> column_name(s) <span class="hljs-keyword">FROM</span> table1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> table2 <span class="hljs-keyword">ON</span> table1.column_name<span class="hljs-operator">=</span>table2.column_name;<br>  # <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span>  <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span>返回左表中的所有行，即使右表中没有匹配项也是如此<br>    eg. <span class="hljs-keyword">SELECT</span> table1.column1, table2.column2...FROM table1 <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> table2 <span class="hljs-keyword">ON</span> table1.column_name <span class="hljs-operator">=</span> table2.column_name;<br>  # <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> 即使左表中没有匹配项，<span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span>也会返回右表中的所有行<br>    eg. <span class="hljs-keyword">SELECT</span> table1.column1, table2.column2...FROM table1 <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> table2 <span class="hljs-keyword">ON</span> table1.column_name <span class="hljs-operator">=</span> table2.column_name;<br># <span class="hljs-number">3</span>)<span class="hljs-keyword">UNION</span>:<span class="hljs-keyword">UNION</span>运算符用于组合两个或多个<span class="hljs-keyword">SELECT</span>语句的结果集<br>  eg. <span class="hljs-keyword">SELECT</span> column_name(s) <span class="hljs-keyword">FROM</span> table1 <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> column_name(s) <span class="hljs-keyword">FROM</span> table2;<br># <span class="hljs-number">4</span>)<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>:<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>选择每个表中的所有行并将它们组合成一个表<br>  eg. <span class="hljs-keyword">SELECT</span> ID, FirstName, LastName, City <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">First</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> ID, FirstName, LastName, City <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Second</span>;<br></code></pre></td></tr></table></figure><h4 id="insert">INSERT</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">INSERT INTO</span> 表名 (列名<span class="hljs-number">1</span>,列名<span class="hljs-number">2</span>,...) <span class="hljs-keyword">VALUES</span> (列值<span class="hljs-number">1</span>,列值<span class="hljs-number">2</span>,...);<br>eg. <span class="hljs-keyword">INSERT INTO</span> table_name <span class="hljs-keyword">VALUES</span>(value1, value2, value3,...);<br>eg. <span class="hljs-keyword">INSERT INTO</span> Employees <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;Anthony&#x27;</span>, <span class="hljs-string">&#x27;Young&#x27;</span>, <span class="hljs-number">35</span>);<br><br>eg. <span class="hljs-keyword">INSERT INTO</span> table_name (column1, column2, column3, ...,columnN)  <span class="hljs-keyword">VALUES</span> (value1, value2, value3,...valueN);<br>eg. <span class="hljs-keyword">INSERT INTO</span> Employees (ID, FirstName, LastName, Age) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;Anthony&#x27;</span>, <span class="hljs-string">&#x27;Young&#x27;</span>, <span class="hljs-number">35</span>);<br></code></pre></td></tr></table></figure><h4 id="update">UPDATE</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">UPDATE</span> 表名 <span class="hljs-keyword">SET</span> 列名<span class="hljs-operator">=</span>值 <span class="hljs-keyword">where</span> 条件;<br>eg. <span class="hljs-keyword">UPDATE</span> tbl_name <span class="hljs-keyword">SET</span> column1<span class="hljs-operator">=</span>value1, column2<span class="hljs-operator">=</span>value2, ... <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>;       <br>eg. <span class="hljs-keyword">UPDATE</span> Employees <span class="hljs-keyword">SET</span> Salary<span class="hljs-operator">=</span><span class="hljs-number">5000</span> <span class="hljs-keyword">WHERE</span> ID<span class="hljs-operator">=</span><span class="hljs-number">1</span>; <br></code></pre></td></tr></table></figure><h4 id="delete">DELETE</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">eg. <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> tbl_name <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>;<br>eg. <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> Employees <span class="hljs-keyword">WHERE</span> ID<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><h4 id="create-tables">CREATE TABLES</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">CREATE TABLE</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span> <br>(<br>列名<span class="hljs-number">1</span> 数据类型[列级别约束条件][<span class="hljs-keyword">default</span>],<br>    列名<span class="hljs-number">2</span> 数据类型[列级别约束条件][<span class="hljs-keyword">default</span>],<br>    ...<br>    [表级别约束条件]<br>);<br>eg. <span class="hljs-keyword">CREATE TABLE</span> table_name(<br>  column_name1 data_type(size),<br>  column_name2 data_type(size),<br>  column_name3 data_type(size),<br>  ....<br>  column_Nu data_type(size)<br>);<br><br>eg. <span class="hljs-keyword">CREATE TABLE</span> Users(<br>     UserID <span class="hljs-type">int</span>,<br>     FirstName <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>), <br>     LastName <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>),<br>    City <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>),<br>    <span class="hljs-keyword">PRIMARY KEY</span>(UserID)<br>    );<br><br>eg. <span class="hljs-keyword">CREATE TABLE</span> testDB(<br>  id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) key,         # <span class="hljs-keyword">primary key</span>(id)<br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">not null</span> comment <span class="hljs-string">&#x27;student name&#x27;</span><br>);<br></code></pre></td></tr></table></figure><h4 id="alter-用于添加删除或修改现有表中的列">ALTER:用于添加，删除或修改现有表中的列</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">ALTER TABLE</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ADD</span> (<span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>类型<span class="hljs-operator">&gt;</span>,<span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>类型<span class="hljs-operator">&gt;</span>,...) [约束条件] [<span class="hljs-keyword">FIRST</span> <span class="hljs-operator">|</span> AFTER 已存在列名];<br>eg. <span class="hljs-keyword">ALTER TABLE</span> People <span class="hljs-keyword">ADD</span> DateOfBirth <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>);<br>  上述<span class="hljs-keyword">SQL</span>代码People表中添加一个名为DateOfBirth的新列<br><br><span class="hljs-keyword">ALTER TABLE</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">DROP</span> <span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span>;<br>eg. <span class="hljs-keyword">ALTER TABLE</span> People <span class="hljs-keyword">DROP</span> DateOfBirth;<br>  上述<span class="hljs-keyword">SQL</span>代码删除People表中名为DateOfBirth的列。<br><br>eg. <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> People,People1;<br><span class="hljs-keyword">DROP</span> DATABASES [IF EXITSTS] db_name;<br><br><span class="hljs-keyword">ALTER TABLE</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span> CHANGE <span class="hljs-operator">&lt;</span>旧列名<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>新列名<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>新数据类型<span class="hljs-operator">&gt;</span>;<br><span class="hljs-keyword">ALTER TABLE</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span> MODIFY <span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>列类型<span class="hljs-operator">&gt;</span> [<span class="hljs-keyword">FIRST</span><span class="hljs-operator">|</span>AFTER] <span class="hljs-operator">&lt;</span>列<span class="hljs-number">2</span><span class="hljs-operator">&gt;</span>;<br>eg. <span class="hljs-keyword">ALTER TABLE</span> People CHANGE FirstName name <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>);<br><br><span class="hljs-keyword">ALTER TABLE</span> <span class="hljs-operator">&lt;</span>旧表名<span class="hljs-operator">&gt;</span> RENAME [<span class="hljs-keyword">TO</span>] <span class="hljs-operator">&lt;</span>新表名<span class="hljs-operator">&gt;</span>;<br>eg. <span class="hljs-keyword">ALTER TABLE</span> People RENAME <span class="hljs-keyword">TO</span> Users;<br>  上述<span class="hljs-keyword">SQL</span>代码重命名列<br>  <br><span class="hljs-keyword">ALTER</span> DATABASES db_name [<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-keyword">CHARACTER SET</span> [<span class="hljs-operator">=</span>] charset_name<br>eg. <span class="hljs-keyword">ALTER</span> databases test2 <span class="hljs-keyword">character set</span> latin1;<br><span class="hljs-keyword">SHOW</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;character%&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="约束">约束</h3><h4 id="约束介绍">约束介绍</h4><table><thead><tr><th>约束类型</th><th>非空约束</th><th>主键约束</th><th>唯一约束</th><th>默认约束</th><th>外键约束</th></tr></thead><tbody><tr><td>关键字</td><td>NOT NULL</td><td>PRIMARY KEY</td><td>UNIQUE</td><td>DEFAULT</td><td>FOREIGN KEY</td></tr></tbody></table><h4 id="not-null">NOT NULL</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">/*创建表时加非空约束*/</span><br><span class="hljs-keyword">CREATE TABLE</span> bookinfo(<br>book_id <span class="hljs-type">int</span>,<br>    book_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT NULL</span><br>);<br><span class="hljs-comment">/*修改表*/</span><br><span class="hljs-keyword">ALTER TABLE</span> bookinfo MODIFY book_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT NULL</span>;<br><br></code></pre></td></tr></table></figure><h4 id="primary-key">PRIMARY KEY</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">/*单字段*/</span><br><span class="hljs-keyword">CREATE TABLE</span> bookinfo(<br>book_id <span class="hljs-type">int</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    book_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT NULL</span><br>    <span class="hljs-comment">/*CONSTRAINT pk_id PRIMARY KEY (book_id)*/</span><br>);<br><span class="hljs-comment">/*复合主键*/</span><br><span class="hljs-keyword">CREATE TABLE</span> bookinfo(<br>book_id <span class="hljs-type">int</span>,<br>    book_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    <span class="hljs-keyword">PRIMARY KEY</span>(book_id,card_id)<br>);<br><span class="hljs-comment">/*修改主键*/</span><br><span class="hljs-keyword">ALTER TABLE</span> bookinfo <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">PRIMARY KEY</span>(book_id);<br><span class="hljs-keyword">ALTER TABLE</span> bookinfo MODIFY book_id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>;<br><span class="hljs-keyword">ALTER TABLE</span> bookinfo <span class="hljs-keyword">ADD CONSTRAINT</span> PK_ID <span class="hljs-keyword">PRIMARY KEY</span>(book_id);<br><span class="hljs-comment">/*删除主键*/</span><br><span class="hljs-keyword">ALTER TABLE</span> bookinfo <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PRIMARY KEY</span>;<br><br></code></pre></td></tr></table></figure><h4 id="unique">UNIQUE</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">CREATE TABLE</span> bookinfo(<br>book_id <span class="hljs-type">int</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    book_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT NULL</span>,<br>    <span class="hljs-comment">/*CONSTRAINT uk_bname UNIQUE (book_id)*/</span><br>);<br><span class="hljs-comment">/*删除主键*/</span><br><span class="hljs-keyword">ALTER TABLE</span> bookinfo <span class="hljs-keyword">DROP</span> KEY uk_bname;<br></code></pre></td></tr></table></figure><h4 id="foreign-key">FOREIGN KEY</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">/*创建外键*/</span><br><span class="hljs-keyword">CREATE TABLE</span> bookcategory(<br>category_id <span class="hljs-type">int</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    category <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>    parent_id <span class="hljs-type">int</span><br>);<br><span class="hljs-keyword">CREATE TABLE</span> bookinfo(<br>book_id <span class="hljs-type">int</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    book_category_id <span class="hljs-type">int</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> fk_cid <span class="hljs-keyword">FOREIGN KEY</span> (book_category_id) <span class="hljs-keyword">REFERENCES</span> bookcategory (category_id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br>);<br><br><span class="hljs-keyword">ALTER TABLE</span> bookinfo <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN KEY</span> fk_cid;<br><span class="hljs-keyword">ALTER TABLE</span> bookinfo <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">FOREIGN  KEY</span> (book_category_id) REFERENCE bookcategory (category_id);<br><br><span class="hljs-comment">/*CASCADE 从父表删除或更新且自动删除或更新子表中匹配的行*/</span><br></code></pre></td></tr></table></figure><h4 id="创建用户">创建用户</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> 用户名<span class="hljs-variable">@IP</span>地址 IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;密码&#x27;</span>; # 指定的IP上登陆<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> 用户名@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;密码&#x27;</span>;    # 登陆不限定IP<br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> 用户名<span class="hljs-variable">@IP</span>地址;<br></code></pre></td></tr></table></figure><h4 id="授权查看权限解除权限">授权/查看权限/解除权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">GRANT</span> 权限<span class="hljs-number">1</span>,...权限n <span class="hljs-keyword">ON</span> 数据库.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> 用户名<span class="hljs-variable">@IP</span>地址;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> 数据库.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> 用户名<span class="hljs-variable">@IP</span>地址;<br><br><span class="hljs-keyword">SHOW</span> GRANTS <span class="hljs-keyword">FOR</span> 用户名<span class="hljs-variable">@IP</span>地址;<br><br><span class="hljs-keyword">REVOKE</span> 权限<span class="hljs-number">1</span>,...权限n <span class="hljs-keyword">ON</span> 数据库.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 用户名<span class="hljs-variable">@IP</span>地址;<br><span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> 数据库.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 用户名<span class="hljs-variable">@IP</span>地址;<br></code></pre></td></tr></table></figure><h3 id="忘记密码问题解决">忘记密码问题解决</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">service mysql stop <br>mysqld_safe --user=mysql --skip-grant-tables --skip-networking &amp;   <span class="hljs-comment"># 跳过授权表模式  </span><br>mysql -uroot -p    <span class="hljs-comment"># 不输密码直接回车</span><br>use mysql;<br>update user <span class="hljs-built_in">set</span> password=PASSWORD(<span class="hljs-string">&quot;123&quot;</span>) <span class="hljs-built_in">where</span> user =<span class="hljs-string">&#x27;root&#x27;</span>;  <span class="hljs-comment"># 设置新密码为123  </span><br>flush privileges;  <br>quit;<br><br>service mysql stop   <br>service mysql start     <span class="hljs-comment"># 以正常模式启动</span><br>mysql -u root -p        <span class="hljs-comment"># 回车输入新密码即可 </span><br><br>MariaDB [(none)]&gt; delete from user <span class="hljs-built_in">where</span> user=<span class="hljs-string">&#x27;&#x27;</span>;<br>MariaDB [(none)]&gt; delete from user <span class="hljs-built_in">where</span> password=<span class="hljs-string">&#x27;&#x27;</span>;  <br>MariaDB [(none)]&gt; create database anyue default character <span class="hljs-built_in">set</span> latin1;  <br>[root@xingyue masR5]# mysql -uroot -p123456 anyue &lt; masR5.sql --default-character-set=lantin1<br></code></pre></td></tr></table></figure><p><a href="#目录" target="_self">回到顶部</a></p>]]></content>
    
    
    <categories>
      
      <category>SQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
      <tag>数据库</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BatShell</title>
    <link href="/posts/8ef1acd.html"/>
    <url>/posts/8ef1acd.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-09-BatShell <span id="more"></span></p><h1 id="windows-bat-脚本">Windows bat 脚本</h1><blockquote><p>批处理文件，在DOS和Windows（任意）系统中，.bat文件是可执行文件，由一系列命令构成，其中可以包含对其他程序的调用。<a href="https://www.jb51.net/article/151923.htm">BATSHELL参考</a></p></blockquote><h2 id="语法">语法：</h2><ul><li><p><code>echo</code>: 显示信息，或将命令回显打开或关上</p><ul><li>echo [on | off]</li><li>echo [message]</li></ul></li><li><p><code>@</code>: 表示不显示@后面的命令</p><ul><li>标签必须单独一行，并且以冒号打头。</li><li>如果命令扩展被启用，GOTO 会如下改变</li></ul></li><li><p><code>goto</code>: goto label, 无条件跳转</p><ul><li>label 指定批处理程序中用作标签的文字字符串 <figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs BAT"><span class="hljs-keyword">goto</span> end<br>:end<br></code></pre></td></tr></table></figure></li></ul></li><li><p><code>rem</code>: 在批处理文件或 CONFIG.SYS 里加上注解或说明</p><ul><li>rem [comment]</li><li>:: [commnet]</li></ul></li><li><p><code>title</code>: 设置窗口标题</p><ul><li>title [string]</li></ul></li><li><p><code>pause</code>：暂停批处理程序，并显示以下消息:</p><ul><li>请按任意键继续. . .</li></ul></li><li><p><code>call</code>：call [drive:][path]filename [batch-parameters]<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs BAT">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-keyword">call</span> :an Hello 世界!<br>:an<br><span class="hljs-built_in">echo</span> %<span class="hljs-number">1</span><br><span class="hljs-built_in">echo</span> %<span class="hljs-number">2</span><br><span class="hljs-built_in">pause</span>&gt;null<br><br>输出为: Hello 世界！<br></code></pre></td></tr></table></figure></p></li><li><p><code>if</code>：执行批处理程序中的条件处理<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs BAT"><span class="hljs-keyword">IF</span> [<span class="hljs-keyword">NOT</span>] <span class="hljs-keyword">ERRORLEVEL</span> number command  <br><span class="hljs-keyword">IF</span> [<span class="hljs-keyword">NOT</span>] string1==string2 command <br><span class="hljs-keyword">IF</span> [<span class="hljs-keyword">NOT</span>] <span class="hljs-keyword">EXIST</span> filename command <br></code></pre></td></tr></table></figure></p></li><li><p><code>for</code>：对一组文件中的每一个文件执行某个特定命令<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs BAT"><span class="hljs-keyword">for</span> %variable <span class="hljs-keyword">in</span> (<span class="hljs-built_in">set</span>) <span class="hljs-keyword">DO</span> command [command-parameters]<br></code></pre></td></tr></table></figure></p><ul><li>在批处理程序中使用 for 命令时, 指定变量请使用<code>%%variable</code>而不要用 <code>%variable</code>,变量名称是区分大小写的，所以 %i不同于 %I</li></ul></li><li><p><code>set</code>：显示、设置或删除 cmd.exe 环境变量<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs BAT"><span class="hljs-built_in">set</span> [variable=[string]]  <br>variable  # 指定环境变量名 <br>string    # 指定要指派给变量的一系列字符串  <br><span class="hljs-built_in">SET</span> /A expression <br><span class="hljs-built_in">SET</span> /P variable=[promptString]<br></code></pre></td></tr></table></figure></p></li><li><p><code>del</code>：删除一个或数个文件 <figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs BAT"><span class="hljs-built_in">DEL</span> [/P] [/F] [/S] [/Q] [/A[[:]attributes]] names<br></code></pre></td></tr></table></figure></p></li></ul><h2 id="参数">参数：</h2><ul><li><p>批脚本里的 <code>%*</code> 指出所有的参数(如<code>%1 %2 %3 %4 %5 ...</code>)</p></li><li><p>批参数(%n)的替代已被增强： <figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs BAT">%~<span class="hljs-number">1</span>         - 删除引号(&quot;)，扩展 <span class="hljs-variable">%1</span><br><span class="hljs-variable">%</span>~f1        - 将 %<span class="hljs-number">1</span> 扩展到一个完全合格的路径名<br>%~d1        - 仅将 %<span class="hljs-number">1</span> 扩展到一个驱动器号<br>%~p1        - 仅将 %<span class="hljs-number">1</span> 扩展到一个路径<br>%~n1        - 仅将 %<span class="hljs-number">1</span> 扩展到一个文件名<br>%~x1        - 仅将 %<span class="hljs-number">1</span> 扩展到一个文件扩展名<br>%~s1        - 扩展的路径只含有短名<br>%~a1        - 将 %<span class="hljs-number">1</span> 扩展到文件属性<br>%~t1        - 将 %<span class="hljs-number">1</span> 扩展到文件的日期/时间<br>%~z1        - 将 %<span class="hljs-number">1</span> 扩展到文件的大小<br>%~$<span class="hljs-built_in">PATH</span>:<span class="hljs-number">1</span>   - 查找列在 <span class="hljs-built_in">PATH</span> 环境变量的目录，并将 %<span class="hljs-number">1</span><br>              扩展到找到的第一个完全合格的名称。如果<br>              环境变量名未被定义，或者没有找到文件，<br>              此修改符会扩展到空字符串<br></code></pre></td></tr></table></figure></p></li><li><p>可以组合修改符来取得多重结果(d-Drive，p-Path):<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs BAT">%~dp0       - 获取当前路径<br>%~dp1       - 只将 %<span class="hljs-number">1</span> 扩展到驱动器号和路径<br>%~nx1       - 只将 %<span class="hljs-number">1</span> 扩展到文件名和扩展名<br>%~dp$<span class="hljs-built_in">PATH</span>:<span class="hljs-number">1</span> - 在列在 <span class="hljs-built_in">PATH</span> 环境变量中的目录里查找 <span class="hljs-variable">%1，并扩展到找到的第一个文件的驱动器号和路径。</span><br><span class="hljs-variable">%</span>~ftza1     - 将 %<span class="hljs-number">1</span> 扩展到类似 <span class="hljs-built_in">DIR</span> 的输出行<br></code></pre></td></tr></table></figure></p></li><li><p><strong>%源字符串:~起始值,截取长度%</strong>(起始值从0开始；截取长度是可选的，如果省略逗号和截取长度，将会从起始值截取到结尾；</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>CRH</category>
      
    </categories>
    
    
    <tags>
      
      <tag>bat</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>网络知识学习</title>
    <link href="/posts/ffc70460.html"/>
    <url>/posts/ffc70460.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-09-网络知识学习 <span id="more"></span></p><h1 id="目录">目录 <a id="top"></a></h1><p><a href="#xianxu" target="_self">异直同交</a><br /><a href="#switch" target="_self">交换机配置</a><br /><a href="#route" target="_self">路由器配置</a><br /><a href="#IPv4" target="_self">IP</a><br /><a href="#netmask" target="_self">子网掩码</a><br /><a href="#wangguan" target="_self">网关与路由</a><br /><a href="#ziwanghuafen" target="_self">子网划分</a><br /><a href="#wangluoshebei" target="_self">网络设备</a><br /><a href="#OSI" target="_self">七层网络模型</a><br /><a href="#xieyi" target="_self">TCP/IP</a><br /><a href="#command" target="_self">常用网络命令</a><br /><a href="#VMware" target="_self">VMware网络模式</a><br /><a href="#luyoubiao" target="_self">路由表</a><br /><a href="#ip-cmd" target="_self">ip命令</a></p><h2 id="网络学习">网络学习:</h2><h3id="主机之间的通信其实是主机内运行的进程间的通信按通信方式分为以下三类">1.主机之间的通信其实是主机内运行的<strong>进程间的通信</strong>。按通信方式分为以下三类：</h3><ul><li><p><code>客户/服务器方式（C/S模式）</code>:<strong>客户（client）</strong>和<strong>服务器（server）</strong>都是指通信中所涉及的两个应用进程。客户是服务请求方，服务器是服务提供方。数据处理方式为:<code>客户端从服务器获取数据，然后对数据进行处理，将处理结果返回给服务器，允许多个客户端对数据进行共同访问和处理</code>。</p></li><li><p><code>浏览器/服务器类型（B/S模式）</code>:<strong>浏览器/服务器类型</strong>，即Browser/Server模式，<code>数据的运算已无需在客户端进行。客户端在安装浏览器之后，只负责显示服务器发来的信息，然后将用户操作返回给服务器，数据的运算可以全部在服务器上进行</code>。客户端只需要通过浏览器，就可以访问和显示任何服务器发来的信息，从而大大降低了网络的管理和维护的成本。这种模型称为浏览器服务器类型（B/S模式），又称为瘦客户端模型（ThinClient），与之相对的C/S模型称为胖客户端模型（Fat Client）。</p></li><li><p>服务端模型常见的为B/W/D(Browser Server /Web/DatabaseServer，浏览器/网站服务器/数据库服务器。各层次分布完成不同的任务，以提高系统整体的可靠性、稳定性和灵活性，因此B/S模式又称为多层模型。</p></li></ul><h3 id="异直同交">2. 异直同交： <a id="xianxu"></a></h3><ul><li><code>异种设备</code>之间用直连线(<code>正线</code>)，两头的线序一样（同为T568A线序或T568B线序）；<br /></li><li><code>同种设备</code>之间用交叉线(<code>反线</code>)，两头的线序不一样（一头为T568A，另外一头为568B）；</li></ul><img src="/posts/ffc70460/%E5%8F%8C%E7%BB%9E%E7%BA%BF.jpg" class="" title="[双绞线]"><img src="/posts/ffc70460/%E4%BF%A1%E9%81%93.jpg" class="" title="[信道]"><h3 id="线序排列以此为从左至右">3. 线序排列以此为从左至右：</h3><ul><li>T568B线序为：<code>橙白-1，橙-2，绿白-3，蓝-4，蓝白-5，绿-6，褐白-7，褐-8</code><br /></li><li>T568A线序为：<code>绿白-1，绿-2，橙白-3，蓝-4，蓝白-5，橙-6，褐白-7，褐-8</code></li></ul><h3 id="ip点分十进制表示">4. IP(点分十进制表示)： <a id="IPv4"></a></h3><table><thead><tr><th>表一</th><th>8位</th><th>8位</th><th>8位</th><th>8位</th></tr></thead><tbody><tr><td>A类</td><td>0网络号(网络地址)</td><td>主机号(主机地址)</td><td>主机号(主机地址)</td><td>主机号(主机地址)</td></tr><tr><td>B类</td><td>10网络号</td><td>网络号</td><td>主机</td><td>主机</td></tr><tr><td>C类</td><td>110网络号</td><td>网络号</td><td>网络号</td><td>主机</td></tr></tbody></table><table><thead><tr><th>表二</th><th>二进制范围</th><th>十进制范围</th></tr></thead><tbody><tr><td>A类</td><td>0 0000000 - 0 1111111</td><td>0-127</td></tr><tr><td>B类</td><td>10 000000 00000000 - 10 111111 00000000</td><td>128-191</td></tr></tbody></table><table><thead><tr><th>表三</th><th>范围</th><th>默认子网掩码</th></tr></thead><tbody><tr><td>A类</td><td>1.0.0.0 ~ 126.0.0.0</td><td>默认子网：255.0.0.0，其中 0 与 127除外</td></tr><tr><td>B类</td><td>128.1.0.0 ~ 191.255.0.0</td><td>默认子网：255.255.0.0</td></tr><tr><td>C类</td><td>192.0.1.0 ~ 223.255.255.255</td><td>默认子网：255.255.255.0</td></tr></tbody></table><h4 id="重要将ip地址和掩码与运算就是子网地址网络地址">4.1重要：将（ip地址）和（掩码）与运算，就是子网地址(网络地址)<a id="netmask"></a></h4><p><strong>私有IP(在本地局域网上的IP):</strong> <figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-keyword">A</span>类：<span class="hljs-number">10.0.0.0</span> ~ <span class="hljs-number">10.255.255.255</span><br>B类：<span class="hljs-number">172.16.0.0</span> ~ <span class="hljs-number">172.31.255.255</span><br>C类：<span class="hljs-number">192.168.0.0</span> ~ <span class="hljs-number">192.168.255.255</span><br></code></pre></td></tr></table></figure></p><table><thead><tr><th>网络号/地址</th><th>主机号/地址</th><th>源地址</th><th>目的地址</th><th>意义</th></tr></thead><tbody><tr><td>全0</td><td>全0</td><td>可用</td><td>不可用</td><td>本网络所有主机</td></tr><tr><td>全0</td><td>主机号</td><td>可用</td><td>不可用</td><td>本网中的某个主机</td></tr><tr><td>网络号</td><td>全1</td><td>不可用</td><td>可用</td><td>对Net-id所有主机进行广播(直接广播地址)</td></tr><tr><td>全1</td><td>全1</td><td>不可用</td><td>可用</td><td>只在本网络内部广播各路由器均不转发(受限广播地址)</td></tr></tbody></table><blockquote><p><code>127.0.0.1~127.255.255.255</code>: 为回环地址, 用于回路测试。网络地址全为0: 表示当前网络或网段;<br />网络地址全为1: 表示所有网络;<br />主机地址全为0: 表示网络地址或指定网络中的任何主机;<br />主机地址全为1: 表示网络中的所有节点;</p></blockquote><img src="/posts/ffc70460/CCNA-4.png" class="" title="[IP图示]"><img src="/posts/ffc70460/CCNA-5.png" class="" title="[可用IP图示]"><img src="/posts/ffc70460/IP-1.png" class="" title="[保留IP图示]"><img src="/posts/ffc70460/CCNA-7.jpg" class="" title="[公有IP与私有IP]"><img src="/posts/ffc70460/%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86%E5%9B%BE%E8%A7%A3.jpg" class="" title="[子网划分]"><h4 id="section">4.2 <a id="wangguan"></a></h4><blockquote><p>网关:网关实质上是<code>一个网络通向其他网络</code>的<code>IP地址</code>，不具体指一类产品，只要<code>连接两个不同网络</code>的设备都可以称作网关；多数工作在OSI模型应用层。默认网关必须是<code>电脑自己所在的网段中的IP地址</code>，而不能填写其他网段中的IP地址。作用:不同网段数据转发，路由选择，默认路由，NAT转换。</p></blockquote><blockquote><p>路由器是网关设备的一种，是连接Internet中各局域网、广域网的设备，它在互连网络中从多条路径中寻找通讯量最少的一条网络路径提供给用户通信。</p></blockquote><blockquote><p>路由:指分组从源到目的地时，决定端到端路径的网络范围的进程，路由工作在OSI参考模型第三层。作用:不同网段数据转发，路由选择;</p></blockquote><h3 id="子网的划分">5. 子网的划分：<a id="ziwanghuafen"></a></h3><blockquote><p>CIDR 无类域间路由表示法：<code>IP/网络ID位数(netMask)</code><br />网络（网段）数量=<code>2^可变网络ID位数</code><br />一个网络主机数量(IP)=<code>2^主机ID位数-2</code>=<code>2^(32-网络ID位数)-2</code><br />网络ID=<code>IP 与 子网掩码(网络ID位数)</code><br /><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs dns">例<span class="hljs-number">1</span>: <span class="hljs-number">172.20.222.123</span>/<span class="hljs-number">20</span>         <span class="hljs-number">172.20.230.100</span>/<span class="hljs-number">20</span><br>    <br>    <span class="hljs-number">172</span>.<span class="hljs-number">20.11011110</span>.<span class="hljs-number">123</span>       <span class="hljs-number">172</span>.<span class="hljs-number">20.11100110</span>.<span class="hljs-number">100</span><br>    <span class="hljs-number">255.255</span>.<span class="hljs-number">11110000.0</span>        <span class="hljs-number">255.255</span>.<span class="hljs-number">11110000.0</span><br>            <span class="hljs-number">11010000.0</span>                <span class="hljs-number">11100000.0</span><br>    netID: <span class="hljs-number">172.20.208.0</span>       netID: <span class="hljs-number">172.20.224.0</span> 不在一个网段<br><br>例<span class="hljs-number">2</span>: <span class="hljs-number">192.168.199.111</span>/<span class="hljs-number">21</span><br>    <br>    <span class="hljs-number">192.168</span>.<span class="hljs-number">11000111.111</span><br>    <span class="hljs-number">255.255</span>.<span class="hljs-number">11111000.0</span><br><br>    <span class="hljs-number">192.168</span>.<span class="hljs-number">11000000.0</span>   <br>    netID: <span class="hljs-number">192.168.192.0</span><br>    子网掩码: <span class="hljs-number">255.255.248.0</span><br><br>    <span class="hljs-number">192.168.11000</span> <span class="hljs-number">000</span>.<span class="hljs-number">00000001</span>  <span class="hljs-number">192.168.192.1</span>/<span class="hljs-number">21</span><br>    <span class="hljs-number">192.168.11000</span> <span class="hljs-number">111.11111110</span>  <span class="hljs-number">192.168.199.254</span>/<span class="hljs-number">21</span><br>     <br>例<span class="hljs-number">3</span>: <span class="hljs-number">222.111.188.123</span>/<span class="hljs-number">26</span><br>    <br>    <span class="hljs-number">222.111.188</span>.<span class="hljs-number">01111011</span><br>    <span class="hljs-number">255.255.255</span>.<span class="hljs-number">11000000</span><br><br>    <span class="hljs-number">222.111.188</span>.<span class="hljs-number">01000000</span><br>    netID: <span class="hljs-number">222.111.188.64</span><br>    netmask: <span class="hljs-number">255.255.255.192</span><br><br>    <span class="hljs-number">222.111.188.01</span> <span class="hljs-number">000001</span>  <span class="hljs-number">222.111.188.65</span>/<span class="hljs-number">26</span><br>    <span class="hljs-number">222.111.188.01</span> <span class="hljs-number">111110</span>  <span class="hljs-number">222.111.188.126</span>/<span class="hljs-number">26</span><br><br>例<span class="hljs-number">4</span>:<br><span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span><span class="hljs-number">1</span>  <br><span class="hljs-number">128</span> <span class="hljs-number">64</span> <span class="hljs-number">32</span> <span class="hljs-number">16</span> <span class="hljs-number">8</span> <span class="hljs-number">4</span> <span class="hljs-number">2</span><span class="hljs-number">1</span>=<span class="hljs-number">255</span> (之和为<span class="hljs-number">255</span>)  <br><br>例<span class="hljs-number">5</span>:<br>划分子网，一个大网络(主机多ID多, 网络ID少)；划分为多个小网络(主机多ID少, 网络ID多)，网络ID位向主机ID位借N位，划分为 <span class="hljs-number">2</span>^N 个子网<br><br><span class="hljs-number">10.0.0.0</span>/<span class="hljs-number">8</span> 分成<span class="hljs-number">2</span>个子网: <span class="hljs-number">10.0.0.0</span>/<span class="hljs-number">9</span>  <span class="hljs-number">10.128.0.0</span>/<span class="hljs-number">9</span><br><span class="hljs-number">10</span>.<span class="hljs-number">0 0000000</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>:<br> <span class="hljs-number">10</span>.<span class="hljs-number">0 0000000</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>     min:<span class="hljs-number">10.0.0.1</span><br> <span class="hljs-number">10.0 1111111</span>.<span class="hljs-number">255.254</span> max:<span class="hljs-number">10.127.255.254</span>  <br><span class="hljs-number">10</span>.<span class="hljs-number">1 0000000</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span><br> <span class="hljs-number">10</span>.<span class="hljs-number">1 0000000</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>     min:<span class="hljs-number">10.128.0.1</span><br> <span class="hljs-number">10.1 1111111</span>.<span class="hljs-number">255.254</span> max:<span class="hljs-number">10.255.255.254</span><br><br>例<span class="hljs-number">6</span>:<br>现有一个IP地址<span class="hljs-number">132.119.110.200</span> 的子网掩码为<span class="hljs-number">255.255.255.240</span>, 它所在的IP子网是什么？它所在子网的广播是地址是多少？<br>子网IP: <br>  <span class="hljs-number">128 64 32 16</span> <span class="hljs-number">8 4 2 1</span><br>  <span class="hljs-number">132.119.100</span>.<span class="hljs-number">11001000</span> <br>  <span class="hljs-number">255.255.255</span>.<span class="hljs-number">11110000</span>     --&gt;<span class="hljs-number">132.119.100</span>.<span class="hljs-number">11000000</span>, 即<span class="hljs-number">132.119.100.192</span><br><br>子网广播地址主机位全为<span class="hljs-number">1</span>:<br>  网络广播地址指的是网络位不变，主机位全为<span class="hljs-number">1</span>，代表特定网段的所有节点。子网掩码<span class="hljs-number">1</span>的数目等于网络位的长度<br>  <span class="hljs-number">240:11110000</span> 所以 网络位为：<span class="hljs-number">8+8+8+4</span>=<span class="hljs-number">28</span>位 ，所以<span class="hljs-number">132.119.100.200</span>的前<span class="hljs-number">28</span>位位网络位。网络位不变，主机位全为<span class="hljs-number">1</span>代表广播地址；<br>  又因为 <span class="hljs-number">200:11001000</span> 所以 广播地址就是<span class="hljs-number">132.119.100</span>.<span class="hljs-number">11001111</span>（<span class="hljs-number">11001111</span>的后四位是主机位）即：<span class="hljs-number">132.119.100.207</span><br></code></pre></td></tr></table></figure></p></blockquote><blockquote><p>利用主机借位的方法来划分子网，下面以C类网络为例（默认:/24）<br /><code>网络地址：</code>192.168.10.0<br /><code>子网掩码：</code>255.255.255.128，也即 192.168.10.0/25<br />* 1、首先： 主机位只有1位用于子网划分，余下7位用于定义主机号<br />* 2、其次子网个数： 2<sup>借位数：即2</sup>1=2个子网；<br />每个子网主机数：2^(32-25) - 2 = 126； 合法的子网，确定块增量：256 - 128= 128，即从0开始，步长128； * 3、列表格</p></blockquote><table><thead><tr><th>-</th><th>项目1</th><th>项目2</th><th>注意</th></tr></thead><tbody><tr><td>子网</td><td>0</td><td>128</td><td>–</td></tr><tr><td>第一个主机</td><td>1</td><td>129</td><td>–</td></tr><tr><td>最后一个主机</td><td>126</td><td>254</td><td>–</td></tr><tr><td>广播地址</td><td>127</td><td>255</td><td>(广播地址总是下个子网前面的数)</td></tr></tbody></table><blockquote><p>利用主机借位的方法来划分子网，又以B类网络为例（默认/16）<br /><code>网络地址：</code>128.1.0.0<br /><code>子网掩码：</code>255.255.224.0 也即 128.1.0.0/19<br />* 1、首先： 主机位只有3位用于子网划分，余下13位用于定义主机号 *2、其次子网个数：<br />2<sup>借位数，即2</sup>3=8个子网；<br />每个子网主机数：2^13 - 2 = 8190；<br />合法的子网，确定块增量，256 - 224 = 32，即从0开始，步长32；<br />* 3、列表格</p></blockquote><table><thead><tr><th>-</th><th>项目1</th><th>项目2</th><th>项目3</th><th>项目4</th><th>项目5</th><th>项目6</th><th>项目7</th><th>项目8</th></tr></thead><tbody><tr><td>子网</td><td>0.0</td><td>32.0</td><td>64.0</td><td>96.0</td><td>128.0</td><td>160.0</td><td>192.0</td><td>224.0</td></tr><tr><td>第一个主机</td><td>0.1</td><td>32.1</td><td>64.1</td><td>96.1</td><td>128.1</td><td>160.1</td><td>192.1</td><td>224.1</td></tr><tr><td>最后一个主机</td><td>0.254</td><td>63.254</td><td>64.254</td><td>127.254</td><td>159.254</td><td>191.254</td><td>223.254</td><td>255.254</td></tr><tr><td>广播地址</td><td>31.255</td><td>63.255</td><td>95.255</td><td>127.255</td><td>159.255</td><td>191.255</td><td>223.255</td><td>255.255</td></tr></tbody></table><ul><li>4、冲突域与广播域：<ul><li>冲突域：连接在同一根线上的节点组成的区域；<br /></li><li>广播域：能够接收到同一个广播消息的节点的集合，其中任何一个节点发送一个广播帧，其他节点均能接收到；</li></ul></li></ul><h3 id="基本网络设备">6.基本网络设备: <a id="wangluoshebei"></a></h3><ul><li>冲突域：被看作是第一层(物理层)的概念，<strong>用Hub或者Repeater连接的所有节点集合可以被认为是在同一个冲突域内</strong>，它不会划分冲突域，一个Hub就是一个冲突域，一个广播域；<br /></li><li>广播域：被看作是第二层(数据链路层)的概念，<strong>接收同样广播消息的节点的集合</strong>，第二层设备（网桥，交换机）第三层设备（路由器）都可以划分冲突域的，当然也可以连接不同的冲突域，交换机的每个端口都是一个冲突域，一个交换机就是一个广播域；<br /></li><li><ahref="https://blog.csdn.net/ugly_girl/article/details/80901887">广播域与冲突域</a></li></ul><img src="/posts/ffc70460/%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.jpg" class="" title="[交换机与路由器]"><h3 id="osi各层的作用">7.OSI各层的作用 <a id="OSI"></a></h3><h4 id="物理层">物理层:</h4><ul><li>中继器：中继器最大的延长距离只有500米，即两台PC之间最多可以使用4台中继器.双绞线的有效传输距离是100米，超过100米后由于信号衰减将出现信号无法识别的现象</li><li>集线器：相当于<strong>多个端口的中继器</strong>，没有软件系统，是<strong>纯硬件设备</strong>，其将多台计算机和网络设备连接在一起构成共享式局域网，对<strong>数据信号起中继的作用</strong>，集线器是指共享式集线器，其<strong>带宽为所有端口共享</strong>；</li></ul><h4 id="数据链路层">数据链路层:</h4><ul><li>数据链路层的功能:<ul><li>1)完成网络之间相邻结点的可靠传输；</li><li>2)物理层传输的是比特流（Bit），数据链路层传输的就是帧（Frame）；</li><li>3)数据链路层是通过MAC(Media AccessControl)地址负责主机之间数据的可靠传输;</li><li>4)CSMA/CD：载波侦听多路访问 冲突检测</li></ul></li><li>数据链路层的主要设备:<ul><li><p><code>网桥(2端口,配合Hub)</code>是一种在<code>数据链路层实现中继</code>，用于<code>连接两个或更多个局域网的数据链路层设备</code>，它处理的对象是<code>数据链路层的协议数据单元---帧</code>，其处理功能包括检查帧的格式、进行差错校验、识别目标地址、选择路由并实现帧的转发等。网桥可以将两个LAN连接在一起，并且按<code>MAC地址转发</code>和<code>分割冲突域</code>的作用，但<code>无法隔绝广播域</code>，<code>网桥具有源mac地址进行学习，目标mac地址转发的功能*</code><br /></p></li><li><p><code>交换机</code>:交换机可以看作是<code>多端口的网桥</code>，具有<code>源mac地址学习 目的mac地址转发的功能*</code>；<code>每个端口具有一个冲突域，隔绝冲突域，共具有一个广播域。</code>对<code>已知单播帧</code>，只往对应端口转发；对于未知的单播帧，即交换机还没有学到的目的mac地址，会进行广播(发往除接收端口以外的所有接口)。对广播帧或组播帧进行广播。<code>交换机是端口带宽独享</code>，端口之间可以采用全双工进行数据传输，实现数据的线速转发（内部保存着MAC地址与Port的对应关系）</p></li><li><p><code>网卡</code>:网络适配器，是连接计算机与网络之间的硬件设备。功能:整理计算机发往网线的数据，并且将数据分解成适当大小的数据包之后向网络上发送出去。网卡的<code>Mac地址</code>是在它被生产时，厂家烧录到ROM（ReadOnly Memory只读存储）中的，是唯一且不可更改的。</p><img src="/posts/ffc70460/Eth%E5%B8%A7%E6%A0%BC%E5%BC%8F.jpg" class="" title="[Eth帧格式]"></li></ul></li></ul><h4 id="网络层">网络层:</h4><ul><li>网络层的主要设备有<strong>路由器和三层交换机(路由器加上交换模块)。</strong></li><li>主要作用:<ul><li><code>转发网络层数据包，在复杂的网络拓扑结构中找出一条最佳的传输路径</code>，采用逐站传递的方式，把数据包从<code>源节点</code>传输到<code>目的节点</code>。进行网络与网络的连接，是把数据从一个网络发送到另一个网络，这个过程就叫路由。</li><li>路由器的<code>每个端口代表着一个网段</code>,连接不同的网络（一般用于连接广域网),它不仅能<code>隔离冲突域，还能检测广播数据包(主要指本地广播数据包)</code>，并丢弃广播包来<code>隔离广播域</code>，每个路由器是一个广播域。**在路由器中记录着路由表，路由器以此来转发数据，以实现网络间的通信，路由器可使<code>交换机划分的VLAN实现互相通信</code>。</li><li>注意:<ul><li>1)受限广播数据包（<strong>255.255.255.255，网络段和主机段全为1</strong>）不能通过路由器，只能将数据包广播给当前局域网的所有主机，故又称为<strong>本地广播</strong>；</li><li>2)直接广播（主机位全为1，如192.168.1.255/24）可通过路由器而将数据广播给指定网络的所有主机；</li><li>3)在实际的网络环境中，路由器不转发私有网络数据（对于目标地址为私有IP的数据包不转发）；</li><li>4)三层交换机兼具二层交换和三层路由的功能，在模拟器中一般用带有交换模块的路由器来模拟(dynamips)，或者在交换机上加上路由模块。</li></ul></li></ul></li><li><strong>集线器</strong>：工作于物理层、纯硬件、用于连接网络终端、<code>不能打破冲突域和广播域</code>。</li><li><strong>交换机</strong>：工作于数据链路层、拥有软件系统、用于连接网络终端、能够<code>隔离了冲突域</code>，<code>但是不能分割广播域</code>。交换机端口间不再形成冲突域，但每个端口自己仍然一个冲突域。</li><li><strong>路由器</strong>：工作于网络层、拥有软件系统、用于连接网络、可以打破冲突域也可以分割广播域，是连接大型网络的必备设备。<em>路由器的每个端口连接的是一个广播域</em></li></ul><h4 id="传输层">传输层：</h4><ul><li>传输层将数据进行分段并重组为数据流。位于传输层的服务将来自上层应用的数据进行分段和重组，并将它们合并到同一个数据流中。它们提供了端到端的数据传输服务，并可在互联网的发送主机和目标主机之间建立逻辑连接。</li><li>传输层负责提供如下机制:对上层应用程序进行<strong>多路复用、建立会话以及拆除虚电路</strong>。它还提供透明的数据传输，从而对高层隐藏随网络而异的信息。传输层可以是无连接的或面向连接的</li></ul><h4 id="会话层">会话层：</h4><ul><li>会话层负责在表示层实体之间建立、管理和终止会话，还对设备或节点之间的对话进行控制。它协调和组织系统之间的通信，为此提供了3种不同的模式:单工、半双工和全双工。总之，会话层的基本功能是将不同应用程序的数据分离。</li></ul><h4 id="表示层">表示层：</h4><ul><li>表示层因其用途而得名，它向应用层提供数据，并负责数据转换和代码格式化。从本质上说，该层是一个转换器，提供编码和转换功能。</li></ul><h4 id="应用层">应用层：</h4><ul><li>应用层是<code>实际应用程序之间的接口</code>，牢记这一点很重要。这意味着诸如MicrosoftWord 等应用程序并不位于应用层中，而是与应用层协议交互；</li><li>应用层让应用程序能够将信息沿协议横向下传输，从而充当了应用程序的组成部分和下一层之间的接口。换句话说，IE并不位于应用层中，而是在需要处理远程资源时与应用层协议交互；</li></ul><h3 id="dod与osi">8.DoD与OSI <a id="xieyi"></a></h3><blockquote><p><em>TCP/IP协议簇</em>（Transmission Control Protocol/InternetProtocol）最早发源于美国国防部(缩写为DoD)的因特网的前身ARPA网项目,1983年1月1日取代旧的网络控制协议NCP,成为今天的互联网和局域网的基石和标准 定义了四层:<strong>应用层、传输层、Internet层、网络访问层</strong>对应OSI的(应用层、表示层、会话层)、传输层、网络层、(数据链路层、物理层);下层为上层提供服务, 体现出上层的类型；</p></blockquote><ul><li><p>模型<br /><img src="/posts/ffc70460/CCNA-1.png" class="" title="[DoD模型与OSI]"><br /><img src="/posts/ffc70460/CCNA-2.png" class="" title="[DoD模型中的协议]"><br /><img src="/posts/ffc70460/CCNA-3.png" class="" title="[知名端口号]"></p></li><li><p>链路层/网络层协议</p><ul><li><strong>地址解析协议(ARP)</strong>：根据已知的IP地址查找主机的硬件地址，其工作原理如下:IP需要发送数据报时，它必须将目标端的硬件地址告知网络接入层协议，如以太网或无线。(上层协议已经将目标端的IP地址告诉它)，如果IP 在ARP 缓存中没有找到目标主机的硬件地址，它将使用ARP获悉这种信息。(<strong>在TCP/IP模型中，ARP协议属于IP层；在OSI模型中，ARP协议属于链路层</strong>)</li><li><strong>RARP（Reverse Address ResolutionProtocol，反向地址转换协议）</strong>：用于实现物理地址向逻辑地址转换。</li></ul></li><li><p>传输层协议(TCP UDP)：</p><ul><li><p><code>TCP</code> 和<code>UDP</code>必须使用<strong>端口号与上层通信</strong>，因为端口号跟踪通过网络同时进行的不同会话。据端口号是源主机动态分配的，其值不小于1024<br /></p></li><li><p>TCP（Transmission ControlProtocol，传输控制协议）功能和特点：用于在不可靠网络上<code>提供可靠</code>的端到端字节流传输服务，<code>面向连接</code>的，通信双方采用<code>三次握手协议</code>建立双方的连接，实现通信，能够提供可靠的交付，数据传输的单位是报文段（segment）</p><img src="/posts/ffc70460/TCP%E6%8A%A5%E5%A4%B4.jpg" class="" title="[TCP报头]"><img src="/posts/ffc70460/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.jpg" class="" title="[TCP三次握手]"><img src="/posts/ffc70460/TCP%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.jpg" class="" title="[TCP四次挥手]"><img src="/posts/ffc70460/TCP.png" class="" title="[TCP]"></li><li><p>UDP（User DatagramProtocol：用户数据报协议）功能和特点：<code>无连接</code>的，即传输数据前发送端和接收端不建立连接，只负责将应用程序传给传输层的数据发送出去，不保证他们能可靠交付目的地，只提供尽最大努力交付，数据传输的单位使用户数据报，可靠性欠佳，但通信开销较小，应用于一些可靠性要求不高的地方，如视频点播。</p><img src="/posts/ffc70460/UDP%E6%8A%A5%E5%A4%B4.jpg" class="" title="[UDP报头]"></li></ul></li><li><p>应用层协议：</p><ul><li>DNS（<code>Domain Name System</code>，实现域名到IP地址的解析）概述：TCP/IP协议创建了一种ASCII码形式的主机命名形式，称为域名（DomainName），例如贵州大学主页域名www.gzu.edu.cn, IP地址是210.40.0.58.DNS是一种分布式的网络目录服务，可以实现域名解析为IP地址,使用<strong>UDP的53号端口</strong>进行通信。</li><li>HTTP（<code>HyperText Transfer Protocol</code>，超文本传输协议）概述：是<code>应用层</code>上一种请求/响应式的协议，实现客户端与服务器的通信，WWW发布信息的主要协议。HTTP通过URL（统一资源定位符）来定位Web服务器资源。URL是Internet上用来描述信息资源的字符串，包括服务器的域名（或IP地址）、目录和文件，默认连接<code>端口是TCP 80</code>。</li><li>FTP（ <code>File Transfer Protocol</code>，文件传送协议）概述：FTP是因特网上使用得最广泛的文件传送协议，<code>采用C/S工作模式。通过建立TCP连接</code>，使网络上不同主机之间能够进行高效的文件传输，实现文件资源共享和信息传递。FTP客户端先通过<code>TCP 21号端口建立控制连接，传输控制信息</code>，在控制连接建立的基础上，每当客户端要下载或上传文件时，再通过<code>TCP 20号端口建立数据连接，传输数据</code>。</li><li>TFTP（<code>Trivial File Transfer Protocol</code>,简单文件传送协议）TFTP是一个很小且易于实现的文件传送协议。<code>TFTP 采用C/S方式，使用 UDP 数据报</code>，因此TFTP 需要有自己的差错改正措施。TFTP 只支持文件传输而不支持交互。TFTP没有一个庞大的命令集，没有列目录的功能，也不能对用户进行身份鉴别。使用<code>UDP69端口</code>进行通信，利用确认和超时重传机制保证传输的可靠性。</li><li>DHCP/BOOTP（<code>Dynamic Host Configuration Protocol</code>，动态主机分配协议，BootstrapProtocol自举协议）概述：<code>BOOTP是一种基于UDP的协议</code>，主要用于无盘工作站从服务器获得自己的IP地址。DHCP是从原来的BOOTP协议发展而来的，引入“租约“概念，分为两部分：服务器端和客户端。DHCP服务器集中管理IP地址的动态分配以及网络上启用DHCP客户端的其他相关配置信息，并负责处理客户端的DHCP要求；而客户端则使用服务器端分配下来的IP网络配置数据，<code>UDP 67 用于DHCP服务器，UDP 68用于DHCP客户端</code></li><li>SMTP协议：<code>Simple Mail Transfer Protocol</code>，简单邮件传输协议，建立在<code>TCP基础上，连接端口为25</code>。发信人向源邮件服务器<code>发送邮件</code>使用SMTP 协议。</li><li>POP协议：<code>Post Office Protocol</code>，邮局协议，建立在TCP上，不支持在线阅读，为邮件读取协议，允许用户自己将邮件下载到本地磁盘，再对邮件进行阅读、修改等操作，现在使用的是它的第三个版本POP3，<code>POP3 服务默认的TCP端口号是110</code>；</li><li>IMAP：<code>Internet Mail Access Protocol</code>,交互式邮件存取协议,一种比POP更高级的消息访问管理协议，建立在TCP连接基础上；</li><li>Telnet：<code>TCP/IP Terminal Emulation Protocol</code>,TCP/IP终端仿真协议，Telnet是标准的提供远程登陆功能的应用，能够运行于不同操作系统的主机之间。用户通过Telnet就可在其所在地通过 TCP连接注册（即登录）到远地的另一个主机上（使用主机名或 IP 地址）。TELNET能将用户的击键传到远地主机，同时也能将远地主机的输出通过 TCP连接返回到用户屏幕。这种服务是透明的，因为用户感觉到好像键盘和显示器是直接连在远地主机上，<code>默认使用TCP23号端口</code>；<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">端口号总结</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">DNS</span><span class="hljs-punctuation">:</span> <span class="hljs-string">默认UDP 53号端口</span><br>  <span class="hljs-attribute">TFTP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">默认UDP 69端口</span><br>  <span class="hljs-attribute">DHCP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">默认UDP 67端口 用于DHCP服务器, UDP 68端口用于DHCP客户端</span><br>  <span class="hljs-attribute">http</span><span class="hljs-punctuation">:</span> <span class="hljs-string">默认TCP 80端口</span><br>  <span class="hljs-attribute">SMTP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">默认TCP 25端口</span><br>  <span class="hljs-attribute">POP3</span><span class="hljs-punctuation">:</span> <span class="hljs-string">默认TCP 110端口</span><br>  <span class="hljs-attribute">Telnet</span><span class="hljs-punctuation">:</span> <span class="hljs-string">默认TCP 23号端口</span><br>  <span class="hljs-attribute">FTP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">客户端先通过TCP 21号端口建立控制连接, 传输控制信息, </span><br>  TCP 20号端口建立数据连接，传输数据。<br></code></pre></td></tr></table></figure></li></ul><img src="/posts/ffc70460/CCNA-6.png" class="" title="[各个层相关协议]"></li></ul><h3 id="常用网络命令">9. 常用网络命令：<a id="command"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">ping：连通性测试，用于测试本机主机名和IP地址，验证与远程主机的连接<br>  -t   <span class="hljs-comment"># 不间断ping该IP地址</span><br>  -a   <span class="hljs-comment"># 将地址解析成计算机名</span><br>  -n  count    <span class="hljs-comment"># 发送count个数据包探测</span><br>  -i  <span class="hljs-keyword">time</span>     <span class="hljs-comment"># TTL = time </span><br><br>ifconfig： 排除DNS域名解析故障<br>  ipconfig /flushdhs    <span class="hljs-comment"># 刷新DNS解析器缓存</span><br><br>traceroute IP           <span class="hljs-comment"># 显示数据包所经过的路由器IP地址</span><br><br>arp： 用于显示和修改IP和物理地址的映射表，ARP表<br>  -a<span class="hljs-comment"># 查看地址解析表，后可跟IP地址</span><br>  -s<span class="hljs-comment"># 在arp缓存中添加项，-d 删除</span><br> <br>netstat：显协议统计信息和当前TCP/IP连接<br>  -a <span class="hljs-comment"># 显示所有连接监听端口</span><br>  -n<span class="hljs-comment"># 以数字形式监听IP地址和端口号</span><br>  -s <span class="hljs-comment"># 按各协议分别显示统计数据</span><br>  -r <span class="hljs-comment"># 显示路由表</span><br>  -e<span class="hljs-comment"># 显示以太网卡统计数据</span><br><br>nmap  端口扫描工具<br>  -sP // 探测网络主机工作状态<br>  -sT //  扫描TCP协议端口<br></code></pre></td></tr></table></figure><h3 id="关于vmware-三种网络方式">10. 关于VMware三种网络方式：<a id="VMware"></a></h3><h4 id="桥接模式bridged-vmnet0">桥接模式(Bridged), VMnet0：</h4><img src="/posts/ffc70460/VMnet0.png" class="" title="[桥接模式]"><ul><li>抽象为体现在物理机的网卡为<code>VMnet0</code>；</li><li>原理：桥接模式就是将主机网卡与虚拟机虚拟的网卡利用虚拟网桥进行通信；<br /></li><li>在桥接的作用下，物理主机虚拟为一个<strong>交换机</strong>，所有桥接设置的虚拟机连接到这个交换机的一个接口上，物理主机也同样插在这个交换机当中，所以所有桥接下的网卡与网卡都是交换模式的，相互可以访问而不干扰。在桥接模式下，<strong>虚拟机ip地址需要与主机在同一个网段，如果需要联网，则网关与DNS需要与主机网卡一致</strong>。网关（Gateway）就是一个网络连接到另一个网络的“关口”，工作在网络层及之上</li></ul><h4 id="主机模式host-only-vmnet1">主机模式(Host-only), VMnet1：</h4><img src="/posts/ffc70460/VMnet1.png" class="" title="[主机模式]"><ul><li>体现在物理机的网卡为<code>VMnet1</code>；</li><li>原理：Host-Only模式其实就是NAT模式去除了虚拟NAT设备，然后使用<strong>VMwareNetwork AdapterVMnet1</strong>虚拟网卡连接VMnet1虚拟交换机来与虚拟机通信的，<strong>Host-Only模式将虚拟机与外网隔开</strong>，使得虚拟机成为一个独立的系统，只与主机相互通讯；<br /></li><li>要使得虚拟机能联网，可以将主机网卡共享给VMware Network AdapterVMnet1网卡，从而达到虚拟机联网的目的；</li></ul><h4 id="nat模式地址转换vmnet8">NAT模式(地址转换),VMnet8：</h4><img src="/posts/ffc70460/VMnet8.png" class="" title="[NAT模式]"><ul><li>体现在物理机的网卡为<code>VMnet8</code>；</li><li>原理：在NAT模式中，主机网卡直接与虚拟NAT设备相连，然后虚拟NAT设备与虚拟DHCP服务器一起连接在虚拟交换机VMnet8上，这样就实现了虚拟机联网；</li><li><code>VMware Network Adapter VMnet8</code>的作用是主机与虚拟机之间的通信；</li></ul><h3 id="路由表构成route--n">11.路由表构成(route -n)<a id="luyoubiao"></a></h3><ul><li><p><code>Destination</code>：数据包的发送路径(主路由、网络路由、默认路由)<br /></p></li><li><p><code>Netmask</code></p></li><li><p><code>Interface</code>：本路由器的出口</p></li><li><p><code>Gateway</code></p><ul><li>直连网络不用配置<br /></li><li>非直连: 下一个路由器邻近本路由器的接口地址 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Kernel IP routing table  <br>Destination   Gateway         Genmask        Flags   Metric    Ref   Use   Iface  <br>192.168.1.0   172.16.0.1      255.255.255.0  UG      0         0     0     eth0   <br>172.16.0.0    0.0.0.0         255.255.0.0    U       0         0     0     eth0<br>10.0.0.0      0.0.0.0         255.0.0.0      U       0         0     0     eth1 <br></code></pre></td></tr></table></figure></li></ul></li><li><p>route记录更改</p><table><thead><tr><th>子命令/参数</th><th>说明</th></tr></thead><tbody><tr><td>-n</td><td>直接使用IP地址，不进行DNS解析主机</td></tr><tr><td>add</td><td>添加路由信息</td></tr><tr><td>del</td><td>删除路由信息</td></tr><tr><td>-net</td><td>到一个网路的路由，后接网络号地址</td></tr><tr><td>-host</td><td>到一个主机路由，后接主机地址</td></tr><tr><td>netmask</td><td>为添加的路由指定子网掩码</td></tr><tr><td>gw</td><td>为发往目标网络/主机的任何分组指定网关</td></tr><tr><td>dev</td><td>指定由哪个网络设备出去，后接网络设备名</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">route add -net 100.0.0.0 netmask 255.0.0.0 gw 192.168.30.200  <span class="hljs-comment"># 网络路由</span><br>route add default gw 192.168.30.2 <span class="hljs-comment"># 默认路由 0.0.0.0 </span><br>route add -host 6.6.6.6 gw 3.3.3.100  <span class="hljs-comment"># 主机路由</span><br>route del default gw 192.168.30.2  <br>route del -host 6.6.6.6<br><br><span class="hljs-comment"># 使用 route添加路由时，设定的路由必须与自己系统的网络接口或者IP可以直接互通，才能添加成功；  </span><br><span class="hljs-comment"># IP地址是属于主机的，而不是网卡； </span><br></code></pre></td></tr></table></figure></li></ul><h3 id="ip命令">15.ip命令 <a id="ip-cmd"></a></h3><ul><li>Usage：ip [option] OBJECT [COMMAND | help]<ul><li><p>ip link <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ip -s <span class="hljs-built_in">link</span> show<br>ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> DEVICE [up|down]<br></code></pre></td></tr></table></figure></p></li><li><p>ip addr <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ip addr add 10.2.2.2/8 dev eth1 label eth1:1<br>ip addr del ADDRESS dev DEV<br>ip addr show dev DEV to PREFIX<br>ip addr flush dev DEV to PREFIX<br></code></pre></td></tr></table></figure></p></li><li><p>ip route <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ip route add to 10.2.2.2/8 dev eth0 via 192.168.10.1<br>ip route show <br>ip route flush<br></code></pre></td></tr></table></figure></p></li></ul></li></ul><p><a href="#top" target="_self">返回顶部</a></p>]]></content>
    
    
    <categories>
      
      <category>CRH</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CCNA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>搭建个人博客</title>
    <link href="/posts/c442673f.html"/>
    <url>/posts/c442673f.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-08-搭建博客 <span id="more"></span></p><h2 id="基础搭建">基础搭建</h2><h3id="创建一个仓库用于存放个人博客文件">创建一个仓库，用于存放个人博客文件</h3><ul><li><p>在Github首页右上角头像左侧加号点选择 Newrepositor(新存储库)或点击这里进行创建一个仓库. <img src="/posts/c442673f/01-CreateBlog.jpg" class="" title="创建仓库"></p></li><li><p>开启Github Pages <img src="/posts/c442673f/02-CreateBlog.jpg" class="" title="创建仓库"></p></li><li><p>进入仓库设置项，进行主题的选择 <img src="/posts/c442673f/03-CreateBlog.jpg" class="" title="创建仓库"></p></li></ul><h2 id="hexo-的搭建">Hexo 的搭建</h2><blockquote><p>Hexo是一个简单、快速、强大的基于 Github Pages的博客发布工具，支持<code>Markdown</code>格式，有众多优秀插件和主题。</p></blockquote><h3 id="安装-node.js">安装 Node.js</h3><h5id="linux类linux下利用nvm安装node比较好httpsgithub.comnvm-shnvm">Linux/类Linux下利用nvm安装Node比较好，<ahref="https://github.com/nvm-sh/nvm">https://github.com/nvm-sh/nvm</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl https://raw.github.com/creationix/nvm/v0.33.11/install.sh | sh<br>$ wget -qO- https://raw.github.com/creationix/nvm/v0.33.11/install.sh | sh<br></code></pre></td></tr></table></figure><h5id="windows下nvm安装配置httpsgithub.comcoreybutlernvm-windows">Windows下nvm安装配置，<ahref="https://github.com/coreybutler/nvm-windows">https://github.com/coreybutler/nvm-windows</a></h5><blockquote><p>nvm 安装好后，利用 nvm 相关命令安装node.js<br /><ahref="https://blog.csdn.net/qq_27626333/article/details/77857223">参考配置nvm</a><br /><ahref="https://www.cnblogs.com/wyy1234/p/9727142.html">参考cnblog博客</a></p></blockquote><ul><li><p>配置nvm安装目录下的 settings.txt <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ root: F:\Design\nvm<br>$ path: F:\Design\nodejs<br>$ <span class="hljs-built_in">arch</span>: 64 <br>$ proxy: none <br>$ node_mirror: https://npm.taobao.org/mirrors/node/<br>$ npm_mirror: https://npm.taobao.org/mirrors/npm/<br></code></pre></td></tr></table></figure></p></li><li><p>配置用npm下载包时全局安装的包路径 <figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">$ npm config set prefix “F:\Design<span class="hljs-symbol">\n</span>vm<span class="hljs-symbol">\n</span>pm”<br>$ <span class="hljs-variable">%NPM_HOME%</span>=F:\Design<span class="hljs-symbol">\n</span>vm<span class="hljs-symbol">\n</span>pm<br></code></pre></td></tr></table></figure></p></li><li><p>配置国内仓库<br /><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$ npm install -<span class="hljs-selector-tag">g</span> cnpm <span class="hljs-attr">--registry</span>=https:<span class="hljs-comment">//registry.npm.taobao.org</span><br></code></pre></td></tr></table></figure></p></li></ul><p>:link:<ahref="https://npm.taobao.org/mirrors/node/">淘宝Node镜像</a><br />:link:<a href="https://npm.taobao.org/mirrors/npm/">淘宝Npm镜像</a></p><h3 id="nvm-命令">nvm 命令</h3><table><thead><tr><th style="text-align: left;">命令</th><th style="text-align: left;">说明</th></tr></thead><tbody><tr><td style="text-align: left;">nvm arch 32/64</td><td style="text-align: left;">显示Node是以32位还是64位模式运行</td></tr><tr><td style="text-align: left;">nvm install <version> [arch]</td><td style="text-align: left;">下载需要的Node版本,默认64位</td></tr><tr><td style="text-align: left;">nvm list [available]</td><tdstyle="text-align: left;">列出node.js安装,在末尾输入可用的类型以显示可供下载的版本列表</td></tr><tr><td style="text-align: left;">nvm on</td><td style="text-align: left;">启用版本管理</td></tr><tr><td style="text-align: left;">nvm off</td><td style="text-align: left;">禁用版本管理</td></tr><tr><td style="text-align: left;">nvm proxy [url]</td><tdstyle="text-align: left;">设置代理,留空以查看当前代理,设置为“none”以删除代理</td></tr><tr><td style="text-align: left;">nvm uninstall <version></td><td style="text-align: left;">卸载指定版本</td></tr><tr><td style="text-align: left;">nvm use <version> [arch]</td><td style="text-align: left;">使用指定Node版本,可以指定位数</td></tr><tr><td style="text-align: left;">nvm root [path]</td><td style="text-align: left;">设置nvm应存储不同版本node.js的目录</td></tr><tr><td style="text-align: left;">nvm version</td><td style="text-align: left;">显示当前的 nvm 版本</td></tr><tr><td style="text-align: left;">nvm node_mirror <node_mirror_url></td><td style="text-align: left;">Set the node mirror(China)</td></tr><tr><td style="text-align: left;">nvm npm_mirror <npm_mirror_url></td><td style="text-align: left;">–</td></tr></tbody></table><h3 id="安装-hexo">安装 Hexo</h3><p><a href="https://hexo.io/zh-cn/docs/">Hexo官方参考文档</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm install -g hexo-cli<br>$ hexo init &lt;folder&gt;  // 必须为空目录<br>$ <span class="hljs-built_in">cd</span> &lt;folder&gt;<br>$ npm install<br>.<br>├── _config.yml<br>├── package.json<br>├── scaffolds<br>├── <span class="hljs-built_in">source</span><br>|   ├── _drafts<br>|   └── _posts<br>└── themes<br><br>$ hexo new [layout] &lt;title&gt;  <span class="hljs-comment"># hexo new &quot;post title with whitespace&quot;  </span><br>$ hexo g  <span class="hljs-comment"># generate 网页文件</span><br>$ hexo s  <span class="hljs-comment"># server https://localhost:4000 预览网页</span><br>$ hexo clean <br>$ hexo d  <span class="hljs-comment"># deployer push 到仓库</span><br></code></pre></td></tr></table></figure></p><h3id="配置优化hexo命令都是在博客主目录执行">配置优化Hexo(命令都是在博客主目录执行)</h3><h4 id="配置_config.yml">配置_config.yml</h4><p>:link:<ahref="https://github.com/cczeng/BlogBackup/blob/master/_config.yml">参考配置</a>#### 安装<code>hexo-deployer-git</code>扩展 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm install hexo-deployer-git --save<br>  <br>deploy:<br><span class="hljs-built_in">type</span>: git<br>repo: git@github.com:anyue967/anyue967.github.io.git<br>branch: master<br></code></pre></td></tr></table></figure></p><h4 id="添加插件">添加插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm install hexo-helper-live2d --save<br></code></pre></td></tr></table></figure><p>:link:<a href="https://github.com/EYHN/hexo-helper-live2d">参考官方live-2d配置文件</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm install hexo-generator-search --save<br><br>search:<br>path: search.xml<br>field: post<br>format: html<br><span class="hljs-built_in">limit</span>: 10000<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm install hexo-filter-optimize --save<br></code></pre></td></tr></table></figure><h2 id="npm-nodejs-package-manager相关命令">npm (Nodejs PackageManager)相关命令</h2><table><thead><tr><th style="text-align: left;">命令</th><th style="text-align: left;">说明</th></tr></thead><tbody><tr><td style="text-align: left;">npm -v</td><td style="text-align: left;">查询node版本</td></tr><tr><td style="text-align: left;">npm install xx -g</td><tdstyle="text-align: left;">全局安装模块,如:<code>gulp@3.9.1</code></td></tr><tr><td style="text-align: left;">npm install xx –save</td><td style="text-align: left;">本地安装模块并写入 json配置</td></tr><tr><td style="text-align: left;">npm search xx</td><td style="text-align: left;">搜索模块</td></tr><tr><td style="text-align: left;">npm outdated</td><td style="text-align: left;">过时模块</td></tr><tr><td style="text-align: left;">npm update xx</td><td style="text-align: left;">更新模块</td></tr><tr><td style="text-align: left;">npm search xx</td><td style="text-align: left;">搜索模块</td></tr><tr><td style="text-align: left;">npm cache clear</td><td style="text-align: left;">清空本地缓存</td></tr><tr><td style="text-align: left;">npm uninstall xx</td><td style="text-align: left;">卸载模块</td></tr><tr><td style="text-align: left;">npm list -g | grep xx</td><td style="text-align: left;">查找全局安装模块</td></tr><tr><td style="text-align: left;">npm list xx</td><td style="text-align: left;">查看模块版本号</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm config <span class="hljs-built_in">set</span> prefix “F:\Design\nvm\npm”      <span class="hljs-comment"># 配置用npm下载模块时全局安装的包路径</span><br>$ npm config <span class="hljs-built_in">set</span> proxy=http://xxx               <span class="hljs-comment"># 设置代理</span><br>$ npm config <span class="hljs-built_in">set</span> registry=<span class="hljs-string">&quot;http://r.cnmpjs.org&quot;</span>     <span class="hljs-comment"># 设置镜像仓库</span><br>$ npm install -g cnpm --registry=https://registry.npm.taobao.org`  <span class="hljs-comment"># 使用淘宝镜像命令</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm cache add &lt;tarball file&gt;<br>$ npm cache add &lt;folder&gt;<br>$ npm cache add &lt;tarball url&gt; <br>$ npm cache add &lt;git url&gt; <br>$ npm cache add &lt;name&gt;@&lt;version&gt;  <br>$ npm cache clean <br>$ npm cache verify  <br><br>npm start<br>npm stop<br>npm restart<br></code></pre></td></tr></table></figure><h2 id="nrm-的安装和使用">nrm 的安装和使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install nrm -g    <span class="hljs-comment"># 全局安装nrm  </span><br>nrm <span class="hljs-built_in">ls</span>    <span class="hljs-comment"># 列出可用的镜像源  </span><br><br>  * npm -------- https://registry.npmjs.org/<br>    yarn ------- https://registry.yarnpkg.com/<br>    cnpm ------- http://r.cnpmjs.org/<br>    taobao ----- https://registry.npm.taobao.org/<br>    nj --------- https://registry.nodejitsu.com/<br>    npmMirror -- https://skimdb.npmjs.com/registry/<br>    edunpm ----- http://registry.enpmjs.org/<br>nrm use taobao    <span class="hljs-comment"># 选择国内淘宝镜像源</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CRH</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Blog</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hello-world</title>
    <link href="/posts/b1d4025b.html"/>
    <url>/posts/b1d4025b.html</url>
    
    <content type="html"><![CDATA[<p>2019-06-02-hello-world <span id="more"></span></p><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your veryfirst post. Check <a href="https://hexo.io/docs/">documentation</a> formore info. If you get any problems when using Hexo, you can find theanswer in <ahref="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> oryou can ask me on <ahref="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start">Quick Start</h2><h3 id="create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p><h3 id="数学公式-latex">数学公式 LaTex</h3><p>基于 MathJax 引擎：</p><p><spanclass="math display">6CO<sub>2</sub> + 6H<sub>2</sub>O → C<sub>6</sub>H<sub>12</sub>O<sub>6</sub> + 6O<sub>2</sub></span></p><p><span class="math display">$$\Gamma _ { \epsilon } ( x ) = [ 1- e ^ { - 2\pi \epsilon } ] ^ { 1- x }\prod _ { n = 0} ^ { \infty } \frac { 1- \operatorname{exp} ( - 2\pi\epsilon ( n + 1) ) } { 1- \operatorname{exp} ( - 2\pi \epsilon ( x + n) ) }$$</span></p><h3 id="流程图">流程图</h3><p>基于 mermaid 语法：</p><pre><code class=" mermaid">sequenceDiagramparticipant Aliceparticipant BobAlice-&gt;&gt;John: Hello John, how are you?loop Healthcheck    John-&gt;&gt;John: Fight against hypochondriaendNote right of John: Rational thoughts &lt;br/&gt;prevail...John--&gt;&gt;Alice: Great!John-&gt;&gt;Bob: How about you?Bob--&gt;&gt;John: Jolly good!</code></pre><pre><code class=" mermaid">ganttdateFormat  YYYY-MM-DDtitle Adding GANTT diagram to mermaidsection A sectionCompleted task            :done,    des1, 2014-01-06,2014-01-08Active task               :active,  des2, 2014-01-09, 3dFuture task               :         des3, after des2, 5dFuture task2               :         des4, after des3, 5d</code></pre><pre><code class=" mermaid">classDiagramClass01 &lt;|-- AveryLongClass : CoolClass03 *-- Class04Class05 o-- Class06Class07 .. Class08Class09 --&gt; C2 : Where am i?Class09 --* C3Class09 --|&gt; Class07Class07 : equals()Class07 : Object[] elementDataClass01 : size()Class01 : int chimpClass01 : int gorillaClass08 &lt;--&gt; C2: Cool label</code></pre><h3 id="参考">参考</h3><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>参考资料1<a href="#fnref:1" rev="footnote" class="footnote-backref">↩︎</a></span></span></li><li><span id="fn:2" class="footnote-text"><span>参考资料2<a href="#fnref:2" rev="footnote" class="footnote-backref">↩︎</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>博客</category>
      
    </categories>
    
    
    <tags>
      
      <tag>博客搭建</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
